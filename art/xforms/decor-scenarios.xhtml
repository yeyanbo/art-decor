<!--
    Copyright (C) 2011-2014 ART-DECOR expert group art-decor.org
    
    Author: Gerrit Boers, Kai U. Heitmann
    
    This program is free software; you can redistribute it and/or modify it under the terms of the
    GNU Lesser General Public License as published by the Free Software Foundation; either version
    2.1 of the License, or (at your option) any later version.
    
    This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
    without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
    See the GNU Lesser General Public License for more details.
    
    The full text of the license is available at http://www.gnu.org/copyleft/lesser.html
-->
<xhtml:html xmlns:f="http://orbeon.org/oxf/xml/formatting" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:fr="http://orbeon.org/oxf/xml/form-runner" xmlns:xxforms="http://orbeon.org/oxf/xml/xforms" xmlns:widget="http://orbeon.org/oxf/xml/widget" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.w3.org/1999/xhtml https://raw.github.com/orbeon/orbeon-forms/master/src/main/resources/org/orbeon/oxf/xml/schemas/xhtml1-transitional-orbeon.xsd">
    <xhtml:head>
        <xhtml:title>
            <xforms:output ref="if (instance('project-instance')/name[@language=$resources/@xml:lang]) then (instance('project-instance')/name[@language=$resources/@xml:lang]) else (instance('project-instance')/name[1])"/> - 
            <xforms:output ref="$resources/scenarios"/>
        </xhtml:title>
        <xhtml:style type="text/css">
            .xforms-repeat-selected-item-2 { 
                font-weight: normal; 
                background-color: inherit;
                color: black;
            }
           .labelouterboxitem {
                background-color: white;
                color: black;
                font-weight: bold;
                font-size: smaller;
                border: 1px solid grey;
                margin: 0px;
                padding: 0px;
                display: inline;
            }
        </xhtml:style>
        <xforms:model id="decor-scenarios">
         <!-- Variable with path to art-external-exist for use by html -->
            <xxforms:variable name="art-external-exist" select="xxforms:property('art.external.exist.url')"/>
         <!-- Variable with path to art-exist for use by form -->
            <xxforms:variable name="art-exist" select="xxforms:property('art.exist.url')"/>
         <!-- Variable with path to decor-external-exist used to pass to client as link for services (Diagrams in new window) -->
            <xxforms:variable name="decor-external-exist" select="xxforms:property('decor.external.exist.url')"/>
         <!-- resources for internationalization -->
            <xforms:instance id="resources-instance">
                <dummy/>
            </xforms:instance>
         <!-- submission for loading resources -->
            <xforms:submission id="get-resources-submission" serialization="none" method="get" resource="{$art-exist}/modules/get-form-resources.xquery" replace="instance" instance="resources-instance"/>
         <!-- language -->
            <xforms:instance id="language">
                <language/>
            </xforms:instance>
            
         <!-- instance for user-agent, used to check if SVG links should be available -->
            <xforms:instance id="user-agent">
                <agent/>
            </xforms:instance>

         <!-- instance for edit status -->
            <xforms:instance id="data-safe">
                <data-safe>true</data-safe>
            </xforms:instance>
         <!-- instance for actors edit status -->
            <xforms:instance id="actors-safe">
                <data-safe>true</data-safe>
            </xforms:instance>

         <!-- instance for document name -->
            <xforms:instance id="document">
                <name>test-decor</name>
            </xforms:instance>

         <!-- instance for DECOR Schema -->
            <xforms:instance id="decor-types">
                <dummy/>
            </xforms:instance>
         <!-- get decor schema enumerations submission -->
            <xforms:submission id="get-decor-schema-types" serialization="none" method="get" resource="{$art-exist}/modules/get-decor-schema-types.xquery" replace="instance" instance="decor-types" xxforms:readonly="true"/>
            
         <!-- warning message texts -->
            <xforms:instance id="messages" xxforms:exclude-result-prefixes="#all">
                <messages>
                    <edit-warning language="nl-NL">
                        <div class="h2">De statuscode van deze transactie is 'Definitief'</div>
                        <p>Er zijn twee mogelijkheden bij het aanmaken van een nieuwe transactie:</p>
                        <ul>
                            <li> Nieuwe versie - Er wordt een nieuwe versie gecreërd met dezelfde Id. Als de nieuwe transactie de huidige gaat vervangen dan dient deze optie gebruikt te worden. </li>
                            <li> Bewerking - Er wordt een nieuwe waardelijst gecreëerd met een nieuwe Id. Deze optie dient gebruikt te worden als er een nieuwe transactie wordt gemaakt op basis van de huidige. </li>
                        </ul>
                    </edit-warning>
                    <edit-warning language="en-US">
                        <div class="h2">The statuscode of this transaction is 'Final'</div>
                        <p>There are two alternatives for creating the new transaction</p>
                        <ul>
                            <li> Version - A new version is created with the same Id. Choose this option if the new transaction replaces the existing one. </li>
                            <li> Adaptation - A new value set is created with a new Id. This option should be used if a new transaction is created based on the existing transaction. </li>
                        </ul>
                    </edit-warning>
                    <edit-warning language="de-DE">
                        <div class="h2">The statuscode of this transaction is 'Final'</div>
                        <p>There are two alternatives for creating the new transaction</p>
                        <ul>
                            <li> Version - A new version is created with the same Id. Choose this option if the new transaction replaces the existing one. </li>
                            <li> Adaptation - A new value set is created with a new Id. This option should be used if a new transaction is created based on the existing transaction. </li>
                        </ul>
                    </edit-warning>
                    <edit-warning language="pl-PL">
                        <div class="h2">The statuscode of this transaction is 'Final'</div>
                        <p>There are two alternatives for creating the new transaction</p>
                        <ul>
                            <li> Version - A new version is created with the same Id. Choose this option if the new transaction replaces the existing one. </li>
                            <li> Adaptation - A new value set is created with a new Id. This option should be used if a new transaction is created based on the existing transaction. </li>
                        </ul>
                    </edit-warning>
                    <status-final language="nl-NL">
                        <p>Let op: deze handeling kan niet ongedaan gemaakt worden en wordt direct toegepast!</p>
                    </status-final>
                    <status-final language="en-US">
                        <p>Beware: this action cannot be undone and is immediately applied!</p>
                    </status-final>
                    <status-final language="de-DE">
                        <p>Achtung: diese Aktion kann nicht rückgängig gemacht werden und werd sofort gespeichert!</p>
                    </status-final>
                    <status-final language="pl-PL">
                        <p>Beware: this action cannot be undone and is immediately applied!</p>
                    </status-final>
                    <status-locked language="nl-NL">
                        <p>De statuswijziging kon niet (recursief) worden toegepast omdat er nog tenminste één lock op staat. <br/>Ook als dit uw lock is, moet u deze eerst afhandelen alvorens de statuswijziging te doen.</p>
                    </status-locked>
                    <status-locked language="en-US">
                        <p>The status change could not be applied (recursively) because there is still at least one lock. <br/>Even if this is your own lock you should first deal with that before applying the status change.</p>
                    </status-locked>
                    <status-locked language="de-DE">
                        <p>The status change could not be applied (recursively) because there is still at least one lock. <br/>Even if this is your own lock you should first deal with that before applying the status change.</p>
                    </status-locked>
                    <status-locked language="pl-PL">
                        <p>The status change could not be applied (recursively) because there is still at least one lock. <br/>Even if this is your own lock you should first deal with that before applying the status change.</p>
                    </status-locked>
                </messages>
            </xforms:instance>
         <!-- instance for project information -->
            <xforms:instance id="project-instance">
                <dummy/>
            </xforms:instance>
         <!-- get decor project submission -->
            <xforms:submission id="get-decor-project-submission" serialization="none" method="get" resource="{$art-exist}/modules/get-decor-project.xq?project={instance('document')}" replace="instance" instance="project-instance" xxforms:readonly="true"/>

         <!-- navigation -->
            <xforms:instance id="scenario-navigation">
                <id/>
            </xforms:instance>
            
         <!-- visibility, determines visibility for elements based on their id
             example call: <xforms:group ref=".[instance('visibility')/id[@id='...']='true']">...</xforms:group>
         -->
            <xforms:instance id="visibility">
                <visibility>
                    <element id="scenariotree">true</element>
                    <element id="scenarioshow">false</element>
                </visibility>
            </xforms:instance>
            
         <!-- instance for scenarios -->
            <xforms:instance id="scenarios-instance">
                <dummy/>
            </xforms:instance>
         <!-- event observer for scenarios changes -->
            <xforms:action ev:observer="scenarios-instance" ev:event="xforms-insert xforms-delete xxforms-value-changed">
                <xforms:setvalue ref="instance('data-safe')">false</xforms:setvalue>
            </xforms:action>
            <xforms:bind nodeset="instance('scenarios-instance')//@isMandatory" type="xs:boolean"/>
            
         <!-- get scenarios submission -->
            <xforms:submission id="get-scenarios-submission" serialization="none" method="get" resource="{$art-exist}/modules/get-decor-scenarios.xq?project={instance('document')}" replace="instance" instance="scenarios-instance">
                <xforms:message ev:event="xforms-submit-error" level="modal">
                    A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"/>; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
                </xforms:message>
                <xforms:action ev:event="xforms-submit-done">
                    <xforms:setvalue ref="instance('data-safe')">true</xforms:setvalue>
                    <xforms:action if="not(instance('scenarios-instance')//*[@id=instance('scenario-navigation')])">
                        <xforms:setvalue ref="instance('scenario-navigation')" value="instance('scenarios-instance')//scenario[1]/@id"/>
                    </xforms:action>
                </xforms:action>
            </xforms:submission>
         <!-- save scenarios submission -->
            <xforms:submission id="save-scenarios" ref="instance('scenarios-instance')" resource="{$art-exist}/modules/save-decor-scenarios.xquery" method="post" replace="none" instance="scenarios-instance" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
                <xforms:message ev:event="xforms-submit-error" level="modal">
                    A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"/>; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
                </xforms:message>
            </xforms:submission>
         <!-- instance for new scenario -->
            <xforms:instance id="new-scenario-instance" xxforms:exclude-result-prefixes="#all">
                <scenario effectiveDate="" id="" statusCode="new">
                    <edit mode="edit"/>
                    <name language=""/>
                    <desc language=""/>
                    <transaction id="" type="group" effectiveDate="" statusCode="new" label="">
                        <name language=""/>
                        <desc language=""/>
                        <transaction id="" label="" displayName="" model="" type="initial" effectiveDate="" statusCode="new">
                            <name language=""/>
                            <desc language=""/>
                            <representingTemplate ref="" flexibility="" sourceDataset=""/>
                        </transaction>
                        <transaction id="" label="" displayName="" model="" type="back" effectiveDate="" statusCode="new">
                            <name language=""/>
                            <desc language=""/>
                            <representingTemplate ref="" flexibility="" sourceDataset=""/>
                        </transaction>
                    </transaction>
                </scenario>
            </xforms:instance>
         <!-- instance for new transaction group -->
            <xforms:instance id="new-transaction-group-instance" xxforms:exclude-result-prefixes="#all">
                <transaction id="" type="group" effectiveDate="" statusCode="new" label="">
                    <name language=""/>
                    <desc language=""/>
                    <transaction id="" label="" displayName="" model="" type="initial" effectiveDate="" statusCode="new">
                        <name language=""/>
                        <desc language=""/>
                        <representingTemplate ref="" flexibility="" sourceDataset=""/>
                    </transaction>
                    <transaction id="" label="" displayName="" model="" type="back" effectiveDate="" statusCode="new">
                        <name language=""/>
                        <desc language=""/>
                        <representingTemplate ref="" flexibility="" sourceDataset=""/>
                    </transaction>
                </transaction>
            </xforms:instance>
         <!-- instance for new transaction -->
            <xforms:instance id="new-transaction-instance" xxforms:exclude-result-prefixes="#all">
                <transaction id="" label="" displayName="" model="" type="initial" effectiveDate="" statusCode="new">
                    <name language=""/>
                    <desc language=""/>
                    <representingTemplate ref="" flexibility="" sourceDataset=""/>
                </transaction>
            </xforms:instance>
         
         <!-- STATUS CHANGE -->
         <!-- instance for setting statusCode -->
            <xforms:instance id="status-change" xxforms:exclude-result-prefixes="#all">
                <statusChange ref="" effectiveDate="" statusCode="" versionLabel="" expirationDate="" actionText="" recurse="true"/>
            </xforms:instance>
            <xforms:bind nodeset="instance('status-change')/@expirationDate" type="xforms:date"/>
            <xforms:bind nodeset="instance('status-change')/@recurse" type="xs:boolean"/>
         <!-- instance for statusCode change response -->
            <xforms:instance id="status-response" xxforms:exclude-result-prefixes="#all">
                <dummy/>
            </xforms:instance>
         <!-- set valueset statusCode -->
            <xforms:submission id="set-decor-object-status" ref="instance('status-change')" method="post" xxforms:instance="status-response" resource="{$art-exist}/modules/set-decor-object-status.xquery" replace="instance" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
                <xforms:message ev:event="xforms-submit-error" level="modal">
                    A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"/>; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
                </xforms:message>
                <xforms:message ev:event="xforms-submit-done" if="instance('status-response')[not(* or 'OK')]">
                    <xforms:output value="instance('status-response')"/>
                </xforms:message>
                <xforms:action ev:event="xforms-submit-done" if="instance('status-response')[*]">
                    <xxforms:show dialog="lock-status-dialog"/>
                </xforms:action>
            </xforms:submission>
         
         <!-- *** ACTORS *** -->
         <!-- instance for scenario actors -->
            <xforms:instance id="actors-instance" xxforms:exclude-result-prefixes="#all">
                <dummy/>
            </xforms:instance>
            <xforms:action ev:observer="actors-instance" ev:event="xforms-insert xforms-delete xxforms-value-changed">
                <xforms:setvalue ref="instance('actors-safe')">false</xforms:setvalue>
            </xforms:action>
         <!-- get actors submission -->
            <xforms:submission id="get-actors-submission" serialization="none" method="get" resource="{$art-exist}/modules/get-decor-scenario-actors.xquery?project={instance('document')}" replace="instance" instance="actors-instance">
                <xforms:message ev:event="xforms-submit-error" level="modal">
                    A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"/>; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
                </xforms:message>
                <xforms:action ev:event="xforms-submit-done">
                    <xforms:setvalue ref="instance('actors-safe')">true</xforms:setvalue>
                </xforms:action>
            </xforms:submission>
         <!-- save actors submission -->
            <xforms:submission id="save-actors-submission" ref="instance('actors-instance')" resource="{$art-exist}/modules/save-decor-actors.xquery" method="post" replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
                <xforms:message ev:event="xforms-submit-error" level="modal">
                   A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"/>; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
                </xforms:message>
            </xforms:submission>
         <!-- instance for new actor -->
            <xforms:instance id="new-actor-instance" xxforms:exclude-result-prefixes="#all">
                <actor id="" type="">
                    <name language=""/>
                </actor>
            </xforms:instance>

         <!-- *** DATASETS / CONCEPTS *** -->
         <!-- instance for dataset list -->
            <xforms:instance id="dataset-list">
                <dummy/>
            </xforms:instance>
            <!-- get dataset list submission -->
            <xforms:submission id="get-decor-dataset-list-submission" serialization="none" method="get" resource="{$art-exist}/modules/get-decor-dataset-list.xq?project={instance('document')}" replace="instance" instance="dataset-list"/>
            
         <!-- instance for dataset -->
            <xforms:instance id="dataset-instance">
                <dummy/>
            </xforms:instance>
         <!-- get dataset tree -->
            <xforms:submission id="get-decor-dataset-tree" serialization="none" method="get" resource="{$art-exist}/modules/get-decor-dataset-tree.xquery?transactionId={instance('scenario-navigation')}" replace="instance" instance="dataset-instance"/>
            
         <!-- instance for concept navigation -->
            <xforms:instance id="concept-navigation">
                <id/>
            </xforms:instance>
         <!-- instance for selected concept -->
            <xforms:instance id="selected-concept">
                <dummy/>
            </xforms:instance>
         <!-- get selected concept submission -->
            <xforms:submission id="get-concept" serialization="none" method="get" resource="{$art-exist}/modules/get-decor-concept.xq?id={instance('concept-navigation')}&amp;effectiveDate={instance('dataset-instance')//concept[@id=instance('concept-navigation')]/@effectiveDate}" replace="instance" instance="selected-concept"/>

         <!-- instance for concept terminologyAssociations -->
            <xforms:instance id="concept-associations">
                <dummy/>
            </xforms:instance>
         <!-- get concept associations submission -->
            <xforms:submission id="get-concept-associations" serialization="none" method="get" resource="{$art-exist}/modules/get-decor-concept-associations.xquery?id={instance('concept-navigation')}" replace="instance" instance="concept-associations"/>

         <!-- *** ISSUES *** -->
         <!-- instance for existing issues on a scenario/transaction-group/transaction -->
            <xforms:instance id="scenario-issues-instance">
                <dummy/>
            </xforms:instance>
         <!-- get issues submission -->
            <xforms:submission id="get-issues-submission" serialization="none" method="get" resource="{$art-exist}/modules/get-decor-object-issues.xquery?id={instance('scenario-navigation')}" replace="instance" instance="scenario-issues-instance"/>
            <xforms:instance id="concept-issues-instance">
                <dummy/>
            </xforms:instance>
         <!-- get issues submission -->
            <xforms:submission id="get-concept-issues" serialization="none" method="get" resource="{$art-exist}/modules/get-decor-object-issues.xquery?id={instance('concept-navigation')}" replace="instance" instance="concept-issues-instance"/>
            <xforms:instance id="issue-navigation">
                <issue id="" currentUserIsSubscribed=""/>
            </xforms:instance>
            <xforms:bind nodeset="instance('scenario-issues-instance')">
                <xforms:bind ref="issue/@currentUserIsSubscribed" type="xs:boolean"/>
            </xforms:bind>
            <xforms:bind nodeset="instance('concept-issues-instance')">
                <xforms:bind ref="issue/@currentUserIsSubscribed" type="xs:boolean"/>
            </xforms:bind>
            <xforms:submission id="update-decor-issue-subscription" resource="{$art-exist}/modules/update-decor-issue-subscription.xquery?id={instance('issue-navigation')/@id}&amp;action={if (instance('issue-navigation')/@currentUserIsSubscribed='true') then 'add' else 'delete'}" method="post" replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
                <xforms:message ev:event="xforms-submit-error" level="modal">
                    A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"/>; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
                </xforms:message>
            </xforms:submission>
            <!-- instance for creating issue -->
            <xforms:instance id="issue-instance" xxforms:exclude-result-prefixes="#all">
                <issues>
                    <issue id="" priority="N" displayName="" type="RFC" project="">
                        <object id="" type="" effectiveDate=""/>
                        <tracking effectiveDate="" statusCode="new" labels="" to="">
                            <author id=""/>
                            <desc language=""/>
                        </tracking>
                    </issue>
                </issues>
            </xforms:instance>
         <!-- instance for holding newly created issues -->
            <xforms:instance id="issues-instance" xxforms:exclude-result-prefixes="#all">
                <issues>
                    <issue/>
                </issues>
            </xforms:instance>
         <!-- save issue submission -->
            <xforms:submission id="save-decor-issue-submission" ref="instance('issues-instance')/issue[object/@id=instance('scenario-navigation')]" resource="{$art-exist}/modules/save-decor-issue.xq" method="post" replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
                <xforms:message ev:event="xforms-submit-error" level="modal">
                    A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"/>; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
                </xforms:message>
            </xforms:submission>
            
         <!-- *** TEMPLATES *** -->
         <!-- navigation -->
            <xforms:instance id="template-navigation">
                <id/>
            </xforms:instance>
         <!-- version navigation -->
            <xforms:instance id="version-navigation">
                <effectiveDate/>
            </xforms:instance>
         <!-- instance for DECOR Templates -->
            <xforms:instance id="decor-template-list" xxforms:exclude-result-prefixes="#all">
                <dummy/>
            </xforms:instance>
         <!-- get decor templates submission -->
            <xforms:submission id="get-decor-template-list" serialization="none" method="get" resource="{$art-exist}/modules/get-decor-template-list.xquery?project={instance('document')}&amp;classified=true" replace="instance" instance="decor-template-list"/>
            <xforms:action ev:event="xforms-model-construct-done">
                <xforms:send submission="get-resources-submission"/>
                <xforms:send submission="get-decor-project-submission"/>
                <xforms:setvalue ref="instance('language')" value="if (string-length(xxforms:get-session-attribute('language'))&gt;0) then (xxforms:get-session-attribute('language')) else (instance('project-instance')/@defaultLanguage/string())"/>
                <xforms:setvalue ref="instance('user-agent')" value="xxforms:get-request-header('User-Agent')"/>
                <xforms:send submission="get-decor-schema-types"/>
                <xforms:send submission="get-decor-dataset-list-submission"/>
                <xforms:send submission="get-actors-submission"/>
                <xforms:send submission="get-scenarios-submission"/>
                <xforms:setvalue ref="instance('scenario-navigation')" value="if (string-length(xxforms:get-request-parameter('id'))&gt;0) then xxforms:get-request-parameter('id') else (instance('scenarios-instance')//scenario[1]/@id)"/>
                <xforms:send submission="get-issues-submission"/>
                <xforms:action if="instance('scenarios-instance')//transaction[@id=instance('scenario-navigation')][representingTemplate/@sourceDataset]">
                    <xforms:send submission="get-decor-dataset-tree"/>
                    <xforms:setvalue ref="instance('concept-navigation')" value="if (string-length(xxforms:get-request-parameter('conceptId'))&gt;0) then xxforms:get-request-parameter('conceptId') else (instance('dataset-instance')//concept[1]/@id)"/>
                    <xforms:send submission="get-concept"/>
                    <xforms:send submission="get-concept-issues"/>
                </xforms:action>
            </xforms:action>
            <xforms:action ev:event="xforms-ready">
                <xforms:setvalue ref="instance('data-safe')">true</xforms:setvalue>
                <xforms:setvalue ref="instance('actors-safe')">true</xforms:setvalue>
            </xforms:action>
            <xxforms:script ev:event="xforms-ready">
                window.onbeforeunload = function() {
                    if (ORBEON.xforms.Document.getValue('data-safe-input') != 'true' || ORBEON.xforms.Document.getValue('actors-safe-input') != 'true')
                    return "You have unsaved changes. If you leave the page now these changes are lost.";
                }
            </xxforms:script>
         <!-- relevant language is returned as first node, rest should be empty -->
            <xxforms:variable name="resources" select="instance('resources-instance')//resources[1]"/>
            <xxforms:variable name="editor" select="contains(xxforms:get-session-attribute('groups'),'editor') and instance('project-instance')/author[@username=xxforms:get-session-attribute('username')]"/>
            <xxforms:variable name="issueCreator" select="contains(xxforms:get-session-attribute('groups'),'issues') and instance('project-instance')/author[@username=xxforms:get-session-attribute('username')]"/>
        </xforms:model>
    </xhtml:head>
    <xhtml:body>
      <!-- special output used to give warning if user leaves page -->
        <xforms:output ref="instance('data-safe')" id="data-safe-input" style="display: none"/>
        <xforms:output ref="instance('actors-safe')" id="actors-safe-input" style="display: none"/>
      <!-- status change dialog -->
        <xxforms:dialog id="status-dialog" appearance="full" level="modal" close="false" draggable="true" visible="false">
            <xhtml:table width="100%">
                <xhtml:tr>
                    <xhtml:td class="heading" colspan="2">
                        <xhtml:div class="heading">
                            <xforms:output ref="instance('status-change')/@actionText"/>
                        </xhtml:div>
                    </xhtml:td>
                </xhtml:tr>
                <xhtml:tr>
                    <xhtml:td colspan="2">
                        <xforms:output mediatype="text/html" ref="xxforms:serialize(instance('messages')/status-final[@language=$resources/@xml:lang[1]], 'html')"/>
                    </xhtml:td>
                </xhtml:tr>
                <!-- version label -->
                <xhtml:tr>
                    <xhtml:td class="item-label-var">
                        <xforms:output ref="$resources/versionLabel"/>
                    </xhtml:td>
                    <xhtml:td>
                        <xforms:input ref="instance('status-change')/@versionLabel" incremental="true"/>
                    </xhtml:td>
                </xhtml:tr>
                <!-- expirationDate -->
                <xforms:group ref="instance('status-change')[@statusCode='final']">
                    <xhtml:tr>
                        <xhtml:td class="item-label-var">
                            <xforms:output ref="$resources/expiration-date"/>
                        </xhtml:td>
                        <xhtml:td>
                            <xforms:input ref="@expirationDate" incremental="true"/>
                        </xhtml:td>
                    </xhtml:tr>
                </xforms:group>
                <!-- recurse status, expirationDate, versionLabel -->
                <xhtml:tr>
                    <xhtml:td class="item-label-var">
                        <xforms:output ref="$resources/recurse"/>
                    </xhtml:td>
                    <xhtml:td>
                        <xforms:input ref="instance('status-change')/@recurse" class="auto-width"/>
                        <xforms:output ref="$resources/apply-status-properties" class="auto-width"/>
                    </xhtml:td>
                </xhtml:tr>
                <xhtml:tr>
                    <xhtml:td colspan="2">
                        <xhtml:div class="buttons">
                            <fr:button>
                                <xforms:label ref="$resources/cancel"/>
                                <xforms:action ev:event="DOMActivate">
                                    <xxforms:hide dialog="status-dialog"/>
                                </xforms:action>
                            </fr:button>
                            <fr:button>
                                <xforms:label>
                                    <xforms:output ref="instance('status-change')/@actionText"/>
                                </xforms:label>
                                <xforms:action ev:event="DOMActivate">
                                    <xforms:setvalue ref="instance('status-change')/@ref" value="instance('scenarios-instance')//*[@id=instance('scenario-navigation')]/@id"/>
                                    <xforms:setvalue ref="instance('status-change')/@effectiveDate" value="instance('scenarios-instance')//*[@id=instance('scenario-navigation')]/@effectiveDate"/>
                                    <xforms:send submission="set-decor-object-status"/>
                                    <xforms:send submission="get-scenarios-submission"/>
                                    <xforms:send submission="get-decor-dataset-tree"/>
                                    <xxforms:hide dialog="status-dialog"/>
                                </xforms:action>
                            </fr:button>
                        </xhtml:div>
                    </xhtml:td>
                </xhtml:tr>
            </xhtml:table>
        </xxforms:dialog>
      <!-- dialog for lock message after status change -->
        <xxforms:dialog id="lock-status-dialog" appearance="full" level="modeless" close="true" draggable="true" visible="false">
            <xforms:action ev:event="xxforms-dialog-open">
                <xforms:setfocus control="close-lock-status"/>
            </xforms:action>
            <xforms:label ref="$resources/concept-locked"/>
            <xhtml:table width="100%">
                <xhtml:tr>
                    <xhtml:td class="heading" colspan="4">
                        <xforms:output mediatype="text/html" ref="xxforms:serialize(instance('messages')/status-locked[@language=$resources/@xml:lang[1]], 'html')"/>
                    </xhtml:td>
                </xhtml:tr>
                <xhtml:tr>
                    <xhtml:td class="item-label-var">
                        <xforms:output ref="$resources/id" class="auto-width"/>
                    </xhtml:td>
                    <xhtml:td class="item-label-var">
                        <xforms:output ref="$resources/name"/>
                    </xhtml:td>
                    <xhtml:td class="item-label-var">
                        <xforms:output ref="$resources/user" class="auto-width"/>
                    </xhtml:td>
                    <xhtml:td class="item-label-var">
                        <xforms:output ref="$resources/starting-from" class="auto-width"/>
                    </xhtml:td>
                </xhtml:tr>
                <xforms:repeat nodeset="instance('status-response')/*">
                    <xhtml:tr class="not-selectable">
                        <xhtml:td>
                            <xforms:output ref="@ref" class="auto-width"/>
                        </xhtml:td>
                        <xhtml:td>
                            <xxforms:variable name="conceptId" select="@ref"/>
                            <xforms:output ref="instance('scenarios-instance')//name[@language=instance('language')][../@id=$conceptId]"/>
                        </xhtml:td>
                        <xhtml:td>
                            <xforms:output ref="@userName" class="auto-width"/>
                        </xhtml:td>
                        <xhtml:td>
                            <xforms:output ref="@since" class="auto-width"/>
                        </xhtml:td>
                    </xhtml:tr>
                </xforms:repeat>
                <xhtml:tr>
                    <xhtml:td colspan="4">
                        <xhtml:div class="buttons">
                            <fr:button id="close-lock-status">
                                <xforms:label ref="$resources/close"/>
                                <xforms:action ev:event="DOMActivate">
                                    <xforms:send submission="get-concept"/>
                                    <xxforms:hide ev:event="DOMActivate" dialog="lock-status-dialog"/>
                                </xforms:action>
                            </fr:button>
                        </xhtml:div>
                    </xhtml:td>
                </xhtml:tr>
            </xhtml:table>
        </xxforms:dialog>
      <!-- template select for connection to a transaction -->
        <xxforms:dialog id="template-dialog" appearance="minimal" level="modal" close="true" draggable="true" visible="false">
            <xforms:action ev:event="xxforms-dialog-open">
                <xforms:send submission="get-decor-template-list"/>
                <xxforms:variable name="currentTransaction" select="instance('scenarios-instance')//transaction[@id=instance('scenario-navigation')]"/>
                <xxforms:variable name="currentTemplate" select="instance('decor-template-list')//template[template/(@id|@ref|@name)=$currentTransaction/representingTemplate/@ref][1]"/>
                <xforms:setvalue ref="instance('template-navigation')" value="if ($currentTemplate) then ($currentTemplate/@uuid) else (instance('decor-template-list')//template/template[1]/@uuid)"/>
            </xforms:action>
            <xforms:label ref="$resources/templates"/>
            <xhtml:table width="100%">
                <xhtml:tr>
                    <!-- template navigation -->
                    <xhtml:td>
                        <xhtml:table class="detail">
                            <xhtml:tr>
                                <xhtml:td class="heading" colspan="2">
                                    <xhtml:div class="navigate-container">
                                        <xhtml:div class="heading">
                                            <xforms:output ref="$resources/templates"/>
                                        </xhtml:div>
                                    </xhtml:div>
                                </xhtml:td>
                            </xhtml:tr>
                            <xhtml:tr>
                                <xhtml:td>
                                    <xhtml:div style="height: 400px; overflow: auto;">
                                        <xforms:select1 ref="instance('template-navigation')" appearance="xxforms:tree">
                                            <xforms:itemset nodeset="instance('decor-template-list')/class/template[template]|instance('decor-template-list')/class" class="{if (name()='template') then concat('node-template-', template[1]/@statusCode) else ''}" xxforms:open="true">
                                                <xforms:label>
                                                    <xforms:output ref="if (name()='template') then (if (string-length(template[1]/@displayName)&gt;0) then template[1]/@displayName else template[1]/@name) else (label[@language=instance('language')])"/>
                                                    <xforms:output ref="if (string-length(template[1]/@versionLabel)&gt;0) then concat(' (', template[1]/@versionLabel, ')') else ''"/>
                                                </xforms:label>
                                                <xforms:value ref="@uuid"/>
                                            </xforms:itemset>
                                            <!--<xforms:itemset nodeset="instance('decor-template-list')/template" class="{if (template[1]/representingTemplate) then (concat('node-reptemplate-', template[1]/@statusCode)) else (concat('node-template-', template[1]/@statusCode))}">
                                                <xforms:label>
                                                    <xforms:output ref="if (string-length(template[1]/@displayName)>0) then (template[1]/@displayName) else (template[1]/@name)"/>
                                                </xforms:label>
                                                <xforms:value ref="@id"/>
                                            </xforms:itemset>-->
                                            <xforms:action ev:event="xforms-value-changed">
                                                <xforms:setvalue ref="instance('version-navigation')" value="(instance('decor-template-list')//template[@uuid=instance('template-navigation')]/template/@effectiveDate)[1]"/>
                                            </xforms:action>
                                        </xforms:select1>
                                    </xhtml:div>
                                </xhtml:td>
                            </xhtml:tr>
                        </xhtml:table>
                    </xhtml:td>
                    <xhtml:td>
                        <xforms:group ref="instance('decor-template-list')//template[@uuid=instance('template-navigation')]/ancestor-or-self::template[last()]">
                            <xxforms:variable name="templateDisplayName" select="if (string-length(template[1]/@displayName)&gt;0) then template[1]/@displayName else @name"/>
                            <xhtml:table class="detail">
                                <xhtml:tr>
                                    <xhtml:td class="heading" colspan="5">
                                        <xhtml:div class="navigate-container">
                                            <xhtml:div class="heading">
                                                <xforms:output ref="$templateDisplayName"/>
                                            </xhtml:div>
                                        </xhtml:div>
                                    </xhtml:td>
                                </xhtml:tr>
                                <xhtml:tr>
                                    <!-- template name -->
                                    <xhtml:td class="item-label">
                                        <xforms:output ref="$resources/name"/>
                                    </xhtml:td>
                                    <xhtml:td colspan="3">
                                        <xforms:output ref="$templateDisplayName"/>
                                    </xhtml:td>
                                    <xhtml:td>
                                        <xhtml:div style="float:right">
                                            <xxforms:variable name="selectedTemplate" select="template[1]"/>
                                            <fr:button>
                                                <xforms:label ref="$resources/select-dynamic"/>
                                                <xforms:action ev:event="DOMActivate">
                                                    <xforms:setvalue ref="instance('scenarios-instance')//representingTemplate[parent::transaction/@id=instance('scenario-navigation')]/@ref" value="$selectedTemplate/(@id|@ref)"/>
                                                    <xforms:setvalue ref="instance('scenarios-instance')//representingTemplate[parent::transaction/@id=instance('scenario-navigation')]/@flexibility" value="''"/>
                                                    <xforms:setvalue ref="instance('scenarios-instance')//representingTemplate[parent::transaction/@id=instance('scenario-navigation')]/@templateId" value="$selectedTemplate/(@id|@ref)"/>
                                                    <xforms:setvalue ref="instance('scenarios-instance')//representingTemplate[parent::transaction/@id=instance('scenario-navigation')]/@templateDisplayName" value="$templateDisplayName"/>
                                                    <xforms:setvalue ref="instance('scenarios-instance')//representingTemplate[parent::transaction/@id=instance('scenario-navigation')]/@templateStatusCode" value="$selectedTemplate/@statusCode"/>
                                                    <xxforms:hide dialog="template-dialog"/>
                                                </xforms:action>
                                            </fr:button>
                                        </xhtml:div>
                                    </xhtml:td>
                                </xhtml:tr>
                                <!-- version repeat header -->
                                <xhtml:tr>
                                    <xhtml:td class="item-label">
                                        <xforms:output ref="$resources/version"/>
                                    </xhtml:td>
                                    <xhtml:td class="item-label">
                                        <xforms:output ref="$resources/versionLabel"/>
                                    </xhtml:td>
                                    <xhtml:td class="item-label">
                                        <xforms:output ref="$resources/status"/>
                                    </xhtml:td>
                                    <xhtml:td class="item-label">
                                        <xforms:output ref="$resources/id"/>
                                    </xhtml:td>
                                    <xhtml:td class="item-label"/>
                                </xhtml:tr>
                                <!-- version repeat -->
                                <xforms:repeat nodeset="template[string-length(@effectiveDate)&gt;0]">
                                    <xxforms:variable name="selectedTemplate" select="."/>
                                    <xhtml:tr>
                                        <xhtml:td>
                                            <xforms:output ref="@effectiveDate" xxforms:format="if (. castable as xs:dateTime) then replace(format-dateTime(.,'[Y0001]-[M01]-[D01] [H01]:[m01]:[s01]', (), (), ()),' 00:00:00','') else (.)"/>
                                        </xhtml:td>
                                        <xhtml:td>
                                            <xforms:output ref="@versionLabel"/>
                                        </xhtml:td>
                                        <xhtml:td>
                                            <xxforms:variable name="statusCode" select="@statusCode"/>
                                            <xforms:output ref="instance('decor-types')/TemplateStatusCodeLifeCycle/enumeration[@value=$statusCode]/label[@language=$resources/@xml:lang]" class="node-s{$statusCode}"/>
                                        </xhtml:td>
                                        <xhtml:td>
                                            <xxforms:variable name="id" select="@id"/>
                                            <xxforms:variable name="bid" select="instance('project-instance')/ids/baseId[@id=string-join(tokenize($id,'\.')[position()!=last()],'.') ]/@prefix"/>
                                            <xforms:output ref="if (string-length($bid)&gt;0) then concat($bid,tokenize($id,'\.')[last()]) else $id"/>
                                        </xhtml:td>
                                        <xhtml:td>
                                            <xhtml:div style="float:right">
                                                <fr:button>
                                                    <xforms:label ref="$resources/select-static"/>
                                                    <xforms:action ev:event="DOMActivate">
                                                        <xforms:setvalue ref="instance('scenarios-instance')//representingTemplate[parent::transaction/@id=instance('scenario-navigation')]/@ref" value="$selectedTemplate/(@id|@ref)"/>
                                                        <xforms:setvalue ref="instance('scenarios-instance')//representingTemplate[parent::transaction/@id=instance('scenario-navigation')]/@flexibility" value="$selectedTemplate/@effectiveDate"/>
                                                        <xforms:setvalue ref="instance('scenarios-instance')//representingTemplate[parent::transaction/@id=instance('scenario-navigation')]/@templateId" value="$selectedTemplate/(@id|@ref)"/>
                                                        <xforms:setvalue ref="instance('scenarios-instance')//representingTemplate[parent::transaction/@id=instance('scenario-navigation')]/@templateDisplayName" value="$templateDisplayName"/>
                                                        <xforms:setvalue ref="instance('scenarios-instance')//representingTemplate[parent::transaction/@id=instance('scenario-navigation')]/@templateStatusCode" value="$selectedTemplate/@statusCode"/>
                                                        <xxforms:hide dialog="template-dialog"/>
                                                    </xforms:action>
                                                </fr:button>
                                            </xhtml:div>
                                        </xhtml:td>
                                    </xhtml:tr>
                                </xforms:repeat>
                            </xhtml:table>
                        </xforms:group>
                        <xhtml:table width="100%" style="margin-top:1em;">
                            <xhtml:tr>
                                <xhtml:td>
                                    <xhtml:div class="buttons">
                                        <fr:button>
                                            <xforms:label ref="$resources/cancel"/>
                                            <xforms:action ev:event="DOMActivate">
                                                <xxforms:hide dialog="template-dialog"/>
                                            </xforms:action>
                                        </fr:button>
                                    </xhtml:div>
                                </xhtml:td>
                            </xhtml:tr>
                        </xhtml:table>
                    </xhtml:td>
                </xhtml:tr>
            </xhtml:table>
        </xxforms:dialog>
        <fr:tabview>
        <!-- Scenarios /transactions -->
            <fr:tab>
                <fr:label ref="$resources/scenarios"/>
                <xhtml:table width="100%">
            <!-- table row with master-detail columns -->
                    <xhtml:tr>
                <!-- scenario-navigation -->
                        <xhtml:td style="width: 10px">
                            <xforms:group ref=".[instance('visibility')/element[@id='scenarioshow']='true']">
                                <fr:button>
                                    <xforms:label>
                                        <xhtml:img src="/img/collapse_east.png" alt="" align="right"/>
                                    </xforms:label>
                                    <xforms:hint ref="$resources/collapse-east"/>
                                    <xforms:action ev:event="DOMActivate">
                                        <xforms:setvalue ref="instance('visibility')/element[@id='scenariotree']">true</xforms:setvalue>
                                        <xforms:setvalue ref="instance('visibility')/element[@id='scenarioshow']">false</xforms:setvalue>
                                    </xforms:action>
                                </fr:button>
                            </xforms:group>
                            <xforms:group ref=".[instance('visibility')/element[@id='scenariotree']='true']">
                                <xxforms:variable name="current-item" select="instance('scenarios-instance')//*[@id=instance('scenario-navigation')]"/>
                                <xhtml:table width="100%">
                                    <xhtml:tr>
                                        <xhtml:td class="heading">
                                            <xhtml:div class="heading">
                                                <xforms:output ref="$resources/scenarios"/>
                                            </xhtml:div>
                                            <xhtml:div class="buttons">
                                        <!-- add scenario -->
                                                <fr:button ref=".[$editor][not(instance('scenarios-instance')/scenario) or instance('scenarios-instance')//scenario[@id=instance('scenario-navigation')]]">
                                                    <xforms:label>
                                                        <xhtml:img src="/img/plus.png" alt=""/>
                                                    </xforms:label>
                                                    <xforms:hint>
                                                        <xforms:output ref="$resources/add-scenario"/>
                                                    </xforms:hint>
                                                    <xforms:action ev:event="DOMActivate">
                                                        <xxforms:variable name="baseId" select="instance('project-instance')/ids/defaultBaseId[@type='SC']/@id"/>
                                                        <xxforms:variable name="transactionBaseId" select="instance('project-instance')/ids/defaultBaseId[@type='TR']/@id"/>
                                                        <xforms:action if="not(instance('scenarios-instance')/scenario)">
                                                            <xforms:setvalue ref="instance('new-scenario-instance')/@id" value="concat($baseId,'.1')"/>
                                                            <xforms:setvalue ref="instance('new-scenario-instance')/transaction/@id" value="concat($transactionBaseId,'.1')"/>
                                                            <xforms:setvalue ref="instance('new-scenario-instance')/transaction/transaction[1]/@id" value="concat($transactionBaseId,'.2')"/>
                                                            <xforms:setvalue ref="instance('new-scenario-instance')/transaction/transaction[2]/@id" value="concat($transactionBaseId,'.3')"/>
                                                        </xforms:action>
                                                        <xforms:action if="instance('scenarios-instance')/scenario">
                                                            <xxforms:variable name="newId" select="concat($baseId,'.',max(instance('scenarios-instance')/scenario[starts-with(@id,concat($baseId,'.')) and count(tokenize(@id,'\.'))=count(tokenize($baseId,'\.'))+1]/number(tokenize(@id,'\.')[last()]))+1)"/>
                                                            <xxforms:variable name="newTransactionGroupId" select="concat($transactionBaseId,'.',max(instance('scenarios-instance')//transaction[starts-with(@id,concat($transactionBaseId,'.')) and count(tokenize(@id,'\.'))=count(tokenize($transactionBaseId,'\.'))+1]/number(tokenize(@id,'\.')[last()]))+1)"/>
                                                            <xxforms:variable name="newTransactionInitialId" select="concat($transactionBaseId,'.',max(instance('scenarios-instance')//transaction[starts-with(@id,concat($transactionBaseId,'.')) and count(tokenize(@id,'\.'))=count(tokenize($transactionBaseId,'\.'))+1]/number(tokenize(@id,'\.')[last()]))+2)"/>
                                                            <xxforms:variable name="newTransactionBackId" select="concat($transactionBaseId,'.',max(instance('scenarios-instance')//transaction[starts-with(@id,concat($transactionBaseId,'.')) and count(tokenize(@id,'\.'))=count(tokenize($transactionBaseId,'\.'))+1]/number(tokenize(@id,'\.')[last()]))+3)"/>
                                                            <xforms:setvalue ref="instance('new-scenario-instance')/@id" value="$newId"/>
                                                            <xforms:setvalue ref="instance('new-scenario-instance')/transaction/@id" value="$newTransactionGroupId"/>
                                                            <xforms:setvalue ref="instance('new-scenario-instance')/transaction/transaction[1]/@id" value="$newTransactionInitialId"/>
                                                            <xforms:setvalue ref="instance('new-scenario-instance')/transaction/transaction[2]/@id" value="$newTransactionBackId"/>
                                                            <xforms:setvalue ref="instance('new-scenario-instance')/@effectiveDate" value="format-dateTime(current-dateTime(), '[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01]')"/>
                                                            <xforms:setvalue ref="instance('new-scenario-instance')/transaction/@effectiveDate" value="format-dateTime(current-dateTime(), '[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01]')"/>
                                                            <xforms:setvalue ref="instance('new-scenario-instance')/transaction/transaction[1]/@effectiveDate" value="format-dateTime(current-dateTime(), '[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01]')"/>
                                                            <xforms:setvalue ref="instance('new-scenario-instance')/transaction/transaction[2]/@effectiveDate" value="format-dateTime(current-dateTime(), '[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01]')"/>
                                                        </xforms:action>
                                                        <xforms:action xxforms:iterate="instance('new-scenario-instance')//name">
                                                            <xforms:setvalue ref="context()/@language" value="instance('language')"/>
                                                        </xforms:action>
                                                        <xforms:action xxforms:iterate="instance('new-scenario-instance')//desc">
                                                            <xforms:setvalue ref="context()/@language" value="instance('language')"/>
                                                        </xforms:action>
                                                        <xforms:action xxforms:iterate="instance('new-scenario-instance')//representingTemplate">
                                                            <xforms:setvalue ref="context()/@sourceDataset" value="instance('dataset-list')/dataset[1]/@id"/>
                                                        </xforms:action>
                                                        <xforms:insert context="instance('scenarios-instance')" nodeset="*" at="last()" position="after" origin="instance('new-scenario-instance')"/>
                                                        <xforms:setvalue ref="instance('scenario-navigation')" value="instance('new-scenario-instance')/@id"/>
                                                        <xforms:setfocus control="scenarioName"/>
                                                    </xforms:action>
                                                </fr:button>
                                                <xforms:group ref=".[$editor][not($current-item/ancestor::*[@statusCode=('final','deprecated')])]">
                                        <!-- add transaction group -->
                                                    <fr:button ref=".[$current-item[self::transaction][@type='group']]">
                                                        <xforms:label>
                                                            <xhtml:img src="/img/plus.png" alt=""/>
                                                        </xforms:label>
                                                        <xforms:hint ref="$resources/add-transaction-group"/>
                                                        <xforms:action ev:event="DOMActivate">
                                                            <xxforms:variable name="current-group" select="instance('scenarios-instance')//transaction[@id=instance('scenario-navigation')]"/>
                                                            <xxforms:variable name="transactionBaseId" select="instance('project-instance')/ids/defaultBaseId[@type='TR']/@id"/>
                                                            <xxforms:variable name="newTransactionGroupId" select="concat($transactionBaseId,'.',max(instance('scenarios-instance')//transaction[starts-with(@id,concat($transactionBaseId,'.')) and count(tokenize(@id,'\.'))=count(tokenize($transactionBaseId,'\.'))+1]/number(tokenize(@id,'\.')[last()]))+1)"/>
                                                            <xxforms:variable name="newTransactionInitialId" select="concat($transactionBaseId,'.',max(instance('scenarios-instance')//transaction[starts-with(@id,concat($transactionBaseId,'.')) and count(tokenize(@id,'\.'))=count(tokenize($transactionBaseId,'\.'))+1]/number(tokenize(@id,'\.')[last()]))+2)"/>
                                                            <xxforms:variable name="newTransactionBackId" select="concat($transactionBaseId,'.',max(instance('scenarios-instance')//transaction[starts-with(@id,concat($transactionBaseId,'.')) and count(tokenize(@id,'\.'))=count(tokenize($transactionBaseId,'\.'))+1]/number(tokenize(@id,'\.')[last()]))+3)"/>
                                                            <xforms:setvalue ref="instance('new-transaction-group-instance')/@id" value="$newTransactionGroupId"/>
                                                            <xforms:setvalue ref="instance('new-transaction-group-instance')/transaction[1]/@id" value="$newTransactionInitialId"/>
                                                            <xforms:setvalue ref="instance('new-transaction-group-instance')/transaction[2]/@id" value="$newTransactionBackId"/>
                                                            <xforms:setvalue ref="instance('new-transaction-group-instance')/@effectiveDate" value="format-dateTime(current-dateTime(), '[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01]')"/>
                                                            <xforms:setvalue ref="instance('new-transaction-group-instance')/transaction[1]/@effectiveDate" value="format-dateTime(current-dateTime(), '[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01]')"/>
                                                            <xforms:setvalue ref="instance('new-transaction-group-instance')/transaction[2]/@effectiveDate" value="format-dateTime(current-dateTime(), '[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01]')"/>
                                                            <xforms:action xxforms:iterate="instance('new-transaction-group-instance')//name">
                                                                <xforms:setvalue ref="context()/@language" value="instance('language')"/>
                                                            </xforms:action>
                                                            <xforms:action xxforms:iterate="instance('new-transaction-group-instance')//desc">
                                                                <xforms:setvalue ref="context()/@language" value="instance('language')"/>
                                                            </xforms:action>
                                                            <xforms:action xxforms:iterate="instance('new-transaction-group-instance')//representingTemplate">
                                                                <xforms:setvalue ref="context()/@sourceDataset" value="instance('dataset-list')/dataset[1]/@id"/>
                                                            </xforms:action>
                                                            <xforms:insert nodeset="$current-group" position="after" origin="instance('new-transaction-group-instance')"/>
                                                            <xforms:insert context="$current-group/ancestor::scenario" origin="xxforms:element('edit',(xxforms:attribute('mode','edit')))"/>
                                                            <xforms:setvalue ref="instance('scenario-navigation')" value="instance('new-transaction-group-instance')/@id"/>
                                                            <xforms:setfocus control="transactionGroupName"/>
                                                        </xforms:action>
                                                    </fr:button>
                                        <!-- add transaction -->
                                                    <fr:button ref=".[$current-item[self::transaction][not(@type='group')]]">
                                                        <xforms:label>
                                                            <xhtml:img src="/img/plus.png" alt=""/>
                                                        </xforms:label>
                                                        <xforms:hint ref="$resources/add-transaction"/>
                                                        <xforms:action ev:event="DOMActivate">
                                                            <xxforms:variable name="current-transaction" select="instance('scenarios-instance')//transaction[@id=instance('scenario-navigation')]"/>
                                                            <xxforms:variable name="transactionBaseId" select="instance('project-instance')/ids/defaultBaseId[@type='TR']/@id"/>
                                                            <xxforms:variable name="newTransactionId" select="concat($transactionBaseId,'.',max(instance('scenarios-instance')//transaction[starts-with(@id,concat($transactionBaseId,'.')) and count(tokenize(@id,'\.'))=count(tokenize($transactionBaseId,'\.'))+1]/number(tokenize(@id,'\.')[last()]))+1)"/>
                                                            <xforms:setvalue ref="instance('new-transaction-instance')/@id" value="$newTransactionId"/>
                                                            <xforms:setvalue ref="instance('new-transaction-instance')/@effectiveDate" value="format-dateTime(current-dateTime(), '[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01]')"/>
                                                            <xforms:action xxforms:iterate="instance('new-transaction-instance')//name">
                                                                <xforms:setvalue ref="context()/@language" value="instance('language')"/>
                                                            </xforms:action>
                                                            <xforms:action xxforms:iterate="instance('new-transaction-instance')//desc">
                                                                <xforms:setvalue ref="context()/@language" value="instance('language')"/>
                                                            </xforms:action>
                                                            <xforms:action xxforms:iterate="instance('new-transaction-instance')//representingTemplate">
                                                                <xforms:setvalue ref="context()/@sourceDataset" value="instance('dataset-list')/dataset[1]/@id"/>
                                                            </xforms:action>
                                                            <xforms:insert nodeset="$current-transaction" position="after" origin="instance('new-transaction-instance')"/>
                                                            <xforms:insert context="$current-transaction/ancestor::scenario" origin="xxforms:element('edit',(xxforms:attribute('mode','edit')))"/>
                                                            <xforms:setvalue ref="instance('scenario-navigation')" value="instance('new-transaction-instance')/@id"/>
                                                            <xforms:setfocus control="transactionName"/>
                                                        </xforms:action>
                                                    </fr:button>
                                        <!-- delete option only if is transaction with statusCode='new' and not the last transaction (group) -->
                                                    <fr:button ref=".[$current-item[self::transaction][@statusCode='new'][count(../transaction)&gt;1]]">
                                                        <xforms:label>
                                                            <xhtml:img src="/img/remove.gif" alt=""/>
                                                        </xforms:label>
                                                        <xforms:hint ref="$resources/delete-transaction"/>
                                                        <xforms:action ev:event="DOMActivate">
                                                            <!-- set navigation to parent if no preceding transaction (group) -->
                                                            <xforms:action if="instance('scenarios-instance')//transaction[@id=instance('scenario-navigation')][not(preceding-sibling::transaction)]">
                                                                <xxforms:variable name="new-scenario-navigation" select="instance('scenarios-instance')//transaction[@id=instance('scenario-navigation')]/parent::*/@id"/>
                                                                <xforms:delete ref="instance('scenarios-instance')//transaction[@id=instance('scenario-navigation')]"/>
                                                                <xforms:setvalue ref="instance('scenario-navigation')" value="$new-scenario-navigation"/>
                                                            </xforms:action>
                                                            <!-- set navigation to preceding transaction (group) -->
                                                            <xforms:action if="instance('scenarios-instance')//transaction[@id=instance('scenario-navigation')][preceding-sibling::transaction]">
                                                                <xxforms:variable name="new-scenario-navigation" select="instance('scenarios-instance')//transaction[@id=instance('scenario-navigation')]/preceding-sibling::transaction[last()]/@id"/>
                                                                <xforms:delete ref="instance('scenarios-instance')//transaction[@id=instance('scenario-navigation')]"/>
                                                                <xforms:setvalue ref="instance('scenario-navigation')" value="$new-scenario-navigation"/>
                                                            </xforms:action>
                                                        </xforms:action>
                                                    </fr:button>
                                                </xforms:group>
                                        <!-- refresh -->
                                                <fr:button ref=".[instance('data-safe')='true'][not(instance('scenarios-instance')//edit)]">
                                                    <xforms:label>
                                                        <xhtml:img src="/img/arrow_refresh.png" alt=""/>
                                                    </xforms:label>
                                                    <xforms:hint ref="$resources/refresh"/>
                                                    <xforms:action ev:event="DOMActivate">
                                                        <xforms:send submission="get-scenarios-submission"/>
                                                        <xforms:send submission="get-decor-dataset-tree"/>
                                                    </xforms:action>
                                                </fr:button>
                                                <fr:button>
                                                    <xforms:label>
                                                        <xhtml:img src="/img/collapse_west.png" alt="" align="right"/>
                                                    </xforms:label>
                                                    <xforms:hint ref="$resources/collapse-west"/>
                                                    <xforms:action ev:event="DOMActivate">
                                                        <xforms:setvalue ref="instance('visibility')/element[@id='scenariotree']">false</xforms:setvalue>
                                                        <xforms:setvalue ref="instance('visibility')/element[@id='scenarioshow']">true</xforms:setvalue>
                                                    </xforms:action>
                                                </fr:button>
                                            </xhtml:div>
                                        </xhtml:td>
                                    </xhtml:tr>
                                    <xhtml:tr>
                                        <xhtml:td>
                                            <xhtml:div class="navigate">
                                                <xforms:select1 ref="instance('scenario-navigation')" appearance="xxforms:tree">
                                                    <xforms:itemset nodeset="instance('scenarios-instance')//scenario | instance('scenarios-instance')//transaction" class="{if (name()='scenario') then (concat('node-s',@statusCode)) else if (@type ='group') then concat('node-transaction-group-s', @statusCode) else if (name()='transaction' and @type='initial') then concat('node-transaction-send-s', @statusCode) else if (name()='transaction' and @type='back') then concat('node-transaction-receive-s', @statusCode)  else if (name()='transaction' and @type='stationary') then concat('node-document-s', @statusCode) else ()}">
                                                        <xforms:label ref="concat(name[@language=instance('language')], if (string-length(@versionLabel) &gt; 0) then concat(' (', @versionLabel, ')') else'')" mediatype="text/html"/>
                                                        <xforms:value ref="@id"/>
                                                    </xforms:itemset>
                                                    <xforms:action ev:event="xforms-value-changed">
                                                        <xforms:send submission="get-decor-dataset-tree"/>
                                                        <xforms:action if="instance('dataset-instance')//concept[not(@absent)][1]/@id">
                                                            <xforms:setvalue ref="instance('concept-navigation')" value="instance('dataset-instance')//concept[not(@absent)][1]/@id"/>
                                                        </xforms:action>
                                                        <xforms:action if="not(instance('dataset-instance')//concept[not(@absent)][1]/@id)">
                                                            <xforms:setvalue ref="instance('concept-navigation')" value="''"/>
                                                        </xforms:action>
                                                        <xforms:send submission="get-concept"/>
                                                        <xforms:send submission="get-issues-submission"/>
                                                        <xforms:send submission="get-concept-issues"/>
                                                    </xforms:action>
                                                </xforms:select1>
                                            </xhtml:div>
                                        </xhtml:td>
                                    </xhtml:tr>
                                </xhtml:table>
                            </xforms:group>
                        </xhtml:td>
                <!-- scenario /transaction (group) details -->
                        <xhtml:td>
                            <xxforms:variable name="treeConcept" select="instance('scenarios-instance')//*[@id=instance('scenario-navigation')]"/>
                            <!-- You may only edit a scenario/transaction when you are editor, 
                                have status new/draft, are not under anything final/deprecated, 
                                and when you or one of your ancestors are not current being edited -->
                            <xxforms:variable name="editAllowed" select="$treeConcept[$editor and @statusCode=('new','draft') and not(ancestor-or-self::*/@statusCode=('final','deprecated')) and not(ancestor-or-self::*/edit)]"/>
                            <xxforms:variable name="currentId" select="$treeConcept/@id"/>
                            <xxforms:variable name="currentEff" select="$treeConcept/@effectiveDate"/>
                            <xxforms:variable name="currentType" select="$treeConcept/name()"/>
                            <xforms:group ref="$treeConcept">
                                <xhtml:table width="100%">
                            <!-- row with header -->
                                    <xhtml:tr>
                                        <xhtml:td class="heading">
                                            <xhtml:div class="heading">
                                                <xforms:output ref="if ($currentType='scenario') then $resources/scenario else $resources/transaction"/>: <xforms:output ref="name[@language=instance('language')]"/>
                                            </xhtml:div>
                                            <xhtml:div class="buttons">
                                            <!-- Edit -->
                                                <fr:button ref=".[$editAllowed]">
                                                    <xforms:label>
                                                        <xhtml:img src="/img/write.png" alt=""/>
                                                    </xforms:label>
                                                    <xforms:hint>
                                                        <xforms:output ref="if ($currentType='scenario') then $resources/edit-scenario else $resources/edit-transaction"/>
                                                    </xforms:hint>
                                                    <xforms:action ev:event="DOMActivate" if="$currentType='scenario'">
                                                        <xforms:insert context="." origin="xxforms:element('edit',(xxforms:attribute('mode','edit')))"/>
                                                    </xforms:action>
                                                    <xforms:action ev:event="DOMActivate" if="not($currentType='scenario')">
                                                        <xforms:insert context="ancestor::scenario" origin="xxforms:element('edit',(xxforms:attribute('mode','edit')))"/>
                                                    </xforms:action>
                                                </fr:button>
                                            <!-- Status change buttons -->
                                                <xforms:group ref=".[$editor]">
                                            <!-- button for setting status to 'draft' -->
                                                    <fr:button ref=".[$editor][@statusCode=('new')][not(ancestor-or-self::*/edit)]">
                                                        <xforms:label>
                                                            <xhtml:img src="/img/node-srejected.png" alt=""/>
                                                        </xforms:label>
                                                        <xforms:hint>
                                                            <xforms:output ref="$resources/set-status-to-draft"/>
                                                        </xforms:hint>
                                                        <xforms:action ev:event="DOMActivate">
                                                            <xforms:action xxforms:iterate="instance('status-change')/@*">
                                                                <xforms:setvalue ref="context()" value="''"/>
                                                            </xforms:action>
                                                            <xforms:setvalue ref="instance('status-change')/@recurse" value="'true'"/>
                                                            <xforms:setvalue ref="instance('status-change')/@statusCode" value="'draft'"/>
                                                            <xforms:setvalue ref="instance('status-change')/@actionText" value="$resources/set-status-to-draft"/>
                                                            <xforms:setvalue ref="instance('status-change')/@versionLabel" value="$treeConcept/@versionLabel"/>
                                                            <xxforms:show dialog="status-dialog"/>
                                                        </xforms:action>
                                                    </fr:button>
                                            <!-- button for setting status to 'final' -->
                                                    <fr:button ref=".[$editor][@statusCode=('draft')][not(ancestor-or-self::*/edit)]">
                                                        <xforms:label>
                                                            <xhtml:img src="/img/node-sfinal.png" alt=""/>
                                                        </xforms:label>
                                                        <xforms:hint>
                                                            <xforms:output ref="$resources/set-status-to-final"/>
                                                        </xforms:hint>
                                                        <xforms:action ev:event="DOMActivate">
                                                            <xforms:action xxforms:iterate="instance('status-change')/@*">
                                                                <xforms:setvalue ref="context()" value="''"/>
                                                            </xforms:action>
                                                            <xforms:setvalue ref="instance('status-change')/@recurse" value="'true'"/>
                                                            <xforms:setvalue ref="instance('status-change')/@statusCode" value="'final'"/>
                                                            <xforms:setvalue ref="instance('status-change')/@actionText" value="$resources/set-status-to-final"/>
                                                            <xforms:setvalue ref="instance('status-change')/@versionLabel" value="$treeConcept/@versionLabel"/>
                                                            <xforms:setvalue ref="instance('status-change')/@expirationDate" value="substring($treeConcept/@expirationDate,1,10)"/>
                                                            <xxforms:show dialog="status-dialog"/>
                                                        </xforms:action>
                                                    </fr:button>
                                            <!-- button for setting status to 'rejected' -->
                                                    <fr:button ref=".[$editor][@statusCode=('draft')][not(ancestor-or-self::*/edit)]">
                                                        <xforms:label>
                                                            <xhtml:img src="/img/node-srejected.png" alt=""/>
                                                        </xforms:label>
                                                        <xforms:hint>
                                                            <xforms:output ref="$resources/set-status-to-rejected"/>
                                                        </xforms:hint>
                                                        <xforms:action ev:event="DOMActivate">
                                                            <xforms:action xxforms:iterate="instance('status-change')/@*">
                                                                <xforms:setvalue ref="context()" value="''"/>
                                                            </xforms:action>
                                                            <xforms:setvalue ref="instance('status-change')/@recurse" value="'true'"/>
                                                            <xforms:setvalue ref="instance('status-change')/@statusCode" value="'rejected'"/>
                                                            <xforms:setvalue ref="instance('status-change')/@actionText" value="$resources/set-status-to-rejected"/>
                                                            <xforms:setvalue ref="instance('status-change')/@versionLabel" value="$treeConcept/@versionLabel"/>
                                                            <xxforms:show dialog="status-dialog"/>
                                                        </xforms:action>
                                                    </fr:button>
                                            <!-- button for setting status to 'cancelled' -->
                                                    <fr:button ref=".[$editor][@statusCode=('draft')][not(ancestor-or-self::*/edit)]">
                                                        <xforms:label>
                                                            <xhtml:img src="/img/node-scancelled.png" alt=""/>
                                                        </xforms:label>
                                                        <xforms:hint>
                                                            <xforms:output ref="$resources/set-status-to-cancelled"/>
                                                        </xforms:hint>
                                                        <xforms:action ev:event="DOMActivate">
                                                            <xforms:action xxforms:iterate="instance('status-change')/@*">
                                                                <xforms:setvalue ref="context()" value="''"/>
                                                            </xforms:action>
                                                            <xforms:setvalue ref="instance('status-change')/@recurse" value="'true'"/>
                                                            <xforms:setvalue ref="instance('status-change')/@statusCode" value="'cancelled'"/>
                                                            <xforms:setvalue ref="instance('status-change')/@actionText" value="$resources/set-status-to-cancelled"/>
                                                            <xforms:setvalue ref="instance('status-change')/@versionLabel" value="$treeConcept/@versionLabel"/>
                                                            <xxforms:show dialog="status-dialog"/>
                                                        </xforms:action>
                                                    </fr:button>
                                            <!-- button for setting status to 'deprecated' -->
                                                    <fr:button ref=".[$editor][@statusCode=('final')][not(ancestor-or-self::*/edit)]">
                                                        <xforms:label>
                                                            <xhtml:img src="/img/node-sdeprecated.png" alt=""/>
                                                        </xforms:label>
                                                        <xforms:hint>
                                                            <xforms:output ref="$resources/set-status-to-deprecated"/>
                                                        </xforms:hint>
                                                        <xforms:action ev:event="DOMActivate">
                                                            <xforms:action xxforms:iterate="instance('status-change')/@*">
                                                                <xforms:setvalue ref="context()" value="''"/>
                                                            </xforms:action>
                                                            <xforms:setvalue ref="instance('status-change')/@recurse" value="'true'"/>
                                                            <xforms:setvalue ref="instance('status-change')/@statusCode" value="'deprecated'"/>
                                                            <xforms:setvalue ref="instance('status-change')/@actionText" value="$resources/set-status-to-deprecated"/>
                                                            <xforms:setvalue ref="instance('status-change')/@versionLabel" value="$treeConcept/@versionLabel"/>
                                                            <xxforms:show dialog="status-dialog"/>
                                                        </xforms:action>
                                                    </fr:button>
                                                </xforms:group>
                                            <!-- show cancel and save buttons if data-safe=false -->
                                                <xforms:group ref=".[$editor][not(ancestor-or-self::*/@statusCode=('final','deprecated'))][instance('data-safe')='false']">
                                                    <fr:button>
                                                        <xforms:label ref="$resources/cancel"/>
                                                        <xforms:action ev:event="DOMActivate">
                                                            <xforms:send submission="get-scenarios-submission"/>
                                                        </xforms:action>
                                                    </fr:button>
                                                    <fr:button>
                                                        <xforms:label ref="$resources/save"/>
                                                        <xforms:action ev:event="DOMActivate">
                                                            <xforms:send submission="save-scenarios"/>
                                                            <xforms:send submission="get-scenarios-submission"/>
                                                            <xforms:send submission="get-decor-dataset-tree"/>
                                                        </xforms:action>
                                                    </fr:button>
                                                </xforms:group>
                                            <!-- Button for showing transaction group diagram -->
                                                <fr:button ref=".[$currentType='transaction'][@type='group'][contains(instance('user-agent'),'Mozilla/5.0')]">
                                                    <xforms:label>
                                                        <xhtml:img src="/img/inserttreecontrol.png" alt=""/>
                                                    </xforms:label>
                                                    <xforms:hint>
                                                        <xforms:output ref="$resources/show-diagram"/>
                                                    </xforms:hint>
                                                    <xforms:action ev:event="DOMActivate">
                                                        <xforms:load resource="{$decor-external-exist}/services/GetImage?prefix={instance('project-instance')/@prefix}&amp;id={instance('scenario-navigation')}&amp;language={instance('language')}" show="new"/>
                                                    </xforms:action>
                                                </fr:button>
                                            <!-- button for creating issue -->
                                                <!-- no button when status is new as the scenario/transaction can still be cancelled leaving no object to bind to -->
                                                <!-- no button when we already have a new issue pending in the UI (it is pointless and also overwrites input the user may already have entered) -->
                                                <xxforms:variable name="noIssue" select="empty(instance('issues-instance')/issue[object/@id=instance('scenario-navigation')])"/>
                                                <fr:button ref=".[$issueCreator][$noIssue][not(@statusCode='new')]">
                                                    <xforms:label>
                                                        <xhtml:img src="/img/flag.png" alt=""/>
                                                    </xforms:label>
                                                    <xforms:hint>
                                                        <xforms:output ref="$resources/add-issue"/>
                                                    </xforms:hint>
                                                    <xforms:action ev:event="DOMActivate">
                                                        <xxforms:variable name="user" select="xxforms:get-session-attribute('username')"/>
                                                        <xforms:insert nodeset="instance('issues-instance')/issue" at="1" position="before" origin="instance('issue-instance')/issue"/>
                                                        <xforms:setvalue ref="instance('issues-instance')/issue[1]/object/@id" value="$currentId"/>
                                                        <xforms:setvalue ref="instance('issues-instance')/issue[1]/object/@effectiveDate" value="$currentEff"/>
                                                        <xforms:setvalue ref="instance('issues-instance')/issue[1]/object/@type" value="if ($currentType='scenario') then 'SC' else 'TR'"/>
                                                        <xforms:setvalue ref="instance('issues-instance')/issue[1]/tracking/author/@id" value="instance('project-instance')//author[@username=$user]/@id"/>
                                                        <xforms:setvalue ref="instance('issues-instance')/issue[1]/tracking/author" value="if (string-length(string-join(instance('project-instance')//author[@username=$user],''))&gt;0) then (instance('project-instance')//author[@username=$user]) else ($user)"/>
                                                        <xforms:setvalue ref="instance('issues-instance')/issue[1]/tracking/desc/@language" value="instance('language')"/>
                                                        <xforms:setvalue ref="instance('issues-instance')/issue[1]/tracking/desc" value="if (instance('language')='nl-NL') then '&lt;b&gt;Bevinding: &lt;/b&gt;&lt;p&gt;-&lt;/p&gt;&lt;b&gt;Voorstel: &lt;/b&gt;&lt;p&gt;-&lt;/p&gt;&lt;b&gt;Nadere toelichting: &lt;/b&gt;&lt;p&gt;-&lt;/p&gt;'                                                            else if (instance('language')='de-DE') then '&lt;b&gt;Befund: &lt;/b&gt;&lt;p&gt;-&lt;/p&gt;&lt;b&gt;Vorschlag: &lt;/b&gt;&lt;p&gt;-&lt;/p&gt;&lt;b&gt;Nähere Erläuterung: &lt;/b&gt;&lt;p&gt;-&lt;/p&gt;'                                                            else '&lt;b&gt;Finding: &lt;/b&gt;&lt;p&gt;-&lt;/p&gt;&lt;b&gt;Suggestion: &lt;/b&gt;&lt;p&gt;-&lt;/p&gt;&lt;b&gt;Further explanation: &lt;/b&gt;&lt;p&gt;-&lt;/p&gt;'"/>
                                                        <xforms:setvalue ref="instance('issues-instance')/issue[1]/@project" value="instance('document')"/>
                                                        <xforms:setfocus control="new-issue-title"/>
                                                    </xforms:action>
                                                </fr:button>
                                            </xhtml:div>
                                        </xhtml:td>
                                    </xhtml:tr>
                            <!-- scenario / transaction (group) details -->
                                    <xhtml:tr>
                                        <xhtml:td>
                                    <!-- GENERIC DETAILS SCENARIOS AND TRANSACTIONS -->
                                            <xhtml:table class="detail" width="100%">
                                        <!-- id and effectiveDate-->
                                                <xhtml:tr>
                                                    <xhtml:td class="item-label">
                                                        <xforms:output ref="$resources/id"/>
                                                    </xhtml:td>
                                                    <xhtml:td>
                                                        <xforms:output ref="@id"/>
                                                    </xhtml:td>
                                    <!-- effectiveDate -->
                                                    <xhtml:td class="item-label">
                                                        <xforms:output ref="$resources/version"/>
                                                    </xhtml:td>
                                                    <xhtml:td>
                                                        <xforms:output ref="@effectiveDate" xxforms:format="if (. castable as xs:dateTime) then replace(format-dateTime(.,'[Y0001]-[M01]-[D01] [H01]:[m01]:[s01]', (), (), ()),' 00:00:00','') else (.)"/>
                                                    </xhtml:td>
                                                </xhtml:tr>
                                        <!-- versionLabel and statusCode -->
                                                <xhtml:tr>
                                            <!-- version label -->
                                                    <xhtml:td class="item-label">
                                                        <xforms:output ref="$resources/versionLabel"/>
                                                    </xhtml:td>
                                                    <xhtml:td>
                                                        <xforms:group ref=".[not(ancestor-or-self::*/edit) or ancestor-or-self::*/@statusCode=('final','deprecated','cancelled','rejected')]">
                                                            <xforms:output ref="@versionLabel" class="short-text"/>
                                                        </xforms:group>
                                                        <xforms:group ref=".[ancestor-or-self::*/edit][not(ancestor-or-self::*/@statusCode=('final','deprecated','cancelled','rejected'))]">
                                                            <xforms:input ref="@versionLabel" class="short-text"/>
                                                        </xforms:group>
                                                    </xhtml:td>
                                            <!-- statusCode -->
                                                    <xhtml:td class="item-label">
                                                        <xforms:output ref="$resources/status"/>
                                                    </xhtml:td>
                                                    <xhtml:td>
                                                        <xxforms:variable name="statusCode" select="@statusCode"/>
                                                        <xforms:output ref="instance('decor-types')/ItemStatusCodeLifeCycle/enumeration[@value=$statusCode]/label[@language=$resources/@xml:lang]" class="{concat('node-s',$statusCode)}"/>
                                                    </xhtml:td>
                                                </xhtml:tr>
                                            
                                    <!-- NEW ISSUE -->
                                                <xforms:group ref="instance('issues-instance')/issue[object/@id=instance('scenario-navigation')]">
                                                    <xhtml:tr>
                                                        <xhtml:td colspan="4" class="heading">
                                                            <xhtml:div class="heading">
                                                                <xforms:output ref="$resources/new-issue"/>
                                                            </xhtml:div>
                                                        </xhtml:td>
                                                    </xhtml:tr>
                                                    <xhtml:tr>
                                                        <xhtml:td colspan="4">
                                                            <xi:include href="/db/apps/art/resources/xform-parts.xml" xpointer="xpointer(//part[@id='issue-new'])">
                                                                <xi:fallback>
                                                                    <xhtml:p>Included document /db/apps/art/resources/xform-parts.xml not found!</xhtml:p>
                                                                </xi:fallback>
                                                            </xi:include>
                                                        </xhtml:td>
                                                    </xhtml:tr>
                                                </xforms:group>
                                                
                                    <!-- READ ONLY SCENARIO / TRANSACTION -->
                                                <xforms:group ref=".[not(ancestor-or-self::*/edit) or ancestor-or-self::*/@statusCode=('final','deprecated','cancelled','rejected')]">
                                            <!-- READ ONLY SCENARIO -->
                                                    <xforms:group ref=".[$currentType='scenario']">
                                                <!-- description -->
                                                        <xhtml:tr>
                                                            <xhtml:td class="item-label">
                                                                <xforms:output ref="$resources/description"/>
                                                            </xhtml:td>
                                                            <xhtml:td colspan="3">
                                                                <xforms:output mediatype="text/html" ref="desc[@language=instance('language')]"/>
                                                            </xhtml:td>
                                                        </xhtml:tr>
                                                <!-- trigger -->
                                                        <xforms:group ref="trigger[@language=instance('language')]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/trigger"/>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3">
                                                                    <xforms:output mediatype="text/html" ref="."/>
                                                                </xhtml:td>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- condition -->
                                                        <xforms:group ref="condition[@language=instance('language')]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/condition"/>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3">
                                                                    <xforms:output mediatype="text/html" ref="."/>
                                                                </xhtml:td>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                    </xforms:group>
                                                    
                                            <!-- READ ONLY TRANSACTION GROUP -->
                                                    <xforms:group ref=".[$currentType='transaction'][@type='group']">
                                                <!-- description -->
                                                        <xhtml:tr>
                                                            <xhtml:td class="item-label">
                                                                <xforms:output ref="$resources/description"/>
                                                            </xhtml:td>
                                                            <xhtml:td colspan="3">
                                                                <xforms:output mediatype="text/html" ref="desc[@language=instance('language')]"/>
                                                            </xhtml:td>
                                                        </xhtml:tr>
                                                <!-- label -->
                                                        <xforms:group ref=".[string-length(@label)&gt;0]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/label"/>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3">
                                                                    <xforms:output ref="@label"/>
                                                                </xhtml:td>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- trigger -->
                                                        <xforms:group ref="trigger[@language=instance('language')]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/trigger"/>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3">
                                                                    <xhtml:table width="100%">
                                                                        <xhtml:tr>
                                                                            <xhtml:td class="item-label">
                                                                                <xforms:output ref="$resources/id"/>
                                                                            </xhtml:td>
                                                                            <xhtml:td class="item-label">
                                                                                <xforms:output ref="$resources/description"/>
                                                                            </xhtml:td>
                                                                        </xhtml:tr>
                                                                        <xhtml:tr>
                                                                            <xhtml:td>
                                                                                <xforms:output ref="@id"/>
                                                                            </xhtml:td>
                                                                            <xhtml:td>
                                                                                <xforms:output ref="."/>
                                                                            </xhtml:td>
                                                                        </xhtml:tr>
                                                                    </xhtml:table>
                                                                </xhtml:td>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- condition -->
                                                        <xforms:group ref="condition[@language=instance('language')]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/condition"/>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3">
                                                                    <xforms:output mediatype="text/html" ref="."/>
                                                                </xhtml:td>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- dependencies -->
                                                        <xforms:group ref="dependencies[@language=instance('language')]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/dependencies"/>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3">
                                                                    <xforms:output mediatype="text/html" ref="."/>
                                                                </xhtml:td>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                    </xforms:group>
                                                    
                                            <!-- READ ONLY TRANSACTION -->
                                                    <xforms:group ref=".[$currentType='transaction'][not(@type='group')]">
                                                <!-- description -->
                                                        <xhtml:tr>
                                                            <xhtml:td class="item-label">
                                                                <xforms:output ref="$resources/description"/>
                                                            </xhtml:td>
                                                            <xhtml:td colspan="3">
                                                                <xforms:output mediatype="text/html" ref="desc[@language=instance('language')]"/>
                                                            </xhtml:td>
                                                        </xhtml:tr>
                                                <!-- model and label -->
                                                        <xforms:group ref=".[string-length(@model)&gt;0 or string-length(@label)&gt;0]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/model"/>
                                                                </xhtml:td>
                                                                <xhtml:td>
                                                                    <xforms:output ref="@model"/>
                                                                </xhtml:td>
                                                                <!-- label -->
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/label"/>
                                                                </xhtml:td>
                                                                <xhtml:td>
                                                                    <xforms:output ref="@label"/>
                                                                </xhtml:td>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- trigger -->
                                                        <xforms:group ref="trigger[@language=instance('language')]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/trigger"/>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3">
                                                                    <xhtml:table width="100%">
                                                                        <xhtml:tr>
                                                                            <xhtml:td class="item-label">
                                                                                <xforms:output ref="$resources/id"/>
                                                                            </xhtml:td>
                                                                            <xhtml:td class="item-label">
                                                                                <xforms:output ref="$resources/description"/>
                                                                            </xhtml:td>
                                                                        </xhtml:tr>
                                                                        <xhtml:tr>
                                                                            <xhtml:td>
                                                                                <xforms:output ref="@id"/>
                                                                            </xhtml:td>
                                                                            <xhtml:td>
                                                                                <xforms:output ref="."/>
                                                                            </xhtml:td>
                                                                        </xhtml:tr>
                                                                    </xhtml:table>
                                                                </xhtml:td>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- condition -->
                                                        <xforms:group ref="condition[@language=instance('language')]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/condition"/>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3">
                                                                    <xforms:output mediatype="text/html" ref="."/>
                                                                </xhtml:td>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- dependencies -->
                                                        <xforms:group ref="dependencies[@language=instance('language')]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/dependencies"/>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3">
                                                                    <xforms:output mediatype="text/html" ref="."/>
                                                                </xhtml:td>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- actors -->
                                                        <xhtml:tr>
                                                            <xhtml:td class="item-label">
                                                                <xforms:output ref="$resources/actors"/>
                                                            </xhtml:td>
                                                            <xhtml:td colspan="3">
                                                                <xhtml:table width="100%">
                                                                    <xhtml:tr>
                                                                        <xhtml:td class="item-label">
                                                                            <xforms:output ref="$resources/name"/>
                                                                        </xhtml:td>
                                                                        <xhtml:td class="item-label">
                                                                            <xforms:output ref="$resources/role"/>
                                                                        </xhtml:td>
                                                                    </xhtml:tr>
                                                                    <xforms:repeat nodeset="actors/actor">
                                                                        <xhtml:tr class="not-selectable">
                                                                            <xhtml:td>
                                                                                <xxforms:variable name="actorId" select="@id"/>
                                                                                <xforms:output ref="instance('actors-instance')/actor[@id=$actorId]/name[@language=instance('language')]"/>
                                                                            </xhtml:td>
                                                                            <xhtml:td>
                                                                                <xxforms:variable name="role" select="@role"/>
                                                                                <xforms:output ref="instance('decor-types')/ActorType/enumeration[@value=$role]/label[@language=$resources/@xml:lang]"/>
                                                                            </xhtml:td>
                                                                        </xhtml:tr>
                                                                    </xforms:repeat>
                                                                </xhtml:table>
                                                            </xhtml:td>
                                                        </xhtml:tr>
                                                    </xforms:group>
                                                </xforms:group>
                                                
                                    <!-- EDITOR SCENARIO / TRANSACTION -->
                                                <xforms:group ref=".[ancestor-or-self::*/edit][not(ancestor-or-self::*/@statusCode=('final','deprecated','cancelled','rejected'))]">
                                            <!-- EDITOR SCENARIO -->
                                                    <xforms:group ref=".[$currentType='scenario']">
                                                <!-- name -->
                                                        <xhtml:tr>
                                                            <xhtml:td class="item-label">
                                                                <xforms:output ref="$resources/name"/>
                                                            </xhtml:td>
                                                            <xhtml:td colspan="3">
                                                                <xforms:input ref="name[@language=instance('language')]" id="scenarioName" incremental="true"/>
                                                            </xhtml:td>
                                                        </xhtml:tr>
                                                <!-- description -->
                                                        <xhtml:tr>
                                                            <xhtml:td class="item-label">
                                                                <xforms:output ref="$resources/description"/>
                                                            </xhtml:td>
                                                            <xhtml:td colspan="3">
                                                                <xforms:textarea mediatype="text/html" ref="desc[@language=instance('language')]"/>
                                                            </xhtml:td>
                                                        </xhtml:tr>
                                                <!-- optional trigger -->
                                                        <xforms:group ref=".[not(trigger)]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/trigger"/>
                                                                    <xhtml:div class="buttons">
                                                                        <xforms:trigger appearance="minimal">
                                                                            <xforms:label>
                                                                                <xhtml:img src="/img/itemadd.png" alt=""/>
                                                                            </xforms:label>
                                                                            <xforms:hint appearance="minimal">
                                                                                <xforms:output ref="$resources/add"/>
                                                                            </xforms:hint>
                                                                            <xforms:insert ev:event="DOMActivate" nodeset="*[self::desc]" origin="xxforms:element('trigger',(xxforms:attribute('language',instance('language'))))"/>
                                                                        </xforms:trigger>
                                                                    </xhtml:div>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3"/>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                        <xforms:group ref="trigger[@language=instance('language')]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/trigger"/>
                                                                    <xhtml:div class="buttons">
                                                                        <xforms:trigger appearance="minimal">
                                                                            <xforms:label>
                                                                                <xhtml:img src="/img/itemdelete.png" alt=""/>
                                                                            </xforms:label>
                                                                            <xforms:hint appearance="minimal">
                                                                                <xforms:output ref="$resources/remove"/>
                                                                            </xforms:hint>
                                                                            <xforms:delete ev:event="DOMActivate" nodeset="."/>
                                                                        </xforms:trigger>
                                                                    </xhtml:div>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3">
                                                                    <xforms:textarea mediatype="text/html" ref="."/>
                                                                </xhtml:td>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- optional condition -->
                                                        <xforms:group ref=".[not(condition)]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/condition"/>
                                                                    <xhtml:div class="buttons">
                                                                        <xforms:trigger appearance="minimal">
                                                                            <xforms:label>
                                                                                <xhtml:img src="/img/itemadd.png" alt=""/>
                                                                            </xforms:label>
                                                                            <xforms:hint appearance="minimal">
                                                                                <xforms:output ref="$resources/add"/>
                                                                            </xforms:hint>
                                                                            <xforms:insert ev:event="DOMActivate" nodeset="*[self::desc]" origin="xxforms:element('condition',(xxforms:attribute('language',instance('language'))))"/>
                                                                        </xforms:trigger>
                                                                    </xhtml:div>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3"/>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                        <xforms:group ref="condition[@language=instance('language')]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/condition"/>
                                                                    <xhtml:div class="buttons">
                                                                        <xforms:trigger appearance="minimal">
                                                                            <xforms:label>
                                                                                <xhtml:img src="/img/itemdelete.png" alt=""/>
                                                                            </xforms:label>
                                                                            <xforms:hint appearance="minimal">
                                                                                <xforms:output ref="$resources/remove"/>
                                                                            </xforms:hint>
                                                                            <xforms:delete ev:event="DOMActivate" nodeset="."/>
                                                                        </xforms:trigger>
                                                                    </xhtml:div>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3">
                                                                    <xforms:textarea mediatype="text/html" ref="."/>
                                                                </xhtml:td>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                    </xforms:group>
                                                    
                                            <!-- EDITOR TRANSACTION GROUP -->
                                                    <xforms:group ref=".[$currentType='transaction'][@type='group']">
                                                <!-- name and label -->
                                                        <xhtml:tr>
                                                    <!-- name -->
                                                            <xhtml:td class="item-label">
                                                                <xforms:output ref="$resources/name"/>
                                                            </xhtml:td>
                                                            <xhtml:td>
                                                                <xforms:input ref="name[@language=instance('language')]" id="transactionGroupName" incremental="true"/>
                                                            </xhtml:td>
                                                    <!-- label -->
                                                            <xhtml:td class="item-label">
                                                                <xforms:output ref="$resources/label"/>
                                                            </xhtml:td>
                                                            <xhtml:td>
                                                                <xforms:input ref="@label" class="short-text" incremental="true"/>
                                                            </xhtml:td>
                                                        </xhtml:tr>
                                                <!-- description -->
                                                        <xhtml:tr>
                                                            <xhtml:td class="item-label">
                                                                <xforms:output ref="$resources/description"/>
                                                            </xhtml:td>
                                                            <xhtml:td colspan="3">
                                                                <xforms:textarea mediatype="text/html" ref="desc[@language=instance('language')]"/>
                                                            </xhtml:td>
                                                        </xhtml:tr>
                                                <!-- optional trigger add -->
                                                        <xforms:group ref=".[not(trigger)]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/trigger"/>
                                                                    <xhtml:div class="buttons">
                                                                        <xforms:trigger appearance="minimal">
                                                                            <xforms:label>
                                                                                <xhtml:img src="/img/itemadd.png" alt=""/>
                                                                            </xforms:label>
                                                                            <xforms:hint appearance="minimal">
                                                                                <xforms:output ref="$resources/add"/>
                                                                            </xforms:hint>
                                                                            <xforms:insert ev:event="DOMActivate" nodeset="*[self::desc]" origin="xxforms:element('trigger',(xxforms:attribute('language',instance('language')),(xxforms:attribute('id',''))))"/>
                                                                        </xforms:trigger>
                                                                    </xhtml:div>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3"/>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- optional trigger edit -->
                                                        <xforms:group ref="trigger[@language=instance('language')]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/trigger"/>
                                                                    <xhtml:div class="buttons">
                                                                        <xforms:trigger appearance="minimal">
                                                                            <xforms:label>
                                                                                <xhtml:img src="/img/itemdelete.png" alt=""/>
                                                                            </xforms:label>
                                                                            <xforms:hint appearance="minimal">
                                                                                <xforms:output ref="$resources/remove"/>
                                                                            </xforms:hint>
                                                                            <xforms:delete ev:event="DOMActivate" nodeset="."/>
                                                                        </xforms:trigger>
                                                                    </xhtml:div>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3">
                                                                    <xhtml:table width="100%">
                                                                        <xhtml:tr>
                                                                            <xhtml:td class="item-label">
                                                                                <xforms:output ref="$resources/id"/>
                                                                            </xhtml:td>
                                                                            <xhtml:td class="item-label">
                                                                                <xforms:output ref="$resources/description"/>
                                                                            </xhtml:td>
                                                                        </xhtml:tr>
                                                                        <xhtml:tr>
                                                                            <xhtml:td>
                                                                                <xforms:input ref="@id" incremental="true"/>
                                                                            </xhtml:td>
                                                                            <xhtml:td>
                                                                                <xforms:textarea mediatype="text/html" ref="."/>
                                                                            </xhtml:td>
                                                                        </xhtml:tr>
                                                                    </xhtml:table>
                                                                </xhtml:td>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- optional condition add -->
                                                        <xforms:group ref=".[not(condition)]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/condition"/>
                                                                    <xhtml:div class="buttons">
                                                                        <xforms:trigger appearance="minimal">
                                                                            <xforms:label>
                                                                                <xhtml:img src="/img/itemadd.png" alt=""/>
                                                                            </xforms:label>
                                                                            <xforms:hint appearance="minimal">
                                                                                <xforms:output ref="$resources/add"/>
                                                                            </xforms:hint>
                                                                            <xforms:insert ev:event="DOMActivate" nodeset="*[self::desc]" origin="xxforms:element('condition',(xxforms:attribute('language',instance('language'))))"/>
                                                                        </xforms:trigger>
                                                                    </xhtml:div>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3"/>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- optional condition edit -->
                                                        <xforms:group ref="condition[@language=instance('language')]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/condition"/>
                                                                    <xhtml:div class="buttons">
                                                                        <xforms:trigger appearance="minimal">
                                                                            <xforms:label>
                                                                                <xhtml:img src="/img/itemdelete.png" alt=""/>
                                                                            </xforms:label>
                                                                            <xforms:hint appearance="minimal">
                                                                                <xforms:output ref="$resources/remove"/>
                                                                            </xforms:hint>
                                                                            <xforms:delete ev:event="DOMActivate" nodeset="."/>
                                                                        </xforms:trigger>
                                                                    </xhtml:div>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3">
                                                                    <xforms:textarea mediatype="text/html" ref="."/>
                                                                </xhtml:td>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- optional dependencies add -->
                                                        <xforms:group ref=".[not(dependencies)]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/dependencies"/>
                                                                    <xhtml:div class="buttons">
                                                                        <xforms:trigger appearance="minimal">
                                                                            <xforms:label>
                                                                                <xhtml:img src="/img/itemadd.png" alt=""/>
                                                                            </xforms:label>
                                                                            <xforms:hint appearance="minimal">
                                                                                <xforms:output ref="$resources/add"/>
                                                                            </xforms:hint>
                                                                            <xforms:insert ev:event="DOMActivate" nodeset="*[self::desc]" origin="xxforms:element('dependencies',(xxforms:attribute('language',instance('language'))))"/>
                                                                        </xforms:trigger>
                                                                    </xhtml:div>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3"/>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- optional dependencies edit -->
                                                        <xforms:group ref="dependencies[@language=instance('language')]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/dependencies"/>
                                                                    <xhtml:div class="buttons">
                                                                        <xforms:trigger appearance="minimal">
                                                                            <xforms:label>
                                                                                <xhtml:img src="/img/itemdelete.png" alt=""/>
                                                                            </xforms:label>
                                                                            <xforms:hint appearance="minimal">
                                                                                <xforms:output ref="$resources/remove"/>
                                                                            </xforms:hint>
                                                                            <xforms:delete ev:event="DOMActivate" nodeset="."/>
                                                                        </xforms:trigger>
                                                                    </xhtml:div>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3">
                                                                    <xforms:textarea mediatype="text/html" ref="."/>
                                                                </xhtml:td>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                    </xforms:group>
                                                    
                                            <!-- EDITOR TRANSACTION -->
                                                    <xforms:group ref=".[$currentType='transaction'][not(@type='group')]">
                                                <!-- name and type -->
                                                        <xhtml:tr>
                                                    <!-- name -->
                                                            <xhtml:td class="item-label">
                                                                <xforms:output ref="$resources/name"/>
                                                            </xhtml:td>
                                                            <xhtml:td>
                                                                <xforms:input ref="name[@language=instance('language')]" id="transactionName" incremental="true"/>
                                                            </xhtml:td>
                                                    <!-- type -->
                                                            <xhtml:td class="item-label">
                                                                <xforms:output ref="$resources/type"/>
                                                            </xhtml:td>
                                                            <xhtml:td>
                                                                <xforms:select1 ref="@type" appearance="minimal" class="auto-width">
                                                                    <xforms:itemset nodeset="instance('decor-types')/TransactionType/enumeration[not(@value='group')]">
                                                                        <xforms:label ref="label[@language=$resources/@xml:lang]"/>
                                                                        <xforms:value ref="@value"/>
                                                                    </xforms:itemset>
                                                                </xforms:select1>
                                                            </xhtml:td>
                                                        </xhtml:tr>
                                                <!-- model and label -->
                                                        <xhtml:tr>
                                                    <!-- model -->
                                                            <xhtml:td class="item-label">
                                                                <xforms:output ref="$resources/model"/>
                                                            </xhtml:td>
                                                            <xhtml:td>
                                                                <xforms:input ref="@model" incremental="true"/>
                                                            </xhtml:td>
                                                    <!-- label -->
                                                            <xhtml:td class="item-label">
                                                                <xforms:output ref="$resources/label"/>
                                                            </xhtml:td>
                                                            <xhtml:td>
                                                                <xforms:input ref="@label" incremental="true"/>
                                                            </xhtml:td>
                                                        </xhtml:tr>
                                                <!-- description -->
                                                        <xhtml:tr>
                                                            <xhtml:td class="item-label">
                                                                <xforms:output ref="$resources/description"/>
                                                            </xhtml:td>
                                                            <xhtml:td colspan="3">
                                                                <xforms:textarea mediatype="text/html" ref="desc[@language=instance('language')]"/>
                                                            </xhtml:td>
                                                        </xhtml:tr>
                                                <!-- optional trigger add -->
                                                        <xforms:group ref=".[not(trigger)]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/trigger"/>
                                                                    <xhtml:div class="buttons">
                                                                        <xforms:trigger appearance="minimal">
                                                                            <xforms:label>
                                                                                <xhtml:img src="/img/itemadd.png" alt=""/>
                                                                            </xforms:label>
                                                                            <xforms:hint appearance="minimal">
                                                                                <xforms:output ref="$resources/add"/>
                                                                            </xforms:hint>
                                                                            <xforms:insert ev:event="DOMActivate" nodeset="*[self::desc]" origin="xxforms:element('trigger',(xxforms:attribute('language',instance('language')),(xxforms:attribute('id',''))))"/>
                                                                        </xforms:trigger>
                                                                    </xhtml:div>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3"/>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- optional trigger edit -->
                                                        <xforms:group ref="trigger[@language=instance('language')]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/trigger"/>
                                                                    <xhtml:div class="buttons">
                                                                        <xforms:trigger appearance="minimal">
                                                                            <xforms:label>
                                                                                <xhtml:img src="/img/itemdelete.png" alt=""/>
                                                                            </xforms:label>
                                                                            <xforms:hint appearance="minimal">
                                                                                <xforms:output ref="$resources/remove"/>
                                                                            </xforms:hint>
                                                                            <xforms:delete ev:event="DOMActivate" nodeset="."/>
                                                                        </xforms:trigger>
                                                                    </xhtml:div>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3">
                                                                    <xhtml:table width="100%">
                                                                        <xhtml:tr>
                                                                            <xhtml:td class="item-label">
                                                                                <xforms:output ref="$resources/id"/>
                                                                            </xhtml:td>
                                                                            <xhtml:td class="item-label">
                                                                                <xforms:output ref="$resources/description"/>
                                                                            </xhtml:td>
                                                                        </xhtml:tr>
                                                                        <xhtml:tr>
                                                                            <xhtml:td>
                                                                                <xforms:input ref="@id" incremental="true"/>
                                                                            </xhtml:td>
                                                                            <xhtml:td>
                                                                                <xforms:textarea mediatype="text/html" ref="."/>
                                                                            </xhtml:td>
                                                                        </xhtml:tr>
                                                                    </xhtml:table>
                                                                </xhtml:td>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- optional condition add -->
                                                        <xforms:group ref=".[not(condition)]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/condition"/>
                                                                    <xhtml:div class="buttons">
                                                                        <xforms:trigger appearance="minimal">
                                                                            <xforms:label>
                                                                                <xhtml:img src="/img/itemadd.png" alt=""/>
                                                                            </xforms:label>
                                                                            <xforms:hint appearance="minimal">
                                                                                <xforms:output ref="$resources/add"/>
                                                                            </xforms:hint>
                                                                            <xforms:insert ev:event="DOMActivate" nodeset="*[self::desc]" origin="xxforms:element('condition',(xxforms:attribute('language',instance('language'))))"/>
                                                                        </xforms:trigger>
                                                                    </xhtml:div>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3"/>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- optional condition edit -->
                                                        <xforms:group ref="condition[@language=instance('language')]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/condition"/>
                                                                    <xhtml:div class="buttons">
                                                                        <xforms:trigger appearance="minimal">
                                                                            <xforms:label>
                                                                                <xhtml:img src="/img/itemdelete.png" alt=""/>
                                                                            </xforms:label>
                                                                            <xforms:hint appearance="minimal">
                                                                                <xforms:output ref="$resources/remove"/>
                                                                            </xforms:hint>
                                                                            <xforms:delete ev:event="DOMActivate" nodeset="."/>
                                                                        </xforms:trigger>
                                                                    </xhtml:div>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3">
                                                                    <xforms:textarea mediatype="text/html" ref="."/>
                                                                </xhtml:td>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- optional dependencies add -->
                                                        <xforms:group ref=".[not(dependencies)]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/dependencies"/>
                                                                    <xhtml:div class="buttons">
                                                                        <xforms:trigger appearance="minimal">
                                                                            <xforms:label>
                                                                                <xhtml:img src="/img/itemadd.png" alt=""/>
                                                                            </xforms:label>
                                                                            <xforms:hint appearance="minimal">
                                                                                <xforms:output ref="$resources/add"/>
                                                                            </xforms:hint>
                                                                            <xforms:insert ev:event="DOMActivate" nodeset="*[self::desc]" origin="xxforms:element('dependencies',(xxforms:attribute('language',instance('language'))))"/>
                                                                        </xforms:trigger>
                                                                    </xhtml:div>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3"/>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- optional dependencies edit -->
                                                        <xforms:group ref="dependencies[@language=instance('language')]">
                                                            <xhtml:tr>
                                                                <xhtml:td class="item-label">
                                                                    <xforms:output ref="$resources/dependencies"/>
                                                                    <xhtml:div class="buttons">
                                                                        <xforms:trigger appearance="minimal">
                                                                            <xforms:label>
                                                                                <xhtml:img src="/img/itemdelete.png" alt=""/>
                                                                            </xforms:label>
                                                                            <xforms:hint appearance="minimal">
                                                                                <xforms:output ref="$resources/remove"/>
                                                                            </xforms:hint>
                                                                            <xforms:delete ev:event="DOMActivate" nodeset="."/>
                                                                        </xforms:trigger>
                                                                    </xhtml:div>
                                                                </xhtml:td>
                                                                <xhtml:td colspan="3">
                                                                    <xforms:textarea mediatype="text/html" ref="."/>
                                                                </xhtml:td>
                                                            </xhtml:tr>
                                                        </xforms:group>
                                                <!-- actors -->
                                                        <xhtml:tr>
                                                            <xhtml:td class="item-label">
                                                                <xforms:output ref="$resources/actors"/>
                                                                <xhtml:div class="buttons">
                                                                    <xforms:trigger appearance="minimal">
                                                                        <xforms:label>
                                                                            <xhtml:img src="/img/itemadd.png" alt=""/>
                                                                        </xforms:label>
                                                                        <xforms:hint appearance="minimal">
                                                                            <xforms:output ref="$resources/add"/>
                                                                        </xforms:hint>
                                                                        <xforms:action ev:event="DOMActivate">
                                                                            <xforms:action if="instance('scenarios-instance')//transaction[@id=instance('scenario-navigation')]/actors/actor">
                                                                                <xforms:insert nodeset="instance('scenarios-instance')//transaction[@id=instance('scenario-navigation')]/actors/actor" at="last()" position="after" origin="xxforms:element('actor',(xxforms:attribute('id',instance('actors-instance')/actor[1]/@id),xxforms:attribute('role','sender')))"/>
                                                                            </xforms:action>
                                                                            <xforms:action if="not(instance('scenarios-instance')//transaction[@id=instance('scenario-navigation')]/actors/actor)">
                                                                                <xforms:insert context="instance('scenarios-instance')//transaction[@id=instance('scenario-navigation')]" origin="xxforms:element('actors','')"/>
                                                                                <xforms:insert context="instance('scenarios-instance')//transaction[@id=instance('scenario-navigation')]/actors" origin="xxforms:element('actor',(xxforms:attribute('id',instance('actors-instance')/actor[1]/@id),xxforms:attribute('role','sender')))"/>
                                                                            </xforms:action>
                                                                        </xforms:action>
                                                                    </xforms:trigger>
                                                                    <xforms:trigger appearance="minimal">
                                                                        <xforms:label>
                                                                            <xhtml:img src="/img/itemdelete.png" alt=""/>
                                                                        </xforms:label>
                                                                        <xforms:hint appearance="minimal">
                                                                            <xforms:output ref="$resources/remove"/>
                                                                        </xforms:hint>
                                                                        <xforms:delete ev:event="DOMActivate" nodeset="instance('scenarios-instance')//transaction[@id=instance('scenario-navigation')]/actors/actor[index('transactionActorList')]"/>
                                                                    </xforms:trigger>
                                                                </xhtml:div>
                                                            </xhtml:td>
                                                            <xhtml:td colspan="3">
                                                                <xhtml:table width="100%">
                                                                    <xhtml:tr>
                                                                        <xhtml:td class="item-label">
                                                                            <xforms:output ref="$resources/name"/>
                                                                        </xhtml:td>
                                                                        <xhtml:td class="item-label">
                                                                            <xforms:output ref="$resources/role"/>
                                                                        </xhtml:td>
                                                                    </xhtml:tr>
                                                                    <xforms:repeat nodeset="actors/actor" id="transactionActorList">
                                                                        <xhtml:tr>
                                                                            <xhtml:td>
                                                                                <xforms:select1 ref="@id" appearance="minimal">
                                                                                    <xforms:itemset nodeset="instance('actors-instance')/actor">
                                                                                        <xforms:label ref="name[@language=instance('language')]"/>
                                                                                        <xforms:value ref="@id"/>
                                                                                    </xforms:itemset>
                                                                                </xforms:select1>
                                                                            </xhtml:td>
                                                                            <xhtml:td>
                                                                                <xforms:select1 ref="@role" appearance="minimal">
                                                                                    <xforms:itemset nodeset="instance('decor-types')/ActorType/enumeration">
                                                                                        <xforms:label ref="label[@language=$resources/@xml:lang]"/>
                                                                                        <xforms:value ref="@value"/>
                                                                                    </xforms:itemset>
                                                                                </xforms:select1>
                                                                            </xhtml:td>
                                                                        </xhtml:tr>
                                                                    </xforms:repeat>
                                                                </xhtml:table>
                                                            </xhtml:td>
                                                        </xhtml:tr>
                                                    </xforms:group>
                                                </xforms:group>
                                            </xhtml:table>
                                            
                                        <!-- ISSUES (EXISTING) and TRANSACTION CONCEPTS/TEMPLATE -->
                                            <xhtml:table width="100%">
                                                <xhtml:tr>
                                                    <xhtml:td>
                                                <!-- EXISTING ISSUES -->
                                                        <xforms:group ref=".[instance('scenario-issues-instance')/issue]">
                                                            <fr:accordion class="fr-accordion-lnf">
                                                                <fr:case>
                                                                    <fr:label ref="concat($resources/issues,' (',count(instance('scenario-issues-instance')/issue),')')"/>
                                                                    <fr:accordion class="fr-accordion-lnf">
                                                                        <xforms:repeat nodeset="instance('scenario-issues-instance')/issue">
                                                                            <fr:case>
                                                                                <fr:label>
                                                                                    <xxforms:variable name="id" select="@id"/>
                                                                                    <xxforms:variable name="type" select="@type"/>
                                                                                    <xxforms:variable name="status" select="@currentStatusCode"/>
                                                                                    <xforms:output ref="instance('decor-types')/IssueType/enumeration[@value=$type]/label[@language=$resources/@xml:lang]" class="node-s{$status}">
                                                                                        <xforms:hint>
                                                                                            <xforms:output ref="$resources/status"/> = 
                                                                                            <xforms:output ref="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value=$status]/label[@language=$resources/@xml:lang]"/>
                                                                                        </xforms:hint>
                                                                                    </xforms:output>
                                                                                    <xforms:trigger appearance="minimal">
                                                                                        <xforms:label ref="concat('(',instance('project-instance')/ids/baseId[@id=string-join(tokenize($id,'\.')[position()!=last()],'.') ]/@prefix,tokenize($id,'\.')[last()],'): ')"/>
                                                                                        <xforms:action ev:event="DOMActivate">
                                                                                            <xforms:load resource="/decor-issues--{instance('project-instance')/@prefix}?issueId={$id}" show="new"/>
                                                                                        </xforms:action>
                                                                                    </xforms:trigger>
                                                                                    <xforms:output ref="@displayName"/>
                                                                                    <xhtml:div class="buttons">
                                                                                        <xforms:group ref=".[$editor or $issueCreator][@currentUserIsSubscribed='false']">
                                                                                            <xforms:trigger appearance="minimal">
                                                                                                <xforms:label>
                                                                                                    <xhtml:img src="/img/subscribe.png" alt=""/>
                                                                                                    <xforms:output ref="$resources/subscribe"/>
                                                                                                </xforms:label>
                                                                                                <xforms:hint ref="$resources/subscribe-hint"/>
                                                                                                <xforms:action ev:event="DOMActivate">
                                                                                                    <xforms:setvalue ref="instance('issue-navigation')/@id" value="$id"/>
                                                                                                    <xforms:setvalue ref="instance('issue-navigation')/@currentUserIsSubscribed" value="true()"/>
                                                                                                    <xforms:send submission="update-decor-issue-subscription"/>
                                                                                                    <xforms:setvalue ref="@currentUserIsSubscribed" value="true()"/>
                                                                                                </xforms:action>
                                                                                            </xforms:trigger>
                                                                                        </xforms:group>
                                                                                        <xforms:group ref=".[$editor or $issueCreator][@currentUserIsSubscribed='true']">
                                                                                            <xforms:trigger appearance="minimal">
                                                                                                <xforms:label>
                                                                                                    <xhtml:img src="/img/unsubscribe.png" alt=""/>
                                                                                                    <xforms:output ref="$resources/unsubscribe"/>
                                                                                                </xforms:label>
                                                                                                <xforms:hint ref="$resources/unsubscribe-hint"/>
                                                                                                <xforms:action ev:event="DOMActivate">
                                                                                                    <xforms:setvalue ref="instance('issue-navigation')/@id" value="$id"/>
                                                                                                    <xforms:setvalue ref="instance('issue-navigation')/@currentUserIsSubscribed" value="false()"/>
                                                                                                    <xforms:send submission="update-decor-issue-subscription"/>
                                                                                                    <xforms:setvalue ref="@currentUserIsSubscribed" value="false()"/>
                                                                                                </xforms:action>
                                                                                            </xforms:trigger>
                                                                                        </xforms:group>
                                                                                    </xhtml:div>
                                                                                </fr:label>
                                                                                <xi:include href="/db/apps/art/resources/xform-parts.xml" xpointer="xpointer(//part[@id='issue-readonly'])">
                                                                                    <xi:fallback>
                                                                                        <xhtml:p>Included document /db/apps/art/resources/xform-parts.xml not found!</xhtml:p>
                                                                                    </xi:fallback>
                                                                                </xi:include>
                                                                            </fr:case>
                                                                        </xforms:repeat>
                                                                    </fr:accordion>
                                                                </fr:case>
                                                            </fr:accordion>
                                                        </xforms:group>
                                                        
                                                <!-- TRANSACTION CONCEPTS/TEMPLATE -->
                                                        <xforms:group ref=".[$currentType='transaction'][not(@type='group')]">
                                                            <fr:accordion class="fr-accordion-lnf">
                                                                <fr:case selected="true">
                                                                    <fr:label ref="concat($resources/concepts,' (',count(representingTemplate/concept),')')"/>
                                                                    <xhtml:table width="100%">
                                                        <!-- READ ONLY -->
                                                                        <xforms:group ref=".[not(ancestor-or-self::*/edit) or ancestor-or-self::*/@statusCode=('final','deprecated','cancelled','rejected')]">
                                                                            <!-- template xx -->
                                                                            <xforms:group ref="representingTemplate[string-length(@ref)&gt;0]">
                                                                                <xhtml:tr>
                                                                                    <xhtml:td class="item-label">
                                                                                        <xforms:output ref="$resources/template"/>
                                                                                    </xhtml:td>
                                                                                    <xhtml:td>
                                                                                        <xxforms:variable name="templateEffectiveDate" select="if (string-length(@flexibility)&gt;0) then (@flexibility) else ($resources/dynamic)"/>
                                                                                        <xxforms:variable name="templateDisplayName" select="if (string-length(@templateDisplayName)&gt;0) then (@templateDisplayName) else (@ref)"/>
                                                                                        <xforms:trigger appearance="minimal" class="node-s{@templateStatusCode}">
                                                                                            <xforms:label ref="@templateId"/>
                                                                                            <xforms:action ev:event="DOMActivate">
                                                                                                <xforms:load resource="/decor-templates--{instance('project-instance')/@prefix}?templateRef={@ref}&amp;templateEffectiveDate={@flexibility}" show="new"/>
                                                                                            </xforms:action>
                                                                                        </xforms:trigger>
                                                                                        <xhtml:i>
                                                                                            <xforms:output ref="concat(' ', $templateDisplayName,' (',$templateEffectiveDate,')')"/>
                                                                                        </xhtml:i>
                                                                                    </xhtml:td>
                                                                                </xhtml:tr>
                                                                            </xforms:group>
                                                                            <!-- dataset xx -->
                                                                            <xforms:group ref="representingTemplate[string-length(@sourceDataset)&gt;0]">
                                                                                <xhtml:tr>
                                                                                    <xhtml:td class="item-label">
                                                                                        <xforms:output ref="$resources/source-dataset"/>
                                                                                    </xhtml:td>
                                                                                    <xhtml:td>
                                                                                        <xxforms:variable name="datasetname" select="(instance('dataset-instance')/name[@language=instance('language')])[1]"/>
                                                                                        <xxforms:variable name="datasetDisplayName" select="if (string-length($datasetname)&gt;0) then ($datasetname) else (@sourceDataset)"/>
                                                                                        <xxforms:variable name="datasetversion" select="(instance('dataset-instance')/@versionLabel)[1]"/>
                                                                                        <xxforms:variable name="datasetVersionLabel" select="if (string-length($datasetversion)&gt;0) then concat(' (', $datasetversion, ')') else ''"/>
                                                                                        <xforms:trigger appearance="minimal" class="node-s{instance('dataset-instance')/@statusCode}">
                                                                                            <xforms:label ref="concat($datasetDisplayName, $datasetVersionLabel)"/>
                                                                                            <xforms:action ev:event="DOMActivate">
                                                                                                <xforms:load resource="/decor-datasets--{instance('project-instance')/@prefix}?datasetId={@sourceDataset}" show="new"/>
                                                                                            </xforms:action>
                                                                                        </xforms:trigger>
                                                                                    </xhtml:td>
                                                                                </xhtml:tr>
                                                                            </xforms:group>
                                                                        </xforms:group>
                                                        <!-- EDITOR -->
                                                                        <xforms:group ref=".[ancestor-or-self::*/edit][not(ancestor-or-self::*/@statusCode=('final','deprecated','cancelled','rejected'))]">
                                                                            <!-- template xx -->
                                                                            <xhtml:tr>
                                                                                <xhtml:td class="item-label">
                                                                                    <xforms:output ref="$resources/template"/>
                                                                                    <xhtml:div class="buttons">
                                                                                        <fr:button ref=".[$editor][representingTemplate[string-length(@ref)&gt;0]]">
                                                                                            <xforms:label>
                                                                                                <xhtml:img src="/img/remove.gif" alt=""/>
                                                                                            </xforms:label>
                                                                                            <xforms:hint ref="$resources/delete"/>
                                                                                            <xforms:action ev:event="DOMActivate">
                                                                                                <xforms:setvalue ref="representingTemplate/@ref" value="''"/>
                                                                                                <xforms:setvalue ref="representingTemplate/@flexibility" value="''"/>
                                                                                            </xforms:action>
                                                                                        </fr:button>
                                                                                        <fr:button ref=".[$editor]">
                                                                                            <xforms:label>
                                                                                                <xhtml:img src="/img/write.png" alt=""/>
                                                                                            </xforms:label>
                                                                                            <xforms:hint ref="$resources/edit"/>
                                                                                            <xforms:action ev:event="DOMActivate">
                                                                                                <xxforms:show dialog="template-dialog"/>
                                                                                            </xforms:action>
                                                                                        </fr:button>
                                                                                    </xhtml:div>
                                                                                </xhtml:td>
                                                                                <xhtml:td>
                                                                                    <xforms:group ref="representingTemplate[string-length(@ref)&gt;0]">
                                                                                        <xxforms:variable name="templateEffectiveDate" select="if (string-length(@flexibility)&gt;0) then (@flexibility) else ($resources/dynamic)"/>
                                                                                        <xxforms:variable name="templateDisplayName" select="if (string-length(@templateDisplayName)&gt;0) then (@templateDisplayName) else (@ref)"/>
                                                                                        <xforms:trigger appearance="minimal" class="node-s{@templateStatusCode}">
                                                                                            <xforms:label ref="concat($templateDisplayName,' (',$templateEffectiveDate,')')"/>
                                                                                            <xforms:action ev:event="DOMActivate">
                                                                                                <xforms:load resource="/decor-templates--{instance('project-instance')/@prefix}?templateRef={@ref}&amp;templateEffectiveDate={@flexibility}" show="new"/>
                                                                                            </xforms:action>
                                                                                        </xforms:trigger>
                                                                                    </xforms:group>
                                                                                </xhtml:td>
                                                                            </xhtml:tr>
                                                                            <!-- dataset xx -->
                                                                            <xhtml:tr>
                                                                                <xhtml:td class="item-label">
                                                                                    <xforms:output ref="$resources/source-dataset"/>
                                                                                </xhtml:td>
                                                                                <xhtml:td>
                                                                                    <xforms:select1 ref="representingTemplate/@sourceDataset" appearance="minimal">
                                                                                        <xforms:item>
                                                                                            <xforms:label ref="concat('--',$resources/not-set,'--')"/>
                                                                                            <xforms:value ref="''"/>
                                                                                        </xforms:item>
                                                                                        <xforms:itemset nodeset="instance('dataset-list')/dataset">
                                                                                            <xforms:label ref="concat(name[@language=instance('language')][1], if (string-length(@versionLabel)&gt;0) then concat(' (', @versionLabel, ')') else '')"/>
                                                                                            <xforms:value ref="@id"/>
                                                                                        </xforms:itemset>
                                                                                    </xforms:select1>
                                                                                </xhtml:td>
                                                                            </xhtml:tr>
                                                                        </xforms:group>
                                                        <!-- row with concept navigation and details -->
                                                                        <xhtml:tr>
                                                                            <!-- concept navigation -->
                                                                            <xhtml:td>
                                                                                <!-- variable selected concept -->
                                                                                <xxforms:variable name="current-concept" select="instance('dataset-instance')//concept[@id=instance('concept-navigation')]"/>
                                                                                <xhtml:table width="100%">
                                                                                    <!-- row with heading for tree control and edit buttons	-->
                                                                                    <xhtml:tr>
                                                                                        <xhtml:td class="heading">
                                                                                            <xhtml:div class="heading">
                                                                                                <xforms:output ref="$resources/concepts"/>
                                                                                            </xhtml:div>
                                                                                            <xhtml:div class="buttons">
                                                                                                <xforms:group ref=".[$editor][not(ancestor-or-self::*/@statusCode='final' or ancestor-or-self::*/@statusCode='deprecated')][instance('data-safe')='true']">
                                                                                                    <fr:button ref="instance('dataset-instance')/concept">
                                                                                                        <xforms:label>
                                                                                                            <xhtml:img src="/img/write.png" alt=""/>
                                                                                                        </xforms:label>
                                                                                                        <xforms:hint ref="$resources/edit-transaction"/>
                                                                                                        <xforms:action ev:event="DOMActivate">
                                                                                                            <xforms:load resource="/transaction/{instance('scenario-navigation')}" show="new"/>
                                                                                                        </xforms:action>
                                                                                                    </fr:button>
                                                                                                </xforms:group>
                                                                                            </xhtml:div>
                                                                                        </xhtml:td>
                                                                                    </xhtml:tr>
                                                                                    <xhtml:tr>
                                                                                        <xhtml:td>
                                                                                            <xhtml:div class="navigate">
                                                                                                <xforms:select1 ref="instance('concept-navigation')" appearance="xxforms:tree">
                                                                                                    <xforms:itemset nodeset="instance('dataset-instance')//concept[not(@absent)][not(ancestor::conceptList)]" class="node-s{if (inherit/@iStatusCode) then inherit/@iStatusCode else @statusCode}">
                                                                                                        <!--<xforms:label ref="name[@language=instance('language')]"/>-->
                                                                                                        <xforms:label>
                                                                                                            <xforms:output ref="name[@language=instance('language')]"/>
                                                                                                            <xforms:output ref="if (@conformance='NP') then '' else @minimumMultiplicity"/>
                                                                                                            <xforms:output value="if (@conformance='NP' or string-length(concat(@minimumMultiplicity,@maximumMultiplicity))=0) then ('') else ('..')"/>
                                                                                                            <xforms:output ref="if (@conformance='NP') then '' else @maximumMultiplicity"/>
                                                                                                            <xforms:output ref="if (string(@isMandatory)='true') then ('M') else (@conformance)"/>
                                                                                                        </xforms:label>
                                                                                                        <xforms:value ref="@id"/>
                                                                                                    </xforms:itemset>
                                                                                                    <xforms:action ev:event="xforms-value-changed">
                                                                                                        <xforms:send submission="get-concept"/>
                                                                                                        <xforms:send submission="get-concept-associations"/>
                                                                                                        <xforms:send submission="get-concept-issues"/>
                                                                                                    </xforms:action>
                                                                                                </xforms:select1>
                                                                                            </xhtml:div>
                                                                                        </xhtml:td>
                                                                                    </xhtml:tr>
                                                                                </xhtml:table>
                                                                            </xhtml:td>
                                                                            <!-- concept details -->
                                                                            <xhtml:td width="60%">
                                                                                <!-- Need to have at least one active concept in the current dataset to be sure we display details for something relevant -->
                                                                                <xs:group ref=".[instance('dataset-instance')//concept[not(@absent)]]">
                                                                                    <xhtml:table width="100%">
                                                                                        <xforms:group ref="instance('dataset-instance')//concept[@id=instance('concept-navigation')]">
                                                                                            <xxforms:variable name="conceptId" select="@id"/>
                                                                                            <xxforms:variable name="type" select="@type"/>
                                                                                            <xxforms:variable name="conceptInTemplate" select="instance('scenarios-instance')//transaction[@id=instance('scenario-navigation')]/representingTemplate/concept[@ref=$conceptId]"/>
                                                                                            <!-- row with concept header -->
                                                                                            <xhtml:tr>
                                                                                                <xhtml:td class="heading">
                                                                                                    <xhtml:div class="heading">
                                                                                                        <xforms:output ref="name[@language=instance('language')]"/>
                                                                                                    </xhtml:div>
                                                                                                    <xhtml:div class="buttons">
                                                                                                        <!-- button for showing diagram in new window -->
                                                                                                        <xforms:group ref=".[contains(instance('user-agent'),'Mozilla/5.0')]">
                                                                                                            <fr:button id="view-transaction-diagram-concept">
                                                                                                                <xforms:label>
                                                                                                                    <xhtml:img src="/img/inserttreecontrol.png" alt=""/>
                                                                                                                </xforms:label>
                                                                                                                <xforms:hint ref="$resources/show-diagram"/>
                                                                                                                <xforms:action ev:event="DOMActivate">
                                                                                                                    <xforms:load resource="{$decor-external-exist}/services/RetrieveConceptDiagram?id={instance('concept-navigation')}&amp;transactionId={instance('scenario-navigation')}&amp;language={instance('language')}" show="new"/>
                                                                                                                </xforms:action>
                                                                                                            </fr:button>
                                                                                                        </xforms:group>
                                                                                                    </xhtml:div>
                                                                                                </xhtml:td>
                                                                                            </xhtml:tr>
                                                                                            <!-- row with transaction concept details -->
                                                                                            <xhtml:tr>
                                                                                                <xhtml:td>
                                                                                                    <xhtml:table class="detail" width="100%">
                                                                                                        <!-- row with cardinality -->
                                                                                                        <xforms:group ref=".[$conceptInTemplate/@minimumMultiplicity]">
                                                                                                            <xhtml:tr>
                                                                                                                <xhtml:td class="item-label">
                                                                                                                    <xforms:output ref="$resources/cardinality"/>
                                                                                                                </xhtml:td>
                                                                                                                <xhtml:td>
                                                                                                                    <xforms:output ref="$conceptInTemplate/@minimumMultiplicity"/>..<xforms:output ref="$conceptInTemplate/@maximumMultiplicity"/>
                                                                                                                    <xforms:group ref=".[$conceptInTemplate/@isMandatory='true']">
                                                                                                                        <xforms:output ref="$resources/mandatory"/>
                                                                                                                    </xforms:group>
                                                                                                                </xhtml:td>
                                                                                                            </xhtml:tr>
                                                                                                        </xforms:group>
                                                                                                        <!-- row with conformance -->
                                                                                                        <xforms:group ref=".[$conceptInTemplate/@conformance]">
                                                                                                            <xhtml:tr>
                                                                                                                <xhtml:td class="item-label">
                                                                                                                    <xforms:output ref="$resources/conformance"/>
                                                                                                                </xhtml:td>
                                                                                                                <xhtml:td>
                                                                                                                    <xxforms:variable name="conformance" select="$conceptInTemplate/@conformance"/>
                                                                                                                    <xforms:output ref="instance('decor-types')/ConformanceType/enumeration[@value=$conformance]/label[@language=$resources/@xml:lang]"/>
                                                                                                                </xhtml:td>
                                                                                                            </xhtml:tr>
                                                                                                        </xforms:group>
                                                                                                        <xforms:repeat nodeset="$conceptInTemplate/condition">
                                                                                                            <xhtml:tr class="not-selectable">
                                                                                                                <xhtml:td class="item-label">
                                                                                                                    <xforms:output ref="$resources/condition"/>
                                                                                                                </xhtml:td>
                                                                                                                <xhtml:td>
                                                                                                                    <xhtml:table width="100%">
                                                                                                                        <xhtml:tr>
                                                                                                                            <xhtml:td colspan="2">
                                                                                                                                <xforms:group ref=".[string-length(.)&gt;0]">
                                                                                                                                    <xforms:output ref="."/>
                                                                                                                                </xforms:group>
                                                                                                                                <xforms:group ref=".[string-length(.)=0]">
                                                                                                                                    <xforms:output ref="$resources/in-all-other-cases"/>
                                                                                                                                </xforms:group>
                                                                                                                            </xhtml:td>
                                                                                                                        </xhtml:tr>
                                                                                                                        <xhtml:tr>
                                                                                                                            <xhtml:td class="item-label">
                                                                                                                                <xforms:output ref="if (.[@minimumMultiplicity or @maximumMultiplicity]) then ($resources/cardinality) else ($resources/conformance)"/>
                                                                                                                            </xhtml:td>
                                                                                                                            <xhtml:td>
                                                                                                                                <xforms:group ref=".[@minimumMultiplicity or @maximumMultiplicity]">
                                                                                                                                    <xforms:output ref="@minimumMultiplicity"/>..<xforms:output ref="@maximumMultiplicity"/>
                                                                                                                                </xforms:group>
                                                                                                                                <xxforms:variable name="conformance" select="@conformance"/>
                                                                                                                                <xforms:output ref="instance('decor-types')/ConformanceType/enumeration[@value=$conformance]/label[@language=$resources/@xml:lang]"/>
                                                                                                                                <xforms:group ref=".[@isMandatory='true']">
                                                                                                                                    <xforms:output ref="$resources/mandatory"/>
                                                                                                                                </xforms:group>
                                                                                                                            </xhtml:td>
                                                                                                                        </xhtml:tr>
                                                                                                                    </xhtml:table>
                                                                                                                </xhtml:td>
                                                                                                            </xhtml:tr>
                                                                                                        </xforms:repeat>
                                                                                                    </xhtml:table>
                                                                                                </xhtml:td>
                                                                                            </xhtml:tr>
                                                                                        </xforms:group>
                                                                                        <!-- row with concept details -->
                                                                                        <xforms:group ref="instance('selected-concept')">
                                                                                            <xhtml:tr>
                                                                                                <xhtml:td>
                                                                                                    <xi:include href="/db/apps/art/resources/xform-parts.xml" xpointer="xpointer(//part[@id='concept-readonly'])">
                                                                                                        <xi:fallback>
                                                                                                            <xhtml:p>Included document /db/apps/art/resources/xform-parts.xml not found!</xhtml:p>
                                                                                                        </xi:fallback>
                                                                                                    </xi:include>
                                                                                                </xhtml:td>
                                                                                            </xhtml:tr>
                                                                                        </xforms:group>
                                                                                        <!-- group for community info -->
                                                                                        <xforms:group ref="instance('selected-concept')/community[.//association/data]">
                                                                                            <xhtml:tr>
                                                                                                <xhtml:td>
                                                                                                    <fr:accordion class="fr-accordion-lnf">
                                                                                                        <fr:case>
                                                                                                            <fr:label ref="concat($resources/community,' (',count(instance('selected-concept')/community//association/data),')')"/>
                                                                                                            <xhtml:div class="detail">
                                                                                                                <fr:accordion class="fr-accordion-lnf">
                                                                                                                    <xforms:repeat nodeset="associations/association/data">
                                                                                                                        <xi:include href="/db/apps/art/resources/xform-parts.xml" xpointer="xpointer(//part[@id='concept-community-readonly'])">
                                                                                                                            <xi:fallback>
                                                                                                                                <xhtml:p>Included document /db/apps/art/resources/xform-parts.xml not found!</xhtml:p>
                                                                                                                            </xi:fallback>
                                                                                                                        </xi:include>
                                                                                                                    </xforms:repeat>
                                                                                                                </fr:accordion>
                                                                                                            </xhtml:div>
                                                                                                        </fr:case>
                                                                                                    </fr:accordion>
                                                                                                </xhtml:td>
                                                                                            </xhtml:tr>
                                                                                        </xforms:group>
                                                                                        <!-- group with existing issues -->
                                                                                        <xforms:group ref="instance('concept-issues-instance')/issue">
                                                                                            <xhtml:tr>
                                                                                                <xhtml:td>
                                                                                                    <fr:accordion class="fr-accordion-lnf">
                                                                                                        <fr:case>
                                                                                                            <fr:label ref="concat($resources/issues,' (',count(instance('concept-issues-instance')/issue),')')"/>
                                                                                                            <xhtml:div class="detail">
                                                                                                                <fr:accordion class="fr-accordion-lnf">
                                                                                                                    <xforms:repeat nodeset="instance('concept-issues-instance')/issue" id="concept-issues">
                                                                                                                        <fr:case>
                                                                                                                            <fr:label>
                                                                                                                                <xxforms:variable name="id" select="@id"/>
                                                                                                                                <xxforms:variable name="type" select="@type"/>
                                                                                                                                <xxforms:variable name="status" select="@currentStatusCode"/>
                                                                                                                                <xforms:output ref="instance('decor-types')/IssueType/enumeration[@value=$type]/label[@language=$resources/@xml:lang]" class="node-s{$status}">
                                                                                                                                    <xforms:hint>
                                                                                                                                        <xforms:output ref="$resources/status"/> = 
                                                                                                                                        <xforms:output ref="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value=$status]/label[@language=$resources/@xml:lang]"/>
                                                                                                                                    </xforms:hint>
                                                                                                                                </xforms:output>
                                                                                                                                <xforms:trigger appearance="minimal">
                                                                                                                                    <xforms:label ref="concat('(',instance('project-instance')/ids/baseId[@id=string-join(tokenize($id,'\.')[position()!=last()],'.') ]/@prefix,tokenize($id,'\.')[last()],'): ')"/>
                                                                                                                                    <xforms:action ev:event="DOMActivate">
                                                                                                                                        <xforms:load resource="/decor-issues--{instance('project-instance')/@prefix}?issueId={$id}" show="new"/>
                                                                                                                                    </xforms:action>
                                                                                                                                </xforms:trigger>
                                                                                                                                <xforms:output ref="@displayName"/>
                                                                                                                                <xhtml:div class="buttons">
                                                                                                                                    <xforms:group ref=".[$editor or $issueCreator][@currentUserIsSubscribed='false']">
                                                                                                                                        <xforms:trigger appearance="minimal">
                                                                                                                                            <xforms:label>
                                                                                                                                                <xhtml:img src="/img/subscribe.png" alt=""/>
                                                                                                                                                <xforms:output ref="$resources/subscribe"/>
                                                                                                                                            </xforms:label>
                                                                                                                                            <xforms:hint ref="$resources/subscribe-hint"/>
                                                                                                                                            <xforms:action ev:event="DOMActivate">
                                                                                                                                                <xforms:setvalue ref="instance('issue-navigation')/@id" value="$id"/>
                                                                                                                                                <xforms:setvalue ref="instance('issue-navigation')/@currentUserIsSubscribed" value="true()"/>
                                                                                                                                                <xforms:send submission="update-decor-issue-subscription"/>
                                                                                                                                                <xforms:setvalue ref="@currentUserIsSubscribed" value="true()"/>
                                                                                                                                            </xforms:action>
                                                                                                                                        </xforms:trigger>
                                                                                                                                    </xforms:group>
                                                                                                                                    <xforms:group ref=".[$editor or $issueCreator][@currentUserIsSubscribed='true']">
                                                                                                                                        <xforms:trigger appearance="minimal">
                                                                                                                                            <xforms:label>
                                                                                                                                                <xhtml:img src="/img/unsubscribe.png" alt=""/>
                                                                                                                                                <xforms:output ref="$resources/unsubscribe"/>
                                                                                                                                            </xforms:label>
                                                                                                                                            <xforms:hint ref="$resources/unsubscribe-hint"/>
                                                                                                                                            <xforms:action ev:event="DOMActivate">
                                                                                                                                                <xforms:setvalue ref="instance('issue-navigation')/@id" value="$id"/>
                                                                                                                                                <xforms:setvalue ref="instance('issue-navigation')/@currentUserIsSubscribed" value="false()"/>
                                                                                                                                                <xforms:send submission="update-decor-issue-subscription"/>
                                                                                                                                                <xforms:setvalue ref="@currentUserIsSubscribed" value="false()"/>
                                                                                                                                            </xforms:action>
                                                                                                                                        </xforms:trigger>
                                                                                                                                    </xforms:group>
                                                                                                                                </xhtml:div>
                                                                                                                            </fr:label>
                                                                                                                            <xi:include href="/db/apps/art/resources/xform-parts.xml" xpointer="xpointer(//part[@id='issue-readonly'])">
                                                                                                                                <xi:fallback>
                                                                                                                                    <xhtml:p>Included document /db/apps/art/resources/xform-parts.xml not found!</xhtml:p>
                                                                                                                                </xi:fallback>
                                                                                                                            </xi:include>
                                                                                                                        </fr:case>
                                                                                                                    </xforms:repeat>
                                                                                                                </fr:accordion>
                                                                                                            </xhtml:div>
                                                                                                        </fr:case>
                                                                                                    </fr:accordion>
                                                                                                </xhtml:td>
                                                                                            </xhtml:tr>
                                                                                        </xforms:group>
                                                                                    </xhtml:table>
                                                                                </xs:group>
                                                                            </xhtml:td>
                                                                        </xhtml:tr>
                                                                    </xhtml:table>
                                                                </fr:case>
                                                            </fr:accordion>
                                                        </xforms:group>
                                                    </xhtml:td>
                                                </xhtml:tr>
                                            </xhtml:table>
                                        </xhtml:td>
                                    </xhtml:tr>
                                </xhtml:table>
                            </xforms:group>
                        </xhtml:td>
                    </xhtml:tr>
                </xhtml:table>
            </fr:tab>
         <!-- Actors -->
            <fr:tab>
                <fr:label ref="$resources/actors"/>
            <!-- row with Actors header and Save and Cancel buttons -->
                <xhtml:table class="detail" width="100%">
                    <xhtml:tr>
                        <xhtml:td class="heading" colspan="3">
                            <xhtml:div class="heading">
                                <xforms:output ref="$resources/actors-in-all-scenarios"/>
                            </xhtml:div>
                            <xhtml:div class="buttons">
                                <xforms:group ref=".[$editor]">
                                    <fr:button>
                                        <xforms:label>
                                            <xhtml:img src="/img/plus.png" alt=""/>
                                        </xforms:label>
                                        <xforms:hint>
                                            <xforms:output ref="$resources/add-actor"/>
                                        </xforms:hint>
                                        <xforms:action ev:event="DOMActivate">
                                            <xxforms:variable name="baseId" select="instance('project-instance')/ids/defaultBaseId[@type='AC']/@id"/>
                                            <xforms:action if="not(instance('actors-instance')/actor)">
                                                <xforms:setvalue ref="instance('new-actor-instance')/@id" value="concat($baseId,'.1')"/>
                                            </xforms:action>
                                            <xforms:action if="instance('actors-instance')/actor">
                                                <xxforms:variable name="newId" select="concat($baseId,'.',max(instance('actors-instance')/actor[starts-with(@id,concat($baseId,'.')) and count(tokenize(@id,'\.'))=count(tokenize($baseId,'\.'))+1]/number(tokenize(@id,'\.')[last()]))+1)"/>
                                                <xforms:setvalue ref="instance('new-actor-instance')/@id" value="$newId"/>
                                            </xforms:action>
                                            <xforms:setvalue ref="instance('new-actor-instance')/@type" value="instance('decor-types')/ScenarioActorType/enumeration[1]/@value"/>
                                            <xforms:setvalue ref="instance('new-actor-instance')/name/@language" value="instance('language')"/>
                                            <xforms:insert context="instance('actors-instance')" nodeset="actor" at="last()" position="after" origin="instance('new-actor-instance')"/>
                                            <xforms:setvalue ref="instance('actors-safe')">false</xforms:setvalue>
                                        </xforms:action>
                                    </fr:button>
                                </xforms:group>
                        <!-- show cancel and save buttons if data-safe=false -->
                                <xforms:group ref=".[instance('actors-safe')='false']">
                                    <fr:button>
                                        <xforms:label ref="$resources/cancel"/>
                                        <xforms:action ev:event="DOMActivate">
                                            <xforms:send submission="get-actors-submission"/>
                                        </xforms:action>
                                    </fr:button>
                                    <fr:button>
                                        <xforms:label ref="$resources/save"/>
                                        <xforms:action ev:event="DOMActivate">
                                            <xforms:send submission="save-actors-submission"/>
                                            <xforms:send submission="get-actors-submission"/>
                                        </xforms:action>
                                    </fr:button>
                                </xforms:group>
                            </xhtml:div>
                        </xhtml:td>
                    </xhtml:tr>

               <!-- row with Actors table heading -->
                    <xhtml:tr>
                        <xhtml:td class="item-label-var">
                            <xforms:output ref="$resources/name"/>
                        </xhtml:td>
                        <xhtml:td class="item-label-var">
                            <xforms:output ref="$resources/type"/>
                        </xhtml:td>
                        <xhtml:td class="item-label-var">
                            <xforms:output ref="$resources/description"/>
                        </xhtml:td>
                    </xhtml:tr>
               <!-- read only view -->
                    <xforms:group ref=".[not($editor)]">
                        <xforms:repeat nodeset="instance('actors-instance')/actor">
                            <xhtml:tr class="not-selectable">
                                <xhtml:td>
                                    <xforms:output ref="name[@language=instance('language')]"/>
                                </xhtml:td>
                                <xhtml:td>
                                    <xxforms:variable name="type" select="@type"/>
                                    <xforms:output ref="instance('decor-types')/ScenarioActorType/enumeration[@value=$type]/label[@language=$resources/@xml:lang]"/>
                                </xhtml:td>
                                <xhtml:td>
                                    <xforms:output mediatype="text/html" ref="desc[@language=instance('language')]"/>
                                </xhtml:td>
                            </xhtml:tr>
                        </xforms:repeat>
                    </xforms:group>
               <!-- editor form -->
                    <xforms:group ref=".[$editor]">
                        <xforms:repeat nodeset="instance('actors-instance')/actor" id="actorList">
                            <xhtml:tr class="not-selectable">
                                <xhtml:td>
                                    <xforms:input ref="name[@language=instance('language')]" incremental="true"/>
                                </xhtml:td>
                                <xhtml:td>
                                    <xforms:select1 id="concept-type" ref="@type" appearance="minimal" class="auto-width">
                                        <xforms:itemset nodeset="instance('decor-types')/ScenarioActorType/enumeration">
                                            <xforms:label ref="label[@language=$resources/@xml:lang]"/>
                                            <xforms:value ref="@value"/>
                                        </xforms:itemset>
                                    </xforms:select1>
                                </xhtml:td>
                                <xhtml:td>
                                    <xforms:textarea mediatype="text/html" ref="desc[@language=instance('language')]"/>
                                    <xforms:group ref=".[not(desc)]">
                                        <xforms:trigger appearance="minimal">
                                            <xforms:label>
                                                <xhtml:img src="/img/itemadd.png" alt=""/>
                                            </xforms:label>
                                            <xforms:hint appearance="minimal">
                                                <xforms:output ref="$resources/add"/>
                                            </xforms:hint>
                                            <xforms:insert ev:event="DOMActivate" nodeset="*[self::name]" origin="xxforms:element('desc',(xxforms:attribute('language',instance('language'))))"/>
                                        </xforms:trigger>
                                    </xforms:group>
                                </xhtml:td>
                            </xhtml:tr>
                        </xforms:repeat>
                    </xforms:group>
                </xhtml:table>
            </fr:tab>
        </fr:tabview>
      <!--        <fr:xforms-inspector/>-->
    </xhtml:body>
</xhtml:html>