<!--
    Copyright (C) 2013-2014 Art Decor expert group
    
    Author: Gerrit Boers

    This program is free software; you can redistribute it and/or modify it under the terms of the
    GNU Lesser General Public License as published by the Free Software Foundation; either version
    2.1 of the License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
    without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
    See the GNU Lesser General Public License for more details.

    The full text of the license is available at http://www.gnu.org/copyleft/lesser.html
-->
<xhtml:html xmlns:f="http://orbeon.org/oxf/xml/formatting" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xhtml="http://www.w3.org/1999/xhtml"
   xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:fr="http://orbeon.org/oxf/xml/form-runner" xmlns:xxforms="http://orbeon.org/oxf/xml/xforms" xmlns:widget="http://orbeon.org/oxf/xml/widget"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://www.w3.org/2002/xforms ../resources/schemas/xforms-1_0-orbeon.xsd http://www.w3.org/1999/xhtml ../resources/schemas/xhtml1-transitional-orbeon.xsd http://www.w3.org/2001/xml-events ../resources/schemas/xml-events-attribs-1.xsd">
   <xhtml:head>
      <xhtml:style type="text/css"
         >
         table.scroll {
         width: 100%;
         }
         table.no-scroll {
         width: 99%;
         }
         .xforms-select1-appearance-full span
         {
         display: block;
         clear: both 
         } 
         .xforms-select-appearance-full span { display: block; clear: both } 
         .xforms-repeat-selected-item-2 {
         font-weight: normal;
         background-color: inherit; 
         color : black
         }
         td.item-label-var, td.heading-var {
         background-color:#f0ebe4;
         color:#7a6e62;
         padding-left : 0.5em;
         padding-right : 0em;
         padding-top : 0.25em;
         padding-bottom : 0.25em;
         text-align:left;
         vertical-align:top;
         }
         td.heading-var {
         font-weight: bold;

         }
         img.small-button {
         margin-left: 0.1em;
         margin-right: 0.1em;
         }
         td.heading-small {
         font-weight: bold;
         text-align:left;
         background-color:#ebe7e1;
         color:#7a6e62;
         padding-right:0.4em;
         padding-left:0.4em;
         }
         td.desc-var {
         padding-left : 0.5em;
         padding-right : 0em;
         padding-top : 0.25em;
         padding-bottom : 0.25em;
         }                    
         .xforms-input.long input {
         width: 50em;
         margin-bottom: 2px;
         text-align: left
         }
         
         .xforms-repeat-selected-item-1.mapping {
         font-weight: normal;
         background-color: inherit; 
         color : black
         }
         .xforms-repeat-selected-item-2.mapping{
         font-weight: normal;
         background-color: inherit; 
         color : black
         }
         .xforms-repeat-selected-item-3.mapping{
         font-weight: normal;
         background-color: inherit; 
         color : black
         }
         .xforms-repeat-selected-item-4.mapping{
         font-weight: normal;
         background-color: inherit; 
         color : black
         }
         .xforms-repeat-template.mapping {
         font-weight: normal;
         background-color: inherit; 
         color : black
         }
         tr.mapping:hover {
         background-color: #eee; 
         }         
         div.heading-alert {
         float:left;
         color : red;
         font-style : italic;
         font-size : 1.25em;
         font-weight : bold;
         vertical-align: middle;
         }
         .node-alert {
         color: red; 
         font-style : italic;
         }
      </xhtml:style>
      <xhtml:title>
         <xforms:output ref="$resources/dhd-thesaurus-editor"/>
      </xhtml:title>
      <xforms:model id="dhd-form-model">
         <!-- Variable with path to art-exist for use by form -->
         <xxforms:variable name="art-exist" select="xxforms:property('art.exist.url')"/>
         <!-- Variable with path to decor-eXist used to pass to client as link for services (Diagrams in new window) -->
         <xxforms:variable name="decor-exist" select="xxforms:property('decor.exist.url')"/>
         <!-- Variable with path to terminology-eXist used to pass to client as link for services (SNOMED, LOINC) -->
         <xxforms:variable name="terminology-exist" select="xxforms:property('terminology.exist.url')"/>
         <xxforms:variable name="terminology-external-exist" select="xxforms:property('terminology.external.exist.url')"/>

         <!-- dhd concept -->
         <xforms:instance id="dhd-concept" xxforms:exclude-result-prefixes="#all">
            <concept/>
         </xforms:instance>
         <!-- instance with logo -->
         <xforms:instance id="logo">
            <logo href="http://www.dutchhospitaldata.nl">dhd-logo40.png</logo>
         </xforms:instance>
         <!-- resources for internationalization -->
         <xforms:instance id="resources-instance">
            <dummy/>
         </xforms:instance>
         <!-- submission for loading resources -->
         <xforms:submission id="get-resources-submission" serialization="none" method="get" resource="{$art-exist}/modules/get-form-resources.xquery?packageRoot=terminology" replace="instance"
            instance="resources-instance">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred:<xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- language -->
         <xforms:instance id="language">
            <language/>
         </xforms:instance>
         <!-- instance for status codes enumeration -->
         <xforms:instance id="status-codes">
            <ThesaurusConceptStatusCodeLifeCycle>
               <enumeration value="draft">
                  <label language="nl-NL">Ontwerp</label>
                  <label language="en-US">Draft</label>
                  <label language="de-DE">Entwurf</label>
               </enumeration>
               <enumeration value="active">
                  <label language="nl-NL">Actief</label>
                  <label language="en-US">Active</label>
                  <label language="de-DE">Aktiv</label>
               </enumeration>
               <enumeration value="retired">
                  <label language="nl-NL">Obsoleet</label>
                  <label language="en-US">Retired</label>
                  <label language="de-DE">Obsolet</label>
               </enumeration>
               <enumeration value="rejected">
                  <label language="nl-NL">Afgewezen</label>
                  <label language="en-US">Rejected</label>
                  <label language="de-DE">Abgewiesen</label>
               </enumeration>
               <enumeration value="update">
                  <label language="nl-NL">In bewerking</label>
                  <label language="en-US">Under update</label>
                  <label language="de-DE">In Bearbeitung</label>
               </enumeration>
               <enumeration value="pending">
                  <label language="nl-NL">Gepland voor activatie</label>
                  <label language="en-US">scheduled for activation</label>
                  <label language="de-DE"/>
               </enumeration>
               <enumeration value="review">
                  <label language="nl-NL">Wordt gereviewed</label>
                  <label language="en-US">In Review</label>
                  <label language="de-DE">In Revision</label>
               </enumeration>
            </ThesaurusConceptStatusCodeLifeCycle>
         </xforms:instance>
         <!-- instance for status codes enumeration -->
         <xforms:instance id="release-status-codes">
            <ReleaseStatusCodeLifeCycle>
               <enumeration value="draft">
                  <label language="nl-NL">Voorlopig</label>
                  <label language="en-US">Draft</label>
                  <label language="de-DE"/>
               </enumeration>
               <enumeration value="final">
                  <label language="nl-NL">Definitief</label>
                  <label language="en-US">Final</label>
                  <label language="de-DE"/>
               </enumeration>
               <enumeration value="deprecated">
                  <label language="nl-NL">Vervallen</label>
                  <label language="en-US">Deprecated</label>
                  <label language="de-DE"/>
               </enumeration>
            </ReleaseStatusCodeLifeCycle>
         </xforms:instance>
         <!-- decor-types -->
         <xforms:instance id="decor-types">
            <language/>
         </xforms:instance>
         <!-- get decor types submission -->
         <xforms:submission id="get-decor-types" serialization="none" method="get" resource="{$art-exist}/modules/get-decor-schema-enumerations.xq" replace="instance" instance="decor-types"
            xxforms:readonly="true"/>
         <!-- warning message texts -->
         <xforms:instance id="messages" xxforms:exclude-result-prefixes="#all">
            <messages>
               <status-final language="nl-NL">
                  <div class="h2">Snomed-CT ID genereren</div>
                  <p>Om de term te kunnen opnemen in Snomed-CT wordt een ID gegenereerd.</p>
                  <p>Let op: deze handeling kan niet ongedaan gemaakt worden!</p>
               </status-final>
               <status-final language="en-US">
                  <div class="h2">Generate Snomed-CT ID</div>
                  <p>To be able to include this term in Snomed-CT an ID will be generated.</p>
                  <p>Beware: this action cannot be undone!</p>
               </status-final>
               <translation-exists language="nl-NL">
                  <p>Term komt voor in de volgende referentieset(s)</p>
               </translation-exists>
               <translation-exists language="en-US">
                  <p>Term occurs in the following reference set(s)</p>
               </translation-exists>
            </messages>
         </xforms:instance>


         <!-- instance for edit status -->
         <xforms:instance id="data-safe">
            <data-safe>true</data-safe>
         </xforms:instance>

         <!-- **** THESAURUS CONCEPT **** -->
         <!-- concept navigation -->
         <xforms:instance id="dhd-concept-navigation" xxforms:exclude-result-prefixes="#all">
            <id/>
         </xforms:instance>


         <!-- get dhd concept -->
         <xforms:submission id="get-dhd-concept" serialization="none" resource="{$terminology-exist}/dhd/modules/get-dhd-concept.xquery?thesaurusId={instance('dhd-concept-navigation')}" method="get"
            instance="dhd-concept" replace="instance"/>
         <!-- get descriptions- for draft concepts -->
         <xforms:submission id="get-draft-concept-list" serialization="none" resource="{$terminology-exist}/dhd/modules/get-dhd-concept-list.xquery?status=draft" method="get"
            instance="snomed-description-itemset" replace="instance">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:setindex repeat="descriptions" index="1"/>
               <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
               <xforms:send submission="get-snomed-context-concept"/>
               <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
               <xforms:action if="instance('snomed-link-mode')='false'">
                  <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@thesaurusId"/>
                  <xforms:send submission="get-dhd-concept"/>
               </xforms:action>
            </xforms:action>
         </xforms:submission>
         <!-- get descriptions- for  update concepts -->
         <xforms:submission id="get-update-concept-list" serialization="none" resource="{$terminology-exist}/dhd/modules/get-dhd-concept-list.xquery?status=update" method="get"
            instance="snomed-description-itemset" replace="instance">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:setindex repeat="descriptions" index="1"/>
               <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
               <xforms:send submission="get-snomed-context-concept"/>
               <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
               <xforms:action if="instance('snomed-link-mode')='false'">
                  <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@thesaurusId"/>
                  <xforms:send submission="get-dhd-concept"/>
               </xforms:action>
            </xforms:action>
         </xforms:submission>
         <!-- get descriptions- for review concepts -->
         <xforms:submission id="get-review-concept-list" serialization="none" resource="{$terminology-exist}/dhd/modules/get-dhd-concept-list.xquery?status=review" method="get"
            instance="snomed-description-itemset" replace="instance">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:setindex repeat="descriptions" index="1"/>
               <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
               <xforms:send submission="get-snomed-context-concept"/>
               <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
               <xforms:action if="instance('snomed-link-mode')='false'">
                  <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@thesaurusId"/>
                  <xforms:send submission="get-dhd-concept"/>
               </xforms:action>
            </xforms:action>
         </xforms:submission>
         <!-- get descriptions- for rejected concepts -->
         <xforms:submission id="get-rejected-concept-list" serialization="none" resource="{$terminology-exist}/dhd/modules/get-dhd-concept-list.xquery?status=rejected" method="get"
            instance="snomed-description-itemset" replace="instance">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:setindex repeat="descriptions" index="1"/>
               <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
               <xforms:send submission="get-snomed-context-concept"/>
               <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
               <xforms:action if="instance('snomed-link-mode')='false'">
                  <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@thesaurusId"/>
                  <xforms:send submission="get-dhd-concept"/>
               </xforms:action>
            </xforms:action>
         </xforms:submission>

         <!-- add concept for Snomed to thesaurus -->
         <xforms:submission id="add-concept-to-thesaurus" serialization="none" method="get"
            resource="{$terminology-exist}/dhd/modules/add-concept-to-thesaurus.xquery?conceptId={instance('snomed-focus-concept')/concept/@conceptId}" replace="instance" instance="dhd-concept"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
                  A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done">
               <xforms:send submission="get-status-info"/>
            </xforms:action>
         </xforms:submission>
         <!-- add selected snomed concepts -->
         <xforms:submission id="add-selected-concepts" ref="instance('snomed-context-concept')" resource="{$terminology-exist}/dhd/modules/add-concept-selection-to-thesaurus.xquery" method="post"
            replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done">
               <xforms:send submission="get-status-info"/>
            </xforms:action>
         </xforms:submission>
         <!-- update snomed link -->
         <xforms:submission id="update-snomed-link" serialization="none" method="get"
            resource="{$terminology-exist}/dhd/modules/update-snomed-link.xquery?thesaurusId={instance('dhd-concept')/@thesaurusId}&amp;conceptId={instance('snomed-focus-concept')/concept/@conceptId}"
            replace="instance" instance="dhd-concept" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done">
               <xforms:setvalue ref="instance('snomed-link-mode')" value="'false'"/>
            </xforms:action>
         </xforms:submission>
         <!-- add concept DBC to thesaurus -->
         <xforms:submission id="add-concept-for-dbc" serialization="none" method="get"
            resource="{$terminology-exist}/dhd/modules/add-concept-to-thesaurus.xquery?dbcCode={instance('dbc-itemset')/dbc[index('dbcItems')]/@code}&amp;agbCode={instance('dbc-itemset')/dbc[index('dbcItems')]/@agbCode}"
            replace="instance" instance="dhd-concept" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done">
               <xforms:send submission="get-status-info"/>
            </xforms:action>
         </xforms:submission>
         <!-- add empty concept to thesaurus -->
         <xforms:submission id="add-empty-concept" serialization="none" method="get" resource="{$terminology-exist}/dhd/modules/add-concept-to-thesaurus.xquery" replace="instance"
            instance="dhd-concept" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done">
               <xforms:send submission="get-status-info"/>
            </xforms:action>
         </xforms:submission>
         <!-- delete thesaurus concept -->
         <xforms:submission id="delete-dhd-thesaurus-concept" serialization="none"
            resource="{$terminology-exist}/dhd/modules/delete-dhd-thesaurus-concept.xquery?thesaurusId={instance('dhd-concept')/@thesaurusId}" method="get" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:send submission="get-status-info"/>
            </xforms:action>
         </xforms:submission>
         <!-- add replacement thesaurus concept -->
         <xforms:submission id="add-replacement-concept" serialization="none"
            resource="{$terminology-exist}/dhd/modules/add-replacement-to-thesaurus.xquery?thesaurusId={instance('dhd-concept')/@thesaurusId}" method="get" replace="instance" instance="dhd-concept"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done">
               <xforms:send submission="get-status-info"/>
            </xforms:action>
         </xforms:submission>
         <!-- new description -->
         <xforms:instance id="desc" xxforms:exclude-result-prefixes="#all">
            <desc/>
         </xforms:instance>
         <!-- create-description -->
         <xforms:submission id="create-description" serialization="none" method="get"
            resource="{$terminology-exist}/dhd/modules/create-description.xquery?thesaurusId={instance('dhd-concept')/@thesaurusId}" replace="instance" instance="desc"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
                  A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- delete description -->
         <xforms:submission id="delete-description" serialization="none" method="get"
            resource="{$terminology-exist}/dhd/modules/delete-description.xquery?thesaurusId={instance('dhd-concept')/@thesaurusId}&amp;interfaceId={instance('dhd-concept')/desc[index('descriptionRepeat')]/@interfaceId}"
            replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- update-description -->
         <xforms:submission id="update-description" ref="instance('dhd-concept')/desc[index('descriptionRepeat')]" resource="{$terminology-exist}/dhd/modules/update-description.xquery" method="post"
            replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
                  A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- duplicate translations -->
         <xforms:instance id="duplicate-translations" xxforms:exclude-result-prefixes="#all">
            <desc/>
         </xforms:instance>
         <!-- find duplicate translations -->
         <xforms:submission id="find-duplicate-translations" ref="instance('member')/desc[index('translations')]" resource="{$terminology-exist}/snomed/modules/find-duplicate-translations.xquery"
            method="post" replace="instance" xxforms:instance="duplicate-translations" xxforms:username="{xxforms:get-session-attribute('username')}"
            xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
                  A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- finalize-translation -->
         <xforms:submission id="finalize-translation" ref="instance('member')/desc[index('translations')]" resource="{$terminology-exist}/snomed/modules/finalize-translation.xquery" method="post"
            replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
                  A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>

         <!-- create ICD10 mapping -->
         <xforms:submission id="create-icd10-mapping" serialization="none" method="get"
            resource="{$terminology-exist}/dhd/modules/create-icd10-mapping.xquery?thesaurusId={instance('dhd-concept')/@thesaurusId}&amp;code={instance('icd-itemset')/icd[index('icdSelectItems')]/@code}&amp;preceding={instance('dhd-concept')/icd10[index('icd10')]/@code}"
            replace="instance" instance="desc" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- delete ICD10 mapping -->
         <xforms:submission id="delete-icd10-mapping" serialization="none"
            resource="{$terminology-exist}/dhd/modules/delete-icd10-mapping.xquery?thesaurusId={instance('dhd-concept')/@thesaurusId}&amp;no={instance('dhd-concept')/icd10[index('icd10')]/@no}"
            method="get" replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}"/>
         <!-- move priority up -->
         <xforms:submission id="move-priority-up" serialization="none"
            resource="{$terminology-exist}/dhd/modules/change-mapping-priority.xquery?thesaurusId={instance('dhd-concept')/@thesaurusId}&amp;code={instance('dhd-concept')/icd10[index('icd10')]/@code}&amp;direction=up"
            method="get" replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}"/>
         <!-- move priority down -->
         <xforms:submission id="move-priority-down" serialization="none"
            resource="{$terminology-exist}/dhd/modules/change-mapping-priority.xquery?thesaurusId={instance('dhd-concept')/@thesaurusId}&amp;code={instance('dhd-concept')/icd10[index('icd10')]/@code}&amp;direction=down"
            method="get" replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}"/>
         <!-- create dbc mapping -->
         <xforms:submission id="create-dbc-mapping" serialization="none" method="get"
            resource="{$terminology-exist}/dhd/modules/create-dbc-mapping.xquery?thesaurusId={instance('dhd-concept')/@thesaurusId}&amp;dbcCode={instance('dbc-itemset')/dbc[index('dbcSelectItems')]/@code}&amp;agbCode={instance('dbc-itemset')/dbc[index('dbcSelectItems')]/@agbCode}"
            replace="instance" instance="desc" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- delete DBC mapping -->
         <xforms:submission id="delete-dbc-mapping" serialization="none"
            resource="{$terminology-exist}/dhd/modules/delete-dbc-mapping.xquery?thesaurusId={instance('dhd-concept')/@thesaurusId}&amp;no={instance('dhd-concept')/dbc[index('dbc')]/@no}" method="get"
            replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}"/>


         <!-- **** THESAURUS GENERAL **** -->
         <!-- project -->
         <xforms:instance id="project" xxforms:exclude-result-prefixes="#all">
            <concept/>
         </xforms:instance>
         <!-- get project -->
         <xforms:submission id="get-thesaurus-project" serialization="none" resource="{$terminology-exist}/dhd/modules/get-thesaurus-project.xquery" method="get" instance="project" replace="instance"/>
         <!-- event observer for  project changes -->
         <xforms:action ev:observer="project" ev:event="xforms-insert xforms-delete xxforms-value-changed">
            <xforms:setvalue ref="instance('data-safe')">false</xforms:setvalue>
         </xforms:action>
         <!-- save project submission -->
         <xforms:submission id="save-project" ref="instance('project')" resource="{$terminology-exist}/dhd/modules/save-thesaurus-project.xquery" method="post" replace="instance"
            xxforms:instance="data-safe" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
                  A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- instance for users -->
         <xforms:instance id="users-instance">
            <users/>
         </xforms:instance>
         <xforms:submission id="get-users" serialization="none" method="get" resource="{$art-exist}/modules/get-user-list.xquery" replace="instance" instance="users-instance"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}"/>
         <!-- instance for new author -->
         <xforms:instance id="author-instance" xxforms:exclude-result-prefixes="#all">
            <author id="" username="guest" admin="false" authorize="false" edit="false" issues="false">Guest</author>
         </xforms:instance>
         <xforms:bind nodeset="instance('project')/author" readonly="not($admin)">
            <xforms:bind nodeset="@issues" type="xs:boolean"/>
            <xforms:bind nodeset="@edit" type="xs:boolean"/>
            <xforms:bind nodeset="@authorize" type="xs:boolean"/>
            <xforms:bind nodeset="@admin" type="xs:boolean"/>
         </xforms:bind>

         <!-- thesaurus startus info -->
         <xforms:instance id="status-info" xxforms:exclude-result-prefixes="#all">
            <concept/>
         </xforms:instance>
         <!-- get status info -->
         <xforms:submission id="get-status-info" serialization="none" mode="asynchronous" resource="{$terminology-exist}/dhd/modules/get-thesaurus-status-info.xquery" method="get"
            instance="status-info" replace="instance"/>

         <!-- Snomed delta info -->
         <xforms:instance id="dhd-delta-info" xxforms:exclude-result-prefixes="#all">
            <concept/>
         </xforms:instance>
         <!-- get project -->
         <xforms:submission id="get-dhd-delta-info" serialization="none" resource="{$terminology-exist}/dhd/modules/get-dhd-delta-info.xquery" method="get" instance="dhd-delta-info" replace="instance"/>

         <!-- RELEASE -->
         <!-- new release -->
         <xforms:instance id="new-release" xxforms:exclude-result-prefixes="#all">
            <release effectiveTime="" statusCode="draft" label="">
               <comment/>
            </release>
         </xforms:instance>
         <xforms:bind nodeset="instance('new-release')/@effectiveTime" type="xforms:dateTime" required="true()"/>
         <xforms:bind nodeset="instance('new-release')/@label" required="true()"/>
         <!-- new release validity -->
         <xforms:instance id="new-release-valid" xxforms:exclude-result-prefixes="#all">
            <valid/>
         </xforms:instance>
         <!-- event observer for new release validity -->
         <xforms:action ev:event="xxforms-invalid" ev:observer="new-release">
            <xforms:setvalue ref="instance('new-release-valid')" value="'false'"/>
         </xforms:action>
         <xforms:action ev:event="xxforms-valid" ev:observer="new-release">
            <xforms:setvalue ref="instance('new-release-valid')" value="'true'"/>
         </xforms:action>
         <xforms:bind nodeset="instance('new-release-valid')" readonly=".='false'"/>
         <!-- thesaurus info-->
         <xforms:instance id="thesaurus-info" xxforms:exclude-result-prefixes="#all">
            <thesaurusInfo/>
         </xforms:instance>
         <xforms:submission id="check-thesaurus" serialization="none" method="get" resource="{$terminology-exist}/dhd/modules/check-thesaurus.xquery" replace="instance" instance="thesaurus-info"/>
         <!-- create-new release -->
         <xforms:submission id="create-1.2-release" ref="instance('new-release')" resource="{$terminology-exist}/dhd/modules/create-thesaurus-1.2-release.xquery" method="post" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
                  A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done"/>
         </xforms:submission>
         <xforms:submission id="create-2.1-release" ref="instance('new-release')" resource="{$terminology-exist}/dhd/modules/create-thesaurus-2.1-release.xquery" method="post" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done"/>
         </xforms:submission>
         <!-- add release info -->
         <xforms:submission id="add-release-info" ref="instance('new-release')" resource="{$terminology-exist}/dhd/modules/add-release-info.xquery" method="post" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done"/>
         </xforms:submission>
         <!-- delete release -->
         <xforms:submission id="delete-release" ref="instance('project')/release[index('releases')]" resource="{$terminology-exist}/dhd/modules/delete-release.xquery" method="post" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done"/>
         </xforms:submission>
         <!-- release notes-->
         <xforms:instance id="release-notes" xxforms:exclude-result-prefixes="#all">
            <releaseNotes/>
         </xforms:instance>
         <!--         <xforms:submission id="get-release-notes" ref="instance('project')/release[index('releases')]" resource="{$terminology-exist}/dhd/modules/get-release-notes.xquery" method="post"
            replace="instance" xxforms:instance="release-notes">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>-->
         <xforms:submission id="get-release-notes" serialization="none"
            resource="{$terminology-exist}/dhd/modules/get-release-notes.xquery?effectiveTime={instance('project')/release[index('releases')]/@effectiveTime}" method="get" instance="release-notes"
            replace="instance"/>

         <!-- **** THESAURUS AND SNOMED SEARCH **** -->
         <!-- snomed link mode -->
         <xforms:instance id="snomed-link-mode">
            <mode>false</mode>
         </xforms:instance>
         <!-- member status filter -->
         <xforms:instance id="member-status-filter">
            <filter/>
         </xforms:instance>
         <xforms:bind nodeset="instance('member-status-filter')" readonly="instance('search-thesaurus-only')='false'"/>
         <!-- member-status filters -->
         <xforms:instance id="status-filters">
            <filters>
               <filter statusCodes="">
                  <name language="nl-NL">Alle</name>
                  <name language="en-US">All</name>
                  <name language="de-DE">Alle</name>
               </filter>
               <filter statusCodes="draft active update">
                  <name language="nl-NL">Actueel</name>
                  <name language="en-US">Current</name>
                  <name language="de-DE">Actuell</name>
               </filter>
               <filter statusCodes="draft">
                  <name language="nl-NL">Ontwerp</name>
                  <name language="en-US">Draft</name>
                  <name language="de-DE">Entwurf</name>
               </filter>
               <filter statusCodes="active">
                  <name language="nl-NL">Actief</name>
                  <name language="en-US">Active</name>
                  <name language="de-DE">Aktiv</name>
               </filter>
               <filter statusCodes="update">
                  <name language="nl-NL">In bewerking</name>
                  <name language="en-US">Under update</name>
                  <name language="de-DE">In Bearbeitung</name>
               </filter>
               <filter statusCodes="retired">
                  <name language="nl-NL">Obsoleet</name>
                  <name language="en-US">Retired</name>
                  <name language="de-DE">Obsolet</name>
               </filter>
               <filter statusCodes="rejected">
                  <name language="nl-NL">Afgewezen</name>
                  <name language="en-US">Rejected</name>
                  <name language="de-DE">Abgewiesen</name>
               </filter>
            </filters>
         </xforms:instance>
         <!-- toplevel filter -->
         <xforms:instance id="selected-toplevels">
            <ids/>
         </xforms:instance>
         <!-- refsets filter -->
         <xforms:instance id="selected-refsets">
            <ids/>
         </xforms:instance>
         <!-- filter list -->
         <xforms:instance id="filters">
            <filters/>
         </xforms:instance>
         <!-- submission for loading toplevel filter list -->
         <xforms:submission id="get-filters" serialization="none" method="get" resource="{$terminology-exist}/snomed/modules/get-search-filters.xquery" replace="instance" instance="filters"
            xxforms:readonly="true"/>

         <!-- **** REFERENCE **** -->
         <!-- status filters -->
         <xforms:instance id="reference-status-filters">
            <filters>
               <filter statusCodes="">
                  <name language="nl-NL">Alle</name>
                  <name language="en-US">All</name>
                  <name language="de-DE">Alle</name>
               </filter>
               <filter statusCodes="active">
                  <name language="nl-NL">Actief</name>
                  <name language="en-US">Active</name>
                  <name language="de-DE">Aktiv</name>
               </filter>
               <filter statusCodes="pending">
                  <name language="nl-NL">Gepland voor activatie</name>
                  <name language="en-US">scheduled for activation</name>
                  <name language="de-DE"/>
               </filter>
               <filter statusCodes="retired">
                  <name language="nl-NL">Obsoleet</name>
                  <name language="en-US">Retired</name>
                  <name language="de-DE">Obsolet</name>
               </filter>
            </filters>
         </xforms:instance>
         <!-- **** SPECIALISM REFERENCE **** -->
         <!-- specialism reference -->
         <xforms:instance id="specialism-reference" xxforms:exclude-result-prefixes="#all">
            <specialismReference/>
         </xforms:instance>
         <!-- get specialism reference -->
         <xforms:submission id="get-specialism-reference" serialization="none" method="get" resource="{$terminology-exist}/dhd/modules/get-specialism-reference.xquery" replace="instance"
            instance="specialism-reference"/>
         <!-- **** DOMAIN REFERENCE **** -->
         <!-- specialism reference -->
         <xforms:instance id="domain-list" xxforms:exclude-result-prefixes="#all">
            <specialismReference/>
         </xforms:instance>
         <!-- get specialism reference -->
         <xforms:submission id="get-domain-list" serialization="none" method="get" resource="{$terminology-exist}/dhd/modules/get-domain-list.xquery" replace="instance" instance="domain-list"/>

         <!-- **** DBC REFERENCE **** -->
         <!-- dbc search -->
         <xforms:instance id="dbc-search" xxforms:exclude-result-prefixes="#all">
            <search/>
         </xforms:instance>
         <!-- dbc specialism filter -->
         <xforms:instance id="dbc-specialism-filter" xxforms:exclude-result-prefixes="#all">
            <filter/>
         </xforms:instance>
         <!-- dbc specialism filter list -->
         <xforms:instance id="dbc-specialism-list">
            <list/>
         </xforms:instance>
         <!-- get specialism select list -->
         <xforms:submission id="get-specialism-list" serialization="none" method="get" resource="{$terminology-exist}/dhd/modules/get-specialism-reference.xquery" replace="instance"
            instance="dbc-specialism-list">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:insert context="instance('dbc-specialism-list')" origin="xxforms:element('specialism',(xxforms:attribute('agbCode',''),xxforms:element('desc','Alle')))"/>
               <xforms:setvalue ref="instance('dbc-specialism-filter')" value="''"/>
            </xforms:action>
         </xforms:submission>
         <!-- dbc status filter -->
         <xforms:instance id="dbc-status-filter" xxforms:exclude-result-prefixes="#all">
            <filter>active</filter>
         </xforms:instance>
         <!-- dbc itemset -->
         <xforms:instance id="dbc-itemset" xxforms:exclude-result-prefixes="#all">
            <dbcs/>
         </xforms:instance>
         <!-- search dbc reference -->
         <xforms:submission id="search-dbc" serialization="none" method="get"
            resource="{$terminology-exist}/dhd/modules/search-dbc-reference.xquery?string={instance('dbc-search')}&amp;statusCodes={instance('dbc-status-filter')}&amp;specialism={instance('dbc-specialism-filter')}"
            replace="instance" instance="dbc-itemset"/>
         <!-- get unlinked dbc list -->
         <xforms:submission id="get-dbc-list" serialization="none" method="get" resource="{$terminology-exist}/dhd/modules/get-dbc-list.xquery?specialism={instance('dbc-specialism-filter')}"
            replace="instance" instance="dbc-itemset"/>
         <!-- dbc concept list -->
         <xforms:instance id="dbc-concept-list" xxforms:exclude-result-prefixes="#all">
            <dbcs/>
         </xforms:instance>
         <!-- get dbc concept list -->
         <xforms:submission id="get-dbc-concept-list" serialization="none" method="get"
            resource="{$terminology-exist}/dhd/modules/get-dbc-concept-list.xquery?agb={instance('dbc-itemset')/dbc[index('dbcItems')]/@agbCode}&amp;code={instance('dbc-itemset')/dbc[index('dbcItems')]/@code}"
            replace="instance" instance="dbc-concept-list"/>


         <!-- **** ICD10 REFERENCE **** -->
         <!-- icd search -->
         <xforms:instance id="icd-search" xxforms:exclude-result-prefixes="#all">
            <search/>
         </xforms:instance>
         <!-- icd status filter -->
         <xforms:instance id="icd-status-filter">
            <filter>active</filter>
         </xforms:instance>

         <!-- icd itemset -->
         <xforms:instance id="icd-itemset" xxforms:exclude-result-prefixes="#all">
            <dbcs/>
         </xforms:instance>
         <!-- search icd reference -->
         <xforms:submission id="search-icd" serialization="none" method="get"
            resource="{$terminology-exist}/dhd/modules/search-icd-reference.xquery?string={instance('icd-search')}&amp;statusCodes={instance('icd-status-filter')}" replace="instance"
            instance="icd-itemset"/>


         <!-- **** STATUS CHANGE**** -->
         <!-- status change -->
         <xforms:instance id="status-change" xxforms:exclude-result-prefixes="#all">
            <statusChange object="" ref="" statusCode="" effectiveDate="" expirationDate=""/>
         </xforms:instance>
         <xforms:bind nodeset="instance('status-change')/@effectiveDate" type="xforms:date" constraint=".='' or .&gt;instance('dhd-concept')/@maxEffectiveDate"/>
         <xforms:bind nodeset="instance('status-change')/@expirationDate" type="xforms:date" constraint=".&gt;../@effectiveDate or .='' or ../@effectiveDate=''"/>
         <!-- status change validity -->
         <xforms:instance id="status-change-valid" xxforms:exclude-result-prefixes="#all">
            <valid/>
         </xforms:instance>
         <!-- event observer for new release validity -->
         <xforms:action ev:event="xxforms-invalid" ev:observer="status-change">
            <xforms:setvalue ref="instance('status-change-valid')" value="'false'"/>
         </xforms:action>
         <xforms:action ev:event="xxforms-valid" ev:observer="status-change">
            <xforms:setvalue ref="instance('status-change-valid')" value="'true'"/>
         </xforms:action>
         <xforms:bind nodeset="instance('status-change-valid')" readonly=".='false'"/>
         <!-- status change response -->
         <xforms:instance id="status-change-response" xxforms:exclude-result-prefixes="#all">
            <response/>
         </xforms:instance>
         <!-- set status code -->
         <xforms:submission id="set-status" ref="instance('status-change')" resource="{$terminology-exist}/dhd/modules/set-thesaurus-object-status.xquery" method="post" replace="instance"
            xxforms:instance="status-change-response" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
                  A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done">
               <xforms:send submission="get-status-info"/>
               <xforms:send submission="get-dhd-concept"/>
               <xforms:action
                  xxforms:iterate="instance('snomed-context-concept')//concept[@thesaurusId=instance('dhd-concept')/@thesaurusId]|instance('snomed-context-concept')//dest[@thesaurusId=instance('dhd-concept')/@thesaurusId]">
                  <xforms:setvalue ref="context()/@memberStatusCode" value="instance('dhd-concept')/@statusCode"/>
               </xforms:action>
               <xforms:action xxforms:iterate="instance('snomed-description-itemset')//description[@thesaurusId=instance('dhd-concept')/@thesaurusId]">
                  <xforms:setvalue ref="context()/@memberStatusCode" value="instance('dhd-concept')/@statusCode"/>
               </xforms:action>
            </xforms:action>
         </xforms:submission>


         <!-- **** SNOMED CONTEXT **** -->
         <!-- instance for context concept navigation -->
         <xforms:instance id="snomed-context-navigation" xxforms:exclude-result-prefixes="#all">
            <dummy/>
         </xforms:instance>
         <!-- instance for context concept -->
         <xforms:instance id="snomed-context-concept" xxforms:exclude-result-prefixes="#all">
            <dummy/>
         </xforms:instance>
         <!-- submission for loading context concept -->
         <xforms:submission id="get-snomed-context-concept" serialization="none" method="get"
            resource="{$terminology-exist}/dhd/modules/get-snomed-concept.xquery?id={instance('snomed-context-navigation')}" replace="instance" instance="snomed-context-concept">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:action xxforms:iterate="instance('snomed-context-concept')/concept|instance('snomed-context-concept')//dest">
                  <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('navId',random())"/>
               </xforms:action>
            </xforms:action>
         </xforms:submission>
         <!-- instance for  context concept hierarchy -->
         <xforms:instance id="snomed-context-subconcepts" xxforms:exclude-result-prefixes="#all">
            <dummy/>
         </xforms:instance>
         <!-- instance for concept hierarchy navigation -->
         <xforms:instance id="snomed-context-hierarchy-navigation" xxforms:exclude-result-prefixes="#all">
            <dummy/>
         </xforms:instance>
         <!-- submission for loading context concept subconcepts -->
         <xforms:submission id="get-snomed-context-subconcepts" serialization="none" method="get"
            resource="{$terminology-exist}/dhd/modules/get-snomed-subconcepts.xquery?id={instance('snomed-context-concept')//concept[@navId=instance('snomed-context-hierarchy-navigation')]/@conceptId}"
            replace="instance" instance="snomed-context-subconcepts">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:action xxforms:iterate="instance('snomed-context-subconcepts')/concept|instance('snomed-context-subconcepts')//dest">
                  <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('navId',random())"/>
               </xforms:action>
            </xforms:action>
         </xforms:submission>
         <!-- instance for focus concept -->
         <xforms:instance id="snomed-focus-concept">
            <concept/>
         </xforms:instance>
         <!-- submission for loading focus concept -->
         <xforms:submission id="get-snomed-focus-concept" serialization="none" method="get"
            resource="{$terminology-exist}/dhd/modules/get-snomed-concept.xquery?id={instance('snomed-context-concept')//concept[@navId=instance('snomed-context-hierarchy-navigation')]/@conceptId|instance('snomed-context-concept')//dest[@navId=instance('snomed-context-hierarchy-navigation')]/@sourceId}"
            replace="instance" instance="snomed-focus-concept">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:action
                  if="not(instance('snomed-focus-concept')/concept/@thesaurusId=instance('dhd-concept')/@thesaurusId) and not(instance('snomed-focus-concept')/concept/@conceptId=instance('dhd-concept')/snomed/@conceptId) and instance('snomed-link-mode')='false'">
                  <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('snomed-focus-concept')/concept/@thesaurusId"/>
                  <xforms:send submission="get-dhd-concept"/>
               </xforms:action>
            </xforms:action>
         </xforms:submission>


         <!-- *** ISSUES *** -->
         <!-- instance for existing issues -->
         <xforms:instance id="issues">
            <dummy/>
         </xforms:instance>
         <!-- get issues submission -->
         <xforms:submission id="get-issues" serialization="none" method="get" resource="{$terminology-exist}/dhd/modules/get-thesaurus-issues.xquery" replace="instance" instance="issues"/>
         <!-- instance for creating issue -->
         <xforms:instance id="issue-instance" xxforms:exclude-result-prefixes="#all">
            <issues>
               <issue id="" priority="N" displayName="" type="RFC" refsetId="">
                  <object id="" type="" effectiveDate=""/>
                  <tracking effectiveDate="" statusCode="new">
                     <author id=""/>
                     <desc language=""/>
                  </tracking>
               </issue>
            </issues>
         </xforms:instance>
         <!-- instance for creating tracking -->
         <xforms:instance id="tracking-instance" xxforms:exclude-result-prefixes="#all">
            <issue>
               <tracking effectiveDate="" statusCode="open">
                  <author id=""/>
                  <desc language=""/>
               </tracking>
            </issue>
         </xforms:instance>
         <!-- instance for creating assignment -->
         <xforms:instance id="assignment-instance" xxforms:exclude-result-prefixes="#all">
            <issue>
               <assignment to="" name="" effectiveDate="">
                  <author id=""/>
                  <desc language=""/>
               </assignment>
            </issue>
         </xforms:instance>
         <!-- instance for holding newly created issues -->
         <xforms:instance id="issues-instance" xxforms:exclude-result-prefixes="#all">
            <issues>
               <issue/>
            </issues>
         </xforms:instance>
         <!-- instance for selected issue -->
         <xforms:instance id="selected-issue">
            <selected>
               <selected/>
               <unassigned/>
               <open/>
               <inprogress/>
               <feedback/>
               <closed/>
            </selected>
         </xforms:instance>
         <!-- instance for issues -->
         <xforms:instance id="selected-status-codes">
            <selected>open</selected>
         </xforms:instance>
         <!-- instance for issues -->
         <xforms:instance id="selected-issue-types">
            <selected>RFC INC CLF FUT</selected>
         </xforms:instance>
         <!-- instance for issues -->
         <xforms:instance id="selected-issue-priorities">
            <selected/>
         </xforms:instance>
         <!-- instance for issues -->
         <xforms:instance id="selected-issue-assignee">
            <selected/>
         </xforms:instance>
         <!-- instance for issues -->
         <xforms:instance id="selected-issue-id">
            <selected/>
         </xforms:instance>
         <!-- save issue submission -->
         <xforms:submission id="save-issue" ref="instance('issues-instance')/issue[object/@id=instance('dhd-concept')/@thesaurusId]"
            action="{$terminology-exist}/dhd/modules/save-thesaurus-issue.xquery" method="post" replace="none" xxforms:username="{xxforms:get-session-attribute('username')}"
            xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
                  A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- update issue submission -->
         <xforms:submission id="update-issue" ref="instance('issues')/issue[@id=instance('selected-issue')/selected]" action="{$terminology-exist}/dhd/modules/update-thesaurus-issue.xquery"
            method="post" replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
                  A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- issue dhd concept -->
         <xforms:instance id="issue-dhd-concept" xxforms:exclude-result-prefixes="#all">
            <concept/>
         </xforms:instance>
         <xforms:submission id="get-issue-dhd-concept" serialization="none"
            resource="{$terminology-exist}/dhd/modules/get-dhd-concept.xquery?thesaurusId={instance('issues')/issue[@id=instance('selected-issue')/selected]/object/@id}" method="get"
            instance="issue-dhd-concept" replace="instance"/>
         <!-- instance for assigned concepts as info -->
         <xforms:instance id="assigned-concepts">
            <dummy/>
         </xforms:instance>
         <!-- get assigned concept list -->
         <xforms:submission id="get-assigned-concepts-info" serialization="none" method="get"
            resource="{$terminology-exist}/dhd/modules/get-assigned-dhd-concept-list.xquery?user={xxforms:get-session-attribute('username')}" replace="instance" instance="assigned-concepts"/>
         <!-- get assigned concept list -->
         <xforms:submission id="get-assigned-concepts" serialization="none" method="get"
            resource="{$terminology-exist}/dhd/modules/get-assigned-dhd-concept-list.xquery?user={xxforms:get-session-attribute('username')}" replace="instance" instance="snomed-description-itemset"/>

         <!-- selected codeSystem -->
         <xforms:instance id="selected-codesystem">
            <id/>
         </xforms:instance>
         <!-- codeSystem list -->
         <xforms:instance id="codesystem-list">
            <dummy/>
         </xforms:instance>
         <!-- get codesystem list -->
         <xforms:submission id="get-codesystem-list" serialization="none" method="get" resource="{$art-exist}/modules/get-decor-codesystem-selection.xquery?project={instance('document')}"
            replace="instance" instance="codesystem-list"/>


         <!-- GROUP CHOICE -->
         <!-- selected-group -->
         <xforms:instance id="selected-group">
            <collection/>
         </xforms:instance>
         <xforms:instance id="special-groups">
            <classifications>
               <group collection="snomed-data" name="Snomed CT" isGroup="false">
                  <classification id="2.16.840.1.113883.6.96" name="Snomed CT">Snomed CT</classification>
               </group>
               <group collection="loinc-data" name="LOINC" isGroup="false">
                  <classification id="2.16.840.1.113883.6.1" name="LOINC">LOINC</classification>
               </group>
            </classifications>
         </xforms:instance>


         <!-- *** SNOMED SEARCH *** -->
         <!-- instance for SNOMED CT concept -->
         <xforms:instance id="snomed-concept-instance">
            <result current="1" count="1">
               <description count="3" length="17" effectiveTime="20030731" conceptId="138875005" caseSignificanceId="900000000000017005" type="pref" fullName="SNOMED CT Concept (SNOMED RT+CTV3)"
                  >SNOMED CT Concept</description>
            </result>
         </xforms:instance>
         <!-- instance for selected concept -->
         <xforms:instance id="snomed-concept-navigation">
            <id>138875005</id>
         </xforms:instance>
         <!-- instance for description search string -->
         <xforms:instance id="snomed-description-search">
            <search/>
         </xforms:instance>
         <!-- instance for description itemset -->
         <xforms:instance id="snomed-description-itemset">
            <result current="0" count="0"/>
         </xforms:instance>
         <!-- instance for selected concept -->
         <xforms:instance id="selected-snomed-concept">
            <dummy/>
         </xforms:instance>
         <!-- instance for concept -->
         <xforms:instance id="snomed-concept">
            <dummy/>
         </xforms:instance>
         <!-- submission for loading concept -->
         <xforms:submission id="get-snomed-concept" serialization="none" method="get"
            resource="{$terminology-exist}/snomed/getConcept/{instance('snomed-concept-hierarchy')//*[@navId=instance('snomed-hierarchy-navigation')]/@conceptId}" replace="instance"
            instance="snomed-concept"/>
         <!-- instance for selected concept in hierarchy -->
         <xforms:instance id="snomed-hierarchy-navigation">
            <id/>
         </xforms:instance>
         <!-- instance for concept hierarchy -->
         <xforms:instance id="snomed-concept-hierarchy">
            <dummy/>
         </xforms:instance>

         <!-- submission for loading subconcept hierarchy -->
         <xforms:submission id="get-snomed-subconcept-hierarchy" serialization="none" method="get"
            resource="{$terminology-exist}/snomed/modules/get-subconcepts.xquery?id={instance('snomed-concept-navigation')}" replace="instance" instance="snomed-concept-hierarchy">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:action xxforms:iterate="instance('snomed-concept-hierarchy')/concept|instance('snomed-concept-hierarchy')//dest">
                  <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('navId',random())"/>
               </xforms:action>
            </xforms:action>
         </xforms:submission>
         <!-- instance for concept hierarchy -->
         <xforms:instance id="snomed-subconcepts">
            <dummy/>
         </xforms:instance>
         <!-- submission for loading concept -->
         <xforms:submission id="get-snomed-subconcepts" serialization="none" method="get"
            resource="{$terminology-exist}/snomed/modules/get-subconcepts.xquery?id={instance('snomed-concept-hierarchy')//*[@navId=instance('snomed-hierarchy-navigation')]/@conceptId}"
            replace="instance" instance="snomed-subconcepts"/>

         <!-- instance for thesaurus only search mode -->
         <xforms:instance id="search-thesaurus-only">
            <mode>true</mode>
         </xforms:instance>
         <xforms:bind nodeset="instance('search-thesaurus-only')" type="xforms:boolean"/>
         <!-- instance for select mode (search or select) -->
         <xforms:instance id="snomed-select-mode">
            <mode>false</mode>
         </xforms:instance>
         <!-- instance for select mode (search or select) -->
         <xforms:instance id="snomed-subconcept">
            <dummy/>
         </xforms:instance>
         <!-- submission for loading subconcept -->
         <xforms:submission id="get-snomed-subconcept" serialization="none" method="get"
            resource="{$terminology-exist}/snomed/getConcept/{instance('snomed-concept-hierarchy')//*[@navId=instance('snomed-hierarchy-navigation')]/@conceptId}" replace="instance"
            instance="snomed-subconcept"/>
         <!-- submission for updating resultset -->
         <xforms:submission id="update-snomed-descriptions" ref="instance('snomed-description-search')"
            action="{$terminology-exist}/dhd/modules/search-snomed-thesaurus.xquery?searchString={instance('snomed-description-search')}&amp;toplevels={instance('selected-toplevels')}&amp;refsets={instance('selected-refsets')}&amp;refsetId={instance('refset-navigation')}&amp;thesaurusOnly={instance('search-thesaurus-only')}&amp;refsetEffectiveDate={instance('version-navigation')}&amp;statusCodes={instance('member-status-filter')}"
            method="get" instance="snomed-description-itemset" replace="instance">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
               <xforms:send submission="get-snomed-context-concept"/>
               <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
               <xforms:action if="instance('snomed-link-mode')='false'">
                  <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@thesaurusId"/>
                  <xforms:send submission="get-dhd-concept"/>
               </xforms:action>
            </xforms:action>
         </xforms:submission>
         <!-- submission for finding snomed concepts for icd10 -->
         <xforms:submission id="get-snomed-for-icd10" ref="instance('snomed-description-search')"
            action="{$terminology-exist}/dhd/modules/get-snomed-for-icd10.xquery?code={instance('dhd-concept')/icd10[index('icd10')]/@code}" method="get" instance="snomed-description-itemset"
            replace="instance"/>
         <!-- submission for finding snomed concepts for icd10 reference -->
         <xforms:submission id="get-snomed-for-icd10-reference" ref="instance('snomed-description-search')"
            action="{$terminology-exist}/dhd/modules/get-snomed-for-icd10.xquery?code={instance('icd-itemset')/icd[index('icdItems')]/@code}" method="get" instance="snomed-description-itemset"
            replace="instance"/>



         <!-- *** CLAML SEARCH *** -->
         <!-- instance for selected classification collection -->
         <xforms:instance id="collection">
            <name/>
         </xforms:instance>
         <!-- instance for selected classificationId -->
         <xforms:instance id="classificationId">
            <name/>
         </xforms:instance>
         <xforms:action ev:observer="classificationId" ev:event="xxforms-value-changed">
            <xforms:send submission="get-claml-hierarchy"/>
            <xforms:setvalue ref="instance('hierarchy-navigation')" value="instance('claml-instance')/Class[1]/@id"/>
            <xxforms:variable name="selection"
               select="if (instance('classification-list')//classification[@id=instance('classificationId')][@language=instance('language')]) then instance('classification-list')//classification[@id=instance('classificationId')][@language=instance('language')][1] else (instance('classification-list')//classification[@id=instance('classificationId')][1])"/>
            <xforms:setvalue ref="instance('new-conceptlist-concept')/@codeSystem" value="$selection/@id"/>
            <xforms:setvalue ref="instance('new-conceptlist-concept')/@codeSystemName" value="$selection/@name"/>
         </xforms:action>
         <!-- instance for selected classification of group -->
         <xforms:instance id="selected-classification">
            <name/>
         </xforms:instance>
         <!-- instance for classification list -->
         <xforms:instance id="classification-list">
            <classifications/>
         </xforms:instance>
         <xforms:submission id="get-classification-list" serialization="none" method="get" resource="{$terminology-exist}/claml/classification-index.xml" replace="instance"
            instance="classification-list"/>
         <!-- instance for selected class -->
         <xforms:instance id="class-navigation">
            <id/>
         </xforms:instance>
         <!-- instance for selected class in hierarchy -->
         <xforms:instance id="hierarchy-navigation">
            <id/>
         </xforms:instance>
         <!-- instance for class -->
         <xforms:instance id="class">
            <dummy/>
         </xforms:instance>
         <xforms:submission id="get-class" serialization="none" method="get"
            resource="{$terminology-exist}/claml/RetrieveClass?classificationId={instance('classificationId')}&amp;code={instance('claml-instance')//*[@id=instance('hierarchy-navigation')][1]/@code}"
            replace="instance" instance="class"/>
         <!-- instance for description search string -->
         <xforms:instance id="claml-search">
            <search/>
         </xforms:instance>
         <!-- instance for description itemset -->
         <xforms:instance id="claml-description-itemset">
            <result current="0" count="0"/>
         </xforms:instance>
         <!-- instance for claml hierarchy -->
         <xforms:instance id="claml-instance">
            <dummy/>
         </xforms:instance>
         <xforms:submission id="get-claml-hierarchy" serialization="none" method="get"
            resource="{$terminology-exist}/claml/modules/get-class-for-hierarchy.xquery?classificationId={instance('classificationId')}&amp;code={instance('class-navigation')}" replace="instance"
            instance="claml-instance">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:action xxforms:iterate="instance('claml-instance')/Class|instance('claml-instance')//SubClass">
                  <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('id',random())"/>
               </xforms:action>
            </xforms:action>
         </xforms:submission>
         <xforms:instance id="subclasses">
            <dummy/>
         </xforms:instance>
         <xforms:submission id="get-subclasses" serialization="none" method="get"
            resource="{$terminology-exist}/claml/RetrieveSubClasses?classificationId={instance('classificationId')}&amp;code={instance('claml-instance')//*[@id=instance('hierarchy-navigation')][1]/@code}"
            replace="instance" instance="claml-instance">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:action xxforms:iterate="instance('claml-instance')/Class|instance('claml-instance')//SubClass">
                  <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('id',random())"/>
               </xforms:action>
            </xforms:action>
         </xforms:submission>
         <xforms:submission id="expand-tree-submission" serialization="none" method="get"
            resource="{$terminology-exist}/claml/RetrieveSubClasses?classificationId={instance('classificationId')}&amp;code={instance('claml-instance')//*[@id=instance('hierarchy-navigation')][1]/@code}"
            replace="instance" instance="subclasses"/>
         <xforms:submission id="update-claml-descriptions" ref="instance('claml-search')"
            action="{$terminology-exist}/claml/SearchDescription?classificationId={instance('classificationId')}&amp;string={instance('claml-search')}" method="get"
            instance="claml-description-itemset" replace="instance"/>
         <!-- instance for select mode (search or select) -->
         <xforms:instance id="select-mode">
            <mode>false</mode>
         </xforms:instance>
         <!-- instance for subclass -->
         <xforms:instance id="subclass">
            <dummy/>
         </xforms:instance>
         <xforms:submission id="get-subclass" serialization="none" method="get"
            resource="{$terminology-exist}/claml/RetrieveClass?classificationId={instance('classificationId')}&amp;code={instance('claml-instance')//*[@id=instance('hierarchy-navigation')][1]/@code}"
            replace="instance" instance="subclass"/>

         <!-- status change polling -->
         <xforms:action ev:event="PollStatusChanges">
            <xforms:send submission="get-status-info"/>
            <xforms:dispatch name="PollStatusChanges" delay="60000" target="dhd-form-model"/>
         </xforms:action>
         <!-- **** XFORMS READY**** -->
         <xforms:action ev:event="xforms-model-construct-done">
            <xforms:send submission="get-resources-submission"/>
            <xforms:setvalue ref="instance('language')"
               value="if (string-length(xxforms:get-session-attribute('language'))&gt;0) then (xxforms:get-session-attribute('language')) else (instance('resources-instance')//resources[1]/@xml:lang/string())"/>
            <xforms:insert context="." origin="xxforms:set-session-attribute('language', instance('language'))"/>
            <xforms:send submission="get-decor-types"/>
            <xforms:send submission="get-filters"/>
            <xforms:send submission="get-users"/>
            <xforms:send submission="get-thesaurus-project"/>
            <xforms:send submission="get-status-info"/>
            <xforms:send submission="get-specialism-reference"/>
            <xforms:send submission="get-specialism-list"/>
            <xforms:send submission="get-issues"/>
            <xforms:send submission="get-assigned-concepts-info"/>
            <xforms:dispatch name="PollStatusChanges" delay="10000" target="dhd-form-model"/>
         </xforms:action>
         <xforms:action ev:event="xforms-ready">
            <xforms:send submission="get-release-notes"/>
            <xforms:setvalue ref="instance('data-safe')" value="'true'"/>
            <xxforms:script>
               window.onbeforeunload = function() {
               if (ORBEON.xforms.Document.getValue('data-safe-input') != 'true')
               return "Er zijn nog berwerkingen die niet zijn opgeslagen!";
               }
            </xxforms:script>
            <!--            <xforms:send submission="update-dhd-concepts"/>-->
            <xforms:setfocus control="search-snomed-description"/>
         </xforms:action>
         <xxforms:variable name="resources" select="instance('resources-instance')//resources[1]"/>
         <xxforms:variable name="editor" select="instance('project')/author[@username=xxforms:get-session-attribute('username')][@edit='true']"/>
         <xxforms:variable name="issueCreator" select="instance('project')/author[@username=xxforms:get-session-attribute('username')][@issues='true']"/>
         <xxforms:variable name="authorize" select="instance('project')/author[@username=xxforms:get-session-attribute('username')][@authorize='true']"/>
         <xxforms:variable name="admin" select="instance('project')/author[@username=xxforms:get-session-attribute('username')][@admin='true']"/>
         <xxforms:variable name="isGroup" select="instance('classification-list')/group[@collection=instance('selected-group')]/@isGroup='true'"/>
      </xforms:model>
   </xhtml:head>
   <xhtml:body>
      <!-- special output used to give warning if user leaves page -->
      <xforms:output ref="instance('data-safe')" id="data-safe-input" style="display: none"/>
      <!-- status change dialog -->
      <xxforms:dialog id="status-dialog" appearance="full" level="modal" close="false" draggable="true" visible="false">
         <xhtml:table width="100%">
            <xforms:group ref="instance('status-change')">
               <xxforms:variable name="actionText"
                  select="if (@statusCode='rejected') then $resources/reject else if (@statusCode='retired') then $resources/deactivate else $resources/authorize-and-activate"/>
               <xhtml:tr>
                  <xhtml:td class="heading" colspan="2">
                     <xhtml:div class="heading">
                        <xforms:output ref="$actionText"/>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
               <xforms:group ref=".[@statusCode='active']">
                  <xhtml:tr>
                     <!-- effectiveDate -->
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/date"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:input ref="@effectiveDate">
                           <xforms:alert>
                              <xforms:output ref="$resources/not-valid"/>
                           </xforms:alert>
                        </xforms:input>
                     </xhtml:td>
                  </xhtml:tr>
               </xforms:group>
               <xforms:group ref=".[@statusCode=('active','retired')]">
                  <xhtml:tr>
                     <!-- expirationDate -->
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/expiration-date"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:input ref="@expirationDate">
                           <xforms:alert>
                              <xforms:output ref="$resources/not-valid"/>
                           </xforms:alert>
                        </xforms:input>
                     </xhtml:td>
                  </xhtml:tr>
               </xforms:group>
               <xhtml:tr>
                  <xhtml:td colspan="2">
                     <xhtml:div class="buttons">
                        <fr:button>
                           <xforms:label ref="$resources/cancel"/>
                           <xforms:action ev:event="DOMActivate">
                              <xxforms:hide dialog="status-dialog"/>
                           </xforms:action>
                        </fr:button>
                        <fr:button ref="instance('status-change-valid')">
                           <xforms:label>
                              <xforms:output ref="$actionText"/>
                           </xforms:label>
                           <xforms:action ev:event="DOMActivate">
                              <xforms:send submission="set-status"/>
                              <xxforms:hide dialog="status-dialog"/>
                           </xforms:action>
                        </fr:button>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
            </xforms:group>
         </xhtml:table>
      </xxforms:dialog>
      <!-- Filter dialog -->
      <xxforms:dialog id="filter-dialog" appearance="minimal" visible="false">
         <xhtml:table>
            <xhtml:tr>
               <xhtml:td>
                  <xforms:select ref="instance('selected-toplevels')" appearance="full" id="filterList">
                     <xforms:itemset nodeset="instance('filters')/topLevels/concept">
                        <xforms:label ref="."/>
                        <xforms:value ref="@id"/>
                     </xforms:itemset>
                     <xforms:action ev:event="xforms-value-changed">
                        <xforms:send submission="update-snomed-descriptions"/>
                        <xforms:action if="xxforms:index('descriptions')&gt;1">
                           <xforms:setindex repeat="descriptions" index="1"/>
                        </xforms:action>
                     </xforms:action>
                  </xforms:select>
               </xhtml:td>
               <xhtml:td>
                  <xforms:select ref="instance('selected-refsets')" appearance="full" id="refsetFilterList">
                     <xforms:itemset nodeset="instance('filters')/refsets/refset">
                        <xforms:label ref="."/>
                        <xforms:value ref="@id"/>
                     </xforms:itemset>
                     <xforms:action ev:event="xforms-value-changed">
                        <xforms:send submission="update-snomed-descriptions"/>
                        <xforms:action if="xxforms:index('descriptions')&gt;1">
                           <xforms:setindex repeat="descriptions" index="1"/>
                        </xforms:action>
                     </xforms:action>
                  </xforms:select>
               </xhtml:td>
            </xhtml:tr>
         </xhtml:table>
      </xxforms:dialog>
      <!-- dialog for finalizing translation -->
      <xxforms:dialog id="finalize-translation-dialog" appearance="full" level="modal" close="false" draggable="true" visible="false">
         <xforms:label ref="$resources/translation"/>
         <xhtml:table width="750px">
            <xforms:group ref="instance('duplicate-translations')[not(desc)]">
               <xhtml:tr>
                  <xhtml:td colspan="3">
                     <xforms:output mediatype="text/html" ref="xxforms:serialize(instance('messages')/status-final[@language=instance('language')], 'html')"/>
                  </xhtml:td>
               </xhtml:tr>
            </xforms:group>
            <xforms:group ref="instance('duplicate-translations')[desc]">
               <xhtml:tr>
                  <xhtml:td colspan="3">
                     <xforms:output mediatype="text/html" ref="xxforms:serialize(instance('messages')/translation-exists[@language=instance('language')], 'html')"/>
                  </xhtml:td>
               </xhtml:tr>
               <xhtml:tr>
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/term"/>
                  </xhtml:td>
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/concept-name"/>
                  </xhtml:td>
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/reference-set"/>
                  </xhtml:td>
               </xhtml:tr>
            </xforms:group>
            <xforms:repeat nodeset="instance('duplicate-translations')/desc">
               <xhtml:tr>
                  <xhtml:td>
                     <xforms:output ref="."/>
                  </xhtml:td>
                  <xhtml:td>
                     <xforms:output ref="@conceptFsn"/>
                  </xhtml:td>
                  <xhtml:td>
                     <xforms:output ref="@refset"/>
                  </xhtml:td>
               </xhtml:tr>
            </xforms:repeat>
            <xhtml:tr>
               <xhtml:td colspan="3">
                  <xhtml:p/>
               </xhtml:td>
            </xhtml:tr>
            <xhtml:tr>
               <xhtml:td colspan="3">
                  <xhtml:div class="buttons">
                     <fr:button>
                        <xforms:label ref="$resources/cancel"/>
                        <xforms:action ev:event="DOMActivate">
                           <xxforms:hide ev:event="DOMActivate" dialog="finalize-translation-dialog"/>
                        </xforms:action>
                     </fr:button>
                     <fr:button>
                        <xforms:label ref="$resources/set-status-to-final"/>
                        <xforms:action ev:event="DOMActivate">
                           <xxforms:hide ev:event="DOMActivate" dialog="finalize-translation-dialog"/>
                           <xforms:action if="not(instance('duplicate-translations')/desc)">
                              <xforms:insert context="instance('member')/desc[index('translations')]" origin="xxforms:attribute('sctId','')"/>
                           </xforms:action>
                           <xforms:action if="instance('duplicate-translations')/desc">
                              <xforms:insert context="instance('member')/desc[index('translations')]" origin="xxforms:attribute('sctId',instance('duplicate-translations')/desc/@id)"/>
                           </xforms:action>
                           <xforms:send submission="finalize-translation"/>
                           <xforms:send submission="get-refset-member"/>
                        </xforms:action>
                     </fr:button>
                  </xhtml:div>
               </xhtml:td>
            </xhtml:tr>
         </xhtml:table>
      </xxforms:dialog>
      <!-- dialog for selecting Art user -->
      <xxforms:dialog id="select-user-dialog" appearance="full" level="modeless" close="false" draggable="true" visible="false">
         <xforms:label ref="$resources/select-user"/>
         <xhtml:table width="250px">
            <xhtml:tr>
               <xhtml:td class="heading">
                  <xforms:output ref="$resources/select-user"/>
               </xhtml:td>
            </xhtml:tr>
            <xhtml:tr>
               <xhtml:td>
                  <xhtml:div class="navigate-small">
                     <xforms:select1 ref="instance('author-instance')/@username" appearance="compact" id="user-select">
                        <xforms:itemset nodeset="instance('users-instance')/user">
                           <xforms:label ref="displayName"/>
                           <xforms:value ref="@name"/>
                        </xforms:itemset>
                        <xforms:action ev:event="xforms-value-changed">
                           <xforms:setvalue ref="instance('author-instance')" value="instance('users-instance')/user[@name=instance('author-instance')/@username]/displayName"/>
                        </xforms:action>
                     </xforms:select1>
                  </xhtml:div>
               </xhtml:td>
            </xhtml:tr>
            <xhtml:tr>
               <xhtml:td>
                  <xhtml:div class="buttons">
                     <fr:button>
                        <xforms:label ref="$resources/cancel"/>
                        <xforms:action ev:event="DOMActivate">
                           <xxforms:hide ev:event="DOMActivate" dialog="select-user-dialog"/>
                        </xforms:action>
                     </fr:button>
                     <fr:button>
                        <xforms:label ref="$resources/add"/>
                        <xforms:action ev:event="DOMActivate">
                           <xxforms:variable name="newId" select="max(instance('project')/author/@id)+1"/>
                           <xforms:setvalue ref="instance('author-instance')/@id" value="$newId"/>
                           <xforms:insert context="instance('project')" nodeset="author" at="index('authorList')" position="after" origin="instance('author-instance')"/>
                           <xxforms:hide ev:event="DOMActivate" dialog="select-user-dialog"/>
                        </xforms:action>
                     </fr:button>
                  </xhtml:div>
               </xhtml:td>
            </xhtml:tr>
         </xhtml:table>
      </xxforms:dialog>
      <!-- ICD10 select dialog -->
      <xxforms:dialog id="icd10-dialog" appearance="full" level="modal" close="false" draggable="true" visible="false">
         <xforms:label ref="$resources/icd10"/>
         <xhtml:table width="100%">
            <xhtml:table class="detail" width="100%" style="margin-top:0.8em;margin-bottom:0.8em;border:2px solid #CCC;">
               <xhtml:tr>
                  <!-- Clear search and refresh -->
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/searchterms"/>
                     <xforms:trigger appearance="minimal">
                        <xforms:label class="control-label">
                           <xhtml:img src="/img/arrow_refresh.png" alt="" align="right"/>
                        </xforms:label>
                        <xforms:action ev:event="DOMActivate">
                           <xforms:setvalue ref="instance('icd-search')" value="''"/>
                           <xforms:delete nodeset="instance('icd-itemset')/node()"/>
                        </xforms:action>
                     </xforms:trigger>
                  </xhtml:td>
                  <!-- Search field -->
                  <xhtml:td>
                     <xforms:input class="top" ref="instance('icd-search')" id="searchSelectICD" incremental="true">
                        <xforms:action ev:event="xforms-value-changed">
                           <xxforms:variable name="search-value" select="."/>
                           <xxforms:variable name="make-suggestion" select="string-length($search-value) &gt;= 2"/>
                           <xforms:action if="$make-suggestion">
                              <xforms:send submission="search-icd"/>
                              <xforms:action if="xxforms:index('descriptions')&gt;1">
                                 <xforms:setindex repeat="descriptions" index="1"/>
                              </xforms:action>
                           </xforms:action>
                        </xforms:action>
                     </xforms:input>
                  </xhtml:td>
               </xhtml:tr>
            </xhtml:table>
            <!-- SEARCH RESULTS -->
            <xhtml:table width="100%" style="margin-top:0.8em;margin-bottom:0.8em;border:2px solid #CCC;">
               <xhtml:tr>
                  <xhtml:td>
                     <xhtml:table class="detail" width="99%">
                        <xhtml:tr>
                           <xhtml:td colspan="7">
                              <xhtml:div class="h2">
                                 <xforms:output ref="$resources/results"/>
                                 (
                                 <xforms:output ref="instance('icd-itemset')/@current"/>
                                 <xforms:output ref="$resources/of"/>
                                 <xforms:output ref="instance('icd-itemset')/@count"/>
                                 )
                              </xhtml:div>
                           </xhtml:td>
                        </xhtml:tr>
                        <xhtml:tr>
                           <xhtml:td width="80%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                              <xforms:output ref="$resources/description"/>
                           </xhtml:td>
                           <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                              <xforms:output ref="$resources/code"/>
                           </xhtml:td>
                           <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                              <xforms:output ref="$resources/use"/>
                           </xhtml:td>
                        </xhtml:tr>
                     </xhtml:table>
                  </xhtml:td>
               </xhtml:tr>
               <xhtml:tr>
                  <xhtml:td>
                     <xhtml:div class="navigate-seven">
                        <xhtml:table class="detail" width="100%" style="margin-top:0.8em;margin-bottom:0.8em;">
                           <xforms:repeat nodeset="instance('icd-itemset')/icd" id="icdSelectItems">
                              <xhtml:tr>
                                 <xhtml:td width="80%">
                                    <xforms:output ref="desc"/>
                                 </xhtml:td>
                                 <xhtml:td width="10%">
                                    <xforms:output ref="@code"/>
                                 </xhtml:td>
                                 <xhtml:td width="10%" style="text-align:right;padding-right:0.5em;">
                                    <xforms:output ref="@concepts[.!=0]"/>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:repeat>
                        </xhtml:table>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
            </xhtml:table>
            <xhtml:table width="100%">
               <xxforms:variable name="icd10Exists" select="instance('dhd-concept')/icd10[@code=instance('icd-itemset')/icd[index('icdSelectItems')]/@code]"/>
               <xxforms:variable name="codeSelected" select="string-length(instance('icd-itemset')/icd[index('icdSelectItems')]/@code)&gt;0"/>
               <xhtml:tr>
                  <xhtml:td>
                     <xhtml:div class="buttons">
                        <fr:button ref=".[not($icd10Exists)][$codeSelected]">
                           <xforms:label ref="$resources/select"/>
                           <xforms:action ev:event="DOMActivate">
                              <xforms:send submission="create-icd10-mapping"/>
                              <xforms:send submission="get-dhd-concept"/>
                              <xxforms:hide ev:event="DOMActivate" dialog="icd10-dialog"/>
                           </xforms:action>
                        </fr:button>
                        <fr:button>
                           <xforms:label ref="$resources/close"/>
                           <xforms:action ev:event="DOMActivate">
                              <xxforms:hide ev:event="DOMActivate" dialog="icd10-dialog"/>
                           </xforms:action>
                        </fr:button>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
            </xhtml:table>
         </xhtml:table>
      </xxforms:dialog>
      <!-- DBC select dialog -->
      <xxforms:dialog id="dbc-dialog" appearance="full" level="modal" close="false" draggable="true" visible="false">
         <xforms:label ref="$resources/dbc"/>
         <!-- Search -->
         <xhtml:table class="detail" width="100%" style="margin-top:0.8em;margin-bottom:0.8em;border:2px solid #CCC;">
            <xhtml:tr>
               <xhtml:td class="item-label">
                  <xforms:output ref="$resources/searchterms"/>
                  <xforms:trigger appearance="minimal">
                     <xforms:label class="control-label">
                        <xhtml:img src="/img/arrow_refresh.png" alt="" align="right"/>
                     </xforms:label>
                     <xforms:action ev:event="DOMActivate">
                        <xforms:setvalue ref="instance('dbc-search')" value="''"/>
                        <xforms:delete nodeset="instance('dbc-itemset')/node()"/>
                     </xforms:action>
                  </xforms:trigger>
               </xhtml:td>
               <xhtml:td>
                  <xforms:input class="top" ref="instance('dbc-search')" id="searchSelectDBC" incremental="true">
                     <xforms:action ev:event="xforms-value-changed">
                        <xxforms:variable name="search-value" select="."/>
                        <xxforms:variable name="make-suggestion" select="string-length($search-value) &gt;= 2"/>
                        <xforms:action if="$make-suggestion">
                           <xforms:send submission="search-dbc"/>
                           <xforms:action if="xxforms:index('descriptions')&gt;1">
                              <xforms:setindex repeat="descriptions" index="1"/>
                           </xforms:action>
                        </xforms:action>
                     </xforms:action>
                  </xforms:input>
               </xhtml:td>
               <!-- dbc specialism filter -->
               <xhtml:td class="item-label" style="width:5%;">
                  <xforms:output ref="$resources/specialism"/>
               </xhtml:td>
               <xhtml:td>
                  <xforms:select1 ref="instance('dbc-specialism-filter')" appearance="minimal" class="auto-width">
                     <xforms:itemset nodeset="instance('dbc-specialism-list')/specialism">
                        <xforms:label ref="concat(@agbCode,' ',desc)"/>
                        <xforms:value ref="@agbCode"/>
                     </xforms:itemset>
                     <xforms:action ev:event="xforms-value-changed">
                        <xforms:send submission="search-dbc"/>
                     </xforms:action>
                  </xforms:select1>
               </xhtml:td>
            </xhtml:tr>
         </xhtml:table>
         <!-- Search results -->
         <xhtml:table width="100%" style="margin-top:0.8em;margin-bottom:0.8em;border:2px solid #CCC;">
            <xhtml:tr>
               <xhtml:td>
                  <xhtml:table class="detail" width="99%">
                     <xhtml:tr>
                        <xhtml:td colspan="4">
                           <xhtml:div class="h2">
                              <xforms:output ref="$resources/results"/>
                                 (
                                 <xforms:output ref="instance('dbc-itemset')/@current"/>
                              <xforms:output ref="$resources/of"/>
                              <xforms:output ref="instance('dbc-itemset')/@count"/>
                                 )
                              </xhtml:div>
                        </xhtml:td>
                     </xhtml:tr>
                     <xhtml:tr>
                        <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                           <xforms:output ref="$resources/agb"/>
                        </xhtml:td>
                        <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                           <xforms:output ref="$resources/dbc"/>
                        </xhtml:td>
                        <xhtml:td width="70%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                           <xforms:output ref="$resources/description"/>
                        </xhtml:td>
                        <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                           <xforms:output ref="$resources/use"/>
                        </xhtml:td>
                     </xhtml:tr>
                  </xhtml:table>
               </xhtml:td>
            </xhtml:tr>
            <xhtml:tr>
               <xhtml:td>
                  <xhtml:div class="navigate-seven">
                     <xhtml:table class="detail" width="100%" style="margin-top:0.8em;margin-bottom:0.8em;">
                        <xforms:repeat nodeset="instance('dbc-itemset')/dbc" id="dbcSelectItems">
                           <xhtml:tr>
                              <xhtml:td width="10%">
                                 <xforms:output ref="@agbCode"/>
                              </xhtml:td>
                              <xhtml:td width="10%">
                                 <xforms:output ref="@code"/>
                              </xhtml:td>
                              <xhtml:td width="70%">
                                 <xforms:output ref="desc"/>
                              </xhtml:td>
                              <xhtml:td width="10%" style="text-align:right;padding-right:0.5em;">
                                 <xforms:output ref="@concepts"/>
                              </xhtml:td>
                           </xhtml:tr>
                        </xforms:repeat>
                     </xhtml:table>
                  </xhtml:div>
               </xhtml:td>
            </xhtml:tr>
         </xhtml:table>
         <!-- buttons -->
         <xhtml:table width="100%">
            <xxforms:variable name="dbcExists"
               select="instance('dhd-concept')/dbc[@code=instance('dbc-itemset')/dbc[index('dbcSelectItems')]/@code][@agbCode=instance('dbc-itemset')/dbc[index('dbcSelectItems')]/@agbCode]"/>
            <xxforms:variable name="codeSelected" select="string-length(instance('dbc-itemset')/dbc[index('dbcSelectItems')]/@code)&gt;0"/>
            <xhtml:tr>
               <xhtml:td>
                  <xhtml:div class="buttons">
                     <fr:button ref=".[not($dbcExists)][$codeSelected]">
                        <xforms:label ref="$resources/select"/>
                        <xforms:action ev:event="DOMActivate">
                           <xforms:send submission="create-dbc-mapping"/>
                           <xforms:send submission="get-dhd-concept"/>
                           <xforms:refresh model="dhd-form-model"/>
                           <xxforms:hide ev:event="DOMActivate" dialog="dbc-dialog"/>
                        </xforms:action>
                     </fr:button>
                     <fr:button>
                        <xforms:label ref="$resources/close"/>
                        <xforms:action ev:event="DOMActivate">
                           <xxforms:hide ev:event="DOMActivate" dialog="dbc-dialog"/>
                        </xforms:action>
                     </fr:button>
                  </xhtml:div>
               </xhtml:td>
            </xhtml:tr>
         </xhtml:table>
      </xxforms:dialog>
      <!-- DOMain select dialog -->
      <xxforms:dialog id="domain-dialog" appearance="full" level="modal" close="false" draggable="true" visible="false">
         <xforms:label ref="$resources/specialism"/>
         <xhtml:table width="400px" style="margin-top:0.8em;margin-bottom:0.8em;border:2px solid #CCC;">
            <xhtml:tr>
               <xhtml:td>
                  <xhtml:table class="detail" width="98%">
                     <xhtml:tr>
                        <xhtml:td width="15%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                           <xforms:output ref="$resources/agb"/>
                        </xhtml:td>
                        <xhtml:td width="15%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                           <xforms:output ref="$resources/short"/>
                        </xhtml:td>
                        <xhtml:td width="70%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                           <xforms:output ref="$resources/description"/>
                        </xhtml:td>
                     </xhtml:tr>
                  </xhtml:table>
               </xhtml:td>
            </xhtml:tr>
            <xhtml:tr>
               <xhtml:td>
                  <xhtml:div class="navigate-seven">
                     <xhtml:table class="detail" width="100%" style="margin-top:0.8em;margin-bottom:0.8em;">
                        <xforms:repeat nodeset="instance('domain-list')/specialism" id="domainSelectItems">
                           <xhtml:tr>
                              <xhtml:td width="15%">
                                 <xforms:output ref="@agbCode"/>
                              </xhtml:td>
                              <xhtml:td width="15%">
                                 <xforms:output ref="subDescShort"/>
                              </xhtml:td>
                              <xhtml:td width="70%">
                                 <xforms:output ref="subDesc"/>
                              </xhtml:td>
                           </xhtml:tr>
                        </xforms:repeat>
                     </xhtml:table>
                  </xhtml:div>
               </xhtml:td>
            </xhtml:tr>
         </xhtml:table>
         <!-- buttons -->
         <xhtml:table width="100%">
            <xxforms:variable name="domainExists"
               select="instance('dhd-concept')/specialism[@agbCode=instance('domain-list')/specialism[index('domainSelectItems')]/@agbCode][@subspecialismShort=instance('domain-list')/specialism[index('domainSelectItems')]/subDescShort]"/>
            <xhtml:tr>
               <xhtml:td>
                  <xhtml:div class="buttons">
                     <fr:button ref=".[not($domainExists)]">
                        <xforms:label ref="$resources/select"/>
                        <xforms:action ev:event="DOMActivate">
                           <xforms:send submission="create-domain-mapping"/>
                           <xforms:send submission="get-dhd-concept"/>
                           <xxforms:hide ev:event="DOMActivate" dialog="domain-dialog"/>
                        </xforms:action>
                     </fr:button>
                     <fr:button>
                        <xforms:label ref="$resources/close"/>
                        <xforms:action ev:event="DOMActivate">
                           <xxforms:hide ev:event="DOMActivate" dialog="domain-dialog"/>
                        </xforms:action>
                     </fr:button>
                  </xhtml:div>
               </xhtml:td>
            </xhtml:tr>
         </xhtml:table>
      </xxforms:dialog>
      <!-- New Release dialog -->
      <xxforms:dialog id="release-dialog" appearance="full" level="modal" close="false" draggable="true" visible="false">
         <xforms:label ref="$resources/new-release"/>
         <!-- group for new release -->
         <xforms:group ref="instance('new-release')[$editor]">
            <xhtml:table width="100%" class="detail">
               <xhtml:tr>
                  <xhtml:td colspan="4" class="heading">
                     <xhtml:div class="heading">
                        <xforms:output ref="$resources/new-release"/>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
               <xhtml:tr>
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/update"/>
                  </xhtml:td>
                  <xhtml:td colspan="3">
                     <xforms:output ref="instance('thesaurus-info')/concepts/@update"/>
                     <xforms:group ref=".[instance('thesaurus-info')/concepts/@update!=0]">
                        <xhtml:img src="/img/exclamation.png" alt=""/>
                     </xforms:group>
                  </xhtml:td>
               </xhtml:tr>
               <xhtml:tr>
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/review"/>
                  </xhtml:td>
                  <xhtml:td colspan="3">
                     <xforms:output ref="instance('thesaurus-info')/concepts/@review"/>
                  </xhtml:td>
               </xhtml:tr>
               <xhtml:tr>
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/draft"/>
                  </xhtml:td>
                  <xhtml:td colspan="3">
                     <xforms:output ref="instance('thesaurus-info')/concepts/@draft"/>
                  </xhtml:td>
               </xhtml:tr>
               <!-- label and date-time -->
               <xhtml:tr>
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/label"/>
                  </xhtml:td>
                  <xhtml:td>
                     <xforms:input ref="@label" incremental="true">
                        <xforms:alert>
                           <xforms:output ref="$resources/required-field"/>
                        </xforms:alert>
                     </xforms:input>
                  </xhtml:td>
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/date"/>
                  </xhtml:td>
                  <xhtml:td>
                     <xforms:input ref="@effectiveTime"/>
                  </xhtml:td>
               </xhtml:tr>
               <xhtml:tr>
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/comment"/>
                  </xhtml:td>
                  <xhtml:td colspan="3">
                     <xforms:textarea mediatype="text/html" ref="comment"/>
                  </xhtml:td>
               </xhtml:tr>
            </xhtml:table>
         </xforms:group>
         <xhtml:table width="100%">
            <xhtml:tr>
               <xhtml:td>
                  <xhtml:div class="buttons">
                     <fr:button ref="instance('new-release-valid')">
                        <xforms:label ref="$resources/create-release"/>
                        <xforms:action ev:event="DOMActivate">
                           <xforms:send submission="add-release-info"/>
                           <xforms:send submission="create-1.2-release"/>
                           <xforms:send submission="create-2.1-release"/>
                           <xforms:send submission="get-thesaurus-project"/>
                           <xforms:setvalue ref="instance('data-safe')" value="'true'"/>
                           <xxforms:hide ev:event="DOMActivate" dialog="release-dialog"/>
                           <!--                              <xforms:load resource="{$terminology-external-exist}/dhd/getRelease" show="new"/>-->
                        </xforms:action>
                     </fr:button>
                     <fr:button>
                        <xforms:label ref="$resources/close"/>
                        <xforms:action ev:event="DOMActivate">
                           <xxforms:hide ev:event="DOMActivate" dialog="release-dialog"/>
                        </xforms:action>
                     </fr:button>
                  </xhtml:div>
               </xhtml:td>
            </xhtml:tr>
         </xhtml:table>
      </xxforms:dialog>
      <fr:tabview>
         <!-- THESAURUS TAB -->
         <fr:tab id="thesaurus-tab">
            <fr:label ref="$resources/thesaurus"/>
            <!-- THESAURUS AND SNOMED SEARCH -->
            <xhtml:table width="100%">
               <xxforms:variable name="current-concept" select="instance('snomed-concept-hierarchy')//concept[@navId=instance('snomed-hierarchy-navigation')]"/>
               <xhtml:tr>
                  <xhtml:td colspan="4" style="border:2px solid #CCC;">
                     <!-- SEARCH -->
                     <xhtml:table width="100%">
                        <xhtml:tr>
                           <!-- Clear search and refresh -->
                           <xhtml:td class="item-label">
                              <xforms:output ref="$resources/searchterms"/>
                              <xforms:trigger appearance="minimal" id="snomed-refresh">
                                 <xforms:label class="control-label">
                                    <xhtml:img src="/img/arrow_refresh.png" alt="" align="right"/>
                                 </xforms:label>
                                 <xforms:action ev:event="DOMActivate">
                                    <xforms:setvalue ref="instance('snomed-description-search')" value="''"/>
                                    <xforms:delete nodeset="instance('snomed-description-itemset')/node()"/>
                                    <xforms:setvalue ref="instance('snomed-context-navigation')" value="''"/>
                                    <xforms:send submission="get-snomed-context-concept"/>
                                    <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                    <xforms:send submission="get-snomed-focus-concept"/>
                                    <xforms:setvalue ref="instance('dhd-concept-navigation')" value="''"/>
                                    <xforms:send submission="get-dhd-concept"/>
                                    <xforms:setfocus control="search-snomed-description"/>
                                 </xforms:action>
                              </xforms:trigger>
                           </xhtml:td>
                           <!-- Search field and filters -->
                           <xhtml:td>
                              <xforms:input class="top" ref="instance('snomed-description-search')" id="search-snomed-description" incremental="true">
                                 <xforms:action ev:event="xforms-value-changed">
                                    <xxforms:variable name="search-value" select="."/>
                                    <xxforms:variable name="make-suggestion"
                                       select="(string-length($search-value) &gt;= 3 and not(matches($search-value,'^[A-Z]|\s$|\s[a-z|0-9]$'))) or (string-length($search-value) &gt;= 2 and not(matches($search-value,'^[a-z]|\s$')))  or matches($search-value,'^[0-9]+')"/>
                                    <xforms:action if="$make-suggestion">
                                       <xforms:send submission="update-snomed-descriptions"/>
                                       <xforms:action if="xxforms:index('descriptions')&gt;1">
                                          <xforms:setindex repeat="descriptions" index="1"/>
                                       </xforms:action>
                                    </xforms:action>
                                 </xforms:action>
                              </xforms:input>
                              <!-- Snomed filter -->
                              <xforms:trigger ref=".[instance('search-thesaurus-only')='false']" appearance="minimal" id="filter">
                                 <xforms:label class="control-label">
                                    <xhtml:img src="/img/filter.png" alt=""/>
                                 </xforms:label>
                                 <xforms:hint ref="$resources/filter"/>
                                 <xforms:action ev:event="DOMActivate">
                                    <xxforms:show dialog="filter-dialog"/>
                                 </xforms:action>
                              </xforms:trigger>
                              <!-- Snomed filter -->
                              <xforms:trigger ref=".[string-length(instance('selected-toplevels'))&gt;0]" appearance="minimal">
                                 <xforms:label class="control-label">
                                    <xhtml:img src="/img/node-s.png" alt=""/>
                                 </xforms:label>
                                 <xforms:hint ref="$resources/clear-filter"/>
                                 <xforms:action ev:event="DOMActivate">
                                    <xforms:setvalue ref="instance('selected-toplevels')" value="''"/>
                                 </xforms:action>
                              </xforms:trigger>
                              <!-- Clear link mode -->
                              <xforms:trigger ref=".[instance('snomed-link-mode')='true']" appearance="minimal">
                                 <xforms:label class="control-label">
                                    <xhtml:img src="/img/link16.png" alt=""/>
                                 </xforms:label>
                                 <xforms:hint ref="$resources/clear-snomed-link-mode"/>
                                 <xforms:action ev:event="DOMActivate">
                                    <xforms:setvalue ref="instance('snomed-link-mode')" value="'false'"/>
                                 </xforms:action>
                              </xforms:trigger>
                           </xhtml:td>
                           <!-- thesaurus only search -->
                           <xhtml:td class="item-label">
                              <xforms:output ref="$resources/thesaurus"/>
                           </xhtml:td>
                           <xhtml:td width="5%">
                              <xforms:input ref="instance('search-thesaurus-only')" class="short-number">
                                 <xforms:action ev:event="xforms-value-changed">

                                    <!--                                    <xforms:send submission="update-snomed-descriptions"/>-->
                                    <!--     <xforms:action if="xxforms:index('descriptions')>1">
                                       <xforms:setindex repeat="descriptions" index="1"/>
                                    </xforms:action>-->
                                    <xforms:action if="instance('snomed-link-mode')='false'">
                                       <xforms:send submission="update-snomed-descriptions"/>
                                    </xforms:action>
                                    <xforms:action if="instance('snomed-link-mode')='true'">
                                       <xforms:delete nodeset="instance('snomed-description-itemset')/description"/>
                                       <xforms:setvalue ref="instance('snomed-description-itemset')/@count" value="0"/>
                                       <xforms:setvalue ref="instance('snomed-description-itemset')/@current" value="0"/>
                                       <xforms:setvalue if="instance('search-thesaurus-only')='true'" ref="instance('snomed-link-mode')" value="'false'"/>
                                    </xforms:action>
                                 </xforms:action>
                              </xforms:input>
                           </xhtml:td>
                           <!-- concept status filter -->
                           <xhtml:td class="item-label" style="width:5%;">
                              <xforms:output ref="$resources/status"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:select1 ref="instance('member-status-filter')" appearance="minimal" class="auto-width">
                                 <xforms:itemset nodeset="instance('status-filters')/filter">
                                    <xforms:label ref="name[@language=instance('language')]"/>
                                    <xforms:value ref="@statusCodes"/>
                                 </xforms:itemset>
                                 <xforms:action ev:event="xforms-value-changed">
                                    <xforms:send submission="update-snomed-descriptions"/>
                                 </xforms:action>
                              </xforms:select1>
                           </xhtml:td>
                           <xhtml:td>
                              <xhtml:div class="buttons">
                                 <xforms:group ref=".[$editor or $authorize]">
                                    <!-- button for getting draft concepts -->
                                    <fr:button ref=".[instance('status-info')/@draft &gt; 0]">
                                       <xforms:label>
                                          <xhtml:img src="/img/node-sdraft.png" alt=""/>
                                       </xforms:label>
                                       <xforms:hint>
                                          <xforms:output ref="$resources/get-all-draft-concepts"/>
                                       </xforms:hint>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:send submission="get-draft-concept-list"/>
                                       </xforms:action>
                                    </fr:button>
                                    <!-- button for getting  update concepts -->
                                    <fr:button ref=".[instance('status-info')/@update &gt; 0]">
                                       <xforms:label>
                                          <xhtml:img src="/img/node-supdate.png" alt=""/>
                                       </xforms:label>
                                       <xforms:hint>
                                          <xforms:output ref="$resources/get-all-update-concepts"/>
                                       </xforms:hint>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:send submission="get-update-concept-list"/>
                                       </xforms:action>
                                    </fr:button>
                                    <!-- button for getting review concepts -->
                                    <fr:button ref=".[instance('status-info')/@review &gt; 0]">
                                       <xforms:label>
                                          <xhtml:img src="/img/eye.png" alt=""/>
                                       </xforms:label>
                                       <xforms:hint>
                                          <xforms:output ref="$resources/get-all-review-concepts"/>
                                       </xforms:hint>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:send submission="get-review-concept-list"/>
                                       </xforms:action>
                                    </fr:button>
                                    <!-- button for getting rejected concepts -->
                                    <fr:button ref=".[instance('status-info')/@rejected &gt; 0]">
                                       <xforms:label>
                                          <xhtml:img src="/img/node-srejected.png" alt=""/>
                                       </xforms:label>
                                       <xforms:hint>
                                          <xforms:output ref="$resources/get-all-rejected-concepts"/>
                                       </xforms:hint>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:send submission="get-rejected-concept-list"/>
                                       </xforms:action>
                                    </fr:button>
                                    <!-- button for getting assigned concepts -->
                                    <fr:button ref=".[instance('assigned-concepts')/@count &gt; 0]">
                                       <xforms:label>
                                          <xhtml:img src="/img/tracking.png" alt=""/>
                                       </xforms:label>
                                       <xforms:hint>
                                          <xforms:output ref="$resources/get-assigned-concepts"/>
                                       </xforms:hint>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:send submission="get-assigned-concepts"/>
                                       </xforms:action>
                                    </fr:button>
                                 </xforms:group>
                              </xhtml:div>
                           </xhtml:td>
                        </xhtml:tr>
                     </xhtml:table>
                     <xhtml:p/>
                     <!-- SEARCH RESULTS -->
                     <xhtml:div class="h2">
                        <xforms:output ref="$resources/results"/>
                        (
                        <xforms:output ref="instance('snomed-description-itemset')/@current"/>
                        <xforms:output ref="$resources/of"/>
                        <xforms:output ref="instance('snomed-description-itemset')/@count"/>
                        )
                     </xhtml:div>
                     <xhtml:div class="navigate-seven">
                        <xhtml:table width="100%">
                           <xforms:repeat nodeset="instance('snomed-description-itemset')/description" id="descriptions">
                              <xhtml:tr>
                                 <xhtml:td style="text-align:center;background-color:#ebe7e1;padding-right:0.4em;padding-left:0.4em;width:1%;margin-right:0.5em;">
                                    <xforms:output ref="if (@type='pref') then 'P' else if(@type='fsn') then 'F' else('S')">
                                       <xforms:hint>F = Fully Specified Name, P = Preferred, S = Synonym</xforms:hint>
                                    </xforms:output>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xforms:output ref="." class="node-s{@memberStatusCode}"/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xforms:output ref="@fullName"/>
                                 </xhtml:td>
                              </xhtml:tr>
                              <xforms:action ev:event="xxforms-index-changed">
                                 <xforms:action if="not(instance('snomed-concept-navigation')=instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId)">
                                    <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
                                    <xforms:send submission="get-snomed-context-concept"/>
                                    <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                 </xforms:action>
                                 <xforms:action if="instance('snomed-link-mode')='false'">
                                    <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@thesaurusId"/>
                                    <xforms:send submission="get-dhd-concept"/>
                                 </xforms:action>
                              </xforms:action>
                              <!--                              <xforms:action ev:event="xxforms-nodeset-changed">
                                 <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
                                 <xforms:send submission="get-snomed-context-concept"/>
                                 <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                 <xforms:action if="instance('snomed-link-mode')='false'">
                                    <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@thesaurusId"/>
                                    <xforms:send submission="get-dhd-concept"/>
                                 </xforms:action>
                              </xforms:action>-->
                           </xforms:repeat>
                        </xhtml:table>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
            </xhtml:table>
            <!-- DHD CONCEPT DETAILS -->
            <xhtml:table class="detail" width="100%" style="margin-top:0.8em;margin-bottom:0.8em;border:2px solid #CCC;">
               <xhtml:tr>
                  <xhtml:td>
                     <xforms:group ref="instance('dhd-concept')">
                        <xhtml:table width="100%" class="detail">
                           <!-- heading with buttons -->
                           <xhtml:tr>
                              <xhtml:td class="heading" colspan="6">
                                 <xhtml:div class="heading">
                                    <xforms:output ref="desc[@type='pref']"/>
                                 </xhtml:div>
                                 <!-- div with buttons -->
                                 <xhtml:div class="buttons" style="margin-left:5em;">
                                    <!-- button for creating empty thesaurus concept -->
                                    <fr:button ref=".[$editor]">
                                       <xforms:label>
                                          <xhtml:img src="/img/plus.png" alt=""/>
                                       </xforms:label>
                                       <xforms:hint>
                                          <xforms:output ref="$resources/create-concept"/>
                                       </xforms:hint>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:send submission="add-empty-concept"/>
                                          <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('dhd-concept')/@thesaurusId"/>
                                          <xforms:send submission="get-dhd-concept"/>
                                          <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('dhd-concept')/snomed/@conceptId"/>
                                          <xforms:send submission="get-snomed-context-concept"/>
                                          <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                          <xforms:setfocus control="descriptionRepeat"/>
                                       </xforms:action>
                                    </fr:button>
                                 </xhtml:div>
                                 <xhtml:div class="buttons">
                                    <xforms:group ref=".[$authorize]">
                                       <!-- button for authorizing setting status to 'active' -->
                                       <fr:button ref=".[@statusCode='review']">
                                          <xforms:label>
                                             <xhtml:img src="/img/tick.png" alt=""/>
                                          </xforms:label>
                                          <xforms:hint>
                                             <xforms:output ref="$resources/authorize-and-activate"/>
                                          </xforms:hint>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:setvalue ref="instance('status-change')/@object" value="'concept'"/>
                                             <xforms:setvalue ref="instance('status-change')/@ref" value="instance('dhd-concept')/@thesaurusId"/>
                                             <xforms:setvalue ref="instance('status-change')/@statusCode" value="'active'"/>
                                             <xxforms:show dialog="status-dialog"/>
                                             <!--                                             <xforms:send submission="set-status"/>-->
                                          </xforms:action>
                                       </fr:button>
                                    </xforms:group>
                                    <xforms:group ref=".[$editor]">
                                       <!-- button for SNOMED link -->
                                       <fr:button ref=".[@statusCode=('draft','update')][string-length(snomed/@conceptId)=0][instance('snomed-link-mode')='false']">
                                          <xforms:label>
                                             <xhtml:img src="/img/link16.png" alt=""/>
                                          </xforms:label>
                                          <xforms:hint>
                                             <xforms:output ref="$resources/link-snomed-concept"/>
                                          </xforms:hint>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:setvalue ref="instance('snomed-link-mode')" value="'true'"/>
                                             <xforms:setvalue ref="instance('search-thesaurus-only')" value="'false'"/>
                                             <xforms:setfocus control="search-snomed-description"/>
                                          </xforms:action>
                                       </fr:button>
                                       <!-- button for setting status to 'review' -->
                                       <fr:button ref=".[@statusCode=('draft','update','pending')][not(desc[string-length(text())=0])]">
                                          <xforms:label>
                                             <xhtml:img src="/img/eye.png" alt=""/>
                                          </xforms:label>
                                          <xforms:hint>
                                             <xforms:output ref="$resources/review"/>
                                          </xforms:hint>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:setvalue ref="instance('status-change')/@object" value="'concept'"/>
                                             <xforms:setvalue ref="instance('status-change')/@ref" value="instance('dhd-concept')/@thesaurusId"/>
                                             <xforms:setvalue ref="instance('status-change')/@statusCode" value="'review'"/>
                                             <xforms:send submission="set-status"/>
                                          </xforms:action>
                                       </fr:button>
                                       <!-- button for setting status to 'rejected' -->
                                       <fr:button ref=".[@statusCode='draft' or (@statusCode='review' and @history='0')]">
                                          <xforms:label>
                                             <xhtml:img src="/img/node-srejected.png" alt=""/>
                                          </xforms:label>
                                          <xforms:hint>
                                             <xforms:output ref="$resources/reject"/>
                                          </xforms:hint>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:setvalue ref="instance('status-change')/@object" value="'concept'"/>
                                             <xforms:setvalue ref="instance('status-change')/@ref" value="instance('dhd-concept')/@thesaurusId"/>
                                             <xforms:setvalue ref="instance('status-change')/@statusCode" value="'rejected'"/>
                                             <xxforms:show dialog="status-dialog"/>
                                          </xforms:action>
                                       </fr:button>
                                       <!-- button for deleting concept -->
                                       <fr:button ref=".[@statusCode='draft']">
                                          <xforms:label>
                                             <xhtml:img src="/img/remove.gif" alt=""/>
                                          </xforms:label>
                                          <xforms:hint>
                                             <xforms:output ref="$resources/delete"/>
                                          </xforms:hint>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:action
                                                xxforms:iterate="instance('snomed-context-concept')//concept[@thesaurusId=instance('dhd-concept')/@thesaurusId]|instance('snomed-context-concept')//dest[@thesaurusId=instance('dhd-concept')/@thesaurusId]">
                                                <xforms:setvalue ref="context()/@memberStatusCode" value="''"/>
                                             </xforms:action>
                                             <xforms:action xxforms:iterate="instance('snomed-description-itemset')//description[@thesaurusId=instance('dhd-concept')/@thesaurusId]">
                                                <xforms:setvalue ref="context()/@memberStatusCode" value="''"/>
                                             </xforms:action>
                                             <xforms:send submission="delete-dhd-thesaurus-concept"/>
                                             <xforms:send submission="get-dhd-concept"/>
                                          </xforms:action>
                                       </fr:button>
                                       <!-- button for setting status to 'draft' -->
                                       <fr:button ref=".[@statusCode='review'][@history=0]">
                                          <xforms:label>
                                             <xhtml:img src="/img/write.png" alt=""/>
                                          </xforms:label>
                                          <xforms:hint>
                                             <xforms:output ref="$resources/edit"/>
                                          </xforms:hint>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:setvalue ref="instance('status-change')/@object" value="'concept'"/>
                                             <xforms:setvalue ref="instance('status-change')/@ref" value="instance('dhd-concept')/@thesaurusId"/>
                                             <xforms:setvalue ref="instance('status-change')/@statusCode" value="'draft'"/>
                                             <xforms:send submission="set-status"/>
                                          </xforms:action>
                                       </fr:button>
                                       <!-- button for setting status to 'update' -->
                                       <fr:button ref=".[@statusCode=('active','review')][@history &gt;0]">
                                          <xforms:label>
                                             <xhtml:img src="/img/write.png" alt=""/>
                                          </xforms:label>
                                          <xforms:hint>
                                             <xforms:output ref="$resources/edit"/>
                                          </xforms:hint>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:setvalue ref="instance('status-change')/@object" value="'concept'"/>
                                             <xforms:setvalue ref="instance('status-change')/@ref" value="instance('dhd-concept')/@thesaurusId"/>
                                             <xforms:setvalue ref="instance('status-change')/@statusCode" value="'update'"/>
                                             <xforms:send submission="set-status"/>
                                          </xforms:action>
                                       </fr:button>
                                       <!-- button for setting status to 'retired' -->
                                       <fr:button ref=".[@statusCode='active']">
                                          <xforms:label>
                                             <xhtml:img src="/img/node-sretired.png" alt=""/>
                                          </xforms:label>
                                          <xforms:hint>
                                             <xforms:output ref="$resources/deactivate"/>
                                          </xforms:hint>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:setvalue ref="instance('status-change')/@object" value="'concept'"/>
                                             <xforms:setvalue ref="instance('status-change')/@ref" value="instance('dhd-concept')/@thesaurusId"/>
                                             <xforms:setvalue ref="instance('status-change')/@statusCode" value="'retired'"/>
                                             <xxforms:show dialog="status-dialog"/>
                                          </xforms:action>
                                       </fr:button>
                                       <!-- button for creating replacement concept' -->
                                       <fr:button ref=".[@statusCode='active'][string-length(@idLink)=0]">
                                          <xforms:label>
                                             <xhtml:img src="/img/add-replacement.png" alt=""/>
                                          </xforms:label>
                                          <xforms:hint>
                                             <xforms:output ref="$resources/add-replacement"/>
                                          </xforms:hint>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:send submission="add-replacement-concept"/>
                                          </xforms:action>
                                       </fr:button>
                                    </xforms:group>
                                    <!-- button for creating issue -->
                                    <xxforms:variable name="noIssue" select="empty(instance('issues-instance')/issue[object/@id=instance('dhd-concept')/@thesaurusId])"/>
                                    <xforms:group ref=".[$noIssue][$issueCreator][@statusCode=('draft','active','update')]">
                                       <fr:button id="add-issue">
                                          <xforms:label>
                                             <xhtml:img src="/img/tracking.png" alt=""/>
                                          </xforms:label>
                                          <xforms:hint>
                                             <xforms:output ref="$resources/add-issue"/>
                                          </xforms:hint>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:insert nodeset="instance('issues-instance')/issue" at="1" position="before" origin="instance('issue-instance')/issue"/>
                                             <xforms:setvalue ref="instance('issues-instance')/issue[1]/object/@id" value="instance('dhd-concept')/@thesaurusId"/>
                                             <xforms:setvalue ref="instance('issues-instance')/issue[1]/object/@type" value="'RS'"/>
                                             <xforms:setvalue ref="instance('issues-instance')/issue[1]/object/@effectiveDate" value="instance('dhd-concept')/@effectiveDate"/>
                                             <xforms:setvalue ref="instance('issues-instance')/issue[1]/tracking/author"
                                                value="instance('project')/author[@username=xxforms:get-session-attribute('username')]"/>
                                             <xforms:setvalue ref="instance('issues-instance')/issue[1]/tracking/author/@id"
                                                value="instance('project')/author[@username=xxforms:get-session-attribute('username')]/@id"/>
                                             <xforms:setvalue ref="instance('issues-instance')/issue[1]/tracking/desc/@language" value="instance('language')"/>
                                             <xforms:setvalue ref="instance('issues-instance')/issue[1]/@refsetId" value="instance('refset-project')/@id"/>
                                             <xforms:setfocus control="issue-title"/>
                                          </xforms:action>
                                       </fr:button>
                                    </xforms:group>
                                 </xhtml:div>
                              </xhtml:td>
                           </xhtml:tr>
                           <!-- DHD thesaurus id and status -->
                           <xhtml:tr>
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/thesaurus-id"/>
                              </xhtml:td>
                              <xhtml:td width="10%">
                                 <xforms:output ref="@thesaurusId"/>
                              </xhtml:td>
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/snomed-id"/>
                              </xhtml:td>
                              <xhtml:td width="10%">
                                 <xforms:output ref="snomed/@conceptId"/>
                              </xhtml:td>
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/status"/>
                              </xhtml:td>
                              <xhtml:td>
                                 <xxforms:variable name="statusCode" select="@statusCode"/>
                                 <xforms:output ref="instance('status-codes')/enumeration[@value=$statusCode]/label[@language=instance('language')]" class="node-s{$statusCode}"/>
                              </xhtml:td>
                           </xhtml:tr>
                           <!-- DHD effectiveDate and expirationDate -->
                           <xhtml:tr>
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/date"/>
                              </xhtml:td>
                              <xhtml:td>
                                 <xforms:output ref="@effectiveDate"
                                    xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                 />
                              </xhtml:td>
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/expiration-date"/>
                              </xhtml:td>
                              <xhtml:td>
                                 <xforms:output ref="@expirationDate"
                                    xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                 />
                              </xhtml:td>
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/edit-date"/>
                              </xhtml:td>
                              <xhtml:td width="10%">
                                 <xforms:output ref="@editDate"
                                    xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                 />
                              </xhtml:td>
                           </xhtml:tr>
                           <!-- Snomed  full name and validation -->
                           <xhtml:tr>
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/snomed-name"/>
                              </xhtml:td>
                              <xhtml:td colspan="3">
                                 <xforms:output ref="snomed/desc"/>
                              </xhtml:td>
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/validated"/>
                              </xhtml:td>
                              <xhtml:td>
                                 <xforms:output ref="snomed/@validationDate"
                                    xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                    class="{if (snomed/@validated='true') then 'node-sfinal' else 'node-sdraft'}"/>
                              </xhtml:td>
                           </xhtml:tr>
                           <!-- replaces -->
                           <xforms:group ref="replaces">
                              <xhtml:tr>
                                 <xhtml:td class="item-label">
                                    <xforms:output ref="$resources/replaces"/>
                                 </xhtml:td>
                                 <xhtml:td colspan="5">
                                    <xforms:trigger appearance="minimal">
                                       <xforms:label>
                                          <xforms:output ref="."/>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('dhd-concept')/replaces/@thesaurusId"/>
                                          <xforms:send submission="get-dhd-concept"/>
                                          <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('dhd-concept')/snomed/@conceptId"/>
                                          <xforms:send submission="get-snomed-context-concept"/>
                                          <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                       </xforms:action>
                                    </xforms:trigger>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:group>
                           <!-- replacedBy -->
                           <xforms:group ref="replacedBy">
                              <xhtml:tr>
                                 <xhtml:td class="item-label">
                                    <xforms:output ref="$resources/replacedBy"/>
                                 </xhtml:td>
                                 <xhtml:td colspan="5">
                                    <xforms:trigger appearance="minimal">
                                       <xforms:label>
                                          <xforms:output ref="."/>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('dhd-concept')/replacedBy/@thesaurusId"/>
                                          <xforms:send submission="get-dhd-concept"/>
                                          <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('dhd-concept')/snomed/@conceptId"/>
                                          <xforms:send submission="get-snomed-context-concept"/>
                                          <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                       </xforms:action>
                                    </xforms:trigger>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:group>
                        </xhtml:table>
                        <fr:accordion class="fr-accordion-lnf">
                           <!-- Referenece term and synonyms -->
                           <fr:case selected="true">
                              <fr:label ref="concat($resources/reference-term,' / ',$resources/synonyms)"/>
                              <xhtml:table width="100%">
                                 <xxforms:variable name="desc" select="instance('dhd-concept')/desc[index('descriptionRepeat')]"/>
                                 <!-- term header -->
                                 <xhtml:tr>
                                    <xhtml:td class="heading-small" width="56%" colspan="2">
                                       <xforms:output ref="$resources/term"/>
                                    </xhtml:td>
                                    <xhtml:td class="heading-small" width="8%">
                                       <xforms:output ref="$resources/date"/>
                                    </xhtml:td>
                                    <xhtml:td class="heading-small" width="8%">
                                       <xforms:output ref="$resources/expiration-date"/>
                                    </xhtml:td>
                                    <xhtml:td class="heading-small" width="8%">
                                       <xforms:output ref="$resources/edit-date"/>
                                    </xhtml:td>
                                    <xhtml:td class="heading-small" width="20%">
                                       <xforms:output ref="$resources/status"/>
                                       <xhtml:div class="buttons">
                                          <xforms:group ref="desc[parent::concept/@statusCode=('draft','update')][$authorize]">
                                             <!-- activate -->
                                             <xforms:trigger ref=".[$desc/@statusCode='review']" appearance="minimal">
                                                <xforms:label>
                                                   <xhtml:img src="/img/authorize16.png" alt=""/>
                                                </xforms:label>
                                                <xforms:hint>
                                                   <xforms:output ref="$resources/authorize-and-activate"/>
                                                </xforms:hint>
                                                <xforms:action ev:event="DOMActivate">
                                                   <xforms:setvalue ref="instance('status-change')/@object" value="'desc'"/>
                                                   <xforms:setvalue ref="instance('status-change')/@ref" value="instance('dhd-concept')/desc[index('descriptionRepeat')]/@interfaceId"/>
                                                   <xforms:setvalue ref="instance('status-change')/@statusCode" value="'active'"/>
                                                   <xxforms:show dialog="status-dialog"/>
                                                </xforms:action>
                                             </xforms:trigger>
                                          </xforms:group>
                                          <xforms:group ref="desc[parent::concept/@statusCode=('draft','update')][$editor]">
                                             <!-- edit ; set to 'update' -->
                                             <xforms:trigger ref=".[$desc/@statusCode='active']" appearance="minimal">
                                                <xforms:label>
                                                   <xhtml:img src="/img/edit16.png" alt=""/>
                                                </xforms:label>
                                                <xforms:hint ref="$resources/edit" appearance="minimal"/>
                                                <xforms:action ev:event="DOMActivate">
                                                   <xforms:setvalue ref="instance('status-change')/@object" value="'desc'"/>
                                                   <xforms:setvalue ref="instance('status-change')/@ref" value="instance('dhd-concept')/desc[index('descriptionRepeat')]/@interfaceId"/>
                                                   <xforms:setvalue ref="instance('status-change')/@statusCode" value="'update'"/>
                                                   <xforms:send submission="set-status"/>
                                                </xforms:action>
                                             </xforms:trigger>
                                             <!-- add synonym -->
                                             <xforms:trigger appearance="minimal">
                                                <xforms:label>
                                                   <xhtml:img src="/img/add16.png" alt=""/>
                                                </xforms:label>
                                                <xforms:hint ref="$resources/add-synonym" appearance="minimal"/>
                                                <xforms:action ev:event="DOMActivate">
                                                   <xforms:send submission="create-description"/>
                                                   <xforms:insert nodeset="." origin="instance('desc')"/>
                                                </xforms:action>
                                             </xforms:trigger>
                                             <!-- delete synonym -->
                                             <xforms:trigger ref=".[$editor][$desc/@statusCode='draft'][$desc/@type='syn']" appearance="minimal">
                                                <xforms:label>
                                                   <xhtml:img src="/img/delete16.png" alt=""/>
                                                </xforms:label>
                                                <xforms:hint ref="$resources/remove" appearance="minimal"/>
                                                <xforms:action ev:event="DOMActivate">
                                                   <xforms:send submission="delete-description"/>
                                                   <xforms:send submission="get-dhd-concept"/>
                                                </xforms:action>
                                             </xforms:trigger>
                                             <!-- deactivate -->
                                             <xforms:trigger ref=".[$desc/@statusCode='active'][$desc/@type='syn']" appearance="minimal">
                                                <xforms:label>
                                                   <xhtml:img src="/img/retire16.png" alt=""/>
                                                </xforms:label>
                                                <xforms:hint ref="$resources/set-status-to-retired" appearance="minimal"/>
                                                <xforms:action ev:event="DOMActivate">
                                                   <xforms:setvalue ref="instance('status-change')/@object" value="'desc'"/>
                                                   <xforms:setvalue ref="instance('status-change')/@ref" value="instance('dhd-concept')/desc[index('descriptionRepeat')]/@interfaceId"/>
                                                   <xforms:setvalue ref="instance('status-change')/@statusCode" value="'retired'"/>
                                                   <xforms:send submission="set-status"/>
                                                </xforms:action>
                                             </xforms:trigger>
                                          </xforms:group>
                                       </xhtml:div>
                                    </xhtml:td>
                                 </xhtml:tr>
                                 <!-- description repeat -->
                                 <xforms:repeat nodeset="desc" id="descriptionRepeat">
                                    <xhtml:tr>
                                       <xhtml:td style="text-align:center;background-color:#ebe7e1;padding-right:0.4em;padding-left:0.4em;width:1%;margin-right:0.5em;">
                                          <xforms:output ref="if (@type='pref') then 'P' else 'S'">
                                             <xforms:hint>P = Preferred, S = Synonym</xforms:hint>
                                          </xforms:output>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:input ref=".[@statusCode=('draft','update')][parent::concept/@statusCode=('draft','update')][$editor]" class="long">
                                             <xforms:action ev:event="xforms-value-changed">
                                                <xforms:send submission="update-description"/>
                                             </xforms:action>
                                          </xforms:input>
                                          <xforms:output ref=".[not(@statusCode=('draft','update')) or parent::concept/@statusCode=('active','retired','rejected') or not($editor)]"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@effectiveDate"
                                             xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                          />
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@expirationDate"
                                             xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                          />
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@editDate"
                                             xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                          />
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xxforms:variable name="refStatusCode" select="@statusCode"/>
                                          <xforms:output ref="instance('status-codes')/enumeration[@value=$refStatusCode]/label[@language=instance('language')]" class="node-s{$refStatusCode}"/>
                                       </xhtml:td>
                                    </xhtml:tr>
                                 </xforms:repeat>
                              </xhtml:table>
                           </fr:case>
                           <!-- ICD10 -->
                           <fr:case selected="true">
                              <fr:label ref="$resources/icd10"/>
                              <xhtml:table width="100%">
                                 <xxforms:variable name="icd10" select="instance('dhd-concept')/icd10[index('icd10')]"/>
                                 <!-- header -->
                                 <xhtml:tr>
                                    <xhtml:td class="heading-small" width="5%">
                                       <xforms:output ref="$resources/code"/>
                                    </xhtml:td>
                                    <xhtml:td class="heading-small" width="51%">
                                       <xforms:output ref="$resources/term"/>
                                    </xhtml:td>
                                    <xhtml:td class="heading-small" width="8%">
                                       <xforms:output ref="$resources/date"/>
                                    </xhtml:td>
                                    <xhtml:td class="heading-small" width="8%">
                                       <xforms:output ref="$resources/expiration-date"/>
                                    </xhtml:td>
                                    <xhtml:td class="heading-small" width="8%">
                                       <xforms:output ref="$resources/edit-date"/>
                                    </xhtml:td>
                                    <xhtml:td class="heading-small" width="20%">
                                       <xforms:output ref="$resources/status"/>
                                       <xhtml:div class="buttons">
                                          <!-- move buttons -->
                                          <xforms:group ref=".[@statusCode=('draft','update')][$editor]">
                                             <!-- move up -->
                                             <xforms:trigger ref=".[$icd10/@priority!=1]" appearance="minimal">
                                                <xforms:label>
                                                   <xhtml:img src="/img/move_up16.png" alt="" class="small-button"/>
                                                </xforms:label>
                                                <xforms:hint ref="$resources/move-up" appearance="minimal"/>
                                                <xforms:action ev:event="DOMActivate">
                                                   <xforms:send submission="move-priority-up"/>
                                                   <xforms:send submission="get-dhd-concept"/>
                                                   <xforms:setindex repeat="icd10" index="index('icd10')-1"/>
                                                </xforms:action>
                                             </xforms:trigger>
                                             <!-- move down -->
                                             <xforms:trigger ref=".[not($icd10/@priority=max(instance('dhd-concept')/icd10/@priority))][count(icd10)&gt;1]" appearance="minimal">
                                                <xforms:label>
                                                   <xhtml:img src="/img/move_down16.png" alt="" class="small-button"/>
                                                </xforms:label>
                                                <xforms:hint ref="$resources/move-down" appearance="minimal"/>
                                                <xforms:action ev:event="DOMActivate">
                                                   <xforms:send submission="move-priority-down"/>
                                                   <xforms:send submission="get-dhd-concept"/>
                                                   <xforms:setindex repeat="icd10" index="index('icd10')+1"/>
                                                </xforms:action>
                                             </xforms:trigger>
                                          </xforms:group>
                                          <!-- authorisation -->
                                          <xforms:group ref=".[@statusCode=('draft','update')][$authorize]">
                                             <!-- activate -->
                                             <xforms:trigger ref=".[$icd10/@statusCode='review']" appearance="minimal">
                                                <xforms:label>
                                                   <xhtml:img src="/img/authorize16.png" alt=""/>
                                                </xforms:label>
                                                <xforms:hint>
                                                   <xforms:output ref="$resources/authorize-and-activate"/>
                                                </xforms:hint>
                                                <xforms:action ev:event="DOMActivate">
                                                   <xforms:setvalue ref="instance('status-change')/@object" value="'icd10'"/>
                                                   <xforms:setvalue ref="instance('status-change')/@ref" value="instance('dhd-concept')/icd10[index('icd10')]/@no"/>
                                                   <xforms:setvalue ref="instance('status-change')/@statusCode" value="'active'"/>
                                                   <xxforms:show dialog="status-dialog"/>
                                                </xforms:action>
                                             </xforms:trigger>
                                          </xforms:group>
                                          <xforms:group ref=".[@statusCode=('draft','update')][$editor]">
                                             <!-- add -->
                                             <xforms:trigger appearance="minimal">
                                                <xforms:label>
                                                   <xhtml:img src="/img/add16.png" alt="" class="small-button"/>
                                                </xforms:label>
                                                <xforms:hint ref="$resources/add" appearance="minimal"/>
                                                <xforms:action ev:event="DOMActivate">
                                                   <xforms:setvalue ref="instance('icd-status-filter')" value="'active'"/>
                                                   <xxforms:show dialog="icd10-dialog"/>
                                                   <xforms:setfocus control="searchSelectICD"/>
                                                </xforms:action>
                                             </xforms:trigger>
                                             <!-- delete -->
                                             <xforms:trigger ref=".[$icd10/@statusCode='draft']" appearance="minimal">
                                                <xforms:label>
                                                   <xhtml:img src="/img/delete16.png" alt="" class="small-button"/>
                                                </xforms:label>
                                                <xforms:hint ref="$resources/remove" appearance="minimal"/>
                                                <xforms:action ev:event="DOMActivate">
                                                   <xforms:send submission="delete-icd10-mapping"/>
                                                   <xforms:send submission="get-dhd-concept"/>
                                                </xforms:action>
                                             </xforms:trigger>
                                             <!-- deactivate -->
                                             <xforms:trigger ref=".[$icd10/@statusCode='active']" appearance="minimal">
                                                <xforms:label>
                                                   <xhtml:img src="/img/retire16.png" alt="" class="small-button"/>
                                                </xforms:label>
                                                <xforms:hint ref="$resources/set-status-to-retired" appearance="minimal"/>
                                                <xforms:action ev:event="DOMActivate">
                                                   <xforms:setvalue ref="instance('status-change')/@object" value="'icd10'"/>
                                                   <xforms:setvalue ref="instance('status-change')/@ref" value="instance('dhd-concept')/icd10[index('icd10')]/@no"/>
                                                   <xforms:setvalue ref="instance('status-change')/@statusCode" value="'retired'"/>
                                                   <xxforms:show dialog="status-dialog"/>
                                                </xforms:action>
                                             </xforms:trigger>
                                          </xforms:group>
                                       </xhtml:div>
                                    </xhtml:td>
                                 </xhtml:tr>
                                 <!-- ICD10 mapping repeat -->
                                 <xforms:repeat nodeset="icd10" id="icd10">
                                    <xhtml:tr>
                                       <xhtml:td>
                                          <xforms:output ref="@code[instance('snomed-link-mode')='false']"/>
                                          <xforms:trigger ref=".[instance('snomed-link-mode')='true']" appearance="minimal">
                                             <xforms:label>
                                                <xforms:output ref="@code"/>
                                             </xforms:label>
                                             <xforms:action ev:event="DOMActivate">
                                                <xforms:send submission="get-snomed-for-icd10"/>
                                                <xforms:setvalue ref="instance('snomed-context-navigation')"
                                                   value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
                                                <xforms:send submission="get-snomed-context-concept"/>
                                                <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                             </xforms:action>
                                          </xforms:trigger>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@term"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@effectiveDate"
                                             xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                          />
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@expirationDate"
                                             xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                          />
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@editDate"
                                             xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                          />
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xxforms:variable name="icdStatusCode" select="@statusCode"/>
                                          <xforms:output ref="instance('status-codes')/enumeration[@value=$icdStatusCode]/label[@language=instance('language')]" class="node-s{$icdStatusCode}"/>
                                       </xhtml:td>
                                    </xhtml:tr>
                                 </xforms:repeat>
                              </xhtml:table>
                           </fr:case>
                           <!-- DBC -->
                           <fr:case selected="true">
                              <fr:label ref="$resources/dbc"/>
                              <xhtml:table width="100%">
                                 <xxforms:variable name="dbc" select="instance('dhd-concept')/dbc[index('dbc')]"/>
                                 <xhtml:tr>
                                    <xhtml:td class="heading-small" colspan="2" width="20%">
                                       <xforms:output ref="$resources/specialism"/>
                                    </xhtml:td>
                                    <xhtml:td class="heading-small" width="5%">
                                       <xforms:output ref="$resources/dbc"/>
                                    </xhtml:td>
                                    <xhtml:td class="heading-small" width="31%">
                                       <xforms:output ref="$resources/description"/>
                                    </xhtml:td>
                                    <xhtml:td class="heading-small" width="8%">
                                       <xforms:output ref="$resources/date"/>
                                    </xhtml:td>
                                    <xhtml:td class="heading-small" width="8%">
                                       <xforms:output ref="$resources/expiration-date"/>
                                    </xhtml:td>
                                    <xhtml:td class="heading-small" width="8%">
                                       <xforms:output ref="$resources/edit-date"/>
                                    </xhtml:td>
                                    <xhtml:td class="heading-small" width="20%">
                                       <xforms:output ref="$resources/status"/>
                                       <xhtml:div class="buttons">
                                          <xforms:group ref=".[@statusCode=('draft','update')][$authorize]">
                                             <!-- activate -->
                                             <xforms:trigger ref=".[$dbc/@statusCode='review']" appearance="minimal">
                                                <xforms:label>
                                                   <xhtml:img src="/img/authorize16.png" alt=""/>
                                                </xforms:label>
                                                <xforms:hint>
                                                   <xforms:output ref="$resources/authorize-and-activate"/>
                                                </xforms:hint>
                                                <xforms:action ev:event="DOMActivate">
                                                   <xforms:setvalue ref="instance('status-change')/@object" value="'dbc'"/>
                                                   <xforms:setvalue ref="instance('status-change')/@ref" value="instance('dhd-concept')/dbc[index('dbc')]/@no"/>
                                                   <xforms:setvalue ref="instance('status-change')/@statusCode" value="'active'"/>
                                                   <xxforms:show dialog="status-dialog"/>
                                                </xforms:action>
                                             </xforms:trigger>
                                          </xforms:group>
                                          <xforms:group ref=".[@statusCode=('draft','update')][$editor]">
                                             <!-- add -->
                                             <xforms:trigger ref=".[$editor]" appearance="minimal">
                                                <xforms:label>
                                                   <xhtml:img src="/img/add16.png" alt="" class="small-button"/>
                                                </xforms:label>
                                                <xforms:hint ref="$resources/add" appearance="minimal"/>
                                                <xforms:action ev:event="DOMActivate">
                                                   <xforms:setvalue ref="instance('dbc-status-filter')" value="'active'"/>
                                                   <xxforms:show dialog="dbc-dialog"/>
                                                   <xforms:setfocus control="searchSelectDBC"/>
                                                </xforms:action>
                                             </xforms:trigger>
                                             <!-- delete -->
                                             <xforms:trigger ref=".[instance('dhd-concept')/dbc[index('dbc')]/@statusCode='draft']" appearance="minimal">
                                                <xforms:label>
                                                   <xhtml:img src="/img/delete16.png" alt="" class="small-button"/>
                                                </xforms:label>
                                                <xforms:hint ref="$resources/remove" appearance="minimal"/>
                                                <xforms:action ev:event="DOMActivate">
                                                   <xforms:send submission="delete-dbc-mapping"/>
                                                   <xforms:send submission="get-dhd-concept"/>
                                                </xforms:action>
                                             </xforms:trigger>
                                             <!-- deactivate -->
                                             <xforms:trigger ref=".[$dbc/@statusCode='active']" appearance="minimal">
                                                <xforms:label>
                                                   <xhtml:img src="/img/retire16.png" alt="" class="small-button"/>
                                                </xforms:label>
                                                <xforms:hint ref="$resources/set-status-to-retired" appearance="minimal"/>
                                                <xforms:action ev:event="DOMActivate">
                                                   <xforms:setvalue ref="instance('status-change')/@object" value="'dbc'"/>
                                                   <xforms:setvalue ref="instance('status-change')/@ref" value="instance('dhd-concept')/dbc[index('dbc')]/@no"/>
                                                   <xforms:setvalue ref="instance('status-change')/@statusCode" value="'retired'"/>
                                                   <xxforms:show dialog="status-dialog"/>
                                                </xforms:action>
                                             </xforms:trigger>
                                          </xforms:group>
                                       </xhtml:div>
                                    </xhtml:td>
                                 </xhtml:tr>
                                 <!-- DBC mapping repeat -->
                                 <xforms:repeat nodeset="dbc" id="dbc">
                                    <xhtml:tr>
                                       <xhtml:td>
                                          <xforms:output ref="@agbCode"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@specialism"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@code"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@desc"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@effectiveDate"
                                             xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                          />
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@expirationDate"
                                             xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                          />
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@editDate"
                                             xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                          />
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xxforms:variable name="dbcStatusCode" select="@statusCode"/>
                                          <xforms:output ref="instance('status-codes')/enumeration[@value=$dbcStatusCode]/label[@language=instance('language')]" class="node-s{$dbcStatusCode}"/>
                                       </xhtml:td>
                                    </xhtml:tr>
                                 </xforms:repeat>
                              </xhtml:table>
                           </fr:case>
                        </fr:accordion>
                        <!-- ISSUES -->
                        <xhtml:table width="100%" class="detail">
                           <!-- group for issue creation -->
                           <xforms:group ref="instance('issues-instance')/issue[object/@id=instance('dhd-concept')/@thesaurusId]">
                              <xhtml:tr>
                                 <xhtml:td colspan="4">
                                    <xhtml:table width="100%">
                                       <xhtml:tr>
                                          <xhtml:td class="heading">
                                             <xhtml:div class="heading">
                                                <xforms:output ref="$resources/new-issue"/>
                                             </xhtml:div>
                                          </xhtml:td>
                                       </xhtml:tr>
                                       <xhtml:tr>
                                          <xhtml:td>
                                             <xhtml:table width="100%">
                                                <!-- issue type -->
                                                <xhtml:tr>
                                                   <xhtml:td class="item-label">
                                                      <xforms:output ref="$resources/type"/>
                                                   </xhtml:td>
                                                   <xhtml:td>
                                                      <xforms:select1 ref="@type" appearance="minimal">
                                                         <xforms:itemset nodeset="instance('decor-types')/IssueType/enumeration">
                                                            <xforms:label ref="label[@language=instance('language')]"/>
                                                            <xforms:value ref="@value"/>
                                                         </xforms:itemset>
                                                      </xforms:select1>
                                                   </xhtml:td>
                                                </xhtml:tr>
                                                <!-- issue type -->
                                                <xhtml:tr>
                                                   <xhtml:td class="item-label">
                                                      <xforms:output ref="$resources/priority"/>
                                                   </xhtml:td>
                                                   <xhtml:td>
                                                      <xforms:select1 ref="@priority" appearance="minimal">
                                                         <xforms:itemset nodeset="instance('decor-types')/IssuePriority/enumeration">
                                                            <xforms:label ref="label[@language=instance('language')]"/>
                                                            <xforms:value ref="@value"/>
                                                         </xforms:itemset>
                                                      </xforms:select1>
                                                   </xhtml:td>
                                                </xhtml:tr>
                                                <!-- title -->
                                                <xhtml:tr>
                                                   <xhtml:td class="item-label">
                                                      <xforms:output ref="$resources/title"/>
                                                   </xhtml:td>
                                                   <xhtml:td>
                                                      <xforms:input id="issue-title" ref="@displayName"/>
                                                   </xhtml:td>
                                                </xhtml:tr>
                                                <!-- description of issue -->
                                                <xhtml:tr>
                                                   <xhtml:td class="item-label">
                                                      <xforms:output ref="$resources/description"/>
                                                   </xhtml:td>
                                                   <xhtml:td>
                                                      <xforms:textarea id="issue-description" mediatype="text/html" ref="tracking/desc"/>
                                                   </xhtml:td>
                                                </xhtml:tr>
                                                <!-- save and cancel buttons -->
                                                <xhtml:tr>
                                                   <xhtml:td class="item-label" colspan="2">
                                                      <xhtml:div class="buttons">
                                                         <fr:button>
                                                            <xforms:label ref="$resources/cancel"/>
                                                            <xforms:action ev:event="DOMActivate">
                                                               <xforms:delete ref="instance('issues-instance')/issue[object/@id=instance('dhd-concept')/@thesaurusId]"/>
                                                               <xforms:setvalue ref="instance('data-safe')">true</xforms:setvalue>
                                                            </xforms:action>
                                                         </fr:button>
                                                         <fr:button>
                                                            <xforms:label ref="$resources/save-issue"/>
                                                            <xforms:action ev:event="DOMActivate">
                                                               <xforms:send submission="save-issue"/>
                                                               <xforms:send submission="get-issues"/>
                                                               <xforms:delete ref="instance('issues-instance')/issue[object/@id=instance('dhd-concept')/@thesaurusId]"/>
                                                               <xforms:setvalue ref="instance('data-safe')">true</xforms:setvalue>
                                                            </xforms:action>
                                                         </fr:button>
                                                      </xhtml:div>
                                                   </xhtml:td>
                                                </xhtml:tr>
                                             </xhtml:table>
                                          </xhtml:td>
                                       </xhtml:tr>
                                    </xhtml:table>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:group>
                           <!-- group for existing issues -->
                           <xforms:group ref="instance('issues')/issue[$issueCreator][object/@id=instance('dhd-concept')/@thesaurusId]">
                              <xhtml:tr>
                                 <xhtml:td colspan="4">
                                    <fr:accordion class="fr-accordion-lnf">
                                       <fr:case>
                                          <fr:label ref="concat($resources/issues,' (',count(instance('issues')/issue[object/@id=instance('dhd-concept')/@thesaurusId]),')')"/>
                                          <xhtml:div class="detail">
                                             <fr:accordion class="fr-accordion-lnf">
                                                <xforms:repeat nodeset="instance('issues')/issue[object/@id=instance('dhd-concept')/@thesaurusId]" id="concept-issues">
                                                   <fr:case>
                                                      <fr:label>
                                                         <xxforms:variable name="type" select="@type"/>
                                                         <xforms:output ref="instance('decor-types')/IssueType/enumeration[@value=$type]/label[@language=instance('language')]"/>: <xforms:output
                                                            ref="@displayName"/>
                                                      </fr:label>
                                                      <xhtml:table width="100%">
                                                         <!-- issue type and priority -->
                                                         <xhtml:tr class="not-selectable">
                                                            <xhtml:td class="item-label">
                                                               <xforms:output ref="$resources/type"/>
                                                            </xhtml:td>
                                                            <xhtml:td>
                                                               <xxforms:variable name="type" select="@type"/>
                                                               <xforms:output ref="instance('decor-types')/IssueType/enumeration[@value=$type]/label[@language=instance('language')]"/>
                                                            </xhtml:td>
                                                            <xhtml:td class="item-label">
                                                               <xforms:output ref="$resources/priority"/>
                                                            </xhtml:td>
                                                            <xhtml:td>
                                                               <xxforms:variable name="priority" select="@priority"/>
                                                               <xforms:output ref="instance('decor-types')/IssuePriority/enumeration[@value=$priority]/label[@language=instance('language')]"/>
                                                            </xhtml:td>
                                                         </xhtml:tr>
                                                         <!-- issue events -->
                                                         <xhtml:tr class="not-selectable">
                                                            <xhtml:td class="item-label">
                                                               <xforms:output ref="$resources/events"/>
                                                            </xhtml:td>
                                                            <xhtml:td colspan="3">
                                                               <xforms:repeat nodeset="tracking|assignment">
                                                                  <xhtml:table width="100%" class="detail" style="border: 1px solid #AAA;">
                                                                     <xhtml:tr class="not-selectable">
                                                                        <xhtml:td style="background-color : #ebe7e1;width:10%;">
                                                                           <xxforms:variable name="status" select="@statusCode"/>
                                                                           <xforms:group ref=".[name()='assignment']">
                                                                              <xforms:output mediatype="image/*" value="'/img/arrowright.png'">
                                                                                 <xforms:hint ref="$resources/assignment"/>
                                                                              </xforms:output>
                                                                           </xforms:group>
                                                                           <xforms:group ref=".[name()='tracking']">
                                                                              <xforms:output mediatype="image/*" value="'/img/tracking.png'">
                                                                                 <xforms:hint ref="$resources/tracking"/>
                                                                              </xforms:output>
                                                                              <xforms:output mediatype="image/*" value="concat('/img/IssueStatusCodeLifeCycle_',@statusCode,'.png')">
                                                                                 <xforms:hint>
                                                                                    <xforms:output ref="$resources/status"
                                                                                       /> = 
                                                                                    <xforms:output
                                                                                       ref="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value=$status]/label[@language=instance('language')]"
                                                                                    />
                                                                                 </xforms:hint>
                                                                              </xforms:output>
                                                                           </xforms:group>
                                                                        </xhtml:td>
                                                                        <xhtml:td style="background-color : #ebe7e1;">
                                                                           <xforms:output ref="author"/>
                                                                        </xhtml:td>
                                                                        <xhtml:td style="background-color : #ebe7e1;">
                                                                           <xforms:output ref="@effectiveDate"
                                                                              xxforms:format="if (instance('language')='en-US') then format-dateTime(xs:dateTime(.),'[M01]/[D01]/[Y]',(), (), ()) else format-dateTime(xs:dateTime(.),'[D01]-[M01]-[Y]', (), (), ())"
                                                                           />
                                                                        </xhtml:td>
                                                                     </xhtml:tr>
                                                                     <xforms:group ref="@name">
                                                                        <xhtml:tr class="not-selectable">
                                                                           <xhtml:td class="item-label">
                                                                              <xforms:output ref="$resources/assigned-to"/>
                                                                           </xhtml:td>
                                                                           <xhtml:td colspan="2">
                                                                              <xforms:output ref="."/>
                                                                           </xhtml:td>
                                                                        </xhtml:tr>
                                                                     </xforms:group>
                                                                     <xhtml:tr class="not-selectable">
                                                                        <xhtml:td class="item-label">
                                                                           <xforms:output ref="$resources/description"/>
                                                                        </xhtml:td>
                                                                        <xhtml:td colspan="2">
                                                                           <xforms:output mediatype="text/html" ref="desc"/>
                                                                        </xhtml:td>
                                                                     </xhtml:tr>
                                                                  </xhtml:table>
                                                               </xforms:repeat>
                                                            </xhtml:td>
                                                         </xhtml:tr>
                                                      </xhtml:table>
                                                   </fr:case>
                                                </xforms:repeat>
                                             </fr:accordion>
                                          </xhtml:div>
                                       </fr:case>
                                    </fr:accordion>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:group>
                        </xhtml:table>
                     </xforms:group>
                  </xhtml:td>
               </xhtml:tr>
            </xhtml:table>
            <!-- SNOMED Context -->
            <xhtml:table class="detail" width="100%" style="border:2px solid #CCC;">
               <xxforms:variable name="current-member-concept" select="instance('snomed-context-concept')//concept[@navId=instance('snomed-context-hierarchy-navigation')]"/>
               <xhtml:tr>
                  <xhtml:td class="heading" colspan="2">
                     <xhtml:div class="heading">
                        <xforms:output ref="$resources/snomed-ct-context"/>
                     </xhtml:div>
                     <!-- selection buttons -->
                     <xforms:group ref=".[instance('snomed-select-mode')='true']">
                        <xhtml:div class="buttons">
                           <!-- cancel select -->
                           <fr:button>
                              <xforms:label ref="$resources/cancel"/>
                              <xforms:action ev:event="DOMActivate">
                                 <xforms:action xxforms:iterate="instance('snomed-context-concept')//concept[@selected]">
                                    <xforms:setvalue ref="context()/@memberStatusCode" value="''"/>
                                    <xforms:delete nodeset="context()/@selected"/>
                                 </xforms:action>
                                 <xforms:setvalue ref="instance('snomed-select-mode')" value="'false'"/>
                              </xforms:action>
                           </fr:button>
                           <!-- select -->
                           <xforms:group ref=".[$current-member-concept/@memberStatusCode='']">
                              <fr:button>
                                 <xforms:label>
                                    <xhtml:img src="/img/node-sdraft.png" alt=""/>
                                 </xforms:label>
                                 <xforms:action ev:event="DOMActivate">
                                    <xforms:insert nodeset="$current-member-concept/@*" origin="xxforms:attribute('selected','')"/>
                                    <xforms:setvalue ref="$current-member-concept/@memberStatusCode" value="'draft'"/>
                                 </xforms:action>
                              </fr:button>
                           </xforms:group>
                           <!-- deselect -->
                           <xforms:group ref=".[$current-member-concept/@selected]">
                              <fr:button>
                                 <xforms:label>
                                    <xhtml:img src="/img/node-s.png" alt=""/>
                                 </xforms:label>
                                 <xforms:action ev:event="DOMActivate">
                                    <xforms:delete nodeset="$current-member-concept/@selected"/>
                                    <xforms:setvalue ref="$current-member-concept/@memberStatusCode" value="''"/>
                                 </xforms:action>
                              </fr:button>
                           </xforms:group>
                           <!-- concepts with subconcepts -->
                           <xforms:group ref=".[$current-member-concept/concept]">
                              <!-- select direct children -->
                              <xforms:group ref=".[$current-member-concept/concept]">
                                 <fr:button>
                                    <xforms:label>
                                       <xhtml:img src="/img/node-s.png" alt=""/>/<xhtml:img src="/img/node-sdraft.png" alt=""/>
                                    </xforms:label>
                                    <xforms:action ev:event="DOMActivate">
                                       <xforms:action xxforms:iterate="$current-member-concept/concept[@memberStatusCode='']">
                                          <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('selected','')"/>
                                          <xforms:setvalue ref="context()/@memberStatusCode" value="'draft'"/>
                                       </xforms:action>
                                    </xforms:action>
                                 </fr:button>
                              </xforms:group>
                              <!-- select all children -->
                              <xforms:group ref=".[$current-member-concept/concept/concept]">
                                 <fr:button>
                                    <xforms:label>
                                       <xhtml:img src="/img/node-s.png" alt=""/>//<xhtml:img src="/img/node-sdraft.png" alt=""/>
                                    </xforms:label>
                                    <xforms:action ev:event="DOMActivate">
                                       <xforms:action xxforms:iterate="$current-member-concept//concept[@memberStatusCode='']">
                                          <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('selected','')"/>
                                          <xforms:setvalue ref="context()/@memberStatusCode" value="'draft'"/>
                                       </xforms:action>
                                    </xforms:action>
                                 </fr:button>
                              </xforms:group>
                              <!-- select with direct children -->
                              <xforms:group ref=".[$current-member-concept/concept][$current-member-concept/@memberStatusCode='']">
                                 <fr:button>
                                    <xforms:label>
                                       <xhtml:img src="/img/node-sdraft.png" alt=""/>/<xhtml:img src="/img/node-sdraft.png" alt=""/>
                                    </xforms:label>
                                    <xforms:action ev:event="DOMActivate">
                                       <xforms:action if="$current-member-concept/@memberStatusCode=''">
                                          <xforms:insert nodeset="$current-member-concept/@*" origin="xxforms:attribute('selected','')"/>
                                          <xforms:setvalue ref="$current-member-concept/@memberStatusCode" value="'draft'"/>
                                       </xforms:action>
                                       <xforms:action xxforms:iterate="$current-member-concept/concept[@memberStatusCode='']">
                                          <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('selected','')"/>
                                          <xforms:setvalue ref="context()/@memberStatusCode" value="'draft'"/>
                                       </xforms:action>
                                    </xforms:action>
                                 </fr:button>
                              </xforms:group>
                              <!-- select with all children -->
                              <xforms:group ref=".[$current-member-concept/concept/concept][$current-member-concept/@memberStatusCode='']">
                                 <fr:button>
                                    <xforms:label>
                                       <xhtml:img src="/img/node-sdraft.png" alt=""/>//<xhtml:img src="/img/node-sdraft.png" alt=""/>
                                    </xforms:label>
                                    <xforms:action ev:event="DOMActivate">
                                       <xforms:action if="$current-member-concept/@memberStatusCode=''">
                                          <xforms:insert nodeset="$current-member-concept/@*" origin="xxforms:attribute('selected','')"/>
                                          <xforms:setvalue ref="$current-member-concept/@memberStatusCode" value="'draft'"/>
                                       </xforms:action>
                                       <xforms:action xxforms:iterate="$current-member-concept//concept[@memberStatusCode='']">
                                          <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('selected','')"/>
                                          <xforms:setvalue ref="context()/@memberStatusCode" value="'draft'"/>
                                       </xforms:action>
                                    </xforms:action>
                                 </fr:button>
                              </xforms:group>
                              <!-- deselect including children -->
                              <xforms:group ref=".[$current-member-concept/@selected]">
                                 <fr:button>
                                    <xforms:label>
                                       <xhtml:img src="/img/node-s.png" alt=""/>//<xhtml:img src="/img/node-s.png" alt=""/>
                                    </xforms:label>
                                    <xforms:action ev:event="DOMActivate">
                                       <xforms:delete nodeset="$current-member-concept/@selected"/>
                                       <xforms:setvalue ref="$current-member-concept/@memberStatusCode" value="''"/>
                                       <xforms:action xxforms:iterate="$current-member-concept//concept">
                                          <xforms:delete nodeset="context()/@selected"/>
                                          <xforms:setvalue ref="context()/@memberStatusCode" value="''"/>
                                       </xforms:action>
                                    </xforms:action>
                                 </fr:button>
                              </xforms:group>
                           </xforms:group>
                           <!-- deselect ALL -->
                           <xforms:group ref=".[instance('snomed-context-concept')//concept/@selected]">
                              <fr:button>
                                 <xforms:label>
                                       //<xhtml:img src="/img/node-s.png" alt=""/>
                                 </xforms:label>
                                 <xforms:action ev:event="DOMActivate" xxforms:iterate="instance('snomed-context-concept')//concept[@selected]">
                                    <xforms:delete nodeset="context()/@selected"/>
                                    <xforms:setvalue ref="context()/@memberStatusCode" value="''"/>
                                 </xforms:action>
                              </fr:button>
                           </xforms:group>
                           <!-- add selected concepts to refset -->
                           <xforms:group ref=".[instance('snomed-context-concept')//concept/@selected]">
                              <fr:button>
                                 <xforms:label ref="$resources/add-selected-concepts"/>
                                 <xforms:action ev:event="DOMActivate">
                                    <!-- iterate selected concepts -->
                                    <xforms:action xxforms:iterate="instance('snomed-context-concept')//concept[@selected]">
                                       <xxforms:variable name="concept" select="context()"/>
                                       <xforms:action xxforms:iterate="instance('snomed-description-itemset')//description[@conceptId=$concept/@conceptId]">
                                          <xforms:setvalue ref="context()/@memberStatusCode" value="$concept/@memberStatusCode"/>
                                       </xforms:action>
                                    </xforms:action>
                                    <xforms:send submission="add-selected-concepts"/>
                                    <xforms:send submission="get-snomed-context-concept"/>
                                    <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                 </xforms:action>
                              </fr:button>
                           </xforms:group>
                        </xhtml:div>
                     </xforms:group>
                  </xhtml:td>
               </xhtml:tr>
               <!-- table row with master-detail columns -->
               <xhtml:tr>
                  <!-- left column with tree concept-navigation -->
                  <xhtml:td width="40%">
                     <!-- table for tree concept-navigation components -->
                     <xhtml:table width="100%">
                        <xhtml:tr>
                           <xhtml:td class="heading">
                              <xhtml:div class="heading">
                                 <xforms:output ref="$resources/hierarchy"/>
                              </xhtml:div>
                              <xhtml:div class="buttons">
                                 <fr:button ref=".[$editor][instance('snomed-select-mode')='false'][instance('snomed-link-mode')='false'][instance('snomed-context-concept')/concept/concept]">
                                    <xforms:label ref="$resources/select-subconcepts"/>
                                    <xforms:action ev:event="DOMActivate">
                                       <xforms:setvalue ref="instance('snomed-select-mode')" value="'true'"/>
                                    </xforms:action>
                                 </fr:button>
                              </xhtml:div>
                           </xhtml:td>
                        </xhtml:tr>
                        <!-- Snomed tree navigation -->
                        <xhtml:tr>
                           <xhtml:td>
                              <xhtml:div class="navigate-container">
                                 <xhtml:div class="navigate">
                                    <xforms:select1 ref="instance('snomed-context-hierarchy-navigation')" appearance="xxforms:tree">
                                       <xforms:itemset nodeset="instance('snomed-context-concept')//*[name()='concept' or (name()='dest' and @type='Is a')]"
                                          xxforms:open="{if (parent::concepts) then 'true' else ('false')}" class="node-s{@memberStatusCode}">
                                          <xforms:label ref="if (@conceptId) then desc[@type='pref'] else concat(.,' (',@subCount,')') "/>
                                          <xforms:value ref="@navId"/>
                                       </xforms:itemset>
                                       <xforms:action ev:event="xforms-value-changed">
                                          <xforms:action if="$current-member-concept/dest">
                                             <xforms:send submission="get-snomed-context-subconcepts"/>
                                             <xforms:action xxforms:iterate="instance('snomed-context-subconcepts')//concept">
                                                <xforms:insert nodeset="context()/@*" origin="$current-member-concept/dest[@sourceId=context()/@conceptId]/@navId"/>
                                             </xforms:action>
                                             <xforms:action xxforms:iterate="instance('snomed-context-subconcepts')//dest">
                                                <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('navId',random())"/>
                                             </xforms:action>
                                             <xforms:delete ref="$current-member-concept/dest"/>
                                             <xforms:insert nodeset="$current-member-concept/*" origin="instance('snomed-context-subconcepts')//concept"/>
                                          </xforms:action>
                                          <xforms:send submission="get-snomed-focus-concept"/>
                                       </xforms:action>
                                    </xforms:select1>
                                 </xhtml:div>
                              </xhtml:div>
                           </xhtml:td>
                        </xhtml:tr>
                     </xhtml:table>
                  </xhtml:td>
                  <!-- concept details -->
                  <xhtml:td width="60%">
                     <xforms:group ref="instance('snomed-focus-concept')/concept">
                        <xhtml:table width="100%">
                           <!-- row with buttons -->
                           <xhtml:tr>
                              <xhtml:td class="heading" colspan="2">
                                 <xhtml:div class="{if (not(@active)) then 'heading-alert' else 'heading'}">
                                    <xforms:output ref="@conceptId"/> - <xforms:output ref="desc[@type='pref'][@active]"/>
                                 </xhtml:div>
                                 <!-- div with buttons -->
                                 <xhtml:div class="buttons">
                                    <!-- button for adding concept to refset -->
                                    <fr:button ref=".[@active][@conceptId][instance('snomed-select-mode')='false'][instance('snomed-link-mode')='false'][$editor][@memberStatusCode=('','retired')]">
                                       <xforms:label>
                                          <xhtml:img src="/img/plus.png" alt=""/>
                                       </xforms:label>
                                       <xforms:hint>
                                          <xforms:output ref="$resources/add"/>
                                       </xforms:hint>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:send submission="add-concept-to-thesaurus"/>
                                          <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('dhd-concept')/@thesaurusId"/>
                                          <xforms:send submission="get-dhd-concept"/>
                                          <xforms:setvalue ref="@memberStatusCode" value="instance('dhd-concept')/@statusCode"/>
                                          <xforms:action
                                             xxforms:iterate="instance('snomed-context-concept')//concept[@conceptId=instance('dhd-concept')/snomed/@conceptId]|instance('snomed-context-concept')//dest[@sourceId=instance('dhd-concept')/snomed/@conceptId]">
                                             <xforms:setvalue ref="context()/@memberStatusCode" value="instance('dhd-concept')/@statusCode"/>
                                          </xforms:action>
                                          <xforms:action xxforms:iterate="instance('snomed-description-itemset')//description[@conceptId=instance('dhd-concept')/snomed/@conceptId]">
                                             <xforms:setvalue ref="context()/@memberStatusCode" value="instance('dhd-concept')/@statusCode"/>
                                          </xforms:action>
                                          <xforms:setfocus control="descriptionRepeat"/>
                                       </xforms:action>
                                    </fr:button>
                                    <!-- button for linking snomed concept to thesaurus concept -->
                                    <fr:button
                                       ref=".[instance('snomed-select-mode')='false'][instance('snomed-link-mode')='true'][@memberStatusCode=('','draft')][string-length(@conceptId)&gt;0][@active][$editor]">
                                       <xforms:label>
                                          <xhtml:img src="/img/link16.png" alt=""/>
                                       </xforms:label>
                                       <xforms:hint>
                                          <xforms:output ref="$resources/link"/>
                                       </xforms:hint>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:send submission="update-snomed-link"/>
                                          <xforms:send submission="get-dhd-concept"/>
                                          <xforms:setvalue ref="@memberStatusCode" value="instance('dhd-concept')/@statusCode"/>
                                          <xforms:action
                                             xxforms:iterate="instance('snomed-context-concept')//concept[@conceptId=instance('dhd-concept')/snomed/@conceptId]|instance('snomed-context-concept')//dest[@sourceId=instance('dhd-concept')/snomed/@conceptId]">
                                             <xforms:setvalue ref="context()/@memberStatusCode" value="instance('dhd-concept')/@statusCode"/>
                                          </xforms:action>
                                          <xforms:action xxforms:iterate="instance('snomed-description-itemset')//description[@conceptId=instance('dhd-concept')/snomed/@conceptId]">
                                             <xforms:setvalue ref="context()/@memberStatusCode" value="instance('dhd-concept')/@statusCode"/>
                                          </xforms:action>
                                       </xforms:action>
                                    </fr:button>
                                 </xhtml:div>
                              </xhtml:td>
                           </xhtml:tr>
                           <xhtml:tr>
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/full-name"/>
                              </xhtml:td>
                              <xhtml:td>
                                 <xforms:output ref="desc[@type='fsn'][@active]"/>
                              </xhtml:td>
                           </xhtml:tr>
                           <!-- concept synonyms -->
                           <xhtml:tr>
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/synonyms"/>
                              </xhtml:td>
                              <xhtml:td>
                                 <xhtml:table width="100%">
                                    <xforms:repeat nodeset="desc[@type='syn'][@active]">
                                       <xhtml:tr class="not-selectable">
                                          <xhtml:td>
                                             <xforms:output ref="."/>
                                          </xhtml:td>
                                       </xhtml:tr>
                                    </xforms:repeat>
                                 </xhtml:table>
                              </xhtml:td>
                           </xhtml:tr>
                        </xhtml:table>
                        <xhtml:div class="h2">
                           <xforms:output ref="$resources/definition"/> (<xforms:output ref="@definitionStatus"/>) </xhtml:div>
                        <!-- concept definitions -->
                        <xhtml:table width="100%" style="border:solid 1px #CCC;margin-bottom:0.4em;margin-top:0.2em">
                           <xforms:repeat nodeset="grp[@grp='0']" id="member-group">
                              <xhtml:tr class="not-selectable">
                                 <xhtml:td width="90%">
                                    <xhtml:table width="100%">
                                       <xforms:repeat nodeset="src[@typeId='116680003'][@active]" id="member-sourcesIsA">
                                          <xhtml:tr class="not-selectable">
                                             <xhtml:td width="30%" class="floating-label">
                                                <xforms:output ref="@type"/>
                                             </xhtml:td>
                                             <xhtml:td width="70%">
                                                <xforms:trigger appearance="minimal">
                                                   <xforms:label ref="."/>
                                                   <xforms:action ev:event="DOMActivate">
                                                      <xforms:setvalue ref="instance('snomed-context-navigation')" value="xxforms:repeat-current('member-sourcesIsA')/@destinationId"/>
                                                      <xforms:send submission="get-snomed-context-concept"/>
                                                      <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                                   </xforms:action>
                                                </xforms:trigger>
                                             </xhtml:td>
                                          </xhtml:tr>
                                       </xforms:repeat>
                                       <xforms:repeat nodeset="src[@typeId!='116680003'][@active]" id="member-sources">
                                          <xhtml:tr class="not-selectable">
                                             <xhtml:td width="30%" class="floating-label">
                                                <xforms:output ref="@type"/>
                                             </xhtml:td>
                                             <xhtml:td width="70%">
                                                <xforms:trigger appearance="minimal">
                                                   <xforms:label ref="."/>
                                                   <xforms:action ev:event="DOMActivate">
                                                      <xforms:setvalue ref="instance('snomed-context-navigation')" value="xxforms:repeat-current('member-sources')/@destinationId"/>
                                                      <xforms:send submission="get-snomed-context-concept"/>
                                                      <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                                   </xforms:action>
                                                </xforms:trigger>
                                             </xhtml:td>
                                          </xhtml:tr>
                                       </xforms:repeat>
                                    </xhtml:table>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:repeat>
                        </xhtml:table>
                        <xforms:repeat nodeset="grp[@grp!='0']" id="member-groups">
                           <xhtml:table width="100%" class="not-selectable" style="border:solid 1px #CCC;margin-bottom:0.4em">
                              <xforms:repeat nodeset="src[@active]" id="member-grpSources">
                                 <xhtml:tr class="not-selectable">
                                    <xhtml:td width="30%" class="floating-label">
                                       <xforms:output ref="@type"/>
                                    </xhtml:td>
                                    <xhtml:td width="70%">
                                       <xforms:trigger appearance="minimal">
                                          <xforms:label ref="."/>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:setvalue ref="instance('snomed-context-navigation')" value="xxforms:repeat-current('member-grpSources')/@destinationId"/>
                                             <xforms:send submission="get-snomed-context-concept"/>
                                             <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                          </xforms:action>
                                       </xforms:trigger>
                                    </xhtml:td>
                                 </xhtml:tr>
                              </xforms:repeat>
                           </xhtml:table>
                        </xforms:repeat>
                        <!-- REFSETS -->
                        <xforms:group ref="refsets[refset]">
                           <xhtml:table width="100%" style="border:solid 1px #CCC;margin-bottom:0.4em;">
                              <xhtml:tr class="not-selectable">
                                 <xhtml:td class="item-label">
                                    <xforms:output ref="$resources/reference-set"/>
                                 </xhtml:td>
                                 <xhtml:td width="90%">
                                    <xhtml:table width="100%">
                                       <xforms:repeat nodeset="refset">
                                          <xhtml:tr class="not-selectable">
                                             <xhtml:td>
                                                <xforms:output ref="@refset"/>
                                             </xhtml:td>
                                          </xhtml:tr>
                                       </xforms:repeat>
                                    </xhtml:table>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xhtml:table>
                        </xforms:group>
                        <!-- Simple Mappings -->
                        <xforms:group ref="simpleMaps[map]">
                           <xhtml:table width="100%" style="border:solid 1px #CCC;margin-bottom:0.4em">
                              <xforms:repeat nodeset="map[@active='1']">
                                 <xhtml:tr class="not-selectable">
                                    <xhtml:td width="30%" class="floating-label">
                                       <xforms:output ref="@refset"/>
                                    </xhtml:td>
                                    <xhtml:td width="70%">
                                       <xforms:output ref="@mapTarget"/>
                                    </xhtml:td>
                                 </xhtml:tr>
                              </xforms:repeat>
                           </xhtml:table>
                        </xforms:group>
                        <!-- Complex Mappings -->
                        <xforms:group ref="complexMaps[map]">
                           <xhtml:table width="100%" style="border:solid 1px #CCC;margin-bottom:0.4em">
                              <xforms:repeat nodeset="map">
                                 <xhtml:tr class="not-selectable">
                                    <xhtml:td width="30%" class="floating-label">
                                       <xforms:output ref="@refset"/>
                                    </xhtml:td>
                                    <xhtml:td width="70%">
                                       <xforms:repeat nodeset="group">
                                          <xhtml:table width="100%" style="border:solid 1px #CCC;margin-bottom:0.4em">
                                             <xhtml:tr class="not-selectable">
                                                <xhtml:td>
                                                   <xhtml:table width="100%">
                                                      <xforms:repeat nodeset="map[@active='1']">
                                                         <xhtml:tr class="not-selectable">
                                                            <xhtml:td>
                                                               <xforms:output ref="@mapTarget"/>
                                                            </xhtml:td>
                                                            <xhtml:td>
                                                               <xforms:output ref="@mapRule">
                                                                  <xforms:hint>
                                                                     <xforms:output ref="../@mapAdvice"/>
                                                                     <xhtml:br/>
                                                                     <xforms:output ref="../@correlation"/>
                                                                  </xforms:hint>
                                                               </xforms:output>
                                                            </xhtml:td>
                                                         </xhtml:tr>
                                                      </xforms:repeat>
                                                   </xhtml:table>
                                                </xhtml:td>
                                             </xhtml:tr>
                                          </xhtml:table>
                                       </xforms:repeat>
                                    </xhtml:td>
                                 </xhtml:tr>
                              </xforms:repeat>
                           </xhtml:table>
                        </xforms:group>
                     </xforms:group>
                  </xhtml:td>
               </xhtml:tr>
            </xhtml:table>
         </fr:tab>
         <!-- RELEASES TAB -->
         <fr:tab>
            <fr:label ref="$resources/releases"/>
            <!-- releases table -->
            <xhtml:table width="100%" class="detail" style="border:2px solid #CCC;margin-top:1em;">
               <!-- heading with buttons -->
               <xhtml:tr>
                  <xhtml:td class="heading" colspan="4">
                     <xhtml:div class="heading">
                        <xforms:output ref="$resources/releases"/>
                     </xhtml:div>
                     <!-- div with buttons -->
                     <xhtml:div class="buttons">
                        <fr:button ref=".[$admin]">
                           <xforms:label>
                              <xhtml:img src="/img/plus.png" alt=""/>
                           </xforms:label>
                           <xforms:hint>
                              <xforms:output ref="$resources/create-release"/>
                           </xforms:hint>
                           <xforms:action ev:event="DOMActivate">
                              <xforms:send submission="check-thesaurus"/>
                              <xforms:setvalue ref="instance('new-release')/@effectiveTime" value="current-dateTime()"/>
                              <xxforms:show dialog="release-dialog"/>
                           </xforms:action>
                        </fr:button>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
               <!-- releases heading -->
               <xhtml:tr>
                  <xhtml:td width="25%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                     <xforms:output ref="$resources/label"/>
                  </xhtml:td>
                  <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                     <xforms:output ref="$resources/date"/>
                  </xhtml:td>
                  <xhtml:td class="heading-small" width="15%">
                     <xforms:output ref="$resources/status"/>
                  </xhtml:td>
                  <xhtml:td width="50%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                     <xforms:output ref="$resources/comment"/>
                  </xhtml:td>
               </xhtml:tr>
               <!-- releases -->
               <xforms:repeat nodeset="instance('project')/release" id="releases">
                  <xhtml:tr>
                     <xhtml:td>
                        <xforms:output ref="@label"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="@effectiveTime"
                           xxforms:format="if (instance('language')='en-US') then format-dateTime(xs:dateTime(.),'[M01]/[D01]/[Y]') else format-dateTime(xs:dateTime(.),'[D01]-[M01]-[Y]')"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xxforms:variable name="releaseStatusCode" select="@statusCode"/>
                        <xforms:output ref="instance('release-status-codes')/enumeration[@value=$releaseStatusCode]/label[@language=instance('language')]" class="node-s{$releaseStatusCode}"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output mediatype="text/html" ref="comment"/>
                     </xhtml:td>
                  </xhtml:tr>
                  <xforms:action ev:event="xxforms-index-changed">
                     <xforms:send submission="get-release-notes"/>
                  </xforms:action>
                  <xforms:action ev:event="xxforms-nodeset-changed">
                     <xforms:send submission="get-release-notes"/>
                  </xforms:action>
               </xforms:repeat>
            </xhtml:table>
            <xhtml:table width="100%" class="detail" style="border:2px solid #CCC;margin-top:1em;">
               <!-- group for release details -->
               <xforms:group ref="instance('project')/release[index('releases')]">
                  <!-- heading -->
                  <xhtml:tr>
                     <xhtml:td colspan="4" class="heading">
                        <xhtml:div class="heading">
                           <xforms:output ref="$resources/release"/>: <xforms:output ref="@label"/>
                           <xforms:output ref="$resources/as-of"/>
                           <xforms:output ref="@effectiveTime"
                              xxforms:format="if (instance('language')='en-US') then format-dateTime(xs:dateTime(.),'[M01]/[D01]/[Y]') else format-dateTime(xs:dateTime(.),'[D01]-[M01]-[Y]')"/>
                        </xhtml:div>
                        <xhtml:div class="buttons">
                           <!-- button for authorizing setting status to 'final' -->
                           <fr:button ref=".[@statusCode='draft'][$admin]">
                              <xforms:label>
                                 <xhtml:img src="/img/tick.png" alt=""/>
                              </xforms:label>
                              <xforms:hint>
                                 <xforms:output ref="$resources/authorize-and-release"/>
                              </xforms:hint>
                              <xforms:action ev:event="DOMActivate">
                                 <xforms:setvalue ref="instance('status-change')/@object" value="'release'"/>
                                 <xforms:setvalue ref="instance('status-change')/@ref" value="instance('project')/release[index('releases')]/@effectiveTime"/>
                                 <xforms:setvalue ref="instance('status-change')/@statusCode" value="'final'"/>
                                 <xforms:send submission="set-status"/>
                                 <xforms:send submission="get-thesaurus-project"/>
                                 <xforms:setvalue ref="instance('data-safe')" value="'true'"/>
                              </xforms:action>
                           </fr:button>
                           <fr:button ref=".[@statusCode='draft'][$admin]">
                              <xforms:label>
                                 <xhtml:img src="/img/remove.gif" alt=""/>
                              </xforms:label>
                              <xforms:hint ref="$resources/delete-release"/>
                              <xforms:action ev:event="DOMActivate">
                                 <xforms:send submission="delete-release"/>
                                 <xforms:send submission="get-thesaurus-project"/>
                              </xforms:action>
                           </fr:button>
                           <fr:button>
                              <xforms:label>
                                 <xhtml:img src="/img/download.png" alt=""/>1.2
                              </xforms:label>
                              <xforms:hint ref="$resources/download-1.2-format-zip"/>
                              <xforms:action ev:event="DOMActivate">
                                 <xforms:load resource="{$terminology-external-exist}/dhd/getRelease/{format-dateTime(@effectiveTime,'[Y][M01][D01]_[H01][m01][s01]_versie1.2')}" show="new"/>
                              </xforms:action>
                           </fr:button>
                           <fr:button>
                              <xforms:label>
                                 <xhtml:img src="/img/download.png" alt=""/>2.1
                              </xforms:label>
                              <xforms:hint ref="$resources/download-2.1-format-zip"/>
                              <xforms:action ev:event="DOMActivate">
                                 <xforms:load resource="{$terminology-external-exist}/dhd/getRelease/{format-dateTime(@effectiveTime,'[Y][M01][D01]_[H01][m01][s01]_versie2.1')}" show="new"/>
                              </xforms:action>
                           </fr:button>
                        </xhtml:div>
                     </xhtml:td>
                  </xhtml:tr>
                  <!-- status and filename -->
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/status"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xxforms:variable name="releaseStatusCode" select="@statusCode"/>
                        <xforms:output ref="instance('release-status-codes')/enumeration[@value=$releaseStatusCode]/label[@language=instance('language')]" class="node-s{$releaseStatusCode}"/>
                     </xhtml:td>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/name"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="@effectiveTime" xxforms:format="format-dateTime(xs:dateTime(.),'[Y][M01][D01]_[H01][m01][s01]_')"/>
                     </xhtml:td>
                  </xhtml:tr>
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/comment"/>
                     </xhtml:td>
                     <xhtml:td colspan="3">
                        <xforms:output mediatype="text/html" ref="comment"/>
                     </xhtml:td>
                  </xhtml:tr>
               </xforms:group>
               <!-- group for release notes -->
               <xforms:group ref="instance('release-notes')">

                  <!-- heading -->
                  <xhtml:tr>
                     <xhtml:td colspan="4" class="heading">
                        <xhtml:div class="heading">
                           <xforms:output ref="$resources/release-notes"/>
                        </xhtml:div>
                     </xhtml:td>
                  </xhtml:tr>
                  <xhtml:tr>
                     <xhtml:td class="item-label" rowspan="2">
                        <xforms:output ref="$resources/issues"/>
                     </xhtml:td>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/new"/>
                     </xhtml:td>
                     <xhtml:td colspan="2">
                        <xhtml:table width="100%">
                           <xforms:repeat nodeset="issues/new/issue" id="newIssues">
                              <xhtml:tr class="not-selectable">
                                 <xhtml:td>
                                    <xforms:trigger appearance="minimal">
                                       <xforms:label>
                                          <xforms:output ref="."/>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:setvalue ref="instance('selected-issue')/selected" value="instance('release-notes')/issues/new/issue[index('newIssues')]/@id"/>
                                          <xforms:send submission="get-issue-dhd-concept"/>
                                          <xforms:dispatch targetid="issues-tab" name="fr-toggle"/>
                                       </xforms:action>
                                    </xforms:trigger>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:repeat>
                        </xhtml:table>
                     </xhtml:td>
                  </xhtml:tr>
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/resolved"/>
                     </xhtml:td>
                     <xhtml:td colspan="2">
                        <xhtml:table width="100%">
                           <xforms:repeat nodeset="issues/resolved/issue" id="resolcedIssues">
                              <xhtml:tr class="not-selectable">
                                 <xhtml:td>
                                    <xforms:trigger appearance="minimal">
                                       <xforms:label>
                                          <xforms:output ref="."/>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:setvalue ref="instance('selected-issue')/selected" value="instance('release-notes')/issues/resolved/issue[index('resolvedIssues')]/@id"/>
                                          <xforms:send submission="get-issue-dhd-concept"/>
                                          <xforms:dispatch targetid="issues-tab" name="fr-toggle"/>
                                       </xforms:action>
                                    </xforms:trigger>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:repeat>
                        </xhtml:table>
                     </xhtml:td>
                  </xhtml:tr>
                  <xhtml:tr>
                     <xhtml:td class="item-label" rowspan="3">
                        <xforms:output ref="$resources/concepts"/>
                     </xhtml:td>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/new"/>
                     </xhtml:td>
                     <xhtml:td colspan="2">
                        <xhtml:table width="100%">
                           <xforms:repeat nodeset="concepts/new/concept" id="newConcepts">
                              <xhtml:tr class="not-selectable">
                                 <xhtml:td>
                                    <xforms:trigger appearance="minimal">
                                       <xforms:label>
                                          <xforms:output ref="."/>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('release-notes')/concepts/new/concept[index('newConcepts')]/@thesaurusId"/>
                                          <xforms:send submission="get-dhd-concept"/>
                                          <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('dhd-concept')/snomed/@conceptId"/>
                                          <xforms:send submission="get-snomed-context-concept"/>
                                          <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@id"/>
                                          <xforms:dispatch targetid="thesaurus-tab" name="fr-toggle"/>
                                       </xforms:action>
                                    </xforms:trigger>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:repeat>
                        </xhtml:table>
                     </xhtml:td>
                  </xhtml:tr>
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/updated"/>
                     </xhtml:td>
                     <xhtml:td colspan="2">
                        <xhtml:table width="100%">
                           <xforms:repeat nodeset="concepts/updated/concept" id="updatedConcepts">
                              <xhtml:tr class="not-selectable">
                                 <xhtml:td>
                                    <xforms:trigger appearance="minimal">
                                       <xforms:label>
                                          <xforms:output ref="."/>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('release-notes')/concepts/updated/concept[index('updatedConcepts')]/@thesaurusId"/>
                                          <xforms:send submission="get-dhd-concept"/>
                                          <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('dhd-concept')/snomed/@conceptId"/>
                                          <xforms:send submission="get-snomed-context-concept"/>
                                          <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                          <xforms:dispatch targetid="thesaurus-tab" name="fr-toggle"/>
                                       </xforms:action>
                                    </xforms:trigger>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:repeat>
                        </xhtml:table>
                     </xhtml:td>
                  </xhtml:tr>
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/retired"/>
                     </xhtml:td>
                     <xhtml:td colspan="2">
                        <xhtml:table width="100%">
                           <xforms:repeat nodeset="concepts/retired/concept" id="retiredConcepts">
                              <xhtml:tr class="not-selectable">
                                 <xhtml:td>
                                    <xforms:trigger appearance="minimal">
                                       <xforms:label>
                                          <xforms:output ref="."/>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('release-notes')/concepts/retired/concept[index('retiredConcepts')]/@thesaurusId"/>
                                          <xforms:send submission="get-dhd-concept"/>
                                          <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('dhd-concept')/snomed/@conceptId"/>
                                          <xforms:send submission="get-snomed-context-concept"/>
                                          <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                          <xforms:dispatch targetid="thesaurus-tab" name="fr-toggle"/>
                                       </xforms:action>
                                    </xforms:trigger>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:repeat>
                        </xhtml:table>
                     </xhtml:td>
                  </xhtml:tr>
               </xforms:group>
            </xhtml:table>
         </fr:tab>
         <!-- DBC REFERENCE TAB -->
         <fr:tab>
            <fr:label ref="$resources/dbc-reference"/>
            <!-- SEARCH INPUT and FILTERS -->
            <xhtml:table class="detail" width="100%" style="margin-top:0.8em;margin-bottom:0.8em;border:2px solid #CCC;">
               <xhtml:tr>
                  <!-- Clear search and refresh -->
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/searchterms"/>
                     <xforms:trigger appearance="minimal">
                        <xforms:label class="control-label">
                           <xhtml:img src="/img/arrow_refresh.png" alt="" align="right"/>
                        </xforms:label>
                        <xforms:action ev:event="DOMActivate">
                           <xforms:setvalue ref="instance('dbc-search')" value="''"/>
                           <xforms:delete nodeset="instance('dbc-itemset')/node()"/>
                        </xforms:action>
                     </xforms:trigger>
                  </xhtml:td>
                  <!-- Search field -->
                  <xhtml:td>
                     <xforms:input class="top" ref="instance('dbc-search')" id="searchDBC" incremental="true">
                        <xforms:action ev:event="xforms-value-changed">
                           <xxforms:variable name="search-value" select="."/>
                           <xxforms:variable name="make-suggestion" select="string-length($search-value) &gt;= 2"/>
                           <xforms:action if="$make-suggestion">
                              <xforms:send submission="search-dbc"/>
                              <xforms:action if="xxforms:index('descriptions')&gt;1">
                                 <xforms:setindex repeat="descriptions" index="1"/>
                              </xforms:action>
                           </xforms:action>
                        </xforms:action>
                     </xforms:input>
                  </xhtml:td>
                  <!-- dbc specialism filter -->
                  <xhtml:td class="item-label" style="width:5%;">
                     <xforms:output ref="$resources/specialism"/>
                  </xhtml:td>
                  <xhtml:td>
                     <xforms:select1 ref="instance('dbc-specialism-filter')" appearance="minimal" class="auto-width">
                        <xforms:itemset nodeset="instance('dbc-specialism-list')/specialism">
                           <xforms:label ref="concat(@agbCode,' ',desc)"/>
                           <xforms:value ref="@agbCode"/>
                        </xforms:itemset>
                        <xforms:action ev:event="xforms-value-changed">
                           <xforms:action if="string-length(instance('dbc-specialism-filter')) &gt;0">
                              <xforms:setvalue ref="instance('dbc-search')" value="''"/>
                           </xforms:action>
                           <xforms:send submission="search-dbc"/>
                        </xforms:action>
                     </xforms:select1>
                  </xhtml:td>
                  <!-- dbc status filter -->
                  <xhtml:td class="item-label" style="width:5%;">
                     <xforms:output ref="$resources/status"/>
                  </xhtml:td>
                  <xhtml:td>
                     <xforms:select1 ref="instance('dbc-status-filter')" appearance="minimal" class="auto-width">
                        <xforms:itemset nodeset="instance('reference-status-filters')/filter">
                           <xforms:label ref="name[@language=instance('language')]"/>
                           <xforms:value ref="@statusCodes"/>
                        </xforms:itemset>
                        <xforms:action ev:event="xforms-value-changed">
                           <xforms:send submission="search-dbc"/>
                        </xforms:action>
                     </xforms:select1>
                  </xhtml:td>
                  <xhtml:td>
                     <xhtml:div class="buttons">
                        <!-- button for getting unlinked DBC codes -->
                        <fr:button ref=".[instance('dbc-specialism-filter')!='']">
                           <xforms:label>
                              <xhtml:img src="/img/brokenLink16.png" alt=""/>
                           </xforms:label>
                           <xforms:hint>
                              <xforms:output ref="$resources/get-unlinked-dbc-codes"/>
                           </xforms:hint>
                           <xforms:action ev:event="DOMActivate">
                              <xforms:send submission="get-dbc-list"/>
                           </xforms:action>
                        </fr:button>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
            </xhtml:table>
            <!-- SEARCH RESULTS -->
            <xhtml:table width="100%" style="margin-top:0.8em;margin-bottom:0.8em;border:2px solid #CCC;">
               <xhtml:tr>
                  <xhtml:td>
                     <xhtml:table class="detail" width="99%">
                        <xhtml:tr>
                           <xhtml:td colspan="7">
                              <xhtml:div class="h2">
                                 <xforms:output ref="$resources/results"/>
                                 (
                                 <xforms:output ref="instance('dbc-itemset')/@current"/>
                                 <xforms:output ref="$resources/of"/>
                                 <xforms:output ref="instance('dbc-itemset')/@count"/>
                                 )
                              </xhtml:div>
                           </xhtml:td>
                        </xhtml:tr>
                        <xhtml:tr>
                           <xhtml:td width="5%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                              <xforms:output ref="$resources/agb"/>
                           </xhtml:td>
                           <xhtml:td width="5%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                              <xforms:output ref="$resources/dbc"/>
                           </xhtml:td>
                           <xhtml:td width="55%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                              <xforms:output ref="$resources/description"/>
                           </xhtml:td>
                           <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                              <xforms:output ref="$resources/date"/>
                           </xhtml:td>
                           <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                              <xforms:output ref="$resources/expiration-date"/>
                           </xhtml:td>
                           <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                              <xforms:output ref="$resources/status"/>
                           </xhtml:td>
                           <xhtml:td width="5%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                              <xforms:output ref="$resources/use"/>
                           </xhtml:td>
                        </xhtml:tr>
                     </xhtml:table>
                  </xhtml:td>
               </xhtml:tr>
               <xhtml:tr>
                  <xhtml:td>
                     <xhtml:div class="navigate-seven">
                        <xhtml:table class="detail" width="100%" style="margin-top:0.8em;margin-bottom:0.8em;">
                           <xforms:repeat nodeset="instance('dbc-itemset')/dbc" id="dbcItems">
                              <xhtml:tr>
                                 <xhtml:td width="5%">
                                    <xforms:output ref="@agbCode"/>
                                 </xhtml:td>
                                 <xhtml:td width="5%">
                                    <xforms:output ref="@code"/>
                                 </xhtml:td>
                                 <xhtml:td width="55%">
                                    <xforms:output ref="desc"/>
                                 </xhtml:td>
                                 <xhtml:td width="10%">
                                    <xforms:output ref="@effectiveDate"
                                       xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                    />
                                 </xhtml:td>
                                 <xhtml:td width="10%">
                                    <xforms:output ref="@expirationDate"
                                       xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                    />
                                 </xhtml:td>
                                 <xhtml:td width="10%">
                                    <xxforms:variable name="statusCode" select="@statusCode"/>
                                    <xforms:output ref="instance('status-codes')/enumeration[@value=$statusCode]/label[@language=instance('language')]" class="node-s{$statusCode}"/>
                                 </xhtml:td>
                                 <xhtml:td width="5%" style="text-align:right;padding-right:0.5em;">
                                    <xforms:output ref="@concepts"/>
                                 </xhtml:td>
                              </xhtml:tr>
                              <xforms:action ev:event="xxforms-index-changed">
                                 <xforms:send submission="get-dbc-concept-list"/>
                              </xforms:action>
                              <xforms:action ev:event="xxforms-nodeset-changed">
                                 <xforms:send submission="get-dbc-concept-list"/>
                              </xforms:action>
                           </xforms:repeat>
                        </xhtml:table>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
            </xhtml:table>
            <!-- Linked thesaurus concepts -->
            <xhtml:table class="detail" width="100%" style="margin-top:0.8em;margin-bottom:0.8em;border:2px solid #CCC;">
               <xhtml:tr>
                  <xhtml:td width="60%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                     <xforms:output ref="$resources/thesaurus-concept"/>
                  </xhtml:td>
                  <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                     <xforms:output ref="$resources/snomed-id"/>
                  </xhtml:td>
                  <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                     <xforms:output ref="$resources/date"/>
                  </xhtml:td>
                  <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                     <xforms:output ref="$resources/expiration-date"/>
                  </xhtml:td>
                  <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                     <xforms:output ref="$resources/status"/>
                     <!-- div with buttons -->
                     <xhtml:div class="buttons">
                        <xforms:group ref="instance('dbc-itemset')/dbc[index('dbcItems')]">
                           <!-- button for creating thesaurus concept for DBC -->
                           <fr:button ref=".[string-length(@code)&gt;0][string-length(@agbCode)&gt;0][@concepts='0'][$editor]">
                              <xforms:label>
                                 <xhtml:img src="/img/plus.png" alt=""/>
                              </xforms:label>
                              <xforms:hint>
                                 <xforms:output ref="$resources/create-concept-for-dbc"/>
                              </xforms:hint>
                              <xforms:action ev:event="DOMActivate">
                                 <xforms:send submission="add-concept-for-dbc"/>
                                 <xforms:setvalue ref="instance('dbc-itemset')/dbc[index('dbcItems')]/@concepts" value="'1'"/>
                                 <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('dhd-concept')/@thesaurusId"/>
                                 <xforms:send submission="get-dhd-concept"/>
                                 <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('dhd-concept')/snomed/@conceptId"/>
                                 <xforms:send submission="get-snomed-context-concept"/>
                                 <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                 <xforms:dispatch targetid="thesaurus-tab" name="fr-toggle"/>
                                 <xforms:setfocus control="descriptionRepeat"/>
                              </xforms:action>
                           </fr:button>
                        </xforms:group>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
               <xforms:repeat nodeset="instance('dbc-concept-list')/concept" id="dbcItemConcepts">
                  <xhtml:tr class="not-selectable">
                     <xhtml:td>
                        <xforms:trigger appearance="minimal">
                           <xforms:label>
                              <xforms:output ref="if (string-length(.)=0) then 'REFERENTIETERM ONTBREEKT' else ."/>
                           </xforms:label>
                           <xforms:action ev:event="DOMActivate">
                              <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('dbc-concept-list')/concept[index('dbcItemConcepts')]/@thesaurusId"/>
                              <xforms:send submission="get-dhd-concept"/>
                              <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('dhd-concept')/snomed/@conceptId"/>
                              <xforms:send submission="get-snomed-context-concept"/>
                              <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                              <xforms:dispatch targetid="thesaurus-tab" name="fr-toggle"/>
                           </xforms:action>
                        </xforms:trigger>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="@conceptId"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="@effectiveDate"
                           xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                        />
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="@expirationDate"
                           xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                        />
                     </xhtml:td>
                     <xhtml:td>
                        <xxforms:variable name="statusCode" select="@statusCode"/>
                        <xforms:output ref="instance('status-codes')/enumeration[@value=$statusCode]/label[@language=instance('language')]" class="node-s{$statusCode}"/>
                     </xhtml:td>
                  </xhtml:tr>
               </xforms:repeat>
            </xhtml:table>
         </fr:tab>
         <!-- ICD10 REFERENCE TAB -->
         <fr:tab>
            <fr:label ref="$resources/icd10-reference"/>
            <xhtml:table class="detail" width="100%" style="margin-top:0.8em;margin-bottom:0.8em;border:2px solid #CCC;">
               <xhtml:tr>
                  <!-- Clear search and refresh -->
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/searchterms"/>
                     <xforms:trigger appearance="minimal">
                        <xforms:label class="control-label">
                           <xhtml:img src="/img/arrow_refresh.png" alt="" align="right"/>
                        </xforms:label>
                        <xforms:action ev:event="DOMActivate">
                           <xforms:setvalue ref="instance('icd-search')" value="''"/>
                           <xforms:delete nodeset="instance('icd-itemset')/node()"/>
                        </xforms:action>
                     </xforms:trigger>
                  </xhtml:td>
                  <!-- Search field -->
                  <xhtml:td>
                     <xforms:input class="top" ref="instance('icd-search')" id="searchICD" incremental="true">
                        <xforms:action ev:event="xforms-value-changed">
                           <xxforms:variable name="search-value" select="."/>
                           <xxforms:variable name="make-suggestion" select="string-length($search-value) &gt;= 2"/>
                           <xforms:action if="$make-suggestion">
                              <xforms:send submission="search-icd"/>
                              <xforms:action if="xxforms:index('descriptions')&gt;1">
                                 <xforms:setindex repeat="descriptions" index="1"/>
                              </xforms:action>
                           </xforms:action>
                        </xforms:action>
                     </xforms:input>
                  </xhtml:td>
                  <!-- icd status filter -->
                  <xhtml:td class="item-label" style="width:5%;">
                     <xforms:output ref="$resources/status"/>
                  </xhtml:td>
                  <xhtml:td>
                     <xforms:select1 ref="instance('icd-status-filter')" appearance="minimal" class="auto-width">
                        <xforms:itemset nodeset="instance('reference-status-filters')/filter">
                           <xforms:label ref="name[@language=instance('language')]"/>
                           <xforms:value ref="@statusCodes"/>
                        </xforms:itemset>
                        <xforms:action ev:event="xforms-value-changed">
                           <xforms:send submission="search-icd"/>
                        </xforms:action>
                     </xforms:select1>
                  </xhtml:td>
               </xhtml:tr>
            </xhtml:table>
            <!-- SEARCH RESULTS -->
            <xhtml:table width="100%" style="margin-top:0.8em;margin-bottom:0.8em;border:2px solid #CCC;">
               <xhtml:tr>
                  <xhtml:td>
                     <xhtml:div>
                        <xhtml:table width="99%">
                           <xhtml:tr>
                              <xhtml:td colspan="8">
                                 <xhtml:div class="h2">
                                    <xforms:output ref="$resources/results"/>
                                    ( 
                                    <xforms:output
                                       ref="instance('icd-itemset')/@current"/>
                                    <xforms:output ref="$resources/of"/>
                                    <xforms:output ref="instance('icd-itemset')/@count"/>
                                    ) 
                                 </xhtml:div>
                              </xhtml:td>
                           </xhtml:tr>
                           <xhtml:tr>
                              <xhtml:td width="47%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                                 <xforms:output ref="$resources/description"/>
                              </xhtml:td>
                              <xhtml:td width="8%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                                 <xforms:output ref="$resources/code"/>
                              </xhtml:td>
                              <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                                 <xforms:output ref="$resources/code-undotted"/>
                              </xhtml:td>
                              <xhtml:td width="9%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                                 <xforms:output ref="$resources/date"/>
                              </xhtml:td>
                              <xhtml:td width="9%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                                 <xforms:output ref="$resources/expiration-date"/>
                              </xhtml:td>
                              <xhtml:td width="7%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                                 <xforms:output ref="$resources/status"/>
                              </xhtml:td>
                              <xhtml:td width="5%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                                 <xforms:output ref="$resources/thesaurus"/>
                              </xhtml:td>
                              <xhtml:td width="5%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                                 <xforms:output ref="$resources/snomed"/>
                              </xhtml:td>
                           </xhtml:tr>
                        </xhtml:table>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
               <xhtml:tr>
                  <xhtml:td>
                     <xhtml:div class="navigate-seven">
                        <xhtml:table class="{if (count(instance('icd-itemset')/icd) &gt; 7) then 'scroll' else 'no-scroll'}">
                           <xforms:repeat nodeset="instance('icd-itemset')/icd" id="icdItems">
                              <xhtml:tr>
                                 <xhtml:td width="47%">
                                    <xforms:output ref="desc"/>
                                 </xhtml:td>
                                 <xhtml:td width="8%">
                                    <xforms:trigger appearance="minimal">
                                       <xforms:label>
                                          <xforms:output ref="@code"/>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:setvalue ref="instance('icd-search')" value="substring(instance('icd-itemset')/icd[index('icdItems')]/@code,1,3)"/>
                                       </xforms:action>
                                    </xforms:trigger>
                                 </xhtml:td>
                                 <xhtml:td width="10%">
                                    <xforms:output ref="@codeStripped"/>
                                 </xhtml:td>
                                 <xhtml:td width="9%">
                                    <xforms:output ref="@effectiveDate"
                                       xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                    />
                                 </xhtml:td>
                                 <xhtml:td width="9%">
                                    <xforms:output ref="@expirationDate"
                                       xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                    />
                                 </xhtml:td>
                                 <xhtml:td width="7%">
                                    <xxforms:variable name="statusCode" select="@statusCode"/>
                                    <xforms:output ref="instance('status-codes')/enumeration[@value=$statusCode]/label[@language=instance('language')]" class="node-s{$statusCode}"/>
                                 </xhtml:td>
                                 <xhtml:td width="5%" style="text-align:right;padding-right:0.5em;">
                                    <xforms:output ref="@concepts[.!=0]"/>
                                 </xhtml:td>
                                 <xhtml:td width="5%" style="text-align:right;padding-right:0.5em;">
                                    <xforms:trigger ref="@snomedCount[.!=0]" appearance="minimal">
                                       <xforms:label>
                                          <xforms:output ref="."/>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:send submission="get-snomed-for-icd10-reference"/>
                                          <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
                                          <xforms:send submission="get-snomed-context-concept"/>
                                          <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                          <xforms:dispatch targetid="thesaurus-tab" name="fr-toggle"/>
                                       </xforms:action>
                                    </xforms:trigger>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:repeat>
                        </xhtml:table>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
            </xhtml:table>
            <!-- Linked thesaurus concepts -->
            <xhtml:table class="detail" width="100%" style="margin-top:0.8em;margin-bottom:0.8em;border:2px solid #CCC;">
               <xhtml:tr>
                  <xhtml:td width="55%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                     <xforms:output ref="$resources/thesaurus-concept"/>
                  </xhtml:td>
                  <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                     <xforms:output ref="$resources/snomed-id"/>
                  </xhtml:td>
                  <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                     <xforms:output ref="$resources/date"/>
                  </xhtml:td>
                  <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                     <xforms:output ref="$resources/expiration-date"/>
                  </xhtml:td>
                  <xhtml:td width="15%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                     <xforms:output ref="$resources/status"/>
                  </xhtml:td>
               </xhtml:tr>
               <xforms:repeat nodeset="instance('icd-itemset')/icd[index('icdItems')]/concept" id="icdItemConcepts">
                  <xhtml:tr class="not-selectable">
                     <xhtml:td>
                        <xforms:trigger appearance="minimal">
                           <xforms:label>
                              <xforms:output ref="if (string-length(.)=0) then 'REFERENTIETERM ONTBREEKT' else ."/>
                           </xforms:label>
                           <xforms:action ev:event="DOMActivate">
                              <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('icd-itemset')/icd[index('icdItems')]/concept[index('icdItemConcepts')]/@thesaurusId"/>
                              <xforms:send submission="get-dhd-concept"/>
                              <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('dhd-concept')/snomed/@conceptId"/>
                              <xforms:send submission="get-snomed-context-concept"/>
                              <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                              <xforms:dispatch targetid="thesaurus-tab" name="fr-toggle"/>
                           </xforms:action>
                        </xforms:trigger>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="@conceptId"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="@effectiveDate" xxforms:format="if (instance('language')='en-US') then format-date(.,'[M01]/[D01]/[Y]') else format-date(.,'[D01]-[M01]-[Y]')"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="@expirationDate" xxforms:format="if (instance('language')='en-US') then format-date(.,'[M01]/[D01]/[Y]') else format-date(.,'[D01]-[M01]-[Y]')"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xxforms:variable name="statusCode" select="@statusCode"/>
                        <xforms:output ref="instance('status-codes')/enumeration[@value=$statusCode]/label[@language=instance('language')]" class="node-s{$statusCode}"/>
                     </xhtml:td>
                  </xhtml:tr>
               </xforms:repeat>
            </xhtml:table>
         </fr:tab>
         <!-- SPECIALISM REFERENCE TAB -->
         <fr:tab>
            <fr:label ref="$resources/specialism-reference"/>
            <xforms:group ref="instance('specialism-reference')">
               <xhtml:table width="100%" class="detail">
                  <xhtml:tr>
                     <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                        <xforms:output ref="$resources/agb"/>
                     </xhtml:td>
                     <xhtml:td width="75%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                        <xforms:output ref="$resources/specialism"/>
                     </xhtml:td>
                     <xhtml:td width="15%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                        <xforms:output ref="$resources/short"/>
                     </xhtml:td>
                     <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                        <xforms:output ref="$resources/status"/>
                     </xhtml:td>
                  </xhtml:tr>
                  <xforms:repeat nodeset="specialism" id="specialismReference">
                     <xxforms:variable name="specialismStatus" select="@statusCode"/>
                     <xhtml:tr>
                        <xhtml:td>
                           <xforms:output ref="@agbCode"/>
                        </xhtml:td>
                        <xhtml:td>
                           <xforms:output ref="desc"/>
                        </xhtml:td>
                        <xhtml:td>
                           <xforms:output ref="descShort"/>
                        </xhtml:td>
                        <xhtml:td>
                           <xxforms:variable name="statusCode" select="@statusCode"/>
                           <xforms:output ref="instance('status-codes')/enumeration[@value=$statusCode]/label[@language=instance('language')]" class="node-s{$statusCode}"/>
                        </xhtml:td>
                     </xhtml:tr>
                  </xforms:repeat>
               </xhtml:table>
            </xforms:group>
         </fr:tab>
         <!-- GENERAL TAB -->
         <fr:tab>
            <fr:label ref="$resources/general"/>
            <xforms:group ref="instance('project')">
               <!-- Thesaurus metadata -->
               <xhtml:table width="100%" class="detail" style="border:2px solid #CCC;">
                  <!-- row with authors header and buttons -->
                  <xhtml:tr>
                     <xhtml:td class="heading" colspan="2">
                        <xhtml:div class="heading">
                           <xforms:output ref="$resources/general"/>
                        </xhtml:div>
                        <xhtml:div class="buttons">
                           <fr:button>
                              <xforms:label ref="$resources/process-snomed-ct-update"/>
                              <xforms:action ev:event="DOMActivate">
                                 <xforms:send submission="get-dhd-delta-info"/>
                              </xforms:action>
                           </fr:button>
                        </xhtml:div>
                     </xhtml:td>
                  </xhtml:tr>
                  <!--                <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/concepts"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="concepts/@count"/> (<xforms:output ref="concepts/@distinctThesaurusIds"/>)
                     </xhtml:td>
                  </xhtml:tr>-->
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/draft"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="instance('status-info')/@draft"/>
                     </xhtml:td>
                  </xhtml:tr>
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/update"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="instance('status-info')/@update"/>
                     </xhtml:td>
                  </xhtml:tr>
               </xhtml:table>
               <xforms:group ref=".[instance('dhd-delta-info')/concept]">
                  <xhtml:table width="100%" class="detail" style="border:2px solid #CCC;">
                     <xhtml:tr>
                        <xhtml:td class="heading" colspan="5">
                           <xhtml:div class="heading">
                              <xforms:output ref="$resources/retired"/>
                           </xhtml:div>
                        </xhtml:td>
                     </xhtml:tr>
                     <xhtml:tr>
                        <xhtml:td class="heading-small" colspan="2">
                           <xforms:output ref="$resources/thesaurus-concept"/>
                        </xhtml:td>
                        <xhtml:td class="heading-small" colspan="2">
                           <xforms:output ref="$resources/snomed-ct"/>
                        </xhtml:td>
                        <xhtml:td class="heading-small"/>
                     </xhtml:tr>
                     <xforms:repeat nodeset="instance('dhd-delta-info')/concept" id="delta-info">
                        <xhtml:tr class="mapping">
                           <xhtml:td width="5%">
                              <xforms:output ref="@thesaurusId"/>
                           </xhtml:td>
                           <xhtml:td width="20%">
                              <xforms:trigger appearance="minimal">
                                 <xforms:label>
                                    <xforms:output ref="@referenceTerm"/>
                                 </xforms:label>
                                 <xforms:action ev:event="DOMActivate">
                                    <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('dhd-delta-info')/concept[index('delta-info')]/@thesaurusId"/>
                                    <xforms:send submission="get-dhd-concept"/>
                                    <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('dhd-concept')/snomed/@conceptId"/>
                                    <xforms:send submission="get-snomed-context-concept"/>
                                    <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@id"/>
                                    <xforms:dispatch targetid="thesaurus-tab" name="fr-toggle"/>
                                 </xforms:action>
                              </xforms:trigger>
                           </xhtml:td>
                           <xhtml:td width="5%">
                              <xforms:output ref="@conceptId"/>
                           </xhtml:td>
                           <xhtml:td width="25%">
                              <xforms:output ref="@fsn"/>
                           </xhtml:td>
                           <xhtml:td width="45%">
                              <xhtml:table width="100%">
                                 <xforms:repeat nodeset="associationReference" id="associationReferences">
                                    <xhtml:tr class="not-selectable">
                                       <xhtml:td width="30%">
                                          <xforms:output ref="substring-before(@refset,' association reference set')"/>
                                       </xhtml:td>
                                       <xhtml:td width="10%">
                                          <xforms:output ref="@targetComponentId"/>
                                       </xhtml:td>
                                       <xhtml:td width="60%">
                                          <xforms:output ref="@targetComponent"/>
                                       </xhtml:td>
                                    </xhtml:tr>
                                 </xforms:repeat>
                              </xhtml:table>
                           </xhtml:td>
                        </xhtml:tr>
                     </xforms:repeat>
                  </xhtml:table>
               </xforms:group>
               <!-- Authors -->
               <xhtml:table width="100%" class="detail" style="border:2px solid #CCC;margin-top:1em;">
                  <!-- row with authors header and buttons -->
                  <xhtml:tr>
                     <xhtml:td class="heading" colspan="7">
                        <xhtml:div class="heading">
                           <xforms:output ref="$resources/users"/>
                        </xhtml:div>
                        <!-- div with buttons -->
                        <xforms:group ref=".[$admin]">
                           <xhtml:div class="buttons">
                              <fr:button id="add-author">
                                 <xforms:label>
                                    <xhtml:img src="/img/plus.png" alt=""/>
                                 </xforms:label>
                                 <xforms:hint>
                                    <xforms:output ref="$resources/add-author"/>
                                 </xforms:hint>
                                 <xforms:action ev:event="DOMActivate">
                                    <xxforms:show dialog="select-user-dialog"/>
                                 </xforms:action>
                              </fr:button>
                              <fr:button id="delete-author">
                                 <xforms:label>
                                    <xhtml:img src="/img/remove.gif" alt=""/>
                                 </xforms:label>
                                 <xforms:hint>
                                    <xforms:output ref="$resources/delete-author"/>
                                 </xforms:hint>
                                 <xforms:action ev:event="DOMActivate">
                                    <xforms:delete context="instance('project')" nodeset="author" at="index('authorList')"/>
                                 </xforms:action>
                              </fr:button>
                              <xforms:group ref=".[instance('data-safe')='false']">
                                 <fr:button>
                                    <xforms:label ref="$resources/cancel"/>
                                    <xforms:action ev:event="DOMActivate">
                                       <xforms:send submission="get-thesaurus-project"/>
                                       <xforms:setvalue ref="instance('data-safe')" value="'true'"/>
                                    </xforms:action>
                                 </fr:button>
                                 <fr:button>
                                    <xforms:label ref="$resources/save"/>
                                    <xforms:action ev:event="DOMActivate">
                                       <xforms:send submission="save-project"/>
                                       <xforms:send submission="get-thesaurus-project"/>
                                       <xforms:setvalue ref="instance('data-safe')" value="'true'"/>
                                    </xforms:action>
                                 </fr:button>
                              </xforms:group>
                           </xhtml:div>
                        </xforms:group>
                     </xhtml:td>
                  </xhtml:tr>
                  <!-- EDITOR -->
                  <xforms:group ref=".[$admin]">
                     <xhtml:tr>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/id"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/user-name"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/name"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/issues"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/edit"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/authorize"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/admin"/>
                        </xhtml:td>
                     </xhtml:tr>
                     <xforms:repeat nodeset="author" id="authorList">
                        <xhtml:tr>
                           <xhtml:td>
                              <xforms:output ref="@id"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xxforms:variable name="username" select="@username"/>
                              <xforms:output ref="@username"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="."/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@issues" class="auto-width"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@edit" class="auto-width"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@authorize" class="auto-width"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@admin" class="auto-width"/>
                           </xhtml:td>
                        </xhtml:tr>
                     </xforms:repeat>
                  </xforms:group>
                  <!-- VIEWER -->
                  <xforms:group ref=".[not($admin)]">
                     <xhtml:tr>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/name"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/issues"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/edit"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/authorize"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/admin"/>
                        </xhtml:td>
                        <!--                            <xhtml:td class="item-label">
                                <xforms:output ref="$resources/username"/>
                            </xhtml:td>-->
                     </xhtml:tr>
                     <xforms:repeat nodeset="author">
                        <xhtml:tr class="not-selectable">
                           <xhtml:td>
                              <xforms:output ref="."/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@issues" class="auto-width"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@edit" class="auto-width"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@authorize" class="auto-width"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@admin" class="auto-width"/>
                           </xhtml:td>
                        </xhtml:tr>
                     </xforms:repeat>
                  </xforms:group>
               </xhtml:table>
            </xforms:group>
         </fr:tab>
         <!-- ISSUES TAB -->
         <fr:tab id="issues-tab">
            <fr:label ref="$resources/issues"/>
            <fr:accordion class="fr-accordion-lnf">
               <fr:case selected="false" id="search-box">
                  <fr:label ref="$resources/selection"/>
                  <xhtml:table width="100%">
                     <!-- row with issues table -->
                     <xhtml:tr>
                        <xhtml:td colspan="4">
                           <xhtml:b>
                              <xforms:output ref="$resources/show"/>
                              <xforms:output
                                 ref="concat(' (', $resources/issues, ': ', count(instance('issues')/issue[if (string-length(instance('selected-issue-id'))&gt;0) then (tokenize(@id,'\.')[last()]=instance('selected-issue-id')) else (@currentStatusCode=tokenize(instance('selected-status-codes'),' ') and @type=tokenize(instance('selected-issue-types'),' ') and (instance('selected-issue-priorities')='' or @priority=tokenize(instance('selected-issue-priorities'),' ')) and (instance('selected-issue-assignee')='' or @lastAssignment=instance('selected-issue-assignee')))]), ' / ', count(instance('issues')/issue), ')')"
                              />
                           </xhtml:b>
                        </xhtml:td>
                     </xhtml:tr>
                     <xhtml:tr>
                        <xhtml:td class="item-label">
                           <xforms:output ref="concat($resources/status,': ')"/>
                        </xhtml:td>
                        <xhtml:td>
                           <xforms:select ref="instance('selected-status-codes')" appearance="full">
                              <xforms:itemset nodeset="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value!='new']">
                                 <xforms:label ref="label[@language=instance('language')]"/>
                                 <xforms:value ref="@value"/>
                              </xforms:itemset>
                           </xforms:select>
                        </xhtml:td>
                        <xhtml:td class="item-label">
                           <xforms:output ref="concat($resources/type,': ')"/>
                        </xhtml:td>
                        <xhtml:td>
                           <xforms:select ref="instance('selected-issue-types')" appearance="full">
                              <xforms:itemset nodeset="instance('decor-types')/IssueType/enumeration">
                                 <xforms:label ref="label[@language=instance('language')]"/>
                                 <xforms:value ref="@value"/>
                              </xforms:itemset>
                           </xforms:select>
                        </xhtml:td>
                        <xhtml:td class="item-label">
                           <xforms:output ref="concat($resources/priority,': ')"/>
                        </xhtml:td>
                        <xhtml:td>
                           <xforms:select ref="instance('selected-issue-priorities')" appearance="full">
                              <xforms:itemset nodeset="instance('decor-types')/IssuePriority/enumeration">
                                 <xforms:label ref="label[@language=instance('language')]"/>
                                 <xforms:value ref="@value"/>
                              </xforms:itemset>
                           </xforms:select>
                        </xhtml:td>
                     </xhtml:tr>
                     <xhtml:tr>
                        <xhtml:td class="item-label">
                           <xforms:output ref="concat($resources/assigned-to,': ')"/>
                        </xhtml:td>
                        <xhtml:td colspan="5">
                           <xforms:select1 ref="instance('selected-issue-assignee')" class="auto-width" appearance="minimal">
                              <xforms:item>
                                 <xforms:label>-</xforms:label>
                                 <xforms:value/>
                              </xforms:item>
                              <xforms:itemset nodeset="distinct-values(instance('issues')//issue[string-length(@lastAssignment)&gt;0]/@lastAssignment)">
                                 <xforms:label ref="."/>
                                 <xforms:value ref="."/>
                              </xforms:itemset>
                           </xforms:select1>
                        </xhtml:td>
                     </xhtml:tr>
                  </xhtml:table>
               </fr:case>
               <fr:case selected="true" id="result-box">
                  <fr:label ref="$resources/results"/>
                  <xhtml:table width="100%">
                     <!-- row with issues table -->
                     <xhtml:tr>
                        <xhtml:td>
                           <xhtml:div class="detail">
                              <fr:datatable width="100%" scrollable="vertical" height="200px">
                                 <xhtml:thead>
                                    <xhtml:tr>
                                       <xhtml:th fr:sortable="true" fr:resizeable="true">
                                          <xforms:output ref="$resources/issue"/>
                                       </xhtml:th>
                                       <xhtml:th fr:sortable="true" fr:sortKey="@currentStatusCode" fr:resizeable="true">
                                          <xforms:output ref="$resources/status"/>
                                       </xhtml:th>
                                       <xhtml:th fr:sortable="true" fr:sortKey="@priority" fr:resizeable="true">
                                          <xforms:output ref="$resources/priority"/>
                                       </xhtml:th>
                                       <xhtml:th fr:sortable="true" fr:resizeable="true">
                                          <xforms:output ref="$resources/type"/>
                                       </xhtml:th>
                                       <xhtml:th fr:sortable="true" fr:resizeable="true">
                                          <xforms:output ref="$resources/date"/>
                                       </xhtml:th>
                                       <xhtml:th fr:sortable="true" fr:sorted="ascending" fr:resizeable="true">
                                          <xforms:output ref="$resources/assigned-to"/>
                                       </xhtml:th>
                                    </xhtml:tr>
                                 </xhtml:thead>
                                 <xhtml:tbody>
                                    <xhtml:tr
                                       repeat-nodeset="instance('issues')/issue[if (string-length(instance('selected-issue-id'))&gt;0) then (tokenize(@id,'\.')[last()]=instance('selected-issue-id')) else (@currentStatusCode=tokenize(instance('selected-status-codes'),' ') and @type=tokenize(instance('selected-issue-types'),' ') and (instance('selected-issue-priorities')='' or @priority=tokenize(instance('selected-issue-priorities'),' ')) and (instance('selected-issue-assignee')='' or @lastAssignment=instance('selected-issue-assignee')))]"
                                       id="open-issue-table">
                                       <xxforms:variable name="type" select="@type"/>
                                       <xhtml:td>
                                          <xforms:output ref="@displayName"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xxforms:variable name="currentStatusCode" select="@currentStatusCode"/>
                                          <xforms:output ref="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value=$currentStatusCode]/label[@language=instance('language')]"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xxforms:variable name="priority" select="@priority"/>
                                          <xforms:output ref="instance('decor-types')/IssuePriority/enumeration[@value=$priority]/label[@language=instance('language')]"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@typeName"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@lastDate"
                                             xxforms:format="if (instance('language')='en-US') then format-dateTime(.,'[M01]/[D01]/[Y]',(), (), ()) else format-dateTime(.,'[D01]-[M01]-[Y]', (), (), ())"
                                          />
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@lastAssignment"/>
                                       </xhtml:td>
                                    </xhtml:tr>
                                 </xhtml:tbody>
                                 <xforms:action ev:event="fr-selection-changed">
                                    <xforms:setvalue ref="instance('selected-issue')/selected" value="event('selected')/@id"/>
                                    <xforms:send submission="get-issue-dhd-concept"/>
                                 </xforms:action>
                              </fr:datatable>
                           </xhtml:div>
                        </xhtml:td>
                     </xhtml:tr>
                  </xhtml:table>
               </fr:case>
            </fr:accordion>
            <xhtml:table width="100%">
               <!-- row with issue details -->
               <xhtml:tr>
                  <xhtml:td>
                     <xhtml:div class="detail">
                        <xforms:group ref="instance('issues')/issue[@id=instance('selected-issue')/selected]">
                           <xhtml:table width="100%">
                              <!-- row with issue header -->
                              <xhtml:tr>
                                 <xhtml:td class="heading" colspan="2">
                                    <xhtml:div class="heading">
                                       <xforms:output ref="@typeName"/>: 
                                     <xforms:output ref="@displayName"/>
                                    </xhtml:div>
                                 </xhtml:td>
                              </xhtml:tr>
                              <xhtml:tr>
                                 <xhtml:td class="item-label">
                                    <xforms:output ref="$resources/priority"/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xxforms:variable name="priority" select="@priority"/>
                                    <xforms:output ref="instance('decor-types')/IssuePriority/enumeration[@value=$priority]/label[@language=instance('language')]"/>
                                 </xhtml:td>
                              </xhtml:tr>
                              <xhtml:tr>
                                 <xhtml:td class="item-label">
                                    <xforms:output ref="$resources/status"/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xxforms:variable name="statusCode" select="@currentStatusCode"/>
                                    <xforms:output ref="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value=$statusCode]/label[@language=instance('language')]"/>
                                 </xhtml:td>
                              </xhtml:tr>
                              <!-- issue objects -->
                              <xhtml:tr>
                                 <xhtml:td class="item-label">
                                    <xforms:output ref="$resources/concerns"/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xforms:group ref="instance('issue-dhd-concept')">
                                       <xhtml:table width="100%" class="detail">
                                          <!-- heading with buttons -->
                                          <xhtml:tr>
                                             <xhtml:td class="heading" colspan="4">
                                                <xhtml:div class="heading">
                                                   <xforms:output ref="desc[@type='pref']"/>
                                                </xhtml:div>
                                                <xhtml:div class="buttons">
                                                   <fr:button>
                                                      <xforms:label>
                                                         <xforms:output ref="$resources/show-in-editor"/>
                                                      </xforms:label>
                                                      <xforms:action ev:event="DOMActivate">
                                                         <xforms:setvalue ref="instance('dhd-concept-navigation')" value="instance('issues')/issue[@id=instance('selected-issue')/selected]/object/@id"/>
                                                         <xforms:send submission="get-dhd-concept"/>
                                                         <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('dhd-concept')/snomed/@conceptId"/>
                                                         <xforms:send submission="get-snomed-context-concept"/>
                                                         <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                                         <xforms:dispatch targetid="thesaurus-tab" name="fr-toggle"/>
                                                         <!--<xforms:setfocus control="search-snomed-description"/>-->
                                                      </xforms:action>
                                                   </fr:button>
                                                </xhtml:div>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <!-- DHD thesaurus id -->
                                          <xhtml:tr>
                                             <xhtml:td class="item-label">
                                                <xforms:output ref="$resources/thesaurus-id"/>
                                             </xhtml:td>
                                             <xhtml:td width="10%">
                                                <xforms:output ref="@thesaurusId"/>
                                             </xhtml:td>
                                             <xhtml:td class="item-label">
                                                <xforms:output ref="$resources/status"/>
                                             </xhtml:td>
                                             <xhtml:td>
                                                <xxforms:variable name="statusCode" select="@statusCode"/>
                                                <xforms:output ref="instance('status-codes')/enumeration[@value=$statusCode]/label[@language=instance('language')]" class="node-s{$statusCode}"/>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <!-- Snomed id and validation -->
                                          <xhtml:tr>
                                             <xhtml:td class="item-label">
                                                <xforms:output ref="$resources/snomed-id"/>
                                             </xhtml:td>
                                             <xhtml:td width="10%">
                                                <xforms:output ref="snomed/@conceptId"/>
                                             </xhtml:td>
                                             <xhtml:td class="item-label">
                                                <xforms:output ref="$resources/validated"/>
                                             </xhtml:td>
                                             <xhtml:td>
                                                <xforms:output ref="snomed/@validationDate"
                                                   xxforms:format="if (instance('language')='en-US') then format-date(.,'[M01]/[D01]/[Y]') else format-date(.,'[D01]-[M01]-[Y]')"
                                                   class="{if (snomed/@validated='true') then 'node-sfinal' else 'node-sdraft'}"/>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <!-- Snomed  full name -->
                                          <xhtml:tr>
                                             <xhtml:td class="item-label">
                                                <xforms:output ref="$resources/snomed-name"/>
                                             </xhtml:td>
                                             <xhtml:td colspan="3">
                                                <xforms:output ref="snomed/desc"/>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <!-- reference (preferred) term -->
                                          <xhtml:tr>
                                             <xhtml:td class="item-label">
                                                <xforms:output ref="$resources/reference-term"/>
                                             </xhtml:td>
                                             <xhtml:td colspan="3">
                                                <xforms:output ref="desc[@type='pref']"/>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <!-- Synonyms -->
                                          <xhtml:tr>
                                             <xhtml:td class="item-label">
                                                <xforms:output ref="$resources/synonyms"/>
                                             </xhtml:td>
                                             <xhtml:td colspan="3">
                                                <xhtml:table width="100%">
                                                   <xforms:repeat nodeset="desc[@type='syn']">
                                                      <xhtml:tr class="not-selectable">
                                                         <xhtml:td>
                                                            <xforms:output ref="." class="node-s{@statusCode}"/>
                                                         </xhtml:td>
                                                      </xhtml:tr>
                                                   </xforms:repeat>
                                                </xhtml:table>
                                             </xhtml:td>
                                          </xhtml:tr>
                                       </xhtml:table>
                                       <xhtml:table width="100%">
                                          <xhtml:tr>
                                             <!-- ICD10 -->
                                             <xhtml:td>
                                                <xhtml:table width="100%" class="detail">
                                                   <xhtml:tr>
                                                      <xhtml:td colspan="3" class="heading">
                                                         <xforms:output ref="$resources/icd10"/>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                   <xforms:repeat nodeset="icd10">
                                                      <xxforms:variable name="icdStatus" select="@statusCode"/>
                                                      <xhtml:tr class="not-selectable">
                                                         <xhtml:td>
                                                            <xforms:output ref="@volgorde" class="node-s{$icdStatus}"/>
                                                         </xhtml:td>
                                                         <xhtml:td>
                                                            <xforms:output ref="@code"/>
                                                         </xhtml:td>
                                                         <xhtml:td>
                                                            <xforms:output ref="@term"/>
                                                         </xhtml:td>
                                                      </xhtml:tr>
                                                   </xforms:repeat>
                                                </xhtml:table>
                                             </xhtml:td>
                                             <!-- DBC -->
                                             <xhtml:td>
                                                <xhtml:table width="100%" class="detail">
                                                   <xhtml:tr>
                                                      <xhtml:td colspan="4" class="heading">
                                                         <xforms:output ref="$resources/dbc"/>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                   <xforms:repeat nodeset="xxforms:sort(dbc,@specialism,'text','ascending')">
                                                      <xxforms:variable name="dbcStatus" select="@statusCode"/>
                                                      <xhtml:tr class="not-selectable">
                                                         <xhtml:td>
                                                            <xforms:output ref="@specialismCode" class="node-s{$dbcStatus}"/>
                                                         </xhtml:td>
                                                         <xhtml:td>
                                                            <xforms:output ref="@specialism"/>
                                                         </xhtml:td>
                                                         <xhtml:td>
                                                            <xforms:output ref="@code"/>
                                                         </xhtml:td>
                                                         <xhtml:td>
                                                            <xforms:output ref="@desc"/>
                                                         </xhtml:td>
                                                      </xhtml:tr>
                                                   </xforms:repeat>
                                                </xhtml:table>
                                             </xhtml:td>
                                             <!-- domains -->
                                             <xhtml:td>
                                                <xhtml:table width="100%" class="detail">
                                                   <xhtml:tr>
                                                      <xhtml:td colspan="2" class="heading">
                                                         <xforms:output ref="$resources/domains"/>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                   <xforms:repeat nodeset="xxforms:sort(specialism,@subspecialism,'text','ascending')">
                                                      <xhtml:tr class="not-selectable">
                                                         <xhtml:td>
                                                            <xforms:output ref="@subspecialism"/>
                                                         </xhtml:td>
                                                         <xhtml:td>
                                                            <xforms:output ref="@specialismShort"/>
                                                         </xhtml:td>
                                                      </xhtml:tr>
                                                   </xforms:repeat>
                                                </xhtml:table>
                                             </xhtml:td>
                                          </xhtml:tr>
                                       </xhtml:table>
                                    </xforms:group>
                                 </xhtml:td>
                              </xhtml:tr>
                              <!-- issue trackings and assignments header with buttons -->
                              <xhtml:tr>
                                 <xhtml:td class="heading" colspan="2">
                                    <xhtml:div class="heading">
                                       <xforms:output ref="$resources/events"/>
                                    </xhtml:div>
                                    <xforms:group ref=".[$issueCreator]">
                                       <xhtml:div class="buttons">
                                          <fr:button>
                                             <xforms:label>
                                                <xhtml:img src="/img/tracking.png" alt=""/>
                                             </xforms:label>
                                             <xforms:hint>
                                                <xforms:output ref="$resources/add"/>
                                             </xforms:hint>
                                             <xforms:action ev:event="DOMActivate">
                                                <xxforms:variable name="user" select="xxforms:get-session-attribute('username')"/>
                                                <xforms:setvalue ref="instance('tracking-instance')/tracking/author/@id" value="instance('project')/author[@username=$user]/@id"/>
                                                <xforms:setvalue ref="instance('tracking-instance')/tracking/author" value="instance('project')/author[@username=$user]"/>
                                                <xforms:setvalue ref="instance('tracking-instance')/tracking/desc/@language" value="instance('language')"/>
                                                <xforms:insert context="instance('issues')/issue[@id=instance('selected-issue')/selected]" nodeset="*" at="last()" position="after"
                                                   origin="instance('tracking-instance')/tracking"/>
                                                <xforms:setfocus control="tracking-description"/>
                                             </xforms:action>
                                          </fr:button>
                                          <fr:button>
                                             <xforms:label>
                                                <xhtml:img src="/img/arrowright.png" alt=""/>
                                             </xforms:label>
                                             <xforms:hint>
                                                <xforms:output ref="$resources/assign"/>
                                             </xforms:hint>
                                             <xforms:action ev:event="DOMActivate">
                                                <xxforms:variable name="user" select="xxforms:get-session-attribute('username')"/>
                                                <xforms:setvalue ref="instance('assignment-instance')/assignment/author/@id" value="instance('project')/author[@username=$user]/@id"/>
                                                <xforms:setvalue ref="instance('assignment-instance')/assignment/@to" value="instance('project')/author[@username=$user]/@id"/>
                                                <xforms:setvalue ref="instance('assignment-instance')/assignment/author" value="instance('project')/author[@username=$user]"/>
                                                <xforms:setvalue ref="instance('assignment-instance')/assignment/@name" value="instance('project')/author[@username=$user]"/>
                                                <xforms:setvalue ref="instance('assignment-instance')/assignment/desc/@language" value="instance('language')"/>
                                                <xforms:insert context="instance('issues')/issue[@id=instance('selected-issue')/selected]" nodeset="*" at="last()" position="after"
                                                   origin="instance('assignment-instance')/assignment"/>
                                                <xforms:setfocus control="assignment-description"/>
                                             </xforms:action>
                                          </fr:button>
                                       </xhtml:div>
                                    </xforms:group>
                                 </xhtml:td>
                              </xhtml:tr>
                              <!-- tracking and assignment editor -->
                              <xhtml:tr>
                                 <xhtml:td colspan="2">
                                    <!-- new tracking editor -->
                                    <xforms:group ref="instance('issues')/issue[@id=instance('selected-issue')/selected]/tracking[string-length(@effectiveDate)=0]">
                                       <xhtml:table width="100%">
                                          <!-- trackings -->
                                          <xhtml:tr>
                                             <xhtml:td class="item-label">
                                                <xforms:output ref="$resources/new-event"/>
                                             </xhtml:td>
                                             <xhtml:td>
                                                <xhtml:table width="100%">
                                                   <!-- tracking type -->
                                                   <xhtml:tr>
                                                      <xhtml:td class="item-label">
                                                         <xforms:output ref="$resources/issue-status"/>
                                                      </xhtml:td>
                                                      <xhtml:td>
                                                         <fr:select1-button ref="@statusCode" appearance="minimal">
                                                            <xforms:itemset nodeset="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration">
                                                               <xforms:label ref="label[@language=instance('language')]"/>
                                                               <xforms:value ref="@value"/>
                                                            </xforms:itemset>
                                                         </fr:select1-button>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                   <!-- description of tracking -->
                                                   <xhtml:tr>
                                                      <xhtml:td class="item-label">
                                                         <xforms:output ref="$resources/description"/>
                                                      </xhtml:td>
                                                      <xhtml:td>
                                                         <xforms:textarea id="tracking-description" mediatype="text/html" ref="desc"/>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                   <!-- save and cancel buttons -->
                                                   <xhtml:tr>
                                                      <xhtml:td class="item-label" colspan="2">
                                                         <xhtml:div class="buttons">
                                                            <fr:button>
                                                               <xforms:label ref="$resources/cancel"/>
                                                               <xforms:action ev:event="DOMActivate">
                                                                  <xforms:delete ref="instance('issues')/issue/tracking[../@id=instance('selected-issue')/selected and string-length(@effectiveDate)=0]"
                                                                  />
                                                               </xforms:action>
                                                            </fr:button>
                                                            <fr:button>
                                                               <xforms:label ref="$resources/save-tracking"/>
                                                               <xforms:action ev:event="DOMActivate">
                                                                  <xxforms:variable name="currentIssue" select="instance('selected-issue')/selected"/>
                                                                  <xforms:setvalue
                                                                     ref="instance('issues')/issue/tracking[../@id=instance('selected-issue')/selected and string-length(@effectiveDate)=0]/@effectiveDate"
                                                                     value="format-dateTime(current-dateTime(), '[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01]')"/>
                                                                  <xforms:send submission="update-issue"/>
                                                                  <xforms:send submission="get-issues"/>
                                                               </xforms:action>
                                                            </fr:button>
                                                         </xhtml:div>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                </xhtml:table>
                                             </xhtml:td>
                                          </xhtml:tr>
                                       </xhtml:table>
                                    </xforms:group>
                                    <!-- new assignment editor -->
                                    <xforms:group ref="instance('issues')/issue[@id=instance('selected-issue')/selected]/assignment[@effectiveDate/string-length()=0]">
                                       <xhtml:table width="100%">
                                          <!-- assignment -->
                                          <xhtml:tr>
                                             <xhtml:td class="item-label">
                                                <xforms:output ref="$resources/new-assignment"/>
                                             </xhtml:td>
                                             <xhtml:td>
                                                <xhtml:table width="100%">
                                                   <!-- assign to -->
                                                   <xhtml:tr>
                                                      <xhtml:td class="item-label">
                                                         <xforms:output ref="$resources/assign-to"/>
                                                      </xhtml:td>
                                                      <xhtml:td>
                                                         <fr:select1-button ref="@to" appearance="minimal">
                                                            <xforms:itemset nodeset="instance('project')/author">
                                                               <xforms:label ref="."/>
                                                               <xforms:value ref="@id"/>
                                                            </xforms:itemset>
                                                            <xforms:action ev:event="xforms-value-changed">
                                                               <xxforms:variable name="id"
                                                                  select="instance('issues')/issue/assignment[../@id=instance('selected-issue')/selected and @effectiveDate/string-length()=0]/@to"/>
                                                               <xforms:setvalue
                                                                  ref="instance('issues')/issue/assignment[../@id=instance('selected-issue')/selected and @effectiveDate/string-length()=0]/@name"
                                                                  value="instance('project')/author[@id=$id]"/>
                                                            </xforms:action>
                                                         </fr:select1-button>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                   <!-- description of assignment -->
                                                   <xhtml:tr>
                                                      <xhtml:td class="item-label">
                                                         <xforms:output ref="$resources/description"/>
                                                      </xhtml:td>
                                                      <xhtml:td>
                                                         <xforms:textarea id="assignment-description" mediatype="text/html" ref="desc[@language=instance('language')]"/>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                   <!-- save and cancel buttons -->
                                                   <xhtml:tr>
                                                      <xhtml:td class="item-label" colspan="2">
                                                         <xhtml:div class="buttons">
                                                            <fr:button>
                                                               <xforms:label ref="$resources/cancel"/>
                                                               <xforms:action ev:event="DOMActivate">
                                                                  <xforms:delete
                                                                     ref="instance('issues')/issue/assignment[../@id=instance('selected-issue')/selected and string-length(@effectiveDate)=0]"/>
                                                               </xforms:action>
                                                            </fr:button>
                                                            <fr:button>
                                                               <xforms:label ref="$resources/assign"/>
                                                               <xforms:action ev:event="DOMActivate">
                                                                  <xforms:setvalue
                                                                     ref="instance('issues')/issue/assignment[../@id=instance('selected-issue')/selected and string-length(@effectiveDate)=0]/@effectiveDate"
                                                                     value="format-dateTime(current-dateTime(), '[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01]')"/>
                                                                  <xforms:send submission="update-issue"/>
                                                                  <xforms:send submission="get-issues"/>
                                                               </xforms:action>
                                                            </fr:button>
                                                         </xhtml:div>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                </xhtml:table>
                                             </xhtml:td>
                                          </xhtml:tr>
                                       </xhtml:table>
                                    </xforms:group>
                                 </xhtml:td>
                              </xhtml:tr>
                              <!-- trackings and assignments -->
                              <xhtml:tr>
                                 <xhtml:td colspan="2">
                                    <xhtml:table width="100%">
                                       <xforms:repeat nodeset="tracking[string-length(@effectiveDate)&gt;0]|assignment[string-length(@effectiveDate)&gt;0]">
                                          <xhtml:tr class="not-selectable">
                                             <xhtml:td class="item-label-var" width="5%">
                                                <xforms:group ref=".[name()='assignment']">
                                                   <xforms:output mediatype="image/*" value="'/img/arrowright.png'">
                                                      <xforms:hint ref="$resources/assignment"/>
                                                   </xforms:output>
                                                </xforms:group>
                                                <xforms:group ref=".[name()='tracking']">
                                                   <xforms:output mediatype="image/*" value="'/img/tracking.png'">
                                                      <xforms:hint ref="$resources/tracking"/>
                                                   </xforms:output>
                                                </xforms:group>
                                             </xhtml:td>
                                             <xhtml:td class="item-label-var" width="10%">
                                                <xforms:group ref="@statusCode">
                                                   <xxforms:variable name="status" select="."/>
                                                   <!--
                                                            <xforms:output ref="$resources/issue-status"/>
                                                            <xforms:output ref="': '"/>
                                                            -->
                                                   <xforms:output mediatype="image/*" value="concat('/img/IssueStatusCodeLifeCycle_',.,'.png')">
                                                      <xforms:hint>
                                                         <xforms:output ref="$resources/status"/> = 
                                                                    <xforms:output
                                                            ref="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value=$status]/label[@language=instance('language')]"/>
                                                      </xforms:hint>
                                                   </xforms:output>
                                                   <xforms:output ref="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value=$status]/label[@language=instance('language')]"/>
                                                </xforms:group>
                                             </xhtml:td>
                                             <xhtml:td class="heading-var" width="85%">

                                                <!-- date -->
                                                <xforms:output ref="@effectiveDate" xxforms:format="format-dateTime(.,'[Y]-[M01]-[D01]', (), (), ())"/>
                                                <xforms:output ref="': '"/>

                                                <!-- assignment to: -->
                                                <xforms:group ref=".[name()='assignment']">
                                                   <xforms:output ref="$resources/assigned-to"/>
                                                   <xforms:output ref="@name"/>
                                                </xforms:group>

                                                <!-- tracking -->
                                                <xforms:group ref=".[name()='tracking']">
                                                   <xforms:output ref="$resources/tracking"/>
                                                </xforms:group>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <xhtml:tr class="not-selectable">
                                             <xhtml:td class="item-label-var" width="5%">
                                                <xforms:output ref="$resources/author"/>
                                             </xhtml:td>
                                             <xhtml:td class="item-label-var" width="5%">
                                                <xforms:output ref="author"/>
                                             </xhtml:td>
                                             <xhtml:td class="desc-var">
                                                <xforms:output mediatype="text/html" ref="desc"/>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <xhtml:tr class="not-selectable">
                                             <xhtml:td colspan="3"/>
                                          </xhtml:tr>
                                       </xforms:repeat>
                                    </xhtml:table>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xhtml:table>
                        </xforms:group>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
            </xhtml:table>
         </fr:tab>
      </fr:tabview>
   </xhtml:body>
</xhtml:html>
