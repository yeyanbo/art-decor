<!--
    Copyright (C) 2011 Nictiz.
    
    Author: Gerrit Boers

    This program is free software; you can redistribute it and/or modify it under the terms of the
    GNU Lesser General Public License as published by the Free Software Foundation; either version
    2.1 of the License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
    without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
    See the GNU Lesser General Public License for more details.

    The full text of the license is available at http://www.gnu.org/copyleft/lesser.html
-->
<xhtml:html xmlns:f="http://orbeon.org/oxf/xml/formatting" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xhtml="http://www.w3.org/1999/xhtml"
   xmlns:fr="http://orbeon.org/oxf/xml/form-runner" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xxforms="http://orbeon.org/oxf/xml/xforms" xmlns:widget="http://orbeon.org/oxf/xml/widget"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="decor-terminology" xsi:schemaLocation="http://www.w3.org/1999/xhtml ../../orbeon_schemas/xhtml1-transitional-orbeon.xsd">
   <xhtml:head>
      <xhtml:style type="text/css">
         .xforms-repeat-selected-item-2 {
         font-weight: normal;
         background-color: inherit; 
         color : black
         }
         td.item-label-var, td.heading-var {
         background-color:#f0ebe4;
         color:#7a6e62;
         padding-left : 0.5em;
         padding-right : 0em;
         padding-top : 0.25em;
         padding-bottom : 0.25em;
         text-align:left;
         vertical-align:top;
         }
         td.heading-var {
         font-weight: bold;
         }
         .xforms-input.long-text input {
         width: 35em;
         margin: 0em;
         padding: 0em;
         text-align: left
         }
         .xforms-input.code input {
         width: 5em;
         margin: 0em;
         padding: 0em;
         }         
         span.code  {
         margin: 0em;
         padding: 0em;
         }
         table.scroll {
         width: 100%;
         }
         table.no-scroll {
         width: 99%;
         }
         .xforms-select1-appearance-full span
         {
         display: block;
         clear: both 
         } 
         .xforms-select-appearance-full span { display: block; clear: both } 
         .xforms-repeat-selected-item-2 {
         font-weight: normal;
         background-color: inherit; 
         color : black
         }
         td.item-label-var, td.heading-var {
         background-color:#f0ebe4;
         color:#7a6e62;
         padding-left : 0.5em;
         padding-right : 0em;
         padding-top : 0.25em;
         padding-bottom : 0.25em;
         text-align:left;
         vertical-align:top;
         }
         td.heading-var {
         font-weight: bold;
         
         }
         img.small-button {
         margin-left: 0.1em;
         margin-right: 0.1em;
         }
         td.heading-small {
         font-weight: bold;
         text-align:left;
         background-color:#ebe7e1;
         color:#7a6e62;
         padding-right:0.4em;
         padding-left:0.4em;
         }
         td.desc-var {
         padding-left : 0.5em;
         padding-right : 0em;
         padding-top : 0.25em;
         padding-bottom : 0.25em;
         }                     
         div.ci-navigate {
         padding-top : 0.25em;
         margin-right: 0em;
         background : white;
         vertical-align : top;
         width: inherit;
         height: 50em;
         overflow-y:auto;
         overflow-x:auto;
         }

         .xforms-repeat-selected-item-1.mapping {
         font-weight: normal;
         background-color: inherit; 
         color : black
         }
         .xforms-repeat-selected-item-2.mapping{
         font-weight: normal;
         background-color: inherit; 
         color : black
         }
         .xforms-repeat-selected-item-3.mapping{
         font-weight: normal;
         background-color: inherit; 
         color : black
         }
         .xforms-repeat-selected-item-4.mapping{
         font-weight: normal;
         background-color: inherit; 
         color : black
         }
         .xforms-repeat-template.mapping {
         font-weight: normal;
         background-color: inherit; 
         color : black
         }
         tr.mapping:hover {
         background-color: #eee; 
         }
         h2.alert {
         color: red; 
         }

      </xhtml:style>
      <xhtml:title>
         <xforms:output ref="$resources/ica-mapping"/>
      </xhtml:title>
      <xforms:model>
         <!-- Variable with path to art-exist for use by form -->
         <xxforms:variable name="art-exist" select="xxforms:property('art.exist.url')"/>
         <!-- Variable with path to terminology-eXist for use by form -->
         <xxforms:variable name="terminology-exist" select="xxforms:property('terminology.exist.url')"/>
         <!-- Variable with path to terminology-eXist used to pass to client as link for services (SNOMED, LOINC) -->
         <xxforms:variable name="terminology-external-exist" select="xxforms:property('terminology.external.exist.url')"/>
         <!-- resources for internationalization -->
         <xforms:instance id="resources-instance">
            <dummy/>
         </xforms:instance>
         <!-- submission for loading resources -->
         <xforms:submission id="get-resources-submission" serialization="none" method="get" resource="{$art-exist}/modules/get-form-resources.xquery?packageRoot=terminology" replace="instance" instance="resources-instance">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred:<xforms:output value="event('error-type')"/>; Status: <xforms:output value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"/>; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- language -->
         <xforms:instance id="language">
            <language/>
         </xforms:instance>
         <!-- instance for DECOR Schema types -->
         <xforms:instance id="decor-types">
            <dummy/>
         </xforms:instance>
         <!-- instance for status codes enumeration -->
         <xforms:instance id="status-codes">
            <ThesaurusConceptStatusCodeLifeCycle>
               <enumeration value="draft">
                  <label language="nl-NL">Ontwerp</label>
                  <label language="en-US">Draft</label>
                  <label language="de-DE">Entwurf</label>
               </enumeration>
               <enumeration value="active">
                  <label language="nl-NL">Actief</label>
                  <label language="en-US">Active</label>
                  <label language="de-DE">Aktiv</label>
               </enumeration>
               <enumeration value="retired">
                  <label language="nl-NL">Obsoleet</label>
                  <label language="en-US">Retired</label>
                  <label language="de-DE">Obsolet</label>
               </enumeration>
               <enumeration value="rejected">
                  <label language="nl-NL">Afgewezen</label>
                  <label language="en-US">Rejected</label>
                  <label language="de-DE">Abgewiesen</label>
               </enumeration>
               <enumeration value="update">
                  <label language="nl-NL">In bewerking</label>
                  <label language="en-US">Under update</label>
                  <label language="de-DE">In Bearbeitung</label>
               </enumeration>
               <enumeration value="pending">
                  <label language="nl-NL">Gepland voor activatie</label>
                  <label language="en-US">scheduled for activation</label>
                  <label language="de-DE"/>
               </enumeration>
               <enumeration value="review">
                  <label language="nl-NL">Wordt gereviewed</label>
                  <label language="en-US">In Review</label>
                  <label language="de-DE">In Revision</label>
               </enumeration>
            </ThesaurusConceptStatusCodeLifeCycle>
         </xforms:instance>
         <!-- instance for status codes enumeration -->
         <xforms:instance id="release-status-codes">
            <ReleaseStatusCodeLifeCycle>
               <enumeration value="draft">
                  <label language="nl-NL">Voorlopig</label>
                  <label language="en-US">Draft</label>
                  <label language="de-DE"/>
               </enumeration>
               <enumeration value="final">
                  <label language="nl-NL">Definitief</label>
                  <label language="en-US">Final</label>
                  <label language="de-DE"/>
               </enumeration>
               <enumeration value="deprecated">
                  <label language="nl-NL">Vervallen</label>
                  <label language="en-US">Deprecated</label>
                  <label language="de-DE"/>
               </enumeration>
            </ReleaseStatusCodeLifeCycle>
         </xforms:instance>
         <!-- get decor submission -->
         <xforms:submission id="get-decor-types" serialization="none" method="get" resource="{$art-exist}/modules/get-decor-schema-enumerations.xq" replace="instance" instance="decor-types"
            xxforms:readonly="true"/>


         <!-- PROJECT -->
         <xforms:instance id="project" xxforms:exclude-result-prefixes="#all">
            <project/>
         </xforms:instance>
         <!-- event observer for project changes -->
         <xforms:action ev:observer="project" ev:event="xforms-insert xforms-delete xxforms-value-changed">
            <xforms:setvalue ref="instance('project-safe')">false</xforms:setvalue>
            <xforms:setvalue ref="instance('data-safe')">false</xforms:setvalue>
         </xforms:action>
         <xforms:submission id="get-project" serialization="none" method="get" resource="{$terminology-exist}/ica/modules/get-ci-list-project.xquery" replace="instance" instance="project"/>
         <!-- save project -->
         <xforms:submission id="save-project" ref="instance('project')" resource="{$terminology-exist}/ica/modules/save-ci-list-project.xquery" method="post" replace="instance"
            xxforms:instance="project-safe" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">A submission error occurred: <xforms:output value="event('error-type')"/>
               <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- instance for users -->
         <xforms:instance id="users-instance">
            <users/>
         </xforms:instance>
         <xforms:submission id="get-users-submission" serialization="none" method="get" resource="{$art-exist}/modules/get-user-list.xquery" replace="instance" instance="users-instance"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}"/>
         <!-- instance for new author -->
         <xforms:instance id="author-instance" xxforms:exclude-result-prefixes="#all">
            <author id="" username="guest" admin="false" authorize="false" edit="false" issues="false">Guest</author>
         </xforms:instance>
         <xforms:bind nodeset="instance('project')/author" readonly="not($admin)">
            <xforms:bind nodeset="@issues" type="xs:boolean"/>
            <xforms:bind nodeset="@edit" type="xs:boolean"/>
            <xforms:bind nodeset="@authorize" type="xs:boolean"/>
            <xforms:bind nodeset="@admin" type="xs:boolean"/>
         </xforms:bind>

         <!-- instance for overall edit status -->
         <xforms:instance id="data-safe" xxforms:exclude-result-prefixes="#all">
            <data-safe>true</data-safe>
         </xforms:instance>
         <!-- instance for project edit status -->
         <xforms:instance id="project-safe" xxforms:exclude-result-prefixes="#all">
            <data-safe>true</data-safe>
         </xforms:instance>
         <!-- instance for ci-list edit status -->
         <xforms:instance id="list-safe" xxforms:exclude-result-prefixes="#all">
            <data-safe>true</data-safe>
         </xforms:instance>

         <!-- instance for help, temporary solution, must move to db -->
         <xforms:instance id="help-instance">
            <help-files>
               <search language="en-US">
                  <div class="h3">Finding Terms</div>
                  <p>Finding terms with the least amount of keystrokes possible, that is the goal.<br/> To achieve this goal the search field offers a combination of wildcard and exact match searches.</p>
                  <b>General Properties</b>
                  <ul>
                     <li> Searches starting with lower case letters will also find terms starting with upper case letters. </li>
                     <li> Results are ordered by wordcount and term length. </li>
                     <li> Starting a search term with lower case will perform a wildcard search. </li>
                     <li> Single term wildcard searches require a minimum of 4 keystrokes. </li>
                     <li> Starting a search term with upper case will perform an exact match search. </li>
                     <li> Single term exact match searches require a minimum of 2 keystrokes. </li>
                  </ul>
                  <b>Examples</b>
                  <table width="100%">
                     <tr>
                        <td class="floating-label">Searching for</td>
                        <td class="floating-label">Enter</td>
                     </tr>
                     <tr>
                        <td>Salbutamol</td>
                        <td>salb</td>
                     </tr>
                     <tr>
                        <td>Pneumonia</td>
                        <td>pneu</td>
                     </tr>
                     <tr>
                        <td>Acute asthma</td>
                        <td>acu ast</td>
                     </tr>
                     <tr>
                        <td>Medication review</td>
                        <td>med rev</td>
                     </tr>
                     <tr>
                        <td>Pain lower back</td>
                        <td>pa lo ba</td>
                     </tr>
                     <tr>
                        <td>Oxazepam tablets 10mg</td>
                        <td>ox ta 10</td>
                     </tr>
                     <tr>
                        <td>Haemoglobin A</td>
                        <td>hae A</td>
                     </tr>
                     <tr>
                        <td>WCC (White blood cell count)</td>
                        <td>WCC</td>
                     </tr>
                     <tr>
                        <td>Hb (Hemoglobin)</td>
                        <td>Hb</td>
                     </tr>
                     <tr>
                        <td>FH: Asthma (Family history: Asthma)</td>
                        <td>FH as</td>
                     </tr>
                  </table>
               </search>
               <search language="nl-NL">
                  <div class="h3">Termen vinden</div>
                  <p>Termen vinden met zo weinig mogelijk toetsaanslagen, dat is het doel.<br/> Om dit te bereiken ondersteunt het zoekveld het zoeken op exacte overeenkomst en het zogenaamde 'wildcard' zoeken.</p>
                  <b>Algemene Eigenschappen</b>
                  <ul>
                     <li> Bij zoektermen met kleine letters worden ook overeenkomende termen met hoofdletters gevonden. </li>
                     <li> Resultaten worden gesorteerd op aantal woorden en lengte van de term. </li>
                     <li> Als een zoekterm met een kleine letter begint dan wordt gezocht naar termen beginnend met de zoekterm (wildcard). </li>
                     <li> Wanneer de opdracht bestaat uit één enkele zoekterm beginnend met een kleine letter, dan moet deze minimaal vier letters bevatten. </li>
                     <li> Als een zoekterm begint met een hoofdletter dan dan wordt gezocht naar termen die exact overeenkomen.. </li>
                     <li> Wanneer de opdracht bestaat uit één enkele zoekterm beginnend met een hoofdletter, dan moet deze minimaal twee letters bevatten. </li>
                  </ul>
                  <b>Voorbeelden</b>
                  <table width="100%">
                     <tr>
                        <td class="floating-label">U zoekt</td>
                        <td class="floating-label">Toets</td>
                     </tr>
                     <tr>
                        <td>Salbutamol</td>
                        <td>salb</td>
                     </tr>
                     <tr>
                        <td>Pneumonia</td>
                        <td>pneu</td>
                     </tr>
                     <tr>
                        <td>Acute asthma</td>
                        <td>acu ast</td>
                     </tr>
                     <tr>
                        <td>Medication review</td>
                        <td>med rev</td>
                     </tr>
                     <tr>
                        <td>Pain lower back</td>
                        <td>pa lo ba</td>
                     </tr>
                     <tr>
                        <td>Oxazepam tablets 10mg</td>
                        <td>ox ta 10</td>
                     </tr>
                     <tr>
                        <td>Haemoglobin A</td>
                        <td>hae A</td>
                     </tr>
                     <tr>
                        <td>WCC (White blood cell count)</td>
                        <td>WCC</td>
                     </tr>
                     <tr>
                        <td>Hb (Hemoglobin)</td>
                        <td>Hb</td>
                     </tr>
                     <tr>
                        <td>FH: Asthma (Family history: Asthma)</td>
                        <td>FH as</td>
                     </tr>
                  </table>
               </search>
            </help-files>
         </xforms:instance>



         <!-- *** CI LIST *** -->
         <!-- instance for ci navigation -->
         <xforms:instance id="ci-navigation" xxforms:exclude-result-prefixes="#all">
            <id>1</id>
         </xforms:instance>
         <!-- ica navigation nodeset -->
         <xforms:instance id="ica-nodeset">
            <nodeset>instance('ci-list')/ci[@statusCode=('review','draft','update','active')]</nodeset>
         </xforms:instance>
         <!-- status filters -->
         <xforms:instance id="status-filters">
            <filters>
               <filter nodeset="instance('ci-list')/ci">
                  <name language="nl-NL">Alle</name>
                  <name language="en-US">All</name>
                  <name language="de-DE">Alle</name>
               </filter>
               <filter nodeset="instance('ci-list')/ci[@statusCode=('review','draft','update','active')]">
                  <name language="nl-NL">Actueel</name>
                  <name language="en-US">Current</name>
                  <name language="de-DE">Actuell</name>
               </filter>
               <filter nodeset="instance('ci-list')/ci[@statusCode='draft']">
                  <name language="nl-NL">Ontwerp</name>
                  <name language="en-US">Draft</name>
                  <name language="de-DE">Draft</name>
               </filter>
               <filter nodeset="instance('ci-list')/ci[@statusCode='review']">
                  <name language="nl-NL">Review</name>
                  <name language="en-US">Review</name>
                  <name language="de-DE">Review</name>
               </filter>
               <filter nodeset="instance('ci-list')/ci[@statusCode='active']">
                  <name language="nl-NL">Actief</name>
                  <name language="en-US">Active</name>
                  <name language="de-DE"/>
               </filter>
               <filter nodeset="instance('ci-list')/ci[@statusCode='update']">
                  <name language="nl-NL">In bewerking</name>
                  <name language="en-US">Update</name>
                  <name language="de-DE"/>
               </filter>
               <filter nodeset="instance('ci-list')/ci[@statusCode='rejected']">
                  <name language="nl-NL">Afgewezen</name>
                  <name language="en-US">Rejected</name>
                  <name language="de-DE">Rejected</name>
               </filter>
            </filters>
         </xforms:instance>
         <!-- instance for CI list -->
         <xforms:instance id="ci-list">
            <dummy/>
         </xforms:instance>
         <xforms:submission id="get-ci-list" serialization="none" method="get" resource="{$terminology-exist}/ica/modules/get-ci-list.xquery" replace="instance" instance="ci-list"/>
         <!-- instance for new ICA mapping -->
         <xforms:instance id="new-ica" xxforms:exclude-result-prefixes="#all">
            <ci code="" statusCode="new" id="" effectiveDate="">
               <edit mode="new"/>
               <description language="nl-NL"/>
               <rationale language="nl-NL"/>
               <text language="nl-NL"/>
               <!--<icpc code=""/>
               <icd-9 code=""/>
               <icd-10 code=""/>
               <snomed code=""/>-->
            </ci>
         </xforms:instance>
         <!-- save ci list -->
         <xforms:submission id="save-ci-list" ref="instance('ci-list')" resource="{$terminology-exist}/ica/modules/save-ci-list.xquery" method="post" replace="instance" xxforms:instance="list-safe"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">A submission error occurred: <xforms:output value="event('error-type')"/>
               <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- selected CI -->
         <xforms:instance id="selected-ci" xxforms:exclude-result-prefixes="#all">
            <ci/>
         </xforms:instance>
         <xforms:bind nodeset="instance('selected-ci')">
            <xforms:bind nodeset="text" readonly="not(.[parent::ci/@statusCode=('draft','update')][$editor])"/>
            <xforms:bind nodeset="cic/@code" readonly="not(.[ancestor::ci/@statusCode=('draft','update')][$editor])"/>
            <xforms:bind nodeset="cic/desc" readonly="not(.[ancestor::ci/@statusCode=('draft','update')][$editor])"/>
            <xforms:bind nodeset="icpc/@code" readonly="not(.[../@statusCode=('draft','update')][$editor])"/>
            <xforms:bind nodeset="icpc/desc" readonly="not(.[../@statusCode=('draft','update')][$editor])"/>
            <xforms:bind nodeset="icd-9/@code" readonly="not(.[../@statusCode=('draft','update')][$editor])"/>
            <xforms:bind nodeset="icd-9/desc" readonly="not(.[../@statusCode=('draft','update')][$editor])"/>
            <xforms:bind nodeset="shb-ci/@code" readonly="not(.[../@statusCode=('draft','update')][$editor])"/>
            <xforms:bind nodeset="shb-ci/@codeSystemName" readonly="not(.[../@statusCode=('draft','update')][$editor])"/>
            <xforms:bind nodeset="shb-ci/desc" readonly="not(.[../@statusCode=('draft','update')][$editor])"/>
         </xforms:bind>
         <!-- get selected CI -->
         <xforms:submission id="get-ci" serialization="none" method="get" resource="{$terminology-exist}/ica/modules/get-ci.xquery?id={instance('ci-navigation')}" replace="instance"
            instance="selected-ci"/>
         <!-- new CI id -->
         <xforms:instance id="new-id" xxforms:exclude-result-prefixes="#all">
            <id/>
         </xforms:instance>
         <!-- create new CI -->
         <xforms:submission id="create-ci" serialization="none" method="get" resource="{$terminology-exist}/ica/modules/create-ci.xquery" replace="instance" instance="new-id"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done">
               <xforms:send submission="get-ci-list"/>
               <xforms:setvalue ref="instance('ci-navigation')" value="instance('new-id')"/>
               <xforms:send submission="get-ci"/>
            </xforms:action>
         </xforms:submission>
         <!-- delete selected CI -->
         <xforms:submission id="delete-ci" serialization="none" method="get" resource="{$terminology-exist}/ica/modules/delete-ci.xquery?id={instance('ci-navigation')}" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done">
               <xforms:send submission="get-ci-list"/>
               <xforms:setvalue ref="instance('ci-navigation')" value="instance('new-id')"/>
               <xforms:send submission="get-ci"/>
            </xforms:action>
         </xforms:submission>

         <!-- update text -->
         <xforms:submission id="update-ci-text" ref="instance('selected-ci')/text" resource="{$terminology-exist}/ica/modules/update-ci-text.xquery" method="post" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- update description -->
         <xforms:submission id="update-ci-description" ref="instance('selected-ci')/description" resource="{$terminology-exist}/ica/modules/update-rich-text.xquery" method="post" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- update rationale -->
         <xforms:submission id="update-ci-rationale" ref="instance('selected-ci')/rationale" resource="{$terminology-exist}/ica/modules/update-rich-text.xquery" method="post" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- update cic mapping -->
         <xforms:submission id="update-cic-mapping" ref="instance('selected-ci')/cic" resource="{$terminology-exist}/ica/modules/update-ci-mapping.xquery" method="post" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- update icpc mapping -->
         <xforms:submission id="update-icpc-mapping" ref="instance('selected-ci')/icpc[index('icpc')]" resource="{$terminology-exist}/ica/modules/update-ci-mapping.xquery" method="post" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- update icd9 mapping -->
         <xforms:submission id="update-icd9-mapping" ref="instance('selected-ci')/icd-9[index('icd9')]" resource="{$terminology-exist}/ica/modules/update-ci-mapping.xquery" method="post"
            replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- update shb-ci mapping -->
         <xforms:submission id="update-shb-ci-mapping" ref="instance('selected-ci')/shb-ci[index('shb-ci')]" resource="{$terminology-exist}/ica/modules/update-ci-mapping.xquery" method="post"
            replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- delete icpc mapping -->
         <xforms:submission id="delete-icpc-mapping" serialization="none" method="get"
            resource="{$terminology-exist}/ica/modules/delete-ci-mapping.xquery?id={instance('selected-ci')/icpc[index('icpc')]/@id}" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done"/>
         </xforms:submission>
         <!-- delete icd9 mapping -->
         <xforms:submission id="delete-icd9-mapping" serialization="none" method="get"
            resource="{$terminology-exist}/ica/modules/delete-ci-mapping.xquery?id={instance('selected-ci')/icd-9[index('icd9')]/@id}" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done"/>
         </xforms:submission>
         <!-- delete icd10 mapping -->
         <xforms:submission id="delete-icd10-mapping" serialization="none" method="get"
            resource="{$terminology-exist}/ica/modules/delete-ci-mapping.xquery?id={instance('selected-ci')/icd-10[index('icd10')]/@id}" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done"/>
         </xforms:submission>
         <!-- delete snomed mapping -->
         <xforms:submission id="delete-snomed-mapping" serialization="none" method="get"
            resource="{$terminology-exist}/ica/modules/delete-ci-mapping.xquery?id={instance('selected-ci')/snomed[index('snomed')]/@id}" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done"/>
         </xforms:submission>
         <!-- delete shb-ci mapping -->
         <xforms:submission id="delete-shb-ci-mapping" serialization="none" method="get"
            resource="{$terminology-exist}/ica/modules/delete-ci-mapping.xquery?id={instance('selected-ci')/shb-ci[index('shb-ci')]/@id}" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done"/>
         </xforms:submission>
         <!-- create icpc mapping -->
         <xforms:submission id="create-icpc-mapping" serialization="none" method="get"
            resource="{$terminology-exist}/ica/modules/create-ci-mapping.xquery?ciId={instance('selected-ci')/@id}&amp;type=icpc" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done"/>
         </xforms:submission>
         <!-- create icd9 mapping -->
         <xforms:submission id="create-icd9-mapping" serialization="none" method="get"
            resource="{$terminology-exist}/ica/modules/create-ci-mapping.xquery?ciId={instance('selected-ci')/@id}&amp;type=icd9" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done"/>
         </xforms:submission>
         <!-- create icd10 mapping -->
         <xforms:submission id="create-icd10-mapping" serialization="none" method="get"
            resource="{$terminology-exist}/ica/modules/create-ci-mapping.xquery?ciId={instance('selected-ci')/@id}&amp;type=icd10&amp;code={instance('class')/@code}&amp;desc={instance('class')/Rubric[@kind='preferred']/Label[1]}"
            replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done"/>
         </xforms:submission>
         <!-- create snomed mapping -->
         <xforms:submission id="create-snomed-mapping" serialization="none" method="get"
            resource="{$terminology-exist}/ica/modules/create-ci-mapping.xquery?ciId={instance('selected-ci')/@id}&amp;type=snomed&amp;code={instance('snomed-concept')/concept/@conceptId}&amp;desc={instance('snomed-concept')/concept/desc[@type='fsn']}"
            replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done"/>
         </xforms:submission>
         <!-- create shb-ci mapping -->
         <xforms:submission id="create-shb-ci-mapping" serialization="none" method="get"
            resource="{$terminology-exist}/ica/modules/create-ci-mapping.xquery?ciId={instance('selected-ci')/@id}&amp;type=shb-ci" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done"/>
         </xforms:submission>

         <!-- **** STATUS CHANGE**** -->
         <!-- status change -->
         <xforms:instance id="status-change" xxforms:exclude-result-prefixes="#all">
            <statusChange object="" ref="" statusCode="" effectiveDate="" expirationDate=""/>
         </xforms:instance>
         <xforms:bind nodeset="instance('status-change')/@effectiveDate" type="xforms:date"/>
         <xforms:bind nodeset="instance('status-change')/@expirationDate" type="xforms:date" constraint=".&gt;../@effectiveDate or .='' or ../@effectiveDate=''"/>
         <!-- status change validity -->
         <xforms:instance id="status-change-valid" xxforms:exclude-result-prefixes="#all">
            <valid/>
         </xforms:instance>
         <!-- event observer for new release validity -->
         <xforms:action ev:event="xxforms-invalid" ev:observer="status-change">
            <xforms:setvalue ref="instance('status-change-valid')" value="'false'"/>
         </xforms:action>
         <xforms:action ev:event="xxforms-valid" ev:observer="status-change">
            <xforms:setvalue ref="instance('status-change-valid')" value="'true'"/>
         </xforms:action>
         <xforms:bind nodeset="instance('status-change-valid')" readonly=".='false'"/>
         <!-- status change response -->
         <xforms:instance id="status-change-response" xxforms:exclude-result-prefixes="#all">
            <response/>
         </xforms:instance>
         <!-- set status code -->
         <xforms:submission id="set-status" ref="instance('status-change')" resource="{$terminology-exist}/ica/modules/set-ci-object-status.xquery" method="post" replace="instance"
            xxforms:instance="status-change-response" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done">
               <xforms:send submission="get-ci"/>
            </xforms:action>
         </xforms:submission>



         <!-- RELEASE -->
         <!-- new release -->
         <xforms:instance id="new-release" xxforms:exclude-result-prefixes="#all">
            <release effectiveTime="" statusCode="draft" label="">
               <comment/>
            </release>
         </xforms:instance>
         <xforms:bind nodeset="instance('new-release')/@effectiveTime" type="xforms:dateTime" required="true()"/>
         <xforms:bind nodeset="instance('new-release')/@label" required="true()"/>
         <!-- new release validity -->
         <xforms:instance id="new-release-valid" xxforms:exclude-result-prefixes="#all">
            <valid/>
         </xforms:instance>
         <!-- event observer for new release validity -->
         <xforms:action ev:event="xxforms-invalid" ev:observer="new-release">
            <xforms:setvalue ref="instance('new-release-valid')" value="'false'"/>
         </xforms:action>
         <xforms:action ev:event="xxforms-valid" ev:observer="new-release">
            <xforms:setvalue ref="instance('new-release-valid')" value="'true'"/>
         </xforms:action>
         <xforms:bind nodeset="instance('new-release-valid')" readonly=".='false'"/>
         <!-- thesaurus info-->
         <xforms:instance id="ci-list-info" xxforms:exclude-result-prefixes="#all">
            <thesaurusInfo/>
         </xforms:instance>
         <xforms:submission id="check-ci-list" serialization="none" method="get" resource="{$terminology-exist}/ica/modules/check-ci-list.xquery" replace="instance" instance="ci-list-info"/>
         <!-- create-new release -->
         <xforms:submission id="create-release" ref="instance('new-release')" resource="{$terminology-exist}/ica/modules/create-release.xquery" method="post" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done"/>
         </xforms:submission>

         <!-- add release info -->
         <xforms:submission id="add-release-info" ref="instance('new-release')" resource="{$terminology-exist}/ica/modules/add-release-info.xquery" method="post" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done"/>
         </xforms:submission>
         <!-- delete release -->
         <xforms:submission id="delete-release" ref="instance('project')/release[index('releases')]" resource="{$terminology-exist}/ica/modules/delete-release.xquery" method="post" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done"/>
         </xforms:submission>
         <!-- release notes-->
         <xforms:instance id="release-notes" xxforms:exclude-result-prefixes="#all">
            <releaseNotes/>
         </xforms:instance>
         <!--         <xforms:submission id="get-release-notes" ref="instance('project')/release[index('releases')]" resource="{$terminology-exist}/ica/modules/get-release-notes.xquery" method="post"
            replace="instance" xxforms:instance="release-notes">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>-->
         <xforms:submission id="get-release-notes" serialization="none"
            resource="{$terminology-exist}/ica/modules/get-release-notes.xquery?effectiveTime={instance('project')/release[index('releases')]/@effectiveTime}" method="get" instance="release-notes"
            replace="instance">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>


         <!-- *** ISSUES *** -->
         <!-- instance for existing issues -->
         <xforms:instance id="ica-issues">
            <dummy/>
         </xforms:instance>
         <!-- get issues submission -->
         <xforms:submission id="get-ica-issues" serialization="none" method="get" resource="{$terminology-exist}/ica/modules/get-ica-issues.xquery" replace="instance" instance="ica-issues"/>
         <!-- instance for creating issue -->
         <xforms:instance id="issue-instance" xxforms:exclude-result-prefixes="#all">
            <issues>
               <issue id="" priority="N" displayName="" type="RFC" refsetId="">
                  <object id="" type="" effectiveDate=""/>
                  <tracking effectiveDate="" statusCode="new">
                     <author id=""/>
                     <desc language=""/>
                  </tracking>
               </issue>
            </issues>
         </xforms:instance>
         <!-- instance for creating tracking -->
         <xforms:instance id="tracking-instance" xxforms:exclude-result-prefixes="#all">
            <issue>
               <tracking effectiveDate="" statusCode="open">
                  <author id=""/>
                  <desc language=""/>
               </tracking>
            </issue>
         </xforms:instance>
         <!-- instance for creating assignment -->
         <xforms:instance id="assignment-instance" xxforms:exclude-result-prefixes="#all">
            <issue>
               <assignment to="" name="" effectiveDate="">
                  <author id=""/>
                  <desc language=""/>
               </assignment>
            </issue>
         </xforms:instance>
         <!-- instance for holding newly created issues -->
         <xforms:instance id="issues-instance" xxforms:exclude-result-prefixes="#all">
            <issues>
               <issue/>
            </issues>
         </xforms:instance>
         <!-- instance for selected issue -->
         <xforms:instance id="selected-issue">
            <selected>
               <selected/>
               <unassigned/>
               <open/>
               <inprogress/>
               <feedback/>
               <closed/>
            </selected>
         </xforms:instance>
         <!-- instance for issues -->
         <xforms:instance id="selected-status-codes">
            <selected>open</selected>
         </xforms:instance>
         <!-- instance for issues -->
         <xforms:instance id="selected-issue-types">
            <selected>RFC INC CLF</selected>
         </xforms:instance>
         <!-- instance for issues -->
         <xforms:instance id="selected-issue-priorities">
            <selected/>
         </xforms:instance>
         <!-- instance for issues -->
         <xforms:instance id="selected-issue-assignee">
            <selected/>
         </xforms:instance>
         <!-- instance for issues -->
         <xforms:instance id="selected-issue-id">
            <selected/>
         </xforms:instance>
         <!-- save issue submission -->
         <xforms:submission id="save-ica-issue" ref="instance('issues-instance')/issue[object/@id=instance('ci-navigation')]" action="{$terminology-exist}/ica/modules/save-ica-issue.xquery"
            method="post" replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">A submission error occurred:<xforms:output value="event('error-type')"/>
            </xforms:message>
         </xforms:submission>
         <!-- save general issue submission -->
         <xforms:submission id="save-general-ica-issue" ref="instance('issues-instance')/issue[tracking][not(object)]" action="{$terminology-exist}/ica/modules/save-ica-issue.xquery" method="post"
            replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">A submission error occurred:<xforms:output value="event('error-type')"/>
            </xforms:message>
         </xforms:submission>
         <!-- update issue submission -->
         <xforms:submission id="update-ica-issue" ref="instance('ica-issues')/issue[@id=instance('selected-issue')/selected]" action="{$terminology-exist}/ica/modules/update-ica-issue.xquery"
            method="post" replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">A submission error occurred:<xforms:output value="event('error-type')"/>
            </xforms:message>
         </xforms:submission>

         <!-- *** SNOMED SEARCH *** -->
         <!-- instance for SNOMED CT concept -->
         <xforms:instance id="snomed-concept-instance">
            <result current="1" count="1">
               <description count="3" length="17" effectiveTime="20030731" conceptId="138875005" caseSignificanceId="900000000000017005" type="pref" fullName="SNOMED CT Concept (SNOMED RT+CTV3)"
                  >SNOMED CT Concept</description>
            </result>
         </xforms:instance>
         <!-- instance for selected concept -->
         <xforms:instance id="snomed-concept-navigation">
            <id>138875005</id>
         </xforms:instance>
         <!-- instance for description search string -->
         <xforms:instance id="snomed-description-search">
            <root>
               <search/>
            </root>
         </xforms:instance>
         <!-- instance for description itemset -->
         <xforms:instance id="snomed-description-itemset">
            <result current="1" count="1">
               <description count="3" length="17" effectiveTime="20030731" conceptId="138875005" caseSignificanceId="900000000000017005" type="pref" fullName="SNOMED CT Concept (SNOMED RT+CTV3)"
                  >SNOMED CT Concept</description>
            </result>
         </xforms:instance>
         <!-- submission for loading description -->
         <xforms:submission id="get-snomed-concept-description" serialization="none" method="get" resource="{$terminology-exist}/snomed/getDescription/{instance('snomed-concept-navigation')}"
            replace="instance" instance="snomed-description-itemset"/>
         <!-- instance for concept -->
         <xforms:instance id="snomed-concept">
            <dummy/>
         </xforms:instance>
         <!-- submission for loading concept -->
         <xforms:submission id="get-snomed-concept" serialization="none" method="get" resource="{$terminology-exist}/snomed/getConcept/{instance('snomed-concept-navigation')}" replace="instance"
            instance="snomed-concept" xxforms:readonly="true"/>
         <!-- submission for updating resultset -->
         <xforms:submission id="update-snomed-descriptions" ref="instance('snomed-description-search')"
            action="{$terminology-exist}/snomed/searchDescription/{instance('snomed-description-search')/search}" method="get" instance="snomed-description-itemset" replace="instance"/>

         <!-- GROUP CHOICE -->
         <!-- selected-group -->
         <xforms:instance id="selected-group">
            <collection>icd10-data</collection>
         </xforms:instance>
         <xforms:instance id="special-groups">
            <classifications>
               <group collection="snomed-data" name="Snomed CT" isGroup="false">
                  <classification id="2.16.840.1.113883.6.96" name="Snomed CT">Snomed CT</classification>
               </group>
               <group collection="loinc-data" name="LOINC" isGroup="false">
                  <classification id="2.16.840.1.113883.6.1" name="LOINC">LOINC</classification>
               </group>
            </classifications>
         </xforms:instance>
         <!-- *** CLAML SEARCH *** -->
         <!-- instance for selected classification collection -->
         <xforms:instance id="collection">
            <name/>
         </xforms:instance>
         <!-- instance for selected classificationId -->
         <xforms:instance id="classificationId">
            <name>2010-0215-1621-2137</name>
         </xforms:instance>
         <xforms:action ev:observer="classificationId" ev:event="xxforms-value-changed">
            <xforms:send submission="get-claml-hierarchy"/>
            <xforms:setvalue ref="instance('hierarchy-navigation')" value="instance('claml-instance')/Class[1]/@id"/>
            <xxforms:variable name="selection"
               select="if (instance('classification-list')//classification[@id=instance('classificationId')][@language=instance('language')]) then instance('classification-list')//classification[@id=instance('classificationId')][@language=instance('language')][1] else (instance('classification-list')//classification[@id=instance('classificationId')][1])"/>
            <xforms:setvalue ref="instance('new-concept-association')/@codeSystem" value="$selection/@id"/>
            <xforms:setvalue ref="instance('new-concept-association')/@codeSystemName" value="$selection/@name"/>
            <!--                        <xforms:send submission="get-class"/>-->
         </xforms:action>
         <!-- instance for selected classification of group -->
         <xforms:instance id="selected-classification">
            <name/>
         </xforms:instance>
         <!-- instance for classification list -->
         <xforms:instance id="classification-list">
            <classifications/>
         </xforms:instance>
         <xforms:submission id="get-classification-list" serialization="none" method="get" resource="{$terminology-exist}/claml/classification-index.xml" replace="instance"
            instance="classification-list"/>
         <!-- instance for selected class -->
         <xforms:instance id="class-navigation">
            <id/>
         </xforms:instance>
         <!-- instance for selected class in hierarchy -->
         <xforms:instance id="hierarchy-navigation">
            <id/>
         </xforms:instance>
         <!-- instance for class -->
         <xforms:instance id="class">
            <dummy/>
         </xforms:instance>
         <xforms:submission id="get-class" serialization="none" method="get"
            resource="{$terminology-exist}/claml/RetrieveClass?classificationId={instance('classificationId')}&amp;code={instance('claml-instance')//*[@id=instance('hierarchy-navigation')][1]/@code}"
            replace="instance" instance="class"/>
         <!-- instance for description search string -->
         <xforms:instance id="claml-search">
            <search/>
         </xforms:instance>
         <!-- instance for description itemset -->
         <xforms:instance id="claml-description-itemset">
            <result current="0" count="0"/>
         </xforms:instance>
         <!-- instance for claml hierarchy -->
         <xforms:instance id="claml-instance">
            <dummy/>
         </xforms:instance>
         <xforms:submission id="get-claml-hierarchy" serialization="none" method="get"
            resource="{$terminology-exist}/claml/modules/get-class-for-hierarchy.xquery?classificationId={instance('classificationId')}&amp;code={instance('class-navigation')}" replace="instance"
            instance="claml-instance">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:action xxforms:iterate="instance('claml-instance')/Class|instance('claml-instance')//SubClass">
                  <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('id',random())"/>
               </xforms:action>
            </xforms:action>
         </xforms:submission>
         <xforms:instance id="subclasses">
            <dummy/>
         </xforms:instance>
         <xforms:submission id="expand-tree-submission" serialization="none" method="get"
            resource="{$terminology-exist}/claml/RetrieveSubClasses?classificationId={instance('classificationId')}&amp;code={instance('claml-instance')//*[@id=instance('hierarchy-navigation')][1]/@code}"
            replace="instance" instance="subclasses"/>
         <xforms:submission id="update-claml-descriptions" ref="instance('claml-search')"
            action="{$terminology-exist}/claml/SearchDescription?classificationId={instance('classificationId')}&amp;string={instance('claml-search')}" method="get"
            instance="claml-description-itemset" replace="instance"/>
         <xforms:setfocus ev:event="xforms-ready" control="navigate"/>
         <xforms:action ev:event="xforms-model-construct-done">
            <xforms:send submission="get-resources-submission"/>
            <xforms:setvalue ref="instance('language')" value="if (string-length(xxforms:get-session-attribute('language'))&gt;0) then (xxforms:get-session-attribute('language')) else (instance('resources-instance')//resources[1]/@xml:lang/string())"/>
            <xforms:insert context="." origin="xxforms:set-session-attribute('language', instance('language'))"/>
            <xforms:send submission="get-users-submission"/>
            <xforms:send submission="get-decor-types"/>
            <xforms:send submission="get-project"/>
            <xforms:send submission="get-ci-list"/>
            <xforms:send submission="get-ica-issues"/>
            <xforms:send submission="get-classification-list"/>
            <xforms:send submission="get-claml-hierarchy"/>
         </xforms:action>
         <xxforms:script ev:event="xforms-ready"
            >
            window.onbeforeunload = function() {
            if (ORBEON.xforms.Document.getValue('data-safe-input') != 'true')
            return "Deze tekst kunnen we aanpassen.";
            }
         </xxforms:script>
         <xforms:action ev:event="xforms-ready">
            <xforms:setvalue ref="instance('ci-navigation')" value="if (count(xxforms:evaluate(instance('ica-nodeset')))&gt;0) then xxforms:evaluate(instance('ica-nodeset'))[1]/@id else ('')"/>
            <xforms:send submission="get-release-notes"/>
            <xforms:setvalue ref="instance('data-safe')">true</xforms:setvalue>
            <xforms:setvalue ref="instance('list-safe')">true</xforms:setvalue>
            <xforms:setvalue ref="instance('project-safe')">true</xforms:setvalue>
         </xforms:action>
         <xxforms:variable name="resources" select="instance('resources-instance')//resources[1]"/>
         <xxforms:variable name="editor" select="instance('project')/author[@username=xxforms:get-session-attribute('username')][@edit='true']"/>
         <xxforms:variable name="issueCreator" select="instance('project')/author[@username=xxforms:get-session-attribute('username')][@issues='true']"/>
         <xxforms:variable name="authorize" select="instance('project')/author[@username=xxforms:get-session-attribute('username')][@authorize='true']"/>
         <xxforms:variable name="admin" select="instance('project')/author[@username=xxforms:get-session-attribute('username')][@admin='true']"/>
         <xxforms:variable name="isGroup" select="instance('classification-list')/group[@collection=instance('selected-group')]/@isGroup='true'"/>
      </xforms:model>
   </xhtml:head>
   <xhtml:body>
      <!-- special output used to give warning if user leaves page -->
      <xforms:output ref="instance('data-safe')" id="data-safe-input" style="display: none"/>
      <!-- dialog for selecting Art user -->
      <xxforms:dialog id="select-user-dialog" appearance="full" level="modeless" close="false" draggable="true" visible="false">
         <xforms:label ref="$resources/select-user"/>
         <xhtml:table width="250px">
            <xhtml:tr>
               <xhtml:td class="heading">
                  <xforms:output ref="$resources/select-user"/>
               </xhtml:td>
            </xhtml:tr>
            <xhtml:tr>
               <xhtml:td>
                  <xhtml:div class="navigate-small">
                     <xforms:select1 ref="instance('author-instance')/@username" appearance="compact" id="user-select">
                        <xforms:itemset nodeset="instance('users-instance')/user">
                           <xforms:label ref="displayName"/>
                           <xforms:value ref="@name"/>
                        </xforms:itemset>
                        <xforms:action ev:event="xforms-value-changed">
                           <xforms:setvalue ref="instance('author-instance')" value="instance('users-instance')/user[@name=instance('author-instance')/@username]/displayName"/>
                        </xforms:action>
                     </xforms:select1>
                  </xhtml:div>
               </xhtml:td>
            </xhtml:tr>
            <xhtml:tr>
               <xhtml:td>
                  <xhtml:div class="buttons">
                     <fr:button>
                        <xforms:label ref="$resources/cancel"/>
                        <xforms:action ev:event="DOMActivate">
                           <xxforms:hide ev:event="DOMActivate" dialog="select-user-dialog"/>
                        </xforms:action>
                     </fr:button>
                     <fr:button>
                        <xforms:label ref="$resources/add"/>
                        <xforms:action ev:event="DOMActivate">
                           <xxforms:variable name="newId" select="max(instance('project')/project/author/@id)+1"/>
                           <xforms:setvalue ref="instance('author-instance')/@id" value="$newId"/>
                           <xforms:insert context="instance('project')" nodeset="author" at="index('authorList')" position="after" origin="instance('author-instance')"/>
                           <xxforms:hide ev:event="DOMActivate" dialog="select-user-dialog"/>
                        </xforms:action>
                     </fr:button>
                  </xhtml:div>
               </xhtml:td>
            </xhtml:tr>
         </xhtml:table>
      </xxforms:dialog>
      <xxforms:dialog id="help-dialog" appearance="full" level="modeless" close="true" draggable="true" visible="false">
         <xforms:label ref="$resources/help"/>
         <xhtml:table width="100%">
            <xhtml:tr>
               <xhtml:td>
                  <xforms:output mediatype="text/html" ref="xxforms:serialize(instance('help-instance')/search[@language=instance('language')], 'html')"/>
               </xhtml:td>
            </xhtml:tr>
            <xhtml:tr>
               <xhtml:td>
                  <xhtml:div style="float:right">
                     <fr:button>
                        <xforms:label ref="$resources/close"/>
                        <xforms:action ev:event="DOMActivate">
                           <xxforms:hide ev:event="DOMActivate" dialog="help-dialog"/>
                        </xforms:action>
                     </fr:button>
                  </xhtml:div>
               </xhtml:td>
            </xhtml:tr>
         </xhtml:table>
      </xxforms:dialog>
      <xxforms:dialog id="snomed-select" appearance="full" level="modeless" close="false" draggable="true" visible="false">
         <xforms:label ref="$resources/snomed-ct"/>
         <xhtml:table width="100%" style="border:1px solid #CCC;">
            <xhtml:tr>
               <xhtml:td width="10%" colspan="2">
                  <xforms:group>
                     <xhtml:table width="100%">
                        <xhtml:tr>
                           <xhtml:td class="item-label">
                              <xforms:output ref="$resources/searchterms"/>
                              <xforms:trigger appearance="minimal" id="snomed-refresh">
                                 <xforms:label class="control-label">
                                    <xhtml:img src="/img/arrow_refresh.png" alt="" align="right"/>
                                 </xforms:label>
                                 <xforms:action ev:event="DOMActivate">
                                    <xforms:setvalue ref="instance('snomed-description-search')/search" value="''"/>
                                    <xforms:setvalue ref="instance('snomed-concept-navigation')" value="'138875005'"/>
                                    <xforms:send submission="get-snomed-concept-description"/>
                                    <xforms:setfocus control="search-description"/>
                                 </xforms:action>
                              </xforms:trigger>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input class="top" ref="instance('snomed-description-search')/search" id="search-snomed-description" incremental="true">
                                 <xforms:action ev:event="xforms-value-changed">
                                    <xxforms:variable name="search-value" select="."/>
                                    <xxforms:variable name="make-suggestion"
                                       select="(string-length($search-value) &gt;= 4 and not(matches($search-value,'^[A-Z]|\s$|\s[a-z|0-9]$'))) or (string-length($search-value) &gt;= 2 and not(matches($search-value,'^[a-z]|\s$')))  or matches($search-value,'^[0-9]+')"/>
                                    <xforms:action if="$make-suggestion">
                                       <xforms:send submission="update-snomed-descriptions"/>
                                       <xforms:action if="xxforms:index('descriptions')&gt;1">
                                          <xforms:setindex repeat="descriptions" index="1"/>
                                       </xforms:action>
                                    </xforms:action>
                                 </xforms:action>
                              </xforms:input>
                           </xhtml:td>
                           <xhtml:td style="vertical-align:middle;"/>
                           <xhtml:td> </xhtml:td>
                        </xhtml:tr>
                     </xhtml:table>
                  </xforms:group>
                  <xhtml:p/>
                  <xforms:group ref="instance('snomed-description-itemset')">
                     <xhtml:div class="h2">
                        <xforms:output ref="$resources/results"/>
                        <xxforms:variable name="resultCount" select="count(description)"/>
                        (
                        <xforms:output ref="@current"/>
                        <xforms:output ref="$resources/of"/>
                        <xforms:output ref="@count"/>
                        )
                     </xhtml:div>
                     <xhtml:div class="navigate-seven">
                        <xhtml:table width="100%">
                           <xforms:repeat nodeset="instance('snomed-description-itemset')/description" id="descriptions">
                              <xhtml:tr>
                                 <xhtml:td style="text-align:center;background-color:#ebe7e1;padding-right:0.4em;padding-left:0.4em;width:1%;margin-right:0.5em;">
                                    <xforms:output ref="if (@type='pref') then 'P' else('S')">
                                       <xforms:hint>P = Preferred, S = Synonym</xforms:hint>
                                    </xforms:output>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xforms:output ref="."/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xforms:output ref="@fullName"/>
                                 </xhtml:td>
                              </xhtml:tr>
                              <xforms:action ev:event="xxforms-index-changed">
                                 <xforms:action if="instance('snomed-concept-navigation')!=instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId">
                                    <xforms:setvalue ref="instance('snomed-concept-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
                                    <xforms:send submission="get-snomed-concept"/>
                                    <xforms:setvalue ref="instance('new-concept-association')/@code" value="instance('snomed-concept')/concept/@conceptId"/>
                                    <xforms:setvalue ref="instance('new-concept-association')/@displayName" value="instance('snomed-concept')/concept/desc[@type='pref'][@active]"/>
                                 </xforms:action>
                              </xforms:action>
                              <xforms:action ev:event="xxforms-nodeset-changed">
                                 <xforms:action if="instance('snomed-concept-navigation')!=instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId">
                                    <xforms:setvalue ref="instance('snomed-concept-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
                                    <xforms:send submission="get-snomed-concept"/>
                                    <xforms:setvalue ref="instance('new-concept-association')/@code" value="instance('snomed-concept')/concept/@conceptId"/>
                                    <xforms:setvalue ref="instance('new-concept-association')/@displayName" value="instance('snomed-concept')/concept/desc[@type='pref'][@active]"/>
                                 </xforms:action>
                              </xforms:action>
                           </xforms:repeat>
                        </xhtml:table>
                     </xhtml:div>
                  </xforms:group>
               </xhtml:td>
            </xhtml:tr>
            <xhtml:tr>
               <xhtml:td colspan="2">
                  <xhtml:table width="100%">
                     <!-- table row with master-detail columns -->
                     <xhtml:tr>
                        <!-- left column with tree concept-navigation -->
                        <xhtml:td width="40%">
                           <!-- table for tree concept-navigation components -->
                           <xhtml:table width="100%">
                              <xhtml:tr>
                                 <xhtml:td>
                                    <!-- heading for tree control with add, insert and delete icons 
                                       icons in reverse order of appearance because of align="right"
                                    -->
                                    <xhtml:div class="navigate-container">
                                       <xhtml:div class="h2">
                                          <xforms:output ref="$resources/hierarchy"/>
                                       </xhtml:div>
                                       <xhtml:div class="{if (count(instance('snomed-concept')//dest)&gt;20) then 'navigate-small' else 'navigate-max'}">
                                          <xforms:select1 ref="instance('snomed-concept-navigation')" appearance="xxforms:tree">
                                             <xforms:itemset nodeset="instance('snomed-concept')//*[name()='concept' or (name()='dest' and @type='Is a')]" xxforms:open="false"
                                                class="{if (@type ='group') then 'node-concept-group' else if (@type ='item' and issue) then 'node-condept-error' else 'node-concept'}">
                                                <xforms:label ref="if (@conceptId) then desc[@type='pref'] else concat(.,' (',@subCount,')') "/>
                                                <xforms:value ref="if (@conceptId) then @conceptId else @sourceId "/>
                                             </xforms:itemset>
                                             <xforms:action ev:event="xforms-value-changed">
                                                <xforms:send submission="get-snomed-concept"/>
                                             </xforms:action>
                                          </xforms:select1>
                                       </xhtml:div>
                                    </xhtml:div>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xhtml:table>
                        </xhtml:td>
                        <!-- concept details -->
                        <xhtml:td width="60%">
                           <xhtml:table width="100%">
                              <xhtml:tr>
                                 <xhtml:td>
                                    <xhtml:div class="detail">
                                       <xforms:group ref="instance('snomed-concept')/concept">
                                          <xhtml:div class="h2 {if (not(@active)) then 'alert' else ''}">
                                             <xforms:output ref="@conceptId"/> - <xforms:output ref="desc[@type='pref'][@active]"/>
                                          </xhtml:div>
                                          <xhtml:table width="100%">
                                             <xhtml:tr>
                                                <xhtml:td class="item-label">
                                                   <xforms:output ref="$resources/full-name"/>
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:output ref="desc[@type='fsn'][@active]"/>
                                                </xhtml:td>
                                             </xhtml:tr>
                                             <!-- concept synonyms -->
                                             <xhtml:tr>
                                                <xhtml:td class="item-label">
                                                   <xforms:output ref="$resources/synonyms"/>
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xhtml:table width="100%">
                                                      <xforms:repeat nodeset="desc[@type='syn'][@active]" id="synonyms">
                                                         <xhtml:tr class="not-selectable">
                                                            <xhtml:td>
                                                               <xforms:output ref="."/>
                                                            </xhtml:td>
                                                         </xhtml:tr>
                                                      </xforms:repeat>
                                                   </xhtml:table>
                                                </xhtml:td>
                                             </xhtml:tr>
                                          </xhtml:table>
                                          <xhtml:div class="h2">
                                             <xforms:output ref="$resources/definition"/> (<xforms:output ref="@definitionStatus"/>)
                                          </xhtml:div>
                                          <!-- concept definitions -->
                                          <xhtml:table width="100%">
                                             <xforms:repeat nodeset="grp[@grp='0']" id="group">
                                                <xhtml:tr class="not-selectable">
                                                   <xhtml:td width="90%">
                                                      <xhtml:table width="100%">
                                                         <xforms:repeat nodeset="src[@typeId='116680003'][@active]" id="sourcesIsA">
                                                            <xhtml:tr class="not-selectable">
                                                               <xhtml:td width="40%" class="floating-label">
                                                                  <xforms:output ref="@type"/>
                                                               </xhtml:td>
                                                               <xhtml:td width="60%">
                                                                  <xforms:trigger appearance="minimal">
                                                                     <xforms:label ref="."/>
                                                                     <xforms:action ev:event="DOMActivate">
                                                                        <xforms:setvalue ref="instance('snomed-concept-navigation')" value="xxforms:repeat-current('sourcesIsA')/@destinationId"/>
                                                                        <xforms:send submission="get-snomed-concept"/>
                                                                     </xforms:action>
                                                                  </xforms:trigger>
                                                               </xhtml:td>
                                                            </xhtml:tr>
                                                         </xforms:repeat>
                                                         <xforms:repeat nodeset="src[@typeId!='116680003'][@active]" id="sources">
                                                            <xhtml:tr class="not-selectable">
                                                               <xhtml:td width="40%" class="floating-label">
                                                                  <xforms:output ref="@type"/>
                                                               </xhtml:td>
                                                               <xhtml:td width="60%">
                                                                  <xforms:trigger appearance="minimal">
                                                                     <xforms:label ref="."/>
                                                                     <xforms:action ev:event="DOMActivate">
                                                                        <xforms:setvalue ref="instance('snomed-concept-navigation')" value="xxforms:repeat-current('sources')/@destinationId"/>
                                                                        <xforms:send submission="get-snomed-concept"/>
                                                                     </xforms:action>
                                                                  </xforms:trigger>
                                                               </xhtml:td>
                                                            </xhtml:tr>
                                                         </xforms:repeat>
                                                      </xhtml:table>
                                                   </xhtml:td>
                                                </xhtml:tr>
                                             </xforms:repeat>
                                          </xhtml:table>
                                          <xhtml:table width="100%">
                                             <xforms:repeat nodeset="grp[@grp!='0']" id="groups">
                                                <xhtml:tr class="not-selectable">
                                                   <xhtml:td class="floating-label">
                                                      <xforms:output ref="$resources/group"/>
                                                   </xhtml:td>
                                                   <xhtml:td width="90%">
                                                      <xhtml:table width="100%">
                                                         <xforms:repeat nodeset="src[@active]" id="grpSources">
                                                            <xhtml:tr class="not-selectable">
                                                               <xhtml:td width="40%" class="floating-label">
                                                                  <xforms:output ref="@type"/>
                                                               </xhtml:td>
                                                               <xhtml:td width="60%">
                                                                  <xforms:trigger appearance="minimal">
                                                                     <xforms:label ref="."/>
                                                                     <xforms:action ev:event="DOMActivate">
                                                                        <xforms:setvalue ref="instance('snomed-concept-navigation')" value="xxforms:repeat-current('grpSources')/@destinationId"/>
                                                                        <xforms:send submission="get-snomed-concept"/>
                                                                     </xforms:action>
                                                                  </xforms:trigger>
                                                               </xhtml:td>
                                                            </xhtml:tr>
                                                         </xforms:repeat>
                                                      </xhtml:table>
                                                   </xhtml:td>
                                                </xhtml:tr>
                                             </xforms:repeat>
                                          </xhtml:table>
                                       </xforms:group>
                                    </xhtml:div>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xhtml:table>
                        </xhtml:td>
                     </xhtml:tr>
                  </xhtml:table>
               </xhtml:td>
            </xhtml:tr>
            <xhtml:tr>
               <xhtml:td>
                  <xhtml:div class="buttons">
                     <fr:button>
                        <xforms:label ref="$resources/cancel"/>
                        <xforms:action ev:event="DOMActivate">
                           <xxforms:hide ev:event="DOMActivate" dialog="snomed-select"/>
                        </xforms:action>
                     </fr:button>
                     <fr:button>
                        <xforms:label ref="$resources/add"/>
                        <xforms:action ev:event="DOMActivate">
                           <xforms:send submission="create-snomed-mapping"/>
                           <xforms:send submission="get-ci"/>
                           <xxforms:hide ev:event="DOMActivate" dialog="snomed-select"/>
                        </xforms:action>
                     </fr:button>
                  </xhtml:div>
               </xhtml:td>
            </xhtml:tr>
         </xhtml:table>
      </xxforms:dialog>
      <xxforms:dialog id="icd-10-select" appearance="full" level="modeless" close="false" draggable="true" visible="false">
         <xforms:label ref="$resources/icd-10"/>
         <xhtml:table width="100%" style="border:1px solid #CCC;">
            <!-- row with search input and results table -->
            <xhtml:tr>
               <xhtml:td width="10%" colspan="2">
                  <!-- Group with codesystem selection -->
                  <xforms:group ref=".[$isGroup]">
                     <xhtml:table width="100%" style="margin-bottom:1em;border:solid 1px #CCC;">
                        <xhtml:tr>
                           <xhtml:td class="item-label">
                              <xforms:output ref="$resources/codesystems"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xhtml:div style="height:10em;">
                                 <xforms:select1 ref="instance('selected-classification')" appearance="compact">
                                    <xforms:itemset nodeset="instance('classification-list')//classification[@package=instance('selected-group')]">
                                       <xforms:label ref="@name"/>
                                       <xforms:value ref="@id"/>
                                    </xforms:itemset>
                                    <xforms:action ev:event="xforms-value-changed">
                                       <xforms:setvalue ref="instance('class-navigation')" value="''"/>
                                       <xforms:setvalue ref="instance('classificationId')" value="instance('selected-classification')"/>
                                    </xforms:action>
                                 </xforms:select1>
                              </xhtml:div>
                           </xhtml:td>
                        </xhtml:tr>
                     </xhtml:table>
                  </xforms:group>
                  <xhtml:table width="100%">
                     <xhtml:tr>
                        <xhtml:td width="70%">
                           <!-- SEARCH INPUT -->
                           <xforms:group>
                              <xhtml:table width="100%">
                                 <xhtml:tr>
                                    <xhtml:td class="item-label">
                                       <xforms:output ref="$resources/searchterms"/>
                                       <xforms:trigger appearance="minimal">
                                          <xforms:label class="control-label">
                                             <xhtml:img src="/img/arrow_refresh.png" alt="" align="right"/>
                                          </xforms:label>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:setvalue ref="instance('claml-search')" value="''"/>
                                             <xforms:setvalue ref="instance('class-navigation')" value="''"/>
                                             <xforms:delete ref="instance('claml-description-itemset')/description"/>
                                             <xforms:send submission="get-claml-hierarchy"/>
                                             <xforms:setfocus control="claml-search-input"/>
                                          </xforms:action>
                                       </xforms:trigger>
                                    </xhtml:td>
                                    <xhtml:td>
                                       <xforms:input class="top" ref="instance('claml-search')" id="claml-search-input" incremental="true">
                                          <xforms:action ev:event="xforms-value-changed">
                                             <xxforms:variable name="search-value" select="."/>
                                             <xxforms:variable name="make-suggestion"
                                                select="(string-length($search-value) &gt;= 2 and not(matches($search-value,'^[A-Z]|\s$|\s[a-z|0-9]$'))) or (string-length($search-value) &gt;= 1 and not(matches($search-value,'^[a-z]|\s$')))"/>
                                             <xforms:action if="$make-suggestion">
                                                <xforms:send submission="update-claml-descriptions"/>
                                                <xforms:action if="xxforms:index('claml-descriptions')&gt;1">
                                                   <xforms:setindex repeat="claml-descriptions" index="1"/>
                                                </xforms:action>
                                             </xforms:action>
                                          </xforms:action>
                                       </xforms:input>
                                    </xhtml:td>
                                    <xhtml:td> </xhtml:td>
                                 </xhtml:tr>
                              </xhtml:table>
                           </xforms:group>
                           <xhtml:p/>
                           <xforms:group ref="instance('claml-description-itemset')">
                              <xhtml:div class="h2">
                                 <xforms:output ref="$resources/results"/>
                                 <xxforms:variable name="resultCount" select="count(description)"/>
                                 (
                                 <xforms:output ref="@current"/>
                                 <xforms:output ref="$resources/of"/>
                                 <xforms:output ref="@count"/>
                                 )
                              </xhtml:div>
                              <!-- SEARCH RESULTS -->
                              <xhtml:div class="navigate-seven">
                                 <xhtml:table width="100%">
                                    <xforms:repeat nodeset="instance('claml-description-itemset')/description" id="claml-descriptions">
                                       <xxforms:variable name="descCode" value="instance('claml-description-itemset')/description[index('claml-descriptions')]/@conceptId"/>
                                       <xxforms:variable name="descCodeSystem" value="instance('claml-description-itemset')/description[index('claml-descriptions')]/@classificationId"/>
                                       <xhtml:tr>
                                          <xhtml:td>
                                             <xforms:output ref="."/>
                                          </xhtml:td>
                                          <xhtml:td>
                                             <xforms:output ref="@superClasses"/>
                                          </xhtml:td>
                                          <xhtml:td>
                                             <xforms:group ref=".[$isGroup]">
                                                <xforms:output ref="@classificationName"/>
                                             </xforms:group>
                                          </xhtml:td>
                                       </xhtml:tr>
                                       <xforms:action ev:event="xxforms-index-changed">
                                          <xforms:action if="instance('class-navigation')!=$descCode or instance('classificationId')!=$descCodeSystem">
                                             <xforms:setvalue ref="instance('class-navigation')" value="instance('claml-description-itemset')/description[index('claml-descriptions')]/@conceptId"/>
                                             <xforms:setvalue ref="instance('classificationId')"
                                                value="instance('claml-description-itemset')/description[index('claml-descriptions')]/@classificationId"/>
                                             <xforms:send submission="get-claml-hierarchy"/>
                                             <xforms:setvalue ref="instance('hierarchy-navigation')" value="instance('claml-instance')/Class[@code=instance('class-navigation')]/@id"/>
                                             <xforms:setvalue ref="instance('new-concept-association')/@code"
                                                value="instance('claml-description-itemset')/description[index('claml-descriptions')]/@conceptId"/>
                                             <xforms:setvalue ref="instance('new-concept-association')/@displayName"
                                                value="instance('claml-description-itemset')/description[index('claml-descriptions')]"/>
                                          </xforms:action>
                                       </xforms:action>
                                       <xforms:action ev:event="xxforms-nodeset-changed">
                                          <xforms:action if="(instance('class-navigation')!=$descCode or instance('classificationId')!=$descCodeSystem)">
                                             <xforms:setvalue ref="instance('class-navigation')" value="instance('claml-description-itemset')/description[index('claml-descriptions')]/@conceptId"/>
                                             <xforms:setvalue ref="instance('classificationId')"
                                                value="instance('claml-description-itemset')/description[index('claml-descriptions')]/@classificationId"/>
                                             <xforms:send submission="get-claml-hierarchy"/>
                                             <xforms:setvalue ref="instance('hierarchy-navigation')" value="instance('claml-instance')/Class[@code=instance('class-navigation')]/@id"/>
                                             <xforms:setvalue ref="instance('new-concept-association')/@code"
                                                value="instance('claml-description-itemset')/description[index('claml-descriptions')]/@conceptId"/>
                                             <xforms:setvalue ref="instance('new-concept-association')/@displayName"
                                                value="instance('claml-description-itemset')/description[index('claml-descriptions')]"/>
                                          </xforms:action>
                                       </xforms:action>
                                    </xforms:repeat>
                                 </xhtml:table>
                              </xhtml:div>
                           </xforms:group>
                        </xhtml:td>
                     </xhtml:tr>
                  </xhtml:table>
               </xhtml:td>
            </xhtml:tr>
            <!-- row with details -->
            <xhtml:tr>
               <xhtml:td colspan="2">
                  <xhtml:table width="100%">
                     <!-- table row with master-detail columns -->
                     <xhtml:tr>
                        <!-- left column with tree class-navigation -->
                        <xhtml:td width="50%">
                           <!-- table for tree class-navigation components -->
                           <xhtml:table width="100%">
                              <xhtml:tr>
                                 <xhtml:td>
                                    <!-- heading for tree control	-->
                                    <xhtml:div class="navigate-container">
                                       <xhtml:div class="h2">
                                          <xforms:output ref="$resources/hierarchy"/>
                                       </xhtml:div>
                                       <xhtml:div class="navigate-small">
                                          <xxforms:variable name="current-class" select="instance('claml-instance')//Class[@id=instance('hierarchy-navigation')]"/>
                                          <xforms:select1 ref="instance('hierarchy-navigation')" appearance="xxforms:tree">
                                             <xforms:itemset nodeset="instance('claml-instance')//*[name()='Class' or name()='SubClass']" class="node-concept">
                                                <xforms:label ref="concat(@code,' - ',Rubric[@kind='preferred'][1]/Label)"/>
                                                <xforms:value ref="@id"/>
                                             </xforms:itemset>
                                             <xforms:action ev:event="xforms-value-changed">
                                                <xforms:action if="$current-class/SubClass">
                                                   <xforms:send submission="expand-tree-submission"/>
                                                   <xforms:action xxforms:iterate="instance('subclasses')//Class">
                                                      <xforms:insert nodeset="context()/@*" origin="$current-class/SubClass[@code=context()/@code]/@id"/>
                                                   </xforms:action>
                                                   <xforms:action xxforms:iterate="instance('subclasses')//SubClass">
                                                      <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('id',random())"/>
                                                   </xforms:action>
                                                   <xforms:delete ref="$current-class/SubClass"/>
                                                   <xforms:insert nodeset="$current-class/*" origin="instance('subclasses')//Class"/>
                                                </xforms:action>
                                                <xforms:send submission="get-class"/>
                                                <xforms:setvalue ref="instance('new-concept-association')/@code" value="instance('class')/@code"/>
                                                <xforms:setvalue ref="instance('new-concept-association')/@displayName" value="instance('class')/Rubric[@kind='preferred']/Label[1]"/>
                                             </xforms:action>
                                          </xforms:select1>
                                       </xhtml:div>
                                    </xhtml:div>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xhtml:table>
                        </xhtml:td>
                        <!-- class details -->
                        <xhtml:td width="50%">
                           <xhtml:table width="100%">
                              <xhtml:tr>
                                 <xhtml:td>
                                    <xhtml:div class="detail">
                                       <xforms:group ref="instance('class')">
                                          <xxforms:variable name="rubrics" select="distinct-values(Rubric/@kind)"/>
                                          <xhtml:div class="h2">
                                             <xforms:output ref="Rubric[@kind='preferred']/Label[1]"/>
                                          </xhtml:div>
                                          <xhtml:table width="100%">
                                             <xhtml:tr class="not-selectable">
                                                <xhtml:td class="item-label">
                                                   <xforms:output ref="$resources/code"/>
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:output ref="@code"/>
                                                </xhtml:td>
                                             </xhtml:tr>
                                             <xhtml:tr class="not-selectable">
                                                <xhtml:td class="item-label">
                                                   <xforms:output ref="$resources/superclass"/>
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xhtml:table>
                                                      <xforms:repeat nodeset="SuperClass" id="superClass">
                                                         <xhtml:tr class="not-selectable">
                                                            <xhtml:td>
                                                               <xforms:trigger appearance="minimal">
                                                                  <xforms:label ref="."/>
                                                                  <xforms:action ev:event="DOMActivate">
                                                                     <xforms:setvalue ref="instance('class-navigation')" value="xxforms:repeat-current('superClass')/@code"/>
                                                                     <xforms:send submission="get-claml-hierarchy"/>
                                                                     <xforms:send submission="get-class"/>
                                                                     <xforms:setvalue ref="instance('new-concept-association')/@code" value="instance('class')/@code"/>
                                                                     <xforms:setvalue ref="instance('new-concept-association')/@displayName"
                                                                        value="instance('class')/Rubric[@kind='preferred']/Label[1]"/>
                                                                  </xforms:action>
                                                               </xforms:trigger>
                                                            </xhtml:td>
                                                         </xhtml:tr>
                                                      </xforms:repeat>
                                                   </xhtml:table>
                                                </xhtml:td>
                                             </xhtml:tr>
                                          </xhtml:table>
                                          <fr:accordion class="fr-accordion-lnf">
                                             <xforms:repeat nodeset="$rubrics[not(.='preferred')]">
                                                <xxforms:variable name="kind" select="."/>
                                                <fr:case>
                                                   <fr:label ref="$kind"/>
                                                   <xhtml:table width="100%">
                                                      <xforms:repeat nodeset="instance('class')/Rubric[@kind=$kind]">
                                                         <xhtml:tr class="not-selectable">
                                                            <xhtml:td>
                                                               <xforms:output ref="Label"/>
                                                            </xhtml:td>
                                                         </xhtml:tr>
                                                      </xforms:repeat>
                                                   </xhtml:table>
                                                </fr:case>
                                             </xforms:repeat>
                                          </fr:accordion>
                                       </xforms:group>
                                    </xhtml:div>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xhtml:table>
                        </xhtml:td>
                     </xhtml:tr>
                  </xhtml:table>
               </xhtml:td>
            </xhtml:tr>
            <xhtml:tr>
               <xhtml:td>
                  <xhtml:div class="buttons">
                     <fr:button>
                        <xforms:label ref="$resources/cancel"/>
                        <xforms:action ev:event="DOMActivate">
                           <xxforms:hide ev:event="DOMActivate" dialog="icd-10-select"/>
                        </xforms:action>
                     </fr:button>
                     <fr:button>
                        <xforms:label ref="$resources/add"/>
                        <xforms:action ev:event="DOMActivate">
                           <xforms:send submission="create-icd10-mapping"/>
                           <xforms:send submission="get-ci"/>
                           <xxforms:hide dialog="icd-10-select"/>
                        </xforms:action>
                     </fr:button>
                  </xhtml:div>
               </xhtml:td>
            </xhtml:tr>
         </xhtml:table>
      </xxforms:dialog>
      <!-- status change dialog -->
      <xxforms:dialog id="status-dialog" appearance="full" level="modal" close="false" draggable="true" visible="false">
         <xhtml:table width="100%">
            <xforms:group ref="instance('status-change')">
               <xxforms:variable name="actionText"
                  select="if (@statusCode='rejected') then $resources/reject else if (@statusCode='retired') then $resources/deactivate else $resources/authorize-and-activate"/>
               <xhtml:tr>
                  <xhtml:td class="heading" colspan="2">
                     <xhtml:div class="heading">
                        <xforms:output ref="$actionText"/>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
               <xforms:group ref=".[@statusCode='active']">
                  <xhtml:tr>
                     <!-- effectiveDate -->
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/date"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:input ref="@effectiveDate">
                           <xforms:alert>
                              <xforms:output ref="$resources/not-valid"/>
                           </xforms:alert>
                        </xforms:input>
                     </xhtml:td>
                  </xhtml:tr>
               </xforms:group>
               <xforms:group ref=".[@statusCode=('active','retired')]">
                  <xhtml:tr>
                     <!-- expirationDate -->
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/expiration-date"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:input ref="@expirationDate">
                           <xforms:alert>
                              <xforms:output ref="$resources/not-valid"/>
                           </xforms:alert>
                        </xforms:input>
                     </xhtml:td>
                  </xhtml:tr>
               </xforms:group>
               <xhtml:tr>
                  <xhtml:td colspan="2">
                     <xhtml:div class="buttons">
                        <fr:button>
                           <xforms:label ref="$resources/cancel"/>
                           <xforms:action ev:event="DOMActivate">
                              <xxforms:hide dialog="status-dialog"/>
                           </xforms:action>
                        </fr:button>
                        <fr:button ref="instance('status-change-valid')">
                           <xforms:label>
                              <xforms:output ref="$actionText"/>
                           </xforms:label>
                           <xforms:action ev:event="DOMActivate">
                              <xforms:send submission="set-status"/>
                              <xxforms:hide dialog="status-dialog"/>
                           </xforms:action>
                        </fr:button>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
            </xforms:group>
         </xhtml:table>
      </xxforms:dialog>
      <!-- New Release dialog -->
      <xxforms:dialog id="release-dialog" appearance="full" level="modal" close="false" draggable="true" visible="false">
         <xforms:label ref="$resources/new-release"/>
         <!-- group for new release -->
         <xforms:group ref="instance('new-release')[$editor]">
            <xhtml:table width="100%" class="detail">
               <xhtml:tr>
                  <xhtml:td colspan="4" class="heading">
                     <xhtml:div class="heading">
                        <xforms:output ref="$resources/new-release"/>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
               <xhtml:tr>
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/update"/>
                  </xhtml:td>
                  <xhtml:td colspan="3">
                     <xforms:output ref="instance('ci-list-info')/concepts/@update"/>
                     <xforms:group ref=".[instance('ci-list-info')/concepts/@update!=0]">
                        <xhtml:img src="/img/exclamation.png"/>
                     </xforms:group>
                  </xhtml:td>
               </xhtml:tr>
               <xhtml:tr>
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/review"/>
                  </xhtml:td>
                  <xhtml:td colspan="3">
                     <xforms:output ref="instance('ci-list-info')/concepts/@review"/>
                  </xhtml:td>
               </xhtml:tr>
               <xhtml:tr>
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/draft"/>
                  </xhtml:td>
                  <xhtml:td colspan="3">
                     <xforms:output ref="instance('ci-list-info')/concepts/@draft"/>
                  </xhtml:td>
               </xhtml:tr>
               <!-- label and date-time -->
               <xhtml:tr>
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/label"/>
                  </xhtml:td>
                  <xhtml:td>
                     <xforms:input ref="@label" incremental="true">
                        <xforms:alert>
                           <xforms:output ref="$resources/required-field"/>
                        </xforms:alert>
                     </xforms:input>
                  </xhtml:td>
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/date"/>
                  </xhtml:td>
                  <xhtml:td>
                     <xforms:input ref="@effectiveTime"/>
                  </xhtml:td>
               </xhtml:tr>
               <xhtml:tr>
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/comment"/>
                  </xhtml:td>
                  <xhtml:td colspan="3">
                     <xforms:textarea mediatype="text/html" ref="comment"/>
                  </xhtml:td>
               </xhtml:tr>
            </xhtml:table>
         </xforms:group>
         <xhtml:table width="100%">
            <xhtml:tr>
               <xhtml:td>
                  <xhtml:div class="buttons">
                     <fr:button ref="instance('new-release-valid')">
                        <xforms:label ref="$resources/create-release"/>
                        <xforms:action ev:event="DOMActivate">
                           <xforms:send submission="add-release-info"/>
                           <xforms:send submission="create-release"/>
                           <xforms:send submission="get-project"/>
                           <xforms:setvalue ref="instance('data-safe')" value="'true'"/>
                           <xxforms:hide ev:event="DOMActivate" dialog="release-dialog"/>
                        </xforms:action>
                     </fr:button>
                     <fr:button>
                        <xforms:label ref="$resources/close"/>
                        <xforms:action ev:event="DOMActivate">
                           <xxforms:hide ev:event="DOMActivate" dialog="release-dialog"/>
                        </xforms:action>
                     </fr:button>
                  </xhtml:div>
               </xhtml:td>
            </xhtml:tr>
         </xhtml:table>
      </xxforms:dialog>
      <fr:tabview>
         <!-- CONTRA-INDICATIONS tab -->
         <fr:tab id="ica-tab">
            <fr:label ref="$resources/contra-indications"/>
            <!-- table with master-detail columns -->
            <xhtml:table width="100%">
               <xhtml:tr>
                  <!-- left column with navigation -->
                  <xhtml:td width="25%">
                     <!-- table for tree navigation components -->
                     <xhtml:table width="100%">
                        <!-- row with heading and insert button	-->
                        <xhtml:tr>
                           <xhtml:td class="heading" colspan="2">
                              <xhtml:div class="heading">
                                 <xforms:output ref="$resources/ica-mapping"/>
                              </xhtml:div>
                           </xhtml:td>
                        </xhtml:tr>
                        <!-- row with filter selector	-->
                        <xhtml:tr>
                           <xhtml:td class="item-label">
                              <xforms:output ref="$resources/show"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:select1 ref="instance('ica-nodeset')" appearance="minimal" class="auto-width">
                                 <xforms:itemset nodeset="instance('status-filters')/filter">
                                    <xforms:label ref="name[@language=instance('language')]"/>
                                    <xforms:value ref="@nodeset"/>
                                 </xforms:itemset>
                                 <xforms:action ev:event="xforms-value-changed">
                                    <xforms:setvalue ref="instance('ci-navigation')"
                                       value="if (count(xxforms:evaluate(instance('ica-nodeset')))&gt;0) then xxforms:evaluate(instance('ica-nodeset'))[1]/@id else ('')"/>
                                    <xforms:setfocus control="navigate"/>
                                 </xforms:action>
                              </xforms:select1>
                           </xhtml:td>
                        </xhtml:tr>
                        <!-- row with navigation list -->
                        <xhtml:tr>
                           <xhtml:td width="100%" colspan="2">
                              <xhtml:div class="ci-navigate">
                                 <xforms:select1 id="navigate" ref="instance('ci-navigation')" appearance="compact">
                                    <xforms:itemset nodeset="xxforms:evaluate(instance('ica-nodeset'))">
                                       <xforms:label ref="text"/>
                                       <xforms:value ref="@id"/>
                                    </xforms:itemset>
                                    <xforms:action ev:event="xforms-value-changed">
                                       <xforms:send submission="get-ci"/>
                                    </xforms:action>
                                 </xforms:select1>
                              </xhtml:div>
                           </xhtml:td>
                        </xhtml:tr>
                     </xhtml:table>
                  </xhtml:td>
                  <!-- code details -->
                  <xhtml:td width="75%">
                     <xhtml:table width="100%" class="detail">
                        <xforms:group ref="instance('selected-ci')">
                           <!-- row with heading and buttons -->
                           <xhtml:tr>
                              <xhtml:td class="heading" colspan="6">
                                 <xhtml:div class="heading">
                                    <xforms:output ref="text[@language=instance('language')]"/>
                                 </xhtml:div>
                                 <xhtml:div class="buttons">
                                    <xforms:group ref=".[$authorize]">
                                       <!-- button for authorizing setting status to 'active' -->
                                       <fr:button ref=".[@statusCode='review']">
                                          <xforms:label>
                                             <xhtml:img src="/img/tick.png" alt=""/>
                                          </xforms:label>
                                          <xforms:hint>
                                             <xforms:output ref="$resources/authorize-and-activate"/>
                                          </xforms:hint>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:setvalue ref="instance('status-change')/@object" value="'ci'"/>
                                             <xforms:setvalue ref="instance('status-change')/@ref" value="instance('selected-ci')/@id"/>
                                             <xforms:setvalue ref="instance('status-change')/@statusCode" value="'active'"/>
                                             <xxforms:show dialog="status-dialog"/>
                                             <!--                                             <xforms:send submission="set-status"/>-->
                                          </xforms:action>
                                       </fr:button>
                                    </xforms:group>
                                    <xforms:group ref=".[$editor]">
                                       <!-- button for setting status to 'review' -->
                                       <fr:button ref=".[@statusCode=('draft','update','pending')][not(text[string-length(text())=0])]">
                                          <xforms:label>
                                             <xhtml:img src="/img/eye.png" alt=""/>
                                          </xforms:label>
                                          <xforms:hint>
                                             <xforms:output ref="$resources/review"/>
                                          </xforms:hint>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:setvalue ref="instance('status-change')/@object" value="'ci'"/>
                                             <xforms:setvalue ref="instance('status-change')/@ref" value="instance('selected-ci')/@id"/>
                                             <xforms:setvalue ref="instance('status-change')/@statusCode" value="'review'"/>
                                             <xforms:send submission="set-status"/>
                                          </xforms:action>
                                       </fr:button>
                                       <!-- button for setting status to 'rejected' -->
                                       <fr:button ref=".[@statusCode='draft' or (@statusCode='review' and @history='0')]">
                                          <xforms:label>
                                             <xhtml:img src="/img/node-srejected.png" alt=""/>
                                          </xforms:label>
                                          <xforms:hint>
                                             <xforms:output ref="$resources/reject"/>
                                          </xforms:hint>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:setvalue ref="instance('status-change')/@object" value="'ci'"/>
                                             <xforms:setvalue ref="instance('status-change')/@ref" value="instance('selected-ci')/@id"/>
                                             <xforms:setvalue ref="instance('status-change')/@statusCode" value="'rejected'"/>
                                             <xxforms:show dialog="status-dialog"/>
                                          </xforms:action>
                                       </fr:button>
                                       <!-- button for deleting concept -->
                                       <fr:button ref=".[@statusCode='draft']">
                                          <xforms:label>
                                             <xhtml:img src="/img/remove.gif" alt=""/>
                                          </xforms:label>
                                          <xforms:hint>
                                             <xforms:output ref="$resources/delete"/>
                                          </xforms:hint>
                                          <xforms:action ev:event="DOMActivate">
                                             <xxforms:variable name="preceding" select="instance('ci-list')/ci[@id=instance('selected-ci')/@id]/preceding-sibling::ci[1]/@id"/>
                                             <xforms:setvalue ref="instance('new-id')" value="if (string-length($preceding) &gt;0) then $preceding else instance('ci-list')/ci[1]/@id"/>
                                             <xforms:send submission="delete-ci"/>
                                          </xforms:action>
                                       </fr:button>
                                       <!-- button for setting status to 'draft' -->
                                       <fr:button ref=".[@statusCode='review'][@history=0]">
                                          <xforms:label>
                                             <xhtml:img src="/img/write.png" alt=""/>
                                          </xforms:label>
                                          <xforms:hint>
                                             <xforms:output ref="$resources/edit"/>
                                          </xforms:hint>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:setvalue ref="instance('status-change')/@object" value="'ci'"/>
                                             <xforms:setvalue ref="instance('status-change')/@ref" value="instance('selected-ci')/@id"/>
                                             <xforms:setvalue ref="instance('status-change')/@statusCode" value="'draft'"/>
                                             <xforms:send submission="set-status"/>
                                          </xforms:action>
                                       </fr:button>
                                       <!-- button for setting status to 'update' -->
                                       <fr:button ref=".[@statusCode=('active','review')][@history &gt;0]">
                                          <xforms:label>
                                             <xhtml:img src="/img/write.png" alt=""/>
                                          </xforms:label>
                                          <xforms:hint>
                                             <xforms:output ref="$resources/edit"/>
                                          </xforms:hint>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:setvalue ref="instance('status-change')/@object" value="'ci'"/>
                                             <xforms:setvalue ref="instance('status-change')/@ref" value="instance('selected-ci')/@id"/>
                                             <xforms:setvalue ref="instance('status-change')/@statusCode" value="'update'"/>
                                             <xforms:send submission="set-status"/>
                                          </xforms:action>
                                       </fr:button>
                                       <!-- button for setting status to 'retired' -->
                                       <fr:button ref=".[@statusCode='active']">
                                          <xforms:label>
                                             <xhtml:img src="/img/node-sretired.png" alt=""/>
                                          </xforms:label>
                                          <xforms:hint>
                                             <xforms:output ref="$resources/deactivate"/>
                                          </xforms:hint>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:setvalue ref="instance('status-change')/@object" value="'ci'"/>
                                             <xforms:setvalue ref="instance('status-change')/@ref" value="instance('selected-ci')/@id"/>
                                             <xforms:setvalue ref="instance('status-change')/@statusCode" value="'retired'"/>
                                             <xxforms:show dialog="status-dialog"/>
                                          </xforms:action>
                                       </fr:button>
                                    </xforms:group>
                                    <!-- button for creating CI -->
                                    <fr:button ref=".[$editor]">
                                       <xforms:label>
                                          <xhtml:img src="/img/plus.png" alt=""/>
                                       </xforms:label>
                                       <xforms:hint>
                                          <xforms:output ref="$resources/create-contra-indication"/>
                                       </xforms:hint>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:send submission="create-ci"/>
                                       </xforms:action>
                                    </fr:button>
                                    <!-- button for creating issue -->
                                    <xxforms:variable name="noIssue" select="empty(instance('issues-instance')/issue[object/@id=instance('ci-navigation')])"/>
                                    <xforms:group ref=".[$noIssue][$issueCreator][@statusCode=('review','pending','update','active')]">
                                       <fr:button id="add-issue">
                                          <xforms:label>
                                             <xhtml:img src="/img/tracking.png" alt=""/>
                                          </xforms:label>
                                          <xforms:hint>
                                             <xforms:output ref="$resources/add-issue"/>
                                          </xforms:hint>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:insert nodeset="instance('issues-instance')/issue" at="1" position="before" origin="instance('issue-instance')/issue"/>
                                             <xforms:setvalue ref="instance('issues-instance')/issue[1]/object/@id" value="instance('ci-navigation')"/>
                                             <xforms:setvalue ref="instance('issues-instance')/issue[1]/object/@type" value="'ICA'"/>
                                             <!--<xforms:setvalue ref="instance('issues-instance')/issue[1]/object/@effectiveDate"
                                                value="instance('ci-list')/members/member[@id=instance('member-navigation')]/@effectiveTime"/>-->
                                             <xforms:setvalue ref="instance('issues-instance')/issue[1]/tracking/author" value="xxforms:get-session-attribute('username')"/>
                                             <xforms:setvalue ref="instance('issues-instance')/issue[1]/tracking/author/@id"
                                                value="instance('project')/project/author[@username=xxforms:get-session-attribute('username')]/@id"/>
                                             <xforms:setvalue ref="instance('issues-instance')/issue[1]/tracking/desc/@language" value="instance('language')"/>
                                             <!--<xforms:setvalue ref="instance('issues-instance')/issue[1]/@refsetId" value="instance('ci-list')/@id"/>-->
                                             <xforms:setfocus control="issue-title"/>
                                          </xforms:action>
                                       </fr:button>
                                    </xforms:group>
                                 </xhtml:div>
                              </xhtml:td>
                           </xhtml:tr>
                           <!-- id, status -->
                           <xhtml:tr>
                              <!-- id -->
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/id"/>
                              </xhtml:td>
                              <xhtml:td colspan="3">
                                 <xforms:output ref="@id"/>
                              </xhtml:td>
                              <!-- status -->
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/status"/>
                              </xhtml:td>
                              <xhtml:td width="20%">
                                 <xxforms:variable name="statusCode" select="@statusCode"/>
                                 <xforms:output ref="instance('status-codes')/enumeration[@value=$statusCode]/label[@language=instance('language')]" class="node-s{$statusCode}"/>
                              </xhtml:td>
                           </xhtml:tr>
                           <!-- effective date, expiration date, edit date -->
                           <xhtml:tr>
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/date"/>
                              </xhtml:td>
                              <xhtml:td width="20%">
                                 <xforms:output ref="@effectiveDate"
                                    xxforms:format="if (instance('language')='en-US' and string-length(.) &gt; 0) then format-date(xs:date(.),'[M01]/[D01]/[Y]') else if  (string-length(.) &gt; 0) then format-date(xs:date(.),'[D01]-[M01]-[Y]') else ."
                                 />
                              </xhtml:td>
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/expiration-date"/>
                              </xhtml:td>
                              <xhtml:td width="20%">
                                 <xforms:output ref="@expirationDate"
                                    xxforms:format="if (instance('language')='en-US' and string-length(.) &gt; 0) then format-date(xs:date(.),'[M01]/[D01]/[Y]') else if  (string-length(.) &gt; 0) then format-date(xs:date(.),'[D01]-[M01]-[Y]') else ."
                                 />
                              </xhtml:td>
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/edit-date"/>
                              </xhtml:td>
                              <xhtml:td width="20%">
                                 <xforms:output ref="@editDate"
                                    xxforms:format="if (instance('language')='en-US' and string-length(.) &gt; 0) then format-date(xs:date(.),'[M01]/[D01]/[Y]') else if  (string-length(.) &gt; 0) then format-date(xs:date(.),'[D01]-[M01]-[Y]') else ."
                                 />
                              </xhtml:td>
                           </xhtml:tr>
                           <!-- text -->
                           <xhtml:tr>
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/text"/>
                              </xhtml:td>
                              <xhtml:td colspan="5">
                                 <xforms:input ref="text" class="long-text" id="ciText">
                                    <xforms:action if="$editor" ev:event="DOMFocusOut">
                                       <xforms:insert context="instance('selected-ci')/text" origin="xxforms:attribute('ciId',instance('selected-ci')/@id)"/>
                                       <xforms:send submission="update-ci-text"/>
                                       <xforms:send submission="get-ci"/>
                                       <xforms:setvalue ref="instance('ci-list')/ci[@id=instance('selected-ci')/@id]/text" value="instance('selected-ci')/text"/>
                                    </xforms:action>
                                 </xforms:input>
                              </xhtml:td>
                           </xhtml:tr>
                           <!-- accordeon with richt text -->
                           <xhtml:tr>
                              <xhtml:td colspan="6">
                                 <fr:accordion class="fr-accordion-lnf">
                                    <!-- description -->
                                    <fr:case selected="false">
                                       <fr:label ref="$resources/description"/>
                                       <xforms:textarea mediatype="text/html" ref="description[@language=instance('language')][parent::ci/@statusCode=('draft','update')][$editor]">
                                          <xforms:action if="$editor" ev:event="DOMFocusOut">
                                             <xforms:insert context="instance('selected-ci')/description" origin="xxforms:attribute('ciId',instance('selected-ci')/@id)"/>
                                             <xforms:send submission="update-ci-description"/>
                                             <xforms:send submission="get-ci"/>
                                          </xforms:action>
                                       </xforms:textarea>
                                       <xforms:output mediatype="text/html" ref="description[parent::ci/@statusCode=('review','active','retired','rejected') or not($editor)]"/>
                                    </fr:case>
                                    <!-- rationale -->
                                    <fr:case selected="true">
                                       <fr:label ref="$resources/rationale"/>
                                       <xforms:textarea mediatype="text/html" ref="rationale[@language=instance('language')][parent::ci/@statusCode=('draft','update')][$editor]">
                                          <xforms:action if="$editor" ev:event="DOMFocusOut">
                                             <xforms:insert context="instance('selected-ci')/rationale" origin="xxforms:attribute('ciId',instance('selected-ci')/@id)"/>
                                             <xforms:send submission="update-ci-rationale"/>
                                             <xforms:send submission="get-ci"/>
                                          </xforms:action>
                                       </xforms:textarea>
                                       <xforms:output mediatype="text/html" ref="rationale[parent::ci/@statusCode=('review','active','retired','rejected') or not($editor)]"/>
                                    </fr:case>
                                    <!-- CIC -->
                                    <fr:case selected="true">
                                       <fr:label ref="$resources/cic"/>
                                       <xhtml:table width="100%">
                                          <!-- header -->
                                          <xhtml:tr>
                                             <xhtml:td class="heading-small" width="8%">
                                                <xforms:output ref="$resources/code"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="92%">
                                                <xforms:output ref="$resources/description"/>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <xhtml:tr>
                                             <xhtml:td>
                                                <xforms:input ref="cic/@code" class="code">
                                                   <xforms:action if="$editor" ev:event="DOMFocusOut">
                                                      <xforms:send submission="update-cic-mapping"/>
                                                      <xforms:send submission="get-ci"/>
                                                   </xforms:action>
                                                </xforms:input>
                                             </xhtml:td>
                                             <xhtml:td>
                                                <xforms:input ref="cic/desc" class="long-text">
                                                   <xforms:action if="$editor" ev:event="DOMFocusOut">
                                                      <xforms:send submission="update-cic-mapping"/>
                                                      <xforms:send submission="get-ci"/>
                                                   </xforms:action>
                                                </xforms:input>
                                             </xhtml:td>
                                          </xhtml:tr>
                                       </xhtml:table>
                                    </fr:case>
                                 </fr:accordion>
                              </xhtml:td>
                           </xhtml:tr>
                           <!-- group for issue creation -->
                           <xforms:group ref="instance('issues-instance')/issue[object/@id=instance('ci-navigation')]">
                              <xhtml:tr>
                                 <xhtml:td colspan="6">
                                    <xhtml:table width="100%">
                                       <xhtml:tr>
                                          <xhtml:td class="heading">
                                             <xhtml:div class="heading">
                                                <xforms:output ref="$resources/new-issue"/>
                                             </xhtml:div>
                                          </xhtml:td>
                                       </xhtml:tr>
                                       <xhtml:tr>
                                          <xhtml:td>
                                             <xhtml:table width="100%">
                                                <!-- issue type -->
                                                <xhtml:tr>
                                                   <xhtml:td class="item-label">
                                                      <xforms:output ref="$resources/type"/>
                                                   </xhtml:td>
                                                   <xhtml:td>
                                                      <xforms:select1 ref="@type" appearance="minimal">
                                                         <xforms:itemset nodeset="instance('decor-types')/IssueType/enumeration">
                                                            <xforms:label ref="label[@language=instance('language')]"/>
                                                            <xforms:value ref="@value"/>
                                                         </xforms:itemset>
                                                      </xforms:select1>
                                                   </xhtml:td>
                                                </xhtml:tr>
                                                <!-- issue type -->
                                                <xhtml:tr>
                                                   <xhtml:td class="item-label">
                                                      <xforms:output ref="$resources/priority"/>
                                                   </xhtml:td>
                                                   <xhtml:td>
                                                      <xforms:select1 ref="@priority" appearance="minimal">
                                                         <xforms:itemset nodeset="instance('decor-types')/IssuePriority/enumeration">
                                                            <xforms:label ref="label[@language=instance('language')]"/>
                                                            <xforms:value ref="@value"/>
                                                         </xforms:itemset>
                                                      </xforms:select1>
                                                   </xhtml:td>
                                                </xhtml:tr>
                                                <!-- title -->
                                                <xhtml:tr>
                                                   <xhtml:td class="item-label">
                                                      <xforms:output ref="$resources/title"/>
                                                   </xhtml:td>
                                                   <xhtml:td>
                                                      <xforms:input id="issue-title" ref="@displayName"/>
                                                   </xhtml:td>
                                                </xhtml:tr>
                                                <!-- description of issue -->
                                                <xhtml:tr>
                                                   <xhtml:td class="item-label">
                                                      <xforms:output ref="$resources/description"/>
                                                   </xhtml:td>
                                                   <xhtml:td>
                                                      <xforms:textarea id="issue-description" mediatype="text/html" ref="tracking/desc"/>
                                                   </xhtml:td>
                                                </xhtml:tr>
                                                <!-- save and cancel buttons -->
                                                <xhtml:tr>
                                                   <xhtml:td class="item-label" colspan="2">
                                                      <xhtml:div class="buttons">
                                                         <fr:button>
                                                            <xforms:label ref="$resources/cancel"/>
                                                            <xforms:action ev:event="DOMActivate">
                                                               <xforms:delete ref="instance('issues-instance')/issue[object/@id=instance('ci-navigation')]"/>
                                                               <xforms:setvalue ref="instance('data-safe')">true</xforms:setvalue>
                                                            </xforms:action>
                                                         </fr:button>
                                                         <fr:button>
                                                            <xforms:label ref="$resources/save-issue"/>
                                                            <xforms:action ev:event="DOMActivate">
                                                               <xforms:send submission="save-ica-issue"/>
                                                               <xforms:send submission="get-ica-issues"/>
                                                               <xforms:delete ref="instance('issues-instance')/issue[object/@id=instance('ci-navigation')]"/>
                                                               <xforms:setvalue ref="instance('data-safe')">true</xforms:setvalue>
                                                            </xforms:action>
                                                         </fr:button>
                                                      </xhtml:div>
                                                   </xhtml:td>
                                                </xhtml:tr>
                                             </xhtml:table>
                                          </xhtml:td>
                                       </xhtml:tr>
                                    </xhtml:table>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:group>
                           <!-- group for existing issues -->
                           <xforms:group ref="instance('ica-issues')/issue[contains(xxforms:get-session-attribute('groups'),'issues')][object/@id=instance('ci-navigation')]">
                              <xhtml:tr>
                                 <xhtml:td colspan="6">
                                    <fr:accordion class="fr-accordion-lnf">
                                       <fr:case>
                                          <fr:label ref="concat($resources/issues,' (',count(instance('ica-issues')/issue[object/@id=instance('ci-navigation')]),')')"/>
                                          <xhtml:div class="detail">
                                             <fr:accordion class="fr-accordion-lnf">
                                                <xforms:repeat nodeset="instance('ica-issues')/issue[object/@id=instance('ci-navigation')]" id="concept-issues">
                                                   <fr:case>
                                                      <fr:label>
                                                         <xxforms:variable name="type" select="@type"/>
                                                         <xforms:output ref="instance('decor-types')/IssueType/enumeration[@value=$type]/label[@language=instance('language')]"/>: <xforms:output
                                                            ref="@displayName"/>
                                                      </fr:label>
                                                      <xhtml:table width="100%">
                                                         <!-- issue type and priority -->
                                                         <xhtml:tr class="not-selectable">
                                                            <xhtml:td class="item-label">
                                                               <xforms:output ref="$resources/type"/>
                                                            </xhtml:td>
                                                            <xhtml:td>
                                                               <xxforms:variable name="type" select="@type"/>
                                                               <xforms:output ref="instance('decor-types')/IssueType/enumeration[@value=$type]/label[@language=instance('language')]"/>
                                                            </xhtml:td>
                                                            <xhtml:td class="item-label">
                                                               <xforms:output ref="$resources/priority"/>
                                                            </xhtml:td>
                                                            <xhtml:td>
                                                               <xxforms:variable name="priority" select="@priority"/>
                                                               <xforms:output ref="instance('decor-types')/IssuePriority/enumeration[@value=$priority]/label[@language=instance('language')]"/>
                                                            </xhtml:td>
                                                         </xhtml:tr>
                                                         <!-- issue events -->
                                                         <xhtml:tr class="not-selectable">
                                                            <xhtml:td class="item-label">
                                                               <xforms:output ref="$resources/events"/>
                                                            </xhtml:td>
                                                            <xhtml:td colspan="3">
                                                               <xforms:repeat nodeset="tracking|assignment">
                                                                  <xhtml:table width="100%" class="detail" style="border: 1px solid #AAA;">
                                                                     <xhtml:tr class="not-selectable">
                                                                        <xhtml:td style="background-color : #ebe7e1;width:10%;">
                                                                           <xxforms:variable name="status" select="@statusCode"/>
                                                                           <xforms:group ref=".[name()='assignment']">
                                                                              <xforms:output mediatype="image/*" value="'/img/arrowright.png'">
                                                                                 <xforms:hint ref="$resources/assignment"/>
                                                                              </xforms:output>
                                                                           </xforms:group>
                                                                           <xforms:group ref=".[name()='tracking']">
                                                                              <xforms:output mediatype="image/*" value="'/img/tracking.png'">
                                                                                 <xforms:hint ref="$resources/tracking"/>
                                                                              </xforms:output>
                                                                              <xforms:output mediatype="image/*" value="concat('/img/IssueStatusCodeLifeCycle_',@statusCode,'.png')">
                                                                                 <xforms:hint>
                                                                                    <xforms:output ref="$resources/status"
                                                                                       /> = 
                                                                                    <xforms:output
                                                                                       ref="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value=$status]/label[@language=instance('language')]"
                                                                                    />
                                                                                 </xforms:hint>
                                                                              </xforms:output>
                                                                           </xforms:group>
                                                                        </xhtml:td>
                                                                        <xhtml:td style="background-color : #ebe7e1;">
                                                                           <xforms:output ref="author"/>
                                                                        </xhtml:td>
                                                                        <xhtml:td style="background-color : #ebe7e1;">
                                                                           <xforms:output ref="@effectiveDate"
                                                                              xxforms:format="if (instance('language')='en-US') then format-dateTime(xs:dateTime(.),'[M01]/[D01]/[Y]',(), (), ()) else format-dateTime(xs:dateTime(.),'[D01]-[M01]-[Y]', (), (), ())"
                                                                           />
                                                                        </xhtml:td>
                                                                     </xhtml:tr>
                                                                     <xforms:group ref="@name">
                                                                        <xhtml:tr class="not-selectable">
                                                                           <xhtml:td class="item-label">
                                                                              <xforms:output ref="$resources/assigned-to"/>
                                                                           </xhtml:td>
                                                                           <xhtml:td colspan="2">
                                                                              <xforms:output ref="."/>
                                                                           </xhtml:td>
                                                                        </xhtml:tr>
                                                                     </xforms:group>
                                                                     <xhtml:tr class="not-selectable">
                                                                        <xhtml:td class="item-label">
                                                                           <xforms:output ref="$resources/description"/>
                                                                        </xhtml:td>
                                                                        <xhtml:td colspan="2">
                                                                           <xforms:output mediatype="text/html" ref="desc"/>
                                                                        </xhtml:td>
                                                                     </xhtml:tr>
                                                                  </xhtml:table>
                                                               </xforms:repeat>
                                                            </xhtml:td>
                                                         </xhtml:tr>
                                                      </xhtml:table>
                                                   </fr:case>
                                                </xforms:repeat>
                                             </fr:accordion>
                                          </xhtml:div>
                                       </fr:case>
                                    </fr:accordion>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:group>
                           <!-- MAPPINGS -->
                           <xhtml:tr>
                              <xhtml:td colspan="6">
                                 <fr:accordion class="fr-accordion-lnf">

                                    <!-- SHB-CI -->
                                    <fr:case selected="true">
                                       <fr:label ref="$resources/SHB-CI"/>
                                       <xhtml:table width="100%">
                                          <xxforms:variable name="shb-ci" select="instance('selected-ci')/shb-ci[index('shb-ci')]"/>
                                          <!-- header -->
                                          <xhtml:tr>
                                             <xhtml:td class="heading-small" width="8%">
                                                <xforms:output ref="$resources/code"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="47%">
                                                <xforms:output ref="$resources/description"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="10%">
                                                <xforms:output ref="$resources/date"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="10%">
                                                <xforms:output ref="$resources/expiration-date"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="10%">
                                                <xforms:output ref="$resources/edit-date"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="15%">
                                                <xforms:output ref="$resources/status"/>
                                                <xhtml:div class="buttons">
                                                   <!-- add -->
                                                   <xforms:trigger ref=".[@statusCode=('draft','update')][$editor]" appearance="minimal">
                                                      <xforms:label>
                                                         <xhtml:img src="/img/add16.png" alt="" class="small-button"/>
                                                      </xforms:label>
                                                      <xforms:hint ref="$resources/add" appearance="minimal"/>
                                                      <xforms:action ev:event="DOMActivate">
                                                         <xforms:action ev:event="DOMActivate">
                                                            <xforms:send submission="create-shb-ci-mapping"/>
                                                            <xforms:send submission="get-ci"/>
                                                         </xforms:action>
                                                      </xforms:action>
                                                   </xforms:trigger>
                                                </xhtml:div>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <!-- repeat -->
                                          <xforms:repeat nodeset="shb-ci" id="shb-ci">
                                             <xhtml:tr class="mapping">
                                                <xhtml:td>
                                                   <xforms:input ref="@code" class="code">
                                                      <xforms:action if="$editor" ev:event="DOMFocusOut">
                                                         <xforms:send submission="update-shb-ci-mapping"/>
                                                         <xforms:send submission="get-ci"/>
                                                      </xforms:action>
                                                   </xforms:input>
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:input ref="desc" class="long-text">
                                                      <xforms:action if="$editor" ev:event="DOMFocusOut">
                                                         <xforms:send submission="update-shb-ci-mapping"/>
                                                         <xforms:send submission="get-ci"/>
                                                      </xforms:action>
                                                   </xforms:input>
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:output ref="@effectiveDate"
                                                      xxforms:format="if (instance('language')='en-US' and string-length(.) &gt; 0) then format-date(xs:date(.),'[M01]/[D01]/[Y]') else if  (string-length(.) &gt; 0) then format-date(xs:date(.),'[D01]-[M01]-[Y]') else ."
                                                   />
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:output ref="@expirationDate"
                                                      xxforms:format="if (instance('language')='en-US' and string-length(.) &gt; 0) then format-date(xs:date(.),'[M01]/[D01]/[Y]') else if  (string-length(.) &gt; 0) then format-date(xs:date(.),'[D01]-[M01]-[Y]') else ."
                                                   />
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:output ref="@editDate"
                                                      xxforms:format="if (instance('language')='en-US' and string-length(.) &gt; 0) then format-date(xs:date(.),'[M01]/[D01]/[Y]') else if  (string-length(.) &gt; 0) then format-date(xs:date(.),'[D01]-[M01]-[Y]') else ."
                                                   />
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xxforms:variable name="icd10StatusCode" select="@statusCode"/>
                                                   <xforms:output ref="instance('status-codes')/enumeration[@value=$icd10StatusCode]/label[@language=instance('language')]"
                                                      class="node-s{$icd10StatusCode}"/>
                                                   <xhtml:div class="buttons">
                                                      <xforms:group ref=".[parent::ci/@statusCode=('draft','update')][$editor]">
                                                         <!-- delete -->
                                                         <xforms:trigger ref=".[@statusCode='draft']" appearance="minimal">
                                                            <xforms:label>
                                                               <xhtml:img src="/img/delete16.png" alt="" class="small-button"/>
                                                            </xforms:label>
                                                            <xforms:hint ref="$resources/remove" appearance="minimal"/>
                                                            <xforms:action ev:event="DOMActivate">
                                                               <xforms:send submission="delete-shb-ci-mapping"/>
                                                               <xforms:send submission="get-ci"/>
                                                            </xforms:action>
                                                         </xforms:trigger>
                                                         <!-- deactivate -->
                                                         <xforms:trigger ref=".[@statusCode='active']" appearance="minimal">
                                                            <xforms:label>
                                                               <xhtml:img src="/img/retire16.png" alt="" class="small-button"/>
                                                            </xforms:label>
                                                            <xforms:hint ref="$resources/set-status-to-retired" appearance="minimal"/>
                                                            <xforms:action ev:event="DOMActivate">
                                                               <xforms:setvalue ref="instance('status-change')/@object" value="'shb-ci'"/>
                                                               <xforms:setvalue ref="instance('status-change')/@ref" value="instance('selected-ci')/shb-ci[index('shb-ci')]/@id"/>
                                                               <xforms:setvalue ref="instance('status-change')/@statusCode" value="'retired'"/>
                                                               <xxforms:show dialog="status-dialog"/>
                                                            </xforms:action>
                                                         </xforms:trigger>
                                                      </xforms:group>
                                                   </xhtml:div>
                                                </xhtml:td>
                                             </xhtml:tr>
                                          </xforms:repeat>
                                       </xhtml:table>
                                    </fr:case>
                                    <!-- ICPC -->
                                    <fr:case selected="true">
                                       <fr:label ref="$resources/icpc"/>
                                       <xhtml:table width="100%">
                                          <!-- header -->
                                          <xhtml:tr>
                                             <xhtml:td class="heading-small" width="8%">
                                                <xforms:output ref="$resources/code"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="47%">
                                                <xforms:output ref="$resources/description"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="10%">
                                                <xforms:output ref="$resources/date"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="10%">
                                                <xforms:output ref="$resources/expiration-date"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="10%">
                                                <xforms:output ref="$resources/edit-date"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="15%">
                                                <xforms:output ref="$resources/status"/>
                                                <xhtml:div class="buttons">
                                                   <!-- add -->
                                                   <xforms:trigger ref=".[@statusCode=('draft','update')][$editor]" appearance="minimal">
                                                      <xforms:label>
                                                         <xhtml:img src="/img/add16.png" alt="" class="small-button"/>
                                                      </xforms:label>
                                                      <xforms:hint ref="$resources/add" appearance="minimal"/>
                                                      <xforms:action ev:event="DOMActivate">
                                                         <xforms:send submission="create-icpc-mapping"/>
                                                         <xforms:send submission="get-ci"/>
                                                      </xforms:action>
                                                   </xforms:trigger>
                                                </xhtml:div>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <!-- ICPC repeat -->
                                          <xforms:repeat nodeset="icpc" id="icpc">
                                             <xhtml:tr class="mapping">
                                                <xhtml:td>
                                                   <xforms:input ref="@code" class="code">
                                                      <xforms:action if="$editor" ev:event="DOMFocusOut">
                                                         <xforms:send submission="update-icpc-mapping"/>
                                                         <xforms:send submission="get-ci"/>
                                                      </xforms:action>
                                                   </xforms:input>
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:input ref="desc" class="long-text">
                                                      <xforms:action if="$editor" ev:event="DOMFocusOut">
                                                         <xforms:send submission="update-icpc-mapping"/>
                                                         <xforms:send submission="get-ci"/>
                                                      </xforms:action>
                                                   </xforms:input>
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:output ref="@effectiveDate"
                                                      xxforms:format="if (instance('language')='en-US' and string-length(.) &gt; 0) then format-date(xs:date(.),'[M01]/[D01]/[Y]') else if  (string-length(.) &gt; 0) then format-date(xs:date(.),'[D01]-[M01]-[Y]') else ."
                                                   />
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:output ref="@expirationDate"
                                                      xxforms:format="if (instance('language')='en-US' and string-length(.) &gt; 0) then format-date(xs:date(.),'[M01]/[D01]/[Y]') else if  (string-length(.) &gt; 0) then format-date(xs:date(.),'[D01]-[M01]-[Y]') else ."
                                                   />
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:output ref="@editDate"
                                                      xxforms:format="if (instance('language')='en-US' and string-length(.) &gt; 0) then format-date(xs:date(.),'[M01]/[D01]/[Y]') else if  (string-length(.) &gt; 0) then format-date(xs:date(.),'[D01]-[M01]-[Y]') else ."
                                                   />
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xxforms:variable name="icpcStatusCode" select="@statusCode"/>
                                                   <xforms:output ref="instance('status-codes')/enumeration[@value=$icpcStatusCode]/label[@language=instance('language')]"
                                                      class="node-s{$icpcStatusCode}"/>
                                                   <xhtml:div class="buttons">
                                                      <xforms:group ref=".[parent::ci/@statusCode=('draft','update')][$editor]">
                                                         <!-- delete -->
                                                         <xforms:trigger ref=".[@statusCode='draft']" appearance="minimal">
                                                            <xforms:label>
                                                               <xhtml:img src="/img/delete16.png" alt="" class="small-button"/>
                                                            </xforms:label>
                                                            <xforms:hint ref="$resources/remove" appearance="minimal"/>
                                                            <xforms:action ev:event="DOMActivate">
                                                               <xforms:send submission="delete-icpc-mapping"/>
                                                               <xforms:send submission="get-ci"/>
                                                            </xforms:action>
                                                         </xforms:trigger>
                                                         <!-- deactivate -->
                                                         <xforms:trigger ref=".[@statusCode='active']" appearance="minimal">
                                                            <xforms:label>
                                                               <xhtml:img src="/img/retire16.png" alt="" class="small-button"/>
                                                            </xforms:label>
                                                            <xforms:hint ref="$resources/set-status-to-retired" appearance="minimal"/>
                                                            <xforms:action ev:event="DOMActivate">
                                                               <xforms:setvalue ref="instance('status-change')/@object" value="'mapping'"/>
                                                               <xforms:setvalue ref="instance('status-change')/@ref" value="instance('selected-ci')/icpc[index('icpc')]/@id"/>
                                                               <xforms:setvalue ref="instance('status-change')/@statusCode" value="'retired'"/>
                                                               <xxforms:show dialog="status-dialog"/>
                                                            </xforms:action>
                                                         </xforms:trigger>
                                                      </xforms:group>
                                                   </xhtml:div>
                                                </xhtml:td>
                                             </xhtml:tr>
                                          </xforms:repeat>
                                       </xhtml:table>
                                    </fr:case>
                                    <!-- ICD9 -->
                                    <fr:case selected="false">
                                       <fr:label ref="$resources/icd9"/>
                                       <xhtml:table width="100%">
                                          <xxforms:variable name="icd9" select="instance('selected-ci')/icd-9[index('icd9')]"/>
                                          <!-- header -->
                                          <xhtml:tr>
                                             <xhtml:td class="heading-small" width="8%">
                                                <xforms:output ref="$resources/code"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="47%">
                                                <xforms:output ref="$resources/description"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="10%">
                                                <xforms:output ref="$resources/date"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="10%">
                                                <xforms:output ref="$resources/expiration-date"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="10%">
                                                <xforms:output ref="$resources/edit-date"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="15%">
                                                <xforms:output ref="$resources/status"/>
                                                <xhtml:div class="buttons">
                                                   <!-- add -->
                                                   <xforms:trigger ref=".[@statusCode=('draft','update')][$editor]" appearance="minimal">
                                                      <xforms:label>
                                                         <xhtml:img src="/img/add16.png" alt="" class="small-button"/>
                                                      </xforms:label>
                                                      <xforms:hint ref="$resources/add" appearance="minimal"/>
                                                      <xforms:action ev:event="DOMActivate">
                                                         <xforms:action ev:event="DOMActivate">
                                                            <xforms:send submission="create-icd9-mapping"/>
                                                            <xforms:send submission="get-ci"/>
                                                         </xforms:action>
                                                      </xforms:action>
                                                   </xforms:trigger>
                                                </xhtml:div>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <!-- ICD9 repeat -->
                                          <xforms:repeat nodeset="icd-9" id="icd9">
                                             <xhtml:tr class="mapping">
                                                <xhtml:td>
                                                   <xforms:input ref="@code" class="code">
                                                      <xforms:action if="$editor" ev:event="DOMFocusOut">
                                                         <xforms:send submission="update-icd9-mapping"/>
                                                         <xforms:send submission="get-ci"/>
                                                      </xforms:action>
                                                   </xforms:input>
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:input ref="desc" class="long-text">
                                                      <xforms:action if="$editor" ev:event="DOMFocusOut">
                                                         <xforms:send submission="update-icd9-mapping"/>
                                                         <xforms:send submission="get-ci"/>
                                                      </xforms:action>
                                                   </xforms:input>
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:output ref="@effectiveDate"
                                                      xxforms:format="if (instance('language')='en-US' and string-length(.) &gt; 0) then format-date(xs:date(.),'[M01]/[D01]/[Y]') else if  (string-length(.) &gt; 0) then format-date(xs:date(.),'[D01]-[M01]-[Y]') else ."
                                                   />
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:output ref="@expirationDate"
                                                      xxforms:format="if (instance('language')='en-US' and string-length(.) &gt; 0) then format-date(xs:date(.),'[M01]/[D01]/[Y]') else if  (string-length(.) &gt; 0) then format-date(xs:date(.),'[D01]-[M01]-[Y]') else ."
                                                   />
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:output ref="@editDate"
                                                      xxforms:format="if (instance('language')='en-US' and string-length(.) &gt; 0) then format-date(xs:date(.),'[M01]/[D01]/[Y]') else if  (string-length(.) &gt; 0) then format-date(xs:date(.),'[D01]-[M01]-[Y]') else ."
                                                   />
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xxforms:variable name="icd9StatusCode" select="@statusCode"/>
                                                   <xforms:output ref="instance('status-codes')/enumeration[@value=$icd9StatusCode]/label[@language=instance('language')]"
                                                      class="node-s{$icd9StatusCode}"/>
                                                   <xhtml:div class="buttons">
                                                      <xforms:group ref=".[parent::ci/@statusCode=('draft','update')][$editor]">
                                                         <!-- delete -->
                                                         <xforms:trigger ref=".[@statusCode='draft']" appearance="minimal">
                                                            <xforms:label>
                                                               <xhtml:img src="/img/delete16.png" alt="" class="small-button"/>
                                                            </xforms:label>
                                                            <xforms:hint ref="$resources/remove" appearance="minimal"/>
                                                            <xforms:action ev:event="DOMActivate">
                                                               <xforms:send submission="delete-icd9-mapping"/>
                                                               <xforms:send submission="get-ci"/>
                                                            </xforms:action>
                                                         </xforms:trigger>
                                                         <!-- deactivate -->
                                                         <xforms:trigger ref=".[@statusCode='active']" appearance="minimal">
                                                            <xforms:label>
                                                               <xhtml:img src="/img/retire16.png" alt="" class="small-button"/>
                                                            </xforms:label>
                                                            <xforms:hint ref="$resources/set-status-to-retired" appearance="minimal"/>
                                                            <xforms:action ev:event="DOMActivate">
                                                               <xforms:setvalue ref="instance('status-change')/@object" value="'mapping'"/>
                                                               <xforms:setvalue ref="instance('status-change')/@ref" value="instance('selected-ci')/icd-9[index('icd9')]/@id"/>
                                                               <xforms:setvalue ref="instance('status-change')/@statusCode" value="'retired'"/>
                                                               <xxforms:show dialog="status-dialog"/>
                                                            </xforms:action>
                                                         </xforms:trigger>
                                                      </xforms:group>
                                                   </xhtml:div>
                                                </xhtml:td>
                                             </xhtml:tr>
                                          </xforms:repeat>
                                       </xhtml:table>
                                    </fr:case>
                                    <!-- ICD10 -->
                                    <fr:case selected="true">
                                       <fr:label ref="$resources/icd10"/>
                                       <xhtml:table width="100%">
                                          <xxforms:variable name="icd10" select="instance('selected-ci')/icd-10[index('icd10')]"/>
                                          <!-- header -->
                                          <xhtml:tr>
                                             <xhtml:td class="heading-small" width="8%">
                                                <xforms:output ref="$resources/code"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="47%">
                                                <xforms:output ref="$resources/description"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="10%">
                                                <xforms:output ref="$resources/date"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="10%">
                                                <xforms:output ref="$resources/expiration-date"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="10%">
                                                <xforms:output ref="$resources/edit-date"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="15%">
                                                <xforms:output ref="$resources/status"/>
                                                <xhtml:div class="buttons">
                                                   <!-- add -->
                                                   <xforms:trigger ref=".[@statusCode=('draft','update')][$editor]" appearance="minimal">
                                                      <xforms:label>
                                                         <xhtml:img src="/img/add16.png" alt="" class="small-button"/>
                                                      </xforms:label>
                                                      <xforms:hint ref="$resources/add" appearance="minimal"/>
                                                      <xforms:action ev:event="DOMActivate">
                                                         <xxforms:show dialog="icd-10-select"/>
                                                         <xforms:setfocus control="claml-search-input"/>
                                                      </xforms:action>
                                                   </xforms:trigger>
                                                </xhtml:div>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <!-- ICD10 repeat -->
                                          <xforms:repeat nodeset="icd-10" id="icd10">
                                             <xhtml:tr class="mapping">
                                                <xhtml:td>
                                                   <xforms:output ref="@code"/>
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:output ref="desc"/>
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:output ref="@effectiveDate"
                                                      xxforms:format="if (instance('language')='en-US' and string-length(.) &gt; 0) then format-date(xs:date(.),'[M01]/[D01]/[Y]') else if  (string-length(.) &gt; 0) then format-date(xs:date(.),'[D01]-[M01]-[Y]') else ."
                                                   />
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:output ref="@expirationDate"
                                                      xxforms:format="if (instance('language')='en-US' and string-length(.) &gt; 0) then format-date(xs:date(.),'[M01]/[D01]/[Y]') else if  (string-length(.) &gt; 0) then format-date(xs:date(.),'[D01]-[M01]-[Y]') else ."
                                                   />
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:output ref="@editDate"
                                                      xxforms:format="if (instance('language')='en-US' and string-length(.) &gt; 0) then format-date(xs:date(.),'[M01]/[D01]/[Y]') else if  (string-length(.) &gt; 0) then format-date(xs:date(.),'[D01]-[M01]-[Y]') else ."
                                                   />
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xxforms:variable name="icd10StatusCode" select="@statusCode"/>
                                                   <xforms:output ref="instance('status-codes')/enumeration[@value=$icd10StatusCode]/label[@language=instance('language')]"
                                                      class="node-s{$icd10StatusCode}"/>
                                                   <xhtml:div class="buttons">
                                                      <xforms:group ref=".[parent::ci/@statusCode=('draft','update')][$editor]">
                                                         <!-- delete -->
                                                         <xforms:trigger ref=".[@statusCode='draft']" appearance="minimal">
                                                            <xforms:label>
                                                               <xhtml:img src="/img/delete16.png" alt="" class="small-button"/>
                                                            </xforms:label>
                                                            <xforms:hint ref="$resources/remove" appearance="minimal"/>
                                                            <xforms:action ev:event="DOMActivate">
                                                               <xforms:send submission="delete-icd10-mapping"/>
                                                               <xforms:send submission="get-ci"/>
                                                            </xforms:action>
                                                         </xforms:trigger>
                                                         <!-- deactivate -->
                                                         <xforms:trigger ref=".[@statusCode='active']" appearance="minimal">
                                                            <xforms:label>
                                                               <xhtml:img src="/img/retire16.png" alt="" class="small-button"/>
                                                            </xforms:label>
                                                            <xforms:hint ref="$resources/set-status-to-retired" appearance="minimal"/>
                                                            <xforms:action ev:event="DOMActivate">
                                                               <xforms:setvalue ref="instance('status-change')/@object" value="'mapping'"/>
                                                               <xforms:setvalue ref="instance('status-change')/@ref" value="instance('selected-ci')/icd-10[index('icd10')]/@id"/>
                                                               <xforms:setvalue ref="instance('status-change')/@statusCode" value="'retired'"/>
                                                               <xxforms:show dialog="status-dialog"/>
                                                            </xforms:action>
                                                         </xforms:trigger>
                                                      </xforms:group>
                                                   </xhtml:div>
                                                </xhtml:td>
                                             </xhtml:tr>
                                          </xforms:repeat>
                                       </xhtml:table>
                                    </fr:case>
                                    <!-- SNOMED CT -->
                                    <fr:case selected="true">
                                       <fr:label ref="$resources/snomed"/>
                                       <xhtml:table width="100%">
                                          <xxforms:variable name="snomed" select="instance('selected-ci')/snomed[index('snomed')]"/>
                                          <!-- header -->
                                          <xhtml:tr>
                                             <xhtml:td class="heading-small" width="8%">
                                                <xforms:output ref="$resources/code"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="47%">
                                                <xforms:output ref="$resources/description"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="10%">
                                                <xforms:output ref="$resources/date"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="10%">
                                                <xforms:output ref="$resources/expiration-date"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="10%">
                                                <xforms:output ref="$resources/edit-date"/>
                                             </xhtml:td>
                                             <xhtml:td class="heading-small" width="15%">
                                                <xforms:output ref="$resources/status"/>
                                                <xhtml:div class="buttons">
                                                   <!-- add -->
                                                   <xforms:trigger ref=".[@statusCode=('draft','update')][$editor]" appearance="minimal">
                                                      <xforms:label>
                                                         <xhtml:img src="/img/add16.png" alt="" class="small-button"/>
                                                      </xforms:label>
                                                      <xforms:hint ref="$resources/add" appearance="minimal"/>
                                                      <xforms:action ev:event="DOMActivate">
                                                         <xxforms:show dialog="snomed-select"/>
                                                         <xforms:setfocus control="search-snomed-description"/>
                                                      </xforms:action>
                                                   </xforms:trigger>
                                                </xhtml:div>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <!-- snomed repeat -->
                                          <xforms:repeat nodeset="snomed" id="snomed">
                                             <xhtml:tr class="mapping">
                                                <xhtml:td>
                                                   <xforms:output ref="@code"/>
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:output ref="desc"/>
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:output ref="@effectiveDate"
                                                      xxforms:format="if (instance('language')='en-US' and string-length(.) &gt; 0) then format-date(xs:date(.),'[M01]/[D01]/[Y]') else if  (string-length(.) &gt; 0) then format-date(xs:date(.),'[D01]-[M01]-[Y]') else ."
                                                   />
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:output ref="@expirationDate"
                                                      xxforms:format="if (instance('language')='en-US' and string-length(.) &gt; 0) then format-date(xs:date(.),'[M01]/[D01]/[Y]') else if  (string-length(.) &gt; 0) then format-date(xs:date(.),'[D01]-[M01]-[Y]') else ."
                                                   />
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xforms:output ref="@editDate"
                                                      xxforms:format="if (instance('language')='en-US' and string-length(.) &gt; 0) then format-date(xs:date(.),'[M01]/[D01]/[Y]') else if  (string-length(.) &gt; 0) then format-date(xs:date(.),'[D01]-[M01]-[Y]') else ."
                                                   />
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xxforms:variable name="icd10StatusCode" select="@statusCode"/>
                                                   <xforms:output ref="instance('status-codes')/enumeration[@value=$icd10StatusCode]/label[@language=instance('language')]"
                                                      class="node-s{$icd10StatusCode}"/>
                                                   <xhtml:div class="buttons">
                                                      <xforms:group ref=".[parent::ci/@statusCode=('draft','update')][$editor]">
                                                         <!-- delete -->
                                                         <xforms:trigger ref=".[@statusCode='draft']" appearance="minimal">
                                                            <xforms:label>
                                                               <xhtml:img src="/img/delete16.png" alt="" class="small-button"/>
                                                            </xforms:label>
                                                            <xforms:hint ref="$resources/remove" appearance="minimal"/>
                                                            <xforms:action ev:event="DOMActivate">
                                                               <xforms:send submission="delete-snomed-mapping"/>
                                                               <xforms:send submission="get-ci"/>
                                                            </xforms:action>
                                                         </xforms:trigger>
                                                         <!-- deactivate -->
                                                         <xforms:trigger ref=".[@statusCode='active']" appearance="minimal">
                                                            <xforms:label>
                                                               <xhtml:img src="/img/retire16.png" alt="" class="small-button"/>
                                                            </xforms:label>
                                                            <xforms:hint ref="$resources/set-status-to-retired" appearance="minimal"/>
                                                            <xforms:action ev:event="DOMActivate">
                                                               <xforms:setvalue ref="instance('status-change')/@object" value="'mapping'"/>
                                                               <xforms:setvalue ref="instance('status-change')/@ref" value="instance('selected-ci')/snomed[index('snomed')]/@id"/>
                                                               <xforms:setvalue ref="instance('status-change')/@statusCode" value="'retired'"/>
                                                               <xxforms:show dialog="status-dialog"/>
                                                            </xforms:action>
                                                         </xforms:trigger>
                                                      </xforms:group>
                                                   </xhtml:div>
                                                </xhtml:td>
                                             </xhtml:tr>
                                          </xforms:repeat>
                                       </xhtml:table>
                                    </fr:case>
                                 </fr:accordion>
                              </xhtml:td>
                           </xhtml:tr>
                        </xforms:group>
                     </xhtml:table>
                  </xhtml:td>
               </xhtml:tr>
            </xhtml:table>
         </fr:tab>
         <!-- RELEASES TAB -->
         <fr:tab>
            <fr:label ref="$resources/releases"/>
            <!-- releases table -->
            <xhtml:table width="100%" class="detail" style="border:2px solid #CCC;margin-top:1em;">
               <!-- heading with buttons -->
               <xhtml:tr>
                  <xhtml:td class="heading" colspan="4">
                     <xhtml:div class="heading">
                        <xforms:output ref="$resources/releases"/>
                     </xhtml:div>
                     <!-- div with buttons -->
                     <xhtml:div class="buttons">
                        <fr:button ref=".[$admin]">
                           <xforms:label>
                              <xhtml:img src="/img/plus.png" alt=""/>
                           </xforms:label>
                           <xforms:hint>
                              <xforms:output ref="$resources/create-release"/>
                           </xforms:hint>
                           <xforms:action ev:event="DOMActivate">
                              <xforms:send submission="check-ci-list"/>
                              <xforms:setvalue ref="instance('new-release')/@effectiveTime" value="current-dateTime()"/>
                              <xxforms:show dialog="release-dialog"/>
                           </xforms:action>
                        </fr:button>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
               <!-- releases heading -->
               <xhtml:tr>
                  <xhtml:td width="25%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                     <xforms:output ref="$resources/label"/>
                  </xhtml:td>
                  <xhtml:td width="10%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                     <xforms:output ref="$resources/date"/>
                  </xhtml:td>
                  <xhtml:td class="heading-small" width="15%">
                     <xforms:output ref="$resources/status"/>
                  </xhtml:td>
                  <xhtml:td width="50%" style="background-color:#f0ebe4;color:#7a6e62;font-weight:bold;padding:0.5em;">
                     <xforms:output ref="$resources/comment"/>
                  </xhtml:td>
               </xhtml:tr>
               <!-- releases -->
               <xforms:repeat nodeset="instance('project')/release" id="releases">
                  <xhtml:tr>
                     <xhtml:td>
                        <xforms:output ref="@label"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="@effectiveTime"
                           xxforms:format="if (instance('language')='en-US') then format-dateTime(xs:dateTime(.),'[M01]/[D01]/[Y]') else format-dateTime(xs:dateTime(.),'[D01]-[M01]-[Y]')"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xxforms:variable name="releaseStatusCode" select="@statusCode"/>
                        <xforms:output ref="instance('release-status-codes')/enumeration[@value=$releaseStatusCode]/label[@language=instance('language')]" class="node-s{$releaseStatusCode}"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output mediatype="text/html" ref="comment"/>
                     </xhtml:td>
                  </xhtml:tr>
                  <xforms:action ev:event="xxforms-index-changed">
                     <xforms:send submission="get-release-notes"/>
                  </xforms:action>
                  <xforms:action ev:event="xxforms-nodeset-changed">
                     <xforms:send submission="get-release-notes"/>
                  </xforms:action>
               </xforms:repeat>
            </xhtml:table>
            <xhtml:table width="100%" class="detail" style="border:2px solid #CCC;margin-top:1em;">
               <!-- group for release details -->
               <xforms:group ref="instance('project')/release[index('releases')]">
                  <!-- heading -->
                  <xhtml:tr>
                     <xhtml:td colspan="4" class="heading">
                        <xhtml:div class="heading">
                           <xforms:output ref="$resources/release"/>: <xforms:output ref="@label"/>
                           <xforms:output ref="$resources/as-of"/>
                           <xforms:output ref="@effectiveTime"
                              xxforms:format="if (instance('language')='en-US') then format-dateTime(xs:dateTime(.),'[M01]/[D01]/[Y]') else format-dateTime(xs:dateTime(.),'[D01]-[M01]-[Y]')"/>
                        </xhtml:div>
                        <xhtml:div class="buttons">
                           <!-- button for authorizing setting status to 'final' -->
                           <fr:button ref=".[@statusCode='draft'][$admin]">
                              <xforms:label>
                                 <xhtml:img src="/img/tick.png" alt=""/>
                              </xforms:label>
                              <xforms:hint>
                                 <xforms:output ref="$resources/authorize-and-release"/>
                              </xforms:hint>
                              <xforms:action ev:event="DOMActivate">
                                 <xforms:setvalue ref="instance('status-change')/@object" value="'release'"/>
                                 <xforms:setvalue ref="instance('status-change')/@ref" value="instance('project')/release[index('releases')]/@effectiveTime"/>
                                 <xforms:setvalue ref="instance('status-change')/@statusCode" value="'final'"/>
                                 <xforms:send submission="set-status"/>
                                 <xforms:send submission="get-project"/>
                                 <xforms:setvalue ref="instance('data-safe')" value="'true'"/>
                              </xforms:action>
                           </fr:button>
                           <fr:button ref=".[@statusCode='draft'][$admin]">
                              <xforms:label>
                                 <xhtml:img src="/img/remove.gif" alt=""/>
                              </xforms:label>
                              <xforms:hint ref="$resources/delete-release"/>
                              <xforms:action ev:event="DOMActivate">
                                 <xforms:send submission="delete-release"/>
                                 <xforms:send submission="get-project"/>
                              </xforms:action>
                           </fr:button>
                           <fr:button>
                              <xforms:label>
                                 <xhtml:img src="/img/download.png" alt=""/>
                              </xforms:label>
                              <xforms:hint ref="$resources/download-zip"/>
                              <xforms:action ev:event="DOMActivate">
                                 <xforms:load resource="{$terminology-external-exist}/ica/getRelease/{format-dateTime(@effectiveTime,'[Y][M01][D01]_[H01][m01][s01]')}" show="new"/>
                              </xforms:action>
                           </fr:button>
                           <fr:button>
                              <xforms:label>
                                 <xhtml:img src="/img/target.png" alt=""/>
                              </xforms:label>
                              <xforms:hint ref="$resources/view-html"/>
                              <xforms:action ev:event="DOMActivate">
                                 <xforms:load resource="{$terminology-external-exist}/ica/RetrieveHTML?release={format-dateTime(@effectiveTime,'[Y][M01][D01]_[H01][m01][s01]')}" show="new"/>
                              </xforms:action>
                           </fr:button>
                        </xhtml:div>
                     </xhtml:td>
                  </xhtml:tr>
                  <!-- status and filename -->
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/status"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xxforms:variable name="releaseStatusCode" select="@statusCode"/>
                        <xforms:output ref="instance('release-status-codes')/enumeration[@value=$releaseStatusCode]/label[@language=instance('language')]" class="node-s{$releaseStatusCode}"/>
                     </xhtml:td>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/name"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="@effectiveTime" xxforms:format="format-dateTime(xs:dateTime(.),'[Y][M01][D01]_[H01][m01][s01]_')"/>
                     </xhtml:td>
                  </xhtml:tr>
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/comment"/>
                     </xhtml:td>
                     <xhtml:td colspan="3">
                        <xforms:output mediatype="text/html" ref="comment"/>
                     </xhtml:td>
                  </xhtml:tr>
               </xforms:group>
               <!-- group for release notes -->
               <xforms:group ref="instance('release-notes')">

                  <!-- heading -->
                  <xhtml:tr>
                     <xhtml:td colspan="4" class="heading">
                        <xhtml:div class="heading">
                           <xforms:output ref="$resources/release-notes"/>
                        </xhtml:div>
                     </xhtml:td>
                  </xhtml:tr>
                  <xhtml:tr>
                     <xhtml:td class="item-label" rowspan="2">
                        <xforms:output ref="$resources/issues"/>
                     </xhtml:td>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/new"/>
                     </xhtml:td>
                     <xhtml:td colspan="2">
                        <xhtml:table width="100%">
                           <xforms:repeat nodeset="issues/new/issue" id="newIssues">
                              <xhtml:tr class="not-selectable">
                                 <xhtml:td>
                                    <xforms:trigger appearance="minimal">
                                       <xforms:label>
                                          <xforms:output ref="."/>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:setvalue ref="instance('selected-issue')/selected" value="instance('release-notes')/issues/new/issue[index('newIssues')]/@id"/>
                                          <xforms:send submission="get-issue-dhd-concept"/>
                                          <xforms:dispatch targetid="issues-tab" name="fr-toggle"/>
                                       </xforms:action>
                                    </xforms:trigger>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:repeat>
                        </xhtml:table>
                     </xhtml:td>
                  </xhtml:tr>
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/resolved"/>
                     </xhtml:td>
                     <xhtml:td colspan="2">
                        <xhtml:table width="100%">
                           <xforms:repeat nodeset="issues/resolved/issue" id="resolvedIssues">
                              <xhtml:tr class="not-selectable">
                                 <xhtml:td>
                                    <xforms:trigger appearance="minimal">
                                       <xforms:label>
                                          <xforms:output ref="."/>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:setvalue ref="instance('selected-issue')/selected" value="instance('release-notes')/issues/resolved/issue[index('resolvedIssues')]/@id"/>
                                          <xforms:send submission="get-issue-dhd-concept"/>
                                          <xforms:dispatch targetid="issues-tab" name="fr-toggle"/>
                                       </xforms:action>
                                    </xforms:trigger>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:repeat>
                        </xhtml:table>
                     </xhtml:td>
                  </xhtml:tr>
                  <!-- NEW -->
                  <xhtml:tr>
                     <xhtml:td class="item-label" rowspan="3">
                        <xforms:output ref="$resources/contra-indications"/>
                     </xhtml:td>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/new"/>
                     </xhtml:td>
                     <xhtml:td colspan="2">
                        <xhtml:table width="100%">
                           <xforms:repeat nodeset="concepts/new/concept" id="newConcepts">
                              <xhtml:tr class="not-selectable">
                                 <xhtml:td>
                                    <xforms:trigger appearance="minimal">
                                       <xforms:label>
                                          <xforms:output ref="."/>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:setvalue ref="instance('ci-navigation')" value="instance('release-notes')/concepts/new/concept[index('newConcepts')]/@id"/>
                                          <xforms:send submission="get-ci"/>
                                          <xforms:dispatch targetid="ica-tab" name="fr-toggle"/>
                                       </xforms:action>
                                    </xforms:trigger>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:repeat>
                        </xhtml:table>
                     </xhtml:td>
                  </xhtml:tr>
                  <!-- UPDATED -->
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/updated"/>
                     </xhtml:td>
                     <xhtml:td colspan="2">
                        <xhtml:table width="100%">
                           <xforms:repeat nodeset="concepts/updated/concept" id="updatedConcepts">
                              <xhtml:tr class="not-selectable">
                                 <xhtml:td>
                                    <xforms:trigger appearance="minimal">
                                       <xforms:label>
                                          <xforms:output ref="."/>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:setvalue ref="instance('ci-navigation')" value="instance('release-notes')/concepts/updated/concept[index('updatedConcepts')]/@id"/>
                                          <xforms:send submission="get-ci"/>
                                          <xforms:dispatch targetid="ica-tab" name="fr-toggle"/>
                                       </xforms:action>
                                    </xforms:trigger>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:repeat>
                        </xhtml:table>
                     </xhtml:td>
                  </xhtml:tr>
                  <!-- RETIRED -->
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/retired"/>
                     </xhtml:td>
                     <xhtml:td colspan="2">
                        <xhtml:table width="100%">
                           <xforms:repeat nodeset="concepts/retired/concept" id="retiredConcepts">
                              <xhtml:tr class="not-selectable">
                                 <xhtml:td>
                                    <xforms:trigger appearance="minimal">
                                       <xforms:label>
                                          <xforms:output ref="."/>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:setvalue ref="instance('ci-navigation')" value="instance('release-notes')/concepts/retired/concept[index('retiredConcepts')]/@id"/>
                                          <xforms:send submission="get-ci"/>
                                          <xforms:dispatch targetid="ica-tab" name="fr-toggle"/>
                                       </xforms:action>
                                    </xforms:trigger>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:repeat>
                        </xhtml:table>
                     </xhtml:td>
                  </xhtml:tr>
               </xforms:group>
            </xhtml:table>
         </fr:tab>
         <!-- GENERAL TAB -->
         <fr:tab>
            <fr:label ref="$resources/general"/>
            <xforms:group ref="instance('project')">
               <!-- Thesaurus metadata -->
               <xhtml:table width="100%" class="detail" style="border:2px solid #CCC;">
                  <xhtml:tr>
                     <xhtml:td class="heading" colspan="2">
                        <xhtml:div class="heading">
                           <xforms:output ref="$resources/general"/>
                        </xhtml:div>
                     </xhtml:td>
                  </xhtml:tr>
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/concepts"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="concepts/@count"/>
                     </xhtml:td>
                  </xhtml:tr>
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/draft"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="concepts/@draft"/>
                     </xhtml:td>
                  </xhtml:tr>
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/update"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="concepts/@update"/>
                     </xhtml:td>
                  </xhtml:tr>
               </xhtml:table>

               <!-- Authors -->
               <xhtml:table width="100%" class="detail" style="border:2px solid #CCC;margin-top:1em;">
                  <!-- row with authors header and buttons -->
                  <xhtml:tr>
                     <xhtml:td class="heading" colspan="7">
                        <xhtml:div class="heading">
                           <xforms:output ref="$resources/users"/>
                        </xhtml:div>
                        <!-- div with buttons -->
                        <xforms:group ref=".[$admin]">
                           <xhtml:div class="buttons">
                              <fr:button id="add-author">
                                 <xforms:label>
                                    <xhtml:img src="/img/plus.png" alt=""/>
                                 </xforms:label>
                                 <xforms:hint>
                                    <xforms:output ref="$resources/add-author"/>
                                 </xforms:hint>
                                 <xforms:action ev:event="DOMActivate">
                                    <xxforms:show dialog="select-user-dialog"/>
                                 </xforms:action>
                              </fr:button>
                              <fr:button id="delete-author">
                                 <xforms:label>
                                    <xhtml:img src="/img/remove.gif" alt=""/>
                                 </xforms:label>
                                 <xforms:hint>
                                    <xforms:output ref="$resources/delete-author"/>
                                 </xforms:hint>
                                 <xforms:action ev:event="DOMActivate">
                                    <xforms:delete context="instance('project')" nodeset="author" at="index('authorList')"/>
                                 </xforms:action>
                              </fr:button>
                              <xforms:group ref=".[instance('data-safe')='false']">
                                 <fr:button>
                                    <xforms:label ref="$resources/cancel"/>
                                    <xforms:action ev:event="DOMActivate">
                                       <xforms:send submission="get-project"/>
                                       <xforms:setvalue ref="instance('data-safe')" value="'true'"/>
                                    </xforms:action>
                                 </fr:button>
                                 <fr:button>
                                    <xforms:label ref="$resources/save"/>
                                    <xforms:action ev:event="DOMActivate">
                                       <xforms:send submission="save-project"/>
                                       <xforms:send submission="get-project"/>
                                       <xforms:setvalue ref="instance('data-safe')" value="'true'"/>
                                    </xforms:action>
                                 </fr:button>
                              </xforms:group>
                           </xhtml:div>
                        </xforms:group>
                     </xhtml:td>
                  </xhtml:tr>
                  <!-- EDITOR -->
                  <xforms:group ref=".[$admin]">
                     <xhtml:tr>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/id"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/user-name"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/name"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/issues"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/edit"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/authorize"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/admin"/>
                        </xhtml:td>
                     </xhtml:tr>
                     <xforms:repeat nodeset="author" id="authorList">
                        <xhtml:tr>
                           <xhtml:td>
                              <xforms:output ref="@id"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xxforms:variable name="username" select="@username"/>
                              <xforms:output ref="@username"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="."/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@issues" class="auto-width"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@edit" class="auto-width"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@authorize" class="auto-width"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@admin" class="auto-width"/>
                           </xhtml:td>
                        </xhtml:tr>
                     </xforms:repeat>
                  </xforms:group>
                  <!-- VIEWER -->
                  <xforms:group ref=".[not($admin)]">
                     <xhtml:tr>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/name"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/issues"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/edit"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/authorize"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/admin"/>
                        </xhtml:td>
                        <!--                            <xhtml:td class="item-label">
                                <xforms:output ref="$resources/username"/>
                            </xhtml:td>-->
                     </xhtml:tr>
                     <xforms:repeat nodeset="author">
                        <xhtml:tr class="not-selectable">
                           <xhtml:td>
                              <xforms:output ref="."/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@issues" class="auto-width"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@edit" class="auto-width"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@authorize" class="auto-width"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@admin" class="auto-width"/>
                           </xhtml:td>
                        </xhtml:tr>
                     </xforms:repeat>
                  </xforms:group>
               </xhtml:table>
            </xforms:group>
         </fr:tab>
         <!-- ISSUES tab -->
         <fr:tab id="issues-tab">
            <fr:label ref="$resources/issues"/>
            <xhtml:table width="100%">
               <!-- row with issues table -->
               <xhtml:tr>
                  <xhtml:td>
                     <xhtml:div class="buttons">
                        <xforms:group ref=".[$issueCreator]">
                           <fr:button id="add-general-issue">
                              <xforms:label>
                                 <xhtml:img src="/img/tracking.png" alt=""/>
                              </xforms:label>
                              <xforms:hint>
                                 <xforms:output ref="$resources/add-general-issue"/>
                              </xforms:hint>
                              <xforms:action ev:event="DOMActivate">
                                 <xforms:insert nodeset="instance('issues-instance')/issue" at="1" position="before" origin="instance('issue-instance')/issue"/>
                                 <xforms:delete ref="instance('issues-instance')/issue[1]/object"/>
                                 <xforms:setvalue ref="instance('issues-instance')/issue[1]/tracking/author" value="xxforms:get-session-attribute('username')"/>
                                 <xforms:setvalue ref="instance('issues-instance')/issue[1]/tracking/author/@id"
                                    value="instance('project')/project/author[@username=xxforms:get-session-attribute('username')]/@id"/>
                                 <xforms:setvalue ref="instance('issues-instance')/issue[1]/tracking/desc/@language" value="instance('language')"/>
                                 <xforms:setfocus control="general-issue-title"/>
                              </xforms:action>
                           </fr:button>
                        </xforms:group>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
               <!-- group for issue creation -->
               <xforms:group ref="instance('issues-instance')/issue[tracking][not(object)]">
                  <xhtml:tr>
                     <xhtml:td class="heading">
                        <xhtml:div class="heading">
                           <xforms:output ref="$resources/new-issue"/>
                        </xhtml:div>
                     </xhtml:td>
                  </xhtml:tr>
                  <xhtml:tr>
                     <xhtml:td>
                        <xhtml:table width="100%">
                           <!-- issue type -->
                           <xhtml:tr>
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/type"/>
                              </xhtml:td>
                              <xhtml:td>
                                 <xforms:select1 ref="@type" appearance="minimal">
                                    <xforms:itemset nodeset="instance('decor-types')/IssueType/enumeration">
                                       <xforms:label ref="label[@language=instance('language')]"/>
                                       <xforms:value ref="@value"/>
                                    </xforms:itemset>
                                 </xforms:select1>
                              </xhtml:td>
                           </xhtml:tr>
                           <!-- issue priority -->
                           <xhtml:tr>
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/priority"/>
                              </xhtml:td>
                              <xhtml:td>
                                 <xforms:select1 ref="@priority" appearance="minimal">
                                    <xforms:itemset nodeset="instance('decor-types')/IssuePriority/enumeration">
                                       <xforms:label ref="label[@language=instance('language')]"/>
                                       <xforms:value ref="@value"/>
                                    </xforms:itemset>
                                 </xforms:select1>
                              </xhtml:td>
                           </xhtml:tr>
                           <!-- title -->
                           <xhtml:tr>
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/title"/>
                              </xhtml:td>
                              <xhtml:td>
                                 <xforms:input id="general-issue-title" ref="@displayName"/>
                              </xhtml:td>
                           </xhtml:tr>
                           <!-- description of issue -->
                           <xhtml:tr>
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/description"/>
                              </xhtml:td>
                              <xhtml:td>
                                 <xforms:textarea mediatype="text/html" ref="tracking/desc"/>
                              </xhtml:td>
                           </xhtml:tr>
                           <!-- save and cancel buttons -->
                           <xhtml:tr>
                              <xhtml:td class="item-label" colspan="2">
                                 <xhtml:div class="buttons">
                                    <fr:button>
                                       <xforms:label ref="$resources/cancel"/>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:delete ref="instance('issues-instance')/issue"/>
                                          <xforms:setvalue ref="instance('data-safe')">true</xforms:setvalue>
                                       </xforms:action>
                                    </fr:button>
                                    <fr:button>
                                       <xforms:label ref="$resources/save-issue"/>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:send submission="save-general-ica-issue"/>
                                          <xforms:send submission="get-ica-issues"/>
                                          <xforms:delete ref="instance('issues-instance')/issue[tracking][not(object)]"/>
                                          <xforms:setvalue ref="instance('data-safe')">true</xforms:setvalue>
                                       </xforms:action>
                                    </fr:button>
                                 </xhtml:div>
                              </xhtml:td>
                           </xhtml:tr>
                        </xhtml:table>
                     </xhtml:td>
                  </xhtml:tr>
               </xforms:group>
            </xhtml:table>
            <fr:accordion class="fr-accordion-lnf">
               <fr:case selected="false" id="search-box">
                  <fr:label ref="$resources/selection"/>
                  <xhtml:table width="100%">
                     <!-- row with issues table -->
                     <xhtml:tr>
                        <xhtml:td colspan="6">
                           <xhtml:b>
                              <xforms:output ref="$resources/show"/>
                              <xforms:output
                                 ref="concat(' (', $resources/issues, ': ', count(instance('ica-issues')/issue[if (string-length(instance('selected-issue-id'))&gt;0) then (tokenize(@id,'\.')[last()]=instance('selected-issue-id')) else (@currentStatusCode=tokenize(instance('selected-status-codes'),' ') and @type=tokenize(instance('selected-issue-types'),' ') and (instance('selected-issue-priorities')='' or @priority=tokenize(instance('selected-issue-priorities'),' ')) and (instance('selected-issue-assignee')='' or @lastAssignment=instance('selected-issue-assignee')))]), ' / ', count(instance('ica-issues')/issue), ')')"
                              />
                           </xhtml:b>
                        </xhtml:td>
                     </xhtml:tr>
                     <xhtml:tr>
                        <xhtml:td class="item-label">
                           <xforms:output ref="concat($resources/status,': ')"/>
                        </xhtml:td>
                        <xhtml:td>
                           <xforms:select ref="instance('selected-status-codes')" appearance="full">
                              <xforms:itemset nodeset="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value!='new']">
                                 <xforms:label ref="label[@language=instance('language')]"/>
                                 <xforms:value ref="@value"/>
                              </xforms:itemset>
                           </xforms:select>
                        </xhtml:td>
                        <xhtml:td class="item-label">
                           <xforms:output ref="concat($resources/type,': ')"/>
                        </xhtml:td>
                        <xhtml:td>
                           <xforms:select ref="instance('selected-issue-types')" appearance="full">
                              <xforms:itemset nodeset="instance('decor-types')/IssueType/enumeration">
                                 <xforms:label ref="label[@language=instance('language')]"/>
                                 <xforms:value ref="@value"/>
                              </xforms:itemset>
                           </xforms:select>
                        </xhtml:td>
                        <xhtml:td class="item-label">
                           <xforms:output ref="concat($resources/priority,': ')"/>
                        </xhtml:td>
                        <xhtml:td>
                           <xforms:select ref="instance('selected-issue-priorities')" appearance="full">
                              <xforms:itemset nodeset="instance('decor-types')/IssuePriority/enumeration">
                                 <xforms:label ref="label[@language=instance('language')]"/>
                                 <xforms:value ref="@value"/>
                              </xforms:itemset>
                           </xforms:select>
                        </xhtml:td>
                     </xhtml:tr>
                     <xhtml:tr>
                        <xhtml:td class="item-label">
                           <xforms:output ref="concat($resources/assigned-to,': ')"/>
                        </xhtml:td>
                        <xhtml:td colspan="5">
                           <xforms:select1 ref="instance('selected-issue-assignee')" class="auto-width" appearance="minimal">
                              <xforms:item>
                                 <xforms:label>-</xforms:label>
                                 <xforms:value/>
                              </xforms:item>
                              <xforms:itemset nodeset="distinct-values(instance('ica-issues')//issue[string-length(@lastAssignment)&gt;0]/@lastAssignment)">
                                 <xforms:label ref="."/>
                                 <xforms:value ref="."/>
                              </xforms:itemset>
                           </xforms:select1>
                        </xhtml:td>
                     </xhtml:tr>
                  </xhtml:table>
               </fr:case>
               <fr:case selected="true" id="result-box">
                  <fr:label ref="$resources/results"/>
                  <xhtml:table width="100%">
                     <!-- row with issues table -->
                     <xhtml:tr>
                        <xhtml:td>
                           <xhtml:div class="detail">
                              <fr:datatable width="100%" scrollable="vertical" height="200px">
                                 <xhtml:thead>
                                    <xhtml:tr>
                                       <xhtml:th fr:sortable="true" fr:resizeable="true">
                                          <xforms:output ref="$resources/issue"/>
                                       </xhtml:th>
                                       <xhtml:th fr:sortable="true" fr:sortKey="@currentStatusCode" fr:resizeable="true">
                                          <xforms:output ref="$resources/status"/>
                                       </xhtml:th>
                                       <xhtml:th fr:sortable="true" fr:sortKey="@priority" fr:resizeable="true">
                                          <xforms:output ref="$resources/priority"/>
                                       </xhtml:th>
                                       <xhtml:th fr:sortable="true" fr:resizeable="true">
                                          <xforms:output ref="$resources/type"/>
                                       </xhtml:th>
                                       <xhtml:th fr:sortable="true" fr:resizeable="true">
                                          <xforms:output ref="$resources/date"/>
                                       </xhtml:th>
                                       <xhtml:th fr:sortable="true" fr:sorted="ascending" fr:resizeable="true">
                                          <xforms:output ref="$resources/assigned-to"/>
                                       </xhtml:th>
                                    </xhtml:tr>
                                 </xhtml:thead>
                                 <xhtml:tbody>
                                    <xhtml:tr
                                       repeat-nodeset="instance('ica-issues')/issue[if (string-length(instance('selected-issue-id'))&gt;0) then (tokenize(@id,'\.')[last()]=instance('selected-issue-id')) else (@currentStatusCode=tokenize(instance('selected-status-codes'),' ') and @type=tokenize(instance('selected-issue-types'),' ') and (instance('selected-issue-priorities')='' or @priority=tokenize(instance('selected-issue-priorities'),' ')) and (instance('selected-issue-assignee')='' or @lastAssignment=instance('selected-issue-assignee')))]"
                                       id="open-issue-table">
                                       <xxforms:variable name="type" select="@type"/>
                                       <xhtml:td>
                                          <xforms:output ref="@displayName"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xxforms:variable name="currentStatusCode" select="@currentStatusCode"/>
                                          <xforms:output ref="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value=$currentStatusCode]/label[@language=instance('language')]"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xxforms:variable name="priority" select="@priority"/>
                                          <xforms:output ref="instance('decor-types')/IssuePriority/enumeration[@value=$priority]/label[@language=instance('language')]"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@typeName"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@lastDate"
                                             xxforms:format="if (instance('language')='en-US') then format-dateTime(xs:dateTime(.),'[M01]/[D01]/[Y]',(), (), ()) else format-dateTime(xs:dateTime(.),'[D01]-[M01]-[Y]', (), (), ())"
                                          />
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@lastAssignment"/>
                                       </xhtml:td>
                                    </xhtml:tr>
                                 </xhtml:tbody>
                                 <xforms:action ev:event="fr-selection-changed">
                                    <xforms:setvalue ref="instance('selected-issue')/selected" value="event('selected')/@id"/>
                                 </xforms:action>
                              </fr:datatable>
                           </xhtml:div>
                        </xhtml:td>
                     </xhtml:tr>
                  </xhtml:table>
               </fr:case>
            </fr:accordion>
            <xhtml:table width="100%">
               <!-- row with issue details -->
               <xhtml:tr>
                  <xhtml:td>
                     <xhtml:div class="detail">
                        <xforms:group ref="instance('ica-issues')/issue[@id=instance('selected-issue')/selected]">
                           <xhtml:table width="100%">
                              <!-- row with issue header -->
                              <xhtml:tr>
                                 <xhtml:td class="heading" colspan="2">
                                    <xhtml:div class="heading">
                                       <xforms:output ref="@typeName"/>: 
                                     <xforms:output ref="@displayName"/>
                                    </xhtml:div>
                                 </xhtml:td>
                              </xhtml:tr>
                              <xhtml:tr>
                                 <xhtml:td class="item-label">
                                    <xforms:output ref="$resources/priority"/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xxforms:variable name="priority" select="@priority"/>
                                    <xforms:output ref="instance('decor-types')/IssuePriority/enumeration[@value=$priority]/label[@language=instance('language')]"/>
                                 </xhtml:td>
                              </xhtml:tr>
                              <xhtml:tr>
                                 <xhtml:td class="item-label">
                                    <xforms:output ref="$resources/status"/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xxforms:variable name="statusCode" select="@currentStatusCode"/>
                                    <xforms:output ref="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value=$statusCode]/label[@language=instance('language')]"/>
                                 </xhtml:td>
                              </xhtml:tr>
                              <!-- issue objects -->
                              <xhtml:tr>
                                 <xhtml:td class="item-label">
                                    <xforms:output ref="$resources/concerns"/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xforms:trigger appearance="minimal">
                                       <xforms:label>
                                          <strong>
                                             <xforms:output ref="instance('ci-list')/ci[@id=instance('ica-issues')/issue[@id=instance('selected-issue')/selected]/object/@id]/text"/>
                                          </strong>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xxforms:variable name="user" select="xxforms:get-session-attribute('username')"/>
                                          <xforms:setvalue ref="instance('ci-navigation')" value="instance('ica-issues')/issue[@id=instance('selected-issue')/selected]/object/@id"/>
                                          <xforms:dispatch targetid="ica-tab" name="fr-toggle"/>
                                          <xforms:setfocus control="navigate"/>
                                       </xforms:action>
                                    </xforms:trigger>
                                 </xhtml:td>
                              </xhtml:tr>
                              <!-- issue trackings and assignments header with buttons -->
                              <xhtml:tr>
                                 <xhtml:td class="heading" colspan="2">
                                    <xhtml:div class="heading">
                                       <xforms:output ref="$resources/events"/>
                                    </xhtml:div>
                                    <xforms:group ref=".[$issueCreator]">
                                       <xhtml:div class="buttons">
                                          <fr:button>
                                             <xforms:label>
                                                <xhtml:img src="/img/tracking.png" alt=""/>
                                             </xforms:label>
                                             <xforms:hint>
                                                <xforms:output ref="$resources/add"/>
                                             </xforms:hint>
                                             <xforms:action ev:event="DOMActivate">
                                                <xxforms:variable name="user" select="xxforms:get-session-attribute('username')"/>
                                                <xforms:setvalue ref="instance('tracking-instance')/tracking/author/@id" value="instance('project')/author[@username=$user]/@id"/>
                                                <xforms:setvalue ref="instance('tracking-instance')/tracking/author" value="instance('project')/author[@username=$user]"/>
                                                <xforms:setvalue ref="instance('tracking-instance')/tracking/desc/@language" value="instance('language')"/>
                                                <xforms:insert context="instance('ica-issues')/issue[@id=instance('selected-issue')/selected]" nodeset="*" at="last()" position="after"
                                                   origin="instance('tracking-instance')/tracking"/>
                                                <xforms:setfocus control="tracking-description"/>
                                             </xforms:action>
                                          </fr:button>
                                          <fr:button>
                                             <xforms:label>
                                                <xhtml:img src="/img/arrowright.png" alt=""/>
                                             </xforms:label>
                                             <xforms:hint>
                                                <xforms:output ref="$resources/assign"/>
                                             </xforms:hint>
                                             <xforms:action ev:event="DOMActivate">
                                                <xxforms:variable name="user" select="xxforms:get-session-attribute('username')"/>
                                                <xforms:setvalue ref="instance('assignment-instance')/assignment/author/@id" value="instance('project')/author[@username=$user]/@id"/>
                                                <xforms:setvalue ref="instance('assignment-instance')/assignment/@to" value="instance('project')/author[@username=$user]/@id"/>
                                                <xforms:setvalue ref="instance('assignment-instance')/assignment/author" value="instance('project')/author[@username=$user]"/>
                                                <xforms:setvalue ref="instance('assignment-instance')/assignment/@name" value="instance('project')/author[@username=$user]"/>
                                                <xforms:setvalue ref="instance('assignment-instance')/assignment/desc/@language" value="instance('language')"/>
                                                <xforms:insert context="instance('ica-issues')/issue[@id=instance('selected-issue')/selected]" nodeset="*" at="last()" position="after"
                                                   origin="instance('assignment-instance')/assignment"/>
                                                <xforms:setfocus control="assignment-description"/>
                                             </xforms:action>
                                          </fr:button>
                                       </xhtml:div>
                                    </xforms:group>
                                 </xhtml:td>
                              </xhtml:tr>
                              <!-- tracking and assignment editor -->
                              <xhtml:tr>
                                 <xhtml:td colspan="2">
                                    <!-- new tracking editor -->
                                    <xforms:group ref="instance('ica-issues')/issue[@id=instance('selected-issue')/selected]/tracking[string-length(@effectiveDate)=0]">
                                       <xhtml:table width="100%">
                                          <!-- trackings -->
                                          <xhtml:tr>
                                             <xhtml:td class="item-label">
                                                <xforms:output ref="$resources/new-event"/>
                                             </xhtml:td>
                                             <xhtml:td>
                                                <xhtml:table width="100%">
                                                   <!-- tracking type -->
                                                   <xhtml:tr>
                                                      <xhtml:td class="item-label">
                                                         <xforms:output ref="$resources/issue-status"/>
                                                      </xhtml:td>
                                                      <xhtml:td>
                                                         <fr:select1-button ref="@statusCode" appearance="minimal">
                                                            <xforms:itemset nodeset="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration">
                                                               <xforms:label ref="label[@language=instance('language')]"/>
                                                               <xforms:value ref="@value"/>
                                                            </xforms:itemset>
                                                         </fr:select1-button>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                   <!-- description of tracking -->
                                                   <xhtml:tr>
                                                      <xhtml:td class="item-label">
                                                         <xforms:output ref="$resources/description"/>
                                                      </xhtml:td>
                                                      <xhtml:td>
                                                         <xforms:textarea id="tracking-description" mediatype="text/html" ref="desc[@language=instance('language')]"/>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                   <!-- save and cancel buttons -->
                                                   <xhtml:tr>
                                                      <xhtml:td class="item-label" colspan="2">
                                                         <xhtml:div class="buttons">
                                                            <fr:button>
                                                               <xforms:label ref="$resources/cancel"/>
                                                               <xforms:action ev:event="DOMActivate">
                                                                  <xforms:delete
                                                                     ref="instance('ica-issues')/issue/tracking[../@id=instance('selected-issue')/selected and string-length(@effectiveDate)=0]"/>
                                                               </xforms:action>
                                                            </fr:button>
                                                            <fr:button>
                                                               <xforms:label ref="$resources/save-tracking"/>
                                                               <xforms:action ev:event="DOMActivate">
                                                                  <xxforms:variable name="currentIssue" select="instance('selected-issue')/selected"/>
                                                                  <xforms:setvalue
                                                                     ref="instance('ica-issues')/issue/tracking[../@id=instance('selected-issue')/selected and string-length(@effectiveDate)=0]/@effectiveDate"
                                                                     value="format-dateTime(current-dateTime(), '[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01]')"/>
                                                                  <xforms:send submission="update-ica-issue"/>
                                                                  <xforms:send submission="get-ica-issues"/>
                                                               </xforms:action>
                                                            </fr:button>
                                                         </xhtml:div>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                </xhtml:table>
                                             </xhtml:td>
                                          </xhtml:tr>
                                       </xhtml:table>
                                    </xforms:group>
                                    <!-- new assignment editor -->
                                    <xforms:group ref="instance('ica-issues')/issue[@id=instance('selected-issue')/selected]/assignment[@effectiveDate/string-length()=0]">
                                       <xhtml:table width="100%">
                                          <!-- assignment -->
                                          <xhtml:tr>
                                             <xhtml:td class="item-label">
                                                <xforms:output ref="$resources/new-assignment"/>
                                             </xhtml:td>
                                             <xhtml:td>
                                                <xhtml:table width="100%">
                                                   <!-- assign to -->
                                                   <xhtml:tr>
                                                      <xhtml:td class="item-label">
                                                         <xforms:output ref="$resources/assign-to"/>
                                                      </xhtml:td>
                                                      <xhtml:td>
                                                         <fr:select1-button ref="@to" appearance="minimal">
                                                            <xforms:itemset nodeset="instance('project')/author">
                                                               <xforms:label ref="."/>
                                                               <xforms:value ref="@id"/>
                                                            </xforms:itemset>
                                                            <xforms:action ev:event="xforms-value-changed">
                                                               <xxforms:variable name="id"
                                                                  select="instance('ica-issues')/issue/assignment[../@id=instance('selected-issue')/selected and @effectiveDate/string-length()=0]/@to"/>
                                                               <xforms:setvalue
                                                                  ref="instance('ica-issues')/issue/assignment[../@id=instance('selected-issue')/selected and @effectiveDate/string-length()=0]/@name"
                                                                  value="instance('project')/author[@id=$id]"/>
                                                            </xforms:action>
                                                         </fr:select1-button>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                   <!-- description of assignment -->
                                                   <xhtml:tr>
                                                      <xhtml:td class="item-label">
                                                         <xforms:output ref="$resources/description"/>
                                                      </xhtml:td>
                                                      <xhtml:td>
                                                         <xforms:textarea id="assignment-description" mediatype="text/html" ref="desc[@language=instance('language')]"/>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                   <!-- save and cancel buttons -->
                                                   <xhtml:tr>
                                                      <xhtml:td class="item-label" colspan="2">
                                                         <xhtml:div class="buttons">
                                                            <fr:button>
                                                               <xforms:label ref="$resources/cancel"/>
                                                               <xforms:action ev:event="DOMActivate">
                                                                  <xforms:delete
                                                                     ref="instance('ica-issues')/issue/assignment[../@id=instance('selected-issue')/selected and string-length(@effectiveDate)=0]"/>
                                                               </xforms:action>
                                                            </fr:button>
                                                            <fr:button>
                                                               <xforms:label ref="$resources/assign"/>
                                                               <xforms:action ev:event="DOMActivate">
                                                                  <xforms:setvalue
                                                                     ref="instance('ica-issues')/issue/assignment[../@id=instance('selected-issue')/selected and string-length(@effectiveDate)=0]/@effectiveDate"
                                                                     value="format-dateTime(current-dateTime(), '[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01]')"/>
                                                                  <xforms:send submission="update-ica-issue"/>
                                                                  <xforms:send submission="get-ica-issues"/>
                                                               </xforms:action>
                                                            </fr:button>
                                                         </xhtml:div>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                </xhtml:table>
                                             </xhtml:td>
                                          </xhtml:tr>
                                       </xhtml:table>
                                    </xforms:group>
                                 </xhtml:td>
                              </xhtml:tr>
                              <!-- trackings and assignments -->
                              <xhtml:tr>
                                 <xhtml:td colspan="2">
                                    <xhtml:table width="100%">
                                       <xforms:repeat nodeset="tracking[string-length(@effectiveDate)&gt;0]|assignment[string-length(@effectiveDate)&gt;0]">
                                          <xhtml:tr class="not-selectable">
                                             <xhtml:td class="item-label-var" width="5%">
                                                <xforms:group ref=".[name()='assignment']">
                                                   <xforms:output mediatype="image/*" value="'/img/arrowright.png'">
                                                      <xforms:hint ref="$resources/assignment"/>
                                                   </xforms:output>
                                                </xforms:group>
                                                <xforms:group ref=".[name()='tracking']">
                                                   <xforms:output mediatype="image/*" value="'/img/tracking.png'">
                                                      <xforms:hint ref="$resources/tracking"/>
                                                   </xforms:output>
                                                </xforms:group>
                                             </xhtml:td>
                                             <xhtml:td class="item-label-var" width="10%">
                                                <xforms:group ref="@statusCode">
                                                   <xxforms:variable name="status" select="."/>
                                                   <!--
                                                            <xforms:output ref="$resources/issue-status"/>
                                                            <xforms:output ref="': '"/>
                                                            -->
                                                   <xforms:output mediatype="image/*" value="concat('/img/IssueStatusCodeLifeCycle_',.,'.png')">
                                                      <xforms:hint>
                                                         <xforms:output ref="$resources/status"/> = 
                                                                    <xforms:output
                                                            ref="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value=$status]/label[@language=instance('language')]"/>
                                                      </xforms:hint>
                                                   </xforms:output>
                                                   <xforms:output ref="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value=$status]/label[@language=instance('language')]"/>
                                                </xforms:group>
                                             </xhtml:td>
                                             <xhtml:td class="heading-var" width="85%">
                                                <!-- date -->
                                                <xforms:output ref="@effectiveDate" xxforms:format="format-dateTime(xs:dateTime(.),'[Y]-[M01]-[D01]', (), (), ())"/>
                                                <xforms:output ref="': '"/>
                                                <!-- assignment to: -->
                                                <xforms:group ref=".[name()='assignment']">
                                                   <xforms:output ref="$resources/assigned-to"/>
                                                   <xforms:output ref="@name"/>
                                                </xforms:group>
                                                <!-- tracking -->
                                                <xforms:group ref=".[name()='tracking']">
                                                   <xforms:output ref="$resources/tracking"/>
                                                </xforms:group>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <xhtml:tr class="not-selectable">
                                             <xhtml:td class="item-label-var" width="5%">
                                                <xforms:output ref="$resources/author"/>
                                             </xhtml:td>
                                             <xhtml:td class="item-label-var" width="5%">
                                                <xforms:output ref="author"/>
                                             </xhtml:td>
                                             <xhtml:td class="desc-var">
                                                <xforms:output mediatype="text/html" ref="desc"/>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <xhtml:tr class="not-selectable">
                                             <xhtml:td colspan="3"/>
                                          </xhtml:tr>
                                       </xforms:repeat>
                                    </xhtml:table>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xhtml:table>
                        </xforms:group>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
            </xhtml:table>
         </fr:tab>
      </fr:tabview>
      <!--      <fr:xforms-inspector/>-->
   </xhtml:body>
</xhtml:html>
