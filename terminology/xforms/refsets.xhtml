<!--
    Copyright (C) 2011
    
    Author: Gerrit Boers

    This program is free software; you can redistribute it and/or modify it under the terms of the
    GNU Lesser General Public License as published by the Free Software Foundation; either version
    2.1 of the License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
    without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
    See the GNU Lesser General Public License for more details.

    The full text of the license is available at http://www.gnu.org/copyleft/lesser.html
-->
<xhtml:html xmlns:f="http://orbeon.org/oxf/xml/formatting" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xhtml="http://www.w3.org/1999/xhtml"
   xmlns:fr="http://orbeon.org/oxf/xml/form-runner" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xxforms="http://orbeon.org/oxf/xml/xforms" xmlns:widget="http://orbeon.org/oxf/xml/widget"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="decor-terminology" xsi:schemaLocation="http://www.w3.org/1999/xhtml ../../orbeon_schemas/xhtml1-transitional-orbeon.xsd">
   <xhtml:head>
      <xhtml:style type="text/css"
         >
         .xforms-select1-appearance-full span
         {
         display: block;
         clear: both 
         } 
         .xforms-select-appearance-full span { display: block; clear: both } 
         .xforms-repeat-selected-item-2 {
         font-weight: normal;
         background-color: inherit; 
         color : black
         }
         td.item-label-var, td.heading-var {
         background-color:#f0ebe4;
         color:#7a6e62;
         padding-left : 0.5em;
         padding-right : 0em;
         padding-top : 0.25em;
         padding-bottom : 0.25em;
         text-align:left;
         vertical-align:top;
         }
         td.heading-var {
         font-weight: bold;
         }
         td.desc-var {
         padding-left : 0.5em;
         padding-right : 0em;
         padding-top : 0.25em;
         padding-bottom : 0.25em;
         }         
         div.heading-alert {
         float:left;
         color : red;
         font-style : italic;
         font-size : 1.25em;
         font-weight : bold;
         vertical-align: middle;
         }
         .node-alert {
         color: red; 
         font-style : italic;
         }
      </xhtml:style>
      <xhtml:title>
         <!--  <xforms:output ref="$resources/snomed-ct"/>
            <xforms:output ref="$resources/reference-sets"/>-->
         <xforms:output ref="instance('refset-project')/name[@language=instance('language')]"/>
      </xhtml:title>
      <xforms:model>
         <!-- Variable with path to art-exist for use by form -->
         <xxforms:variable name="art-exist" select="xxforms:property('art.exist.url')"/>
         <!-- Variable with path to decor-eXist used to pass to client as link for services (Diagrams in new window) -->
         <xxforms:variable name="decor-exist" select="xxforms:property('decor.exist.url')"/>
         <!-- Variable with path to terminology-eXist used to pass to client as link for services (SNOMED, LOINC) -->
         <xxforms:variable name="terminology-exist" select="xxforms:property('terminology.exist.url')"/>
         <xxforms:variable name="terminology-external-exist" select="xxforms:property('terminology.external.exist.url')"/>
         <!-- resources for internationalization -->
         <xforms:instance id="resources-instance">
            <dummy/>
         </xforms:instance>
         <!-- submission for loading resources -->
         <xforms:submission id="get-resources-submission" serialization="none" method="get" resource="{$art-exist}/modules/get-form-resources.xquery?packageRoot=terminology" replace="instance"
            instance="resources-instance">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred:<xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- language -->
         <xforms:instance id="language">
            <language/>
         </xforms:instance>
         <!-- instance for status codes enumeration -->
         <xforms:instance id="status-codes">
            <itemStatusCodeLifeCycle>
               <enumeration value="draft">
                  <label language="nl-NL">Ontwerp</label>
                  <label language="en-US">Draft</label>
                  <label language="de-DE">Entwurf</label>
               </enumeration>
               <enumeration value="active">
                  <label language="nl-NL">Actief</label>
                  <label language="en-US">Active</label>
                  <label language="de-DE">Aktiv</label>
               </enumeration>
               <enumeration value="retired">
                  <label language="nl-NL">Obsoleet</label>
                  <label language="en-US">Retired</label>
                  <label language="de-DE">Obsolet</label>
               </enumeration>
               <enumeration value="rejected">
                  <label language="nl-NL">Afgewezen</label>
                  <label language="en-US">Rejected</label>
                  <label language="de-DE">Abgewiesen</label>
               </enumeration>
               <enumeration value="update">
                  <label language="nl-NL">In bewerking</label>
                  <label language="en-US">Under update</label>
                  <label language="de-DE">In Bearbeitung</label>
               </enumeration>
               <enumeration value="pending">
                  <label language="nl-NL">Gepland voor activatie</label>
                  <label language="en-US">scheduled for activation</label>
                  <label language="de-DE"/>
               </enumeration>
               <enumeration value="review">
                  <label language="nl-NL">Wordt gereviewed</label>
                  <label language="en-US">In Review</label>
                  <label language="de-DE">In Revision</label>
               </enumeration>
            </itemStatusCodeLifeCycle>
         </xforms:instance>
         <!-- instance for status codes enumeration -->
         <xforms:instance id="release-status-codes">
            <releaseStatusCodeLifeCycle>
               <enumeration value="draft">
                  <label language="nl-NL">Voorlopig</label>
                  <label language="en-US">Draft</label>
                  <label language="de-DE"/>
               </enumeration>
               <enumeration value="final">
                  <label language="nl-NL">Definitief</label>
                  <label language="en-US">Final</label>
                  <label language="de-DE"/>
               </enumeration>
               <enumeration value="deprecated">
                  <label language="nl-NL">Vervallen</label>
                  <label language="en-US">Deprecated</label>
                  <label language="de-DE"/>
               </enumeration>
            </releaseStatusCodeLifeCycle>
         </xforms:instance>
         <!-- instance for DECOR Schema types -->
         <xforms:instance id="decor-types">
            <dummy/>
         </xforms:instance>
         <!-- get decor types submission -->
         <xforms:submission id="get-decor-types" serialization="none" method="get" resource="{$art-exist}/modules/get-decor-schema-enumerations.xq" replace="instance" instance="decor-types"
            xxforms:readonly="true"/>
         <!-- warning message texts -->
         <xforms:instance id="messages" xxforms:exclude-result-prefixes="#all">
            <messages>
               <status-final language="nl-NL">
                  <div class="h2">Snomed-CT ID genereren</div>
                  <p>Om de term te kunnen opnemen in Snomed-CT wordt een ID gegenereerd.</p>
                  <p>Let op: deze handeling kan niet ongedaan gemaakt worden!</p>
               </status-final>
               <status-final language="en-US">
                  <div class="h2">Generate Snomed-CT ID</div>
                  <p>To be able to include this term in Snomed-CT an ID will be generated.</p>
                  <p>Beware: this action cannot be undone!</p>
               </status-final>
               <translation-exists language="nl-NL">
                  <p>Term komt voor in de volgende referentieset(s)</p>
               </translation-exists>
               <translation-exists language="en-US">
                  <p>Term occurs in the following reference set(s)</p>
               </translation-exists>
            </messages>
         </xforms:instance>


         <!-- instance for edit status -->
         <xforms:instance id="data-safe">
            <data-safe>true</data-safe>
         </xforms:instance>



         <!-- refset navigation -->
         <xforms:instance id="refset-navigation" xxforms:exclude-result-prefixes="#all">
            <id/>
         </xforms:instance>

         <!-- **** REFSET PROJECT **** -->
         <!-- instance for refset project information -->
         <xforms:instance id="refset-project">
            <project/>
         </xforms:instance>
         <!-- event observer for refset project changes -->
         <xforms:action ev:observer="refset-project" ev:event="xforms-insert xforms-delete xxforms-value-changed">
            <xforms:setvalue ref="instance('data-safe')">false</xforms:setvalue>
         </xforms:action>
         <!-- get decor project submission -->
         <xforms:submission id="get-refset-project" serialization="none" method="get" resource="{$terminology-exist}/snomed/modules/get-refset-project.xquery?id={instance('refset-navigation')}"
            replace="instance" instance="refset-project"/>
         <!-- instance for users -->
         <xforms:instance id="users-instance">
            <users/>
         </xforms:instance>
         <xforms:submission id="get-users-submission" serialization="none" method="get" resource="{$art-exist}/modules/get-user-list.xquery" replace="instance" instance="users-instance"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}"/>
         <!-- instance for new author -->
         <xforms:instance id="author-instance" xxforms:exclude-result-prefixes="#all">
            <author id="" username="guest" admin="false" authorize="false" edit="false" issues="false">Guest</author>
         </xforms:instance>
         <xforms:bind nodeset="instance('refset-project')/author" readonly="not($admin)">
            <xforms:bind nodeset="@issues" type="xs:boolean"/>
            <xforms:bind nodeset="@edit" type="xs:boolean"/>
            <xforms:bind nodeset="@authorize" type="xs:boolean"/>
            <xforms:bind nodeset="@admin" type="xs:boolean"/>
         </xforms:bind>
         <!-- save refset submission -->
         <xforms:submission id="save-refset-project" ref="instance('refset-project')" resource="{$terminology-exist}/snomed/modules/save-refset-project.xquery" method="post" replace="instance"
            xxforms:instance="data-safe" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">A submission error occurred: <xforms:output value="event('error-type')"/>
               <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>

         <!-- **** REFSET AND SNOMED SEARCH **** -->
         <!-- member status filter -->
         <xforms:instance id="member-status-filter">
            <filter>draft active update review</filter>
         </xforms:instance>
         <xforms:bind nodeset="instance('member-status-filter')" readonly="instance('search-refset-only')='false'"/>
         <!-- member-status filters -->
         <xforms:instance id="status-filters">
            <filters>
               <filter statusCodes="">
                  <name language="nl-NL">Alle</name>
                  <name language="en-US">All</name>
                  <name language="de-DE">Alle</name>
               </filter>
               <filter statusCodes="draft active update review">
                  <name language="nl-NL">Actueel</name>
                  <name language="en-US">Current</name>
                  <name language="de-DE">Actuell</name>
               </filter>
               <filter statusCodes="draft">
                  <name language="nl-NL">Ontwerp</name>
                  <name language="en-US">Draft</name>
                  <name language="de-DE">Entwurf</name>
               </filter>
               <filter statusCodes="review">
                  <name language="nl-NL">Wordt gereviewed</name>
                  <name language="en-US">In Review</name>
                  <name language="de-DE">In Revision</name>
               </filter>
               <filter statusCodes="active">
                  <name language="nl-NL">Actief</name>
                  <name language="en-US">Active</name>
                  <name language="de-DE">Aktiv</name>
               </filter>
               <filter statusCodes="update">
                  <name language="nl-NL">In bewerking</name>
                  <name language="en-US">Under update</name>
                  <name language="de-DE">In Bearbeitung</name>
               </filter>
               <filter statusCodes="retired">
                  <name language="nl-NL">Obsoleet</name>
                  <name language="en-US">Retired</name>
                  <name language="de-DE">Obsolet</name>
               </filter>
            </filters>
         </xforms:instance>
         <!-- toplevel filter -->
         <xforms:instance id="selected-toplevels">
            <ids/>
         </xforms:instance>
         <!-- refsets filter -->
         <xforms:instance id="selected-refsets">
            <ids/>
         </xforms:instance>
         <!-- filter list -->
         <xforms:instance id="filters">
            <filters/>
         </xforms:instance>
         <!-- submission for loading toplevel filter list -->
         <xforms:submission id="get-filters" serialization="none" method="get" resource="{$terminology-exist}/snomed/modules/get-search-filters.xquery" replace="instance" instance="filters"
            xxforms:readonly="true"/>
         <!-- get descriptions- for draft, update and concepts -->
         <xforms:submission id="get-draft-concept-list" serialization="none"
            resource="{$terminology-exist}/snomed/modules/get-refset-concept-list.xquery?refsetId={instance('refset-navigation')}&amp;status=draft" method="get" instance="snomed-description-itemset"
            replace="instance">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:setindex repeat="descriptions" index="1"/>
            </xforms:action>
         </xforms:submission>
         <!-- get descriptions- for draft and update concepts -->
         <xforms:submission id="get-update-concept-list" serialization="none"
            resource="{$terminology-exist}/snomed/modules/get-refset-concept-list.xquery?refsetId={instance('refset-navigation')}&amp;status=update" method="get" instance="snomed-description-itemset"
            replace="instance"/>
         <!-- get descriptions- for draft and update concepts -->
         <xforms:submission id="get-review-concept-list" serialization="none"
            resource="{$terminology-exist}/snomed/modules/get-refset-concept-list.xquery?refsetId={instance('refset-navigation')}&amp;status=review" method="get" instance="snomed-description-itemset"
            replace="instance"/>


         <!-- **** REFSET MEMBER **** -->
         <!-- refset member -->
         <xforms:instance id="member" xxforms:exclude-result-prefixes="#all">
            <member/>
         </xforms:instance>
         <xforms:bind nodeset="instance('member')/concept/desc[@uuid]">
            <xforms:bind nodeset="@*" readonly="not(ancestor::member/@statusCode='draft')"/>
            <xforms:bind nodeset="@type" readonly="(.='syn' and count(../../desc[@uuid][@type='pref'])=1) or not(../@statusCode='draft')"/>
            <xforms:bind nodeset="@languageCode" readonly="not(../@statusCode='draft')"/>
         </xforms:bind>
         <!-- get refset member -->
         <xforms:submission id="get-refset-member" serialization="none" method="get"
            resource="{$terminology-exist}/snomed/modules/get-refset-member.xquery?refsetId={instance('refset-navigation')}&amp;conceptId={instance('snomed-focus-concept')/concept/@conceptId}"
            replace="instance" instance="member"/>
         <!-- delete refset member -->
         <xforms:submission id="delete-refset-member" serialization="none" method="get"
            resource="{$terminology-exist}/snomed/modules/delete-refset-member.xquery?refsetId={instance('refset-navigation')}&amp;id={instance('member')/@id}" replace="none"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}"/>
         <!-- add concept to refset -->
         <xforms:submission id="add-concept-to-refset" serialization="none" method="get"
            resource="{$terminology-exist}/snomed/modules/add-concept-to-refset.xquery?refsetId={instance('refset-navigation')}&amp;conceptId={instance('snomed-focus-concept')/concept/@conceptId}&amp;refsetEffectiveDate={instance('version-navigation')}"
            replace="instance" instance="member" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">A submission error occurred: <xforms:output value="event('error-type')"/>
               <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- add selected concepts -->
         <xforms:submission id="add-selected-concepts" ref="instance('snomed-context-concept')" resource="{$terminology-exist}/snomed/modules/add-concept-selection-to-refset.xquery" method="post"
            replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">A submission error occurred: <xforms:output value="event('error-type')"/>
               <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>

         <!-- member new translation -->
         <xforms:instance id="desc" xxforms:exclude-result-prefixes="#all">
            <desc/>
         </xforms:instance>
         <!-- translation language -->
         <xforms:instance id="desc-languages" xxforms:exclude-result-prefixes="#all">
            <languages>
               <language code="nl">
                  <label language="nl-NL">Nederlands</label>
                  <label language="en-GB">Dutch</label>
                  <label language="de-DE">Niederländisch</label>
               </language>
               <language code="en">
                  <label language="nl-NL">Engels</label>
                  <label language="en-GB">English</label>
                  <label language="de-DE">Englisch</label>
               </language>
               <language code="de">
                  <label language="nl-NL">Duits</label>
                  <label language="en-GB">German</label>
                  <label language="de-DE">Deutsch</label>
               </language>
               <language code="fr">
                  <label language="nl-NL">Frans</label>
                  <label language="en-GB">French</label>
                  <label language="de-DE">Französisch</label>
               </language>
            </languages>
         </xforms:instance>
         <!-- translation type -->
         <xforms:instance id="desc-types" xxforms:exclude-result-prefixes="#all">
            <types>
               <type code="syn">
                  <label language="nl-NL">Synoniem</label>
                  <label language="en-GB">Synonym</label>
                  <label language="de-DE">Synonym</label>
               </type>
               <type code="pref">
                  <label language="nl-NL">Voorkeurterm</label>
                  <label language="en-GB">Preferred term</label>
                  <label language="de-DE"/>
               </type>
            </types>
         </xforms:instance>
         <!-- create-translation -->
         <xforms:submission id="create-translation" serialization="none" method="get"
            resource="{$terminology-exist}/snomed/modules/create-translation.xquery?refsetId={instance('refset-navigation')}&amp;memberId={instance('member')/@id}&amp;language={instance('language')}"
            replace="instance" instance="desc" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- delete translation -->
         <xforms:submission id="delete-translation" serialization="none" method="get"
            resource="{$terminology-exist}/snomed/modules/delete-translation.xquery?refsetId={instance('refset-navigation')}&amp;descId={instance('member')/concept/desc[@uuid][index('translations')]/@uuid}"
            replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- update-translation -->
         <xforms:submission id="update-translation" ref="instance('member')/concept/desc[@uuid][index('translations')]" resource="{$terminology-exist}/snomed/modules/update-translation.xquery"
            method="post" replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- duplicate translations -->
         <xforms:instance id="duplicate-translations" xxforms:exclude-result-prefixes="#all">
            <desc/>
         </xforms:instance>
         <!-- find duplicate translations -->
         <xforms:submission id="find-duplicate-translations" ref="instance('member')/concept/desc[@uuid][index('translations')]"
            resource="{$terminology-exist}/snomed/modules/find-duplicate-translations.xquery" method="post" replace="instance" xxforms:instance="duplicate-translations"
            xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">A submission error occurred: <xforms:output value="event('error-type')"/>
               <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>
         <!-- finalize-translation -->
         <xforms:submission id="finalize-translation" ref="instance('member')/concept/desc[@uuid][index('translations')]" resource="{$terminology-exist}/snomed/modules/finalize-translation.xquery"
            method="post" replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
         </xforms:submission>


         <!-- **** STATUS CHANGE**** -->
         <!-- status change -->
         <xforms:instance id="status-change" xxforms:exclude-result-prefixes="#all">
            <statusChange refsetId="" object="" ref="" statusCode=""/>
         </xforms:instance>
         <!-- status change response -->
         <xforms:instance id="status-change-response" xxforms:exclude-result-prefixes="#all">
            <response/>
         </xforms:instance>
         <!-- set status code -->
         <xforms:submission id="set-status" ref="instance('status-change')" resource="{$terminology-exist}/snomed/modules/set-refset-object-status.xquery" method="post" replace="instance"
            xxforms:instance="status-change-response" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">
               A submission error occurred: <xforms:output value="event('error-type')"/>; Status: <xforms:output
                  value="event('response-status-code')"/>; Reason: <xforms:output value="event('response-reason-phrase')"/>; URI: <xforms:output value="event('resource-uri')"
                  />; Headers: <xforms:output value="event('response-headers')"/>; Body: <xforms:output value="event('response-body')"/>
            </xforms:message>
            <xforms:action ev:event="xforms-submit-done">
               <xforms:send submission="get-refset-member"/>
               <xforms:action
                  xxforms:iterate="instance('snomed-context-concept')//concept[@conceptId=instance('member')/concept/@conceptId]|instance('snomed-context-concept')//dest[@sourceId=instance('member')/concept/@conceptId]">
                  <xforms:setvalue ref="context()/@memberStatusCode" value="instance('member')/@statusCode"/>
               </xforms:action>
               <xforms:action xxforms:iterate="instance('snomed-description-itemset')//description[@conceptId=instance('member')/concept/@conceptId]">
                  <xforms:setvalue ref="context()/@memberStatusCode" value="instance('member')/@statusCode"/>
               </xforms:action>
            </xforms:action>
         </xforms:submission>

         <!-- **** SNOMED CONTEXT **** -->
         <!-- instance for context concept navigation -->
         <xforms:instance id="snomed-context-navigation" xxforms:exclude-result-prefixes="#all">
            <dummy/>
         </xforms:instance>
         <!-- instance for context concept -->
         <xforms:instance id="snomed-context-concept" xxforms:exclude-result-prefixes="#all">
            <dummy/>
         </xforms:instance>
         <!-- submission for loading context concept -->
         <xforms:submission id="get-snomed-context-concept" serialization="none" method="get"
            resource="{$terminology-exist}/snomed/modules/get-snomed-concept.xquery?id={instance('snomed-context-navigation')}&amp;refsetId={instance('refset-navigation')}" replace="instance"
            instance="snomed-context-concept">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:action xxforms:iterate="instance('snomed-context-concept')/concept|instance('snomed-context-concept')//dest">
                  <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('navId',random())"/>
               </xforms:action>
            </xforms:action>
         </xforms:submission>
         <!-- instance for  context concept hierarchy -->
         <xforms:instance id="snomed-context-subconcepts" xxforms:exclude-result-prefixes="#all">
            <dummy/>
         </xforms:instance>
         <!-- instance for concept hierarchy navigation -->
         <xforms:instance id="snomed-context-hierarchy-navigation" xxforms:exclude-result-prefixes="#all">
            <dummy/>
         </xforms:instance>
         <!-- submission for loading context concept subconcepts -->
         <xforms:submission id="get-snomed-context-subconcepts" serialization="none" method="get"
            resource="{$terminology-exist}/snomed/modules/get-snomed-subconcepts.xquery?id={instance('snomed-context-concept')//concept[@navId=instance('snomed-context-hierarchy-navigation')]/@conceptId}&amp;refsetId={instance('refset-navigation')}&amp;refsetEffectiveDate={instance('version-navigation')}"
            replace="instance" instance="snomed-context-subconcepts">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:action xxforms:iterate="instance('snomed-context-subconcepts')/concept|instance('snomed-context-subconcepts')//dest">
                  <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('navId',random())"/>
               </xforms:action>
            </xforms:action>
         </xforms:submission>
         <!-- instance for focus concept -->
         <xforms:instance id="snomed-focus-concept">
            <concept/>
         </xforms:instance>
         <!-- submission for loading focus concept -->
         <xforms:submission id="get-snomed-focus-concept" serialization="none" method="get"
            resource="{$terminology-exist}/snomed/modules/get-snomed-concept.xquery?id={instance('snomed-context-concept')//concept[@navId=instance('snomed-context-hierarchy-navigation')]/@conceptId|instance('snomed-context-concept')//dest[@navId=instance('snomed-context-hierarchy-navigation')]/@sourceId}&amp;refsetId={instance('refset-navigation')}&amp;refsetEffectiveDate={instance('version-navigation')}"
            replace="instance" instance="snomed-focus-concept">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:send submission="get-refset-member"/>
            </xforms:action>
         </xforms:submission>


         <!-- *** ISSUES *** -->
         <!-- instance for existing issues -->
         <xforms:instance id="refset-issues">
            <dummy/>
         </xforms:instance>
         <!-- get issues submission -->
         <xforms:submission id="get-refset-issues" serialization="none" method="get" resource="{$terminology-exist}/snomed/modules/get-refset-issues.xquery?refsetId={instance('refset-navigation')}"
            replace="instance" instance="refset-issues"/>
         <!-- instance for creating issue -->
         <xforms:instance id="issue-instance" xxforms:exclude-result-prefixes="#all">
            <issues>
               <issue id="" priority="N" displayName="" type="RFC" refsetId="">
                  <object id="" type="" effectiveDate=""/>
                  <tracking effectiveDate="" statusCode="new">
                     <author id=""/>
                     <desc language=""/>
                  </tracking>
               </issue>
            </issues>
         </xforms:instance>
         <!-- instance for creating tracking -->
         <xforms:instance id="tracking-instance" xxforms:exclude-result-prefixes="#all">
            <issue>
               <tracking effectiveDate="" statusCode="open">
                  <author id=""/>
                  <desc language=""/>
               </tracking>
            </issue>
         </xforms:instance>
         <!-- instance for creating assignment -->
         <xforms:instance id="assignment-instance" xxforms:exclude-result-prefixes="#all">
            <issue>
               <assignment to="" name="" effectiveDate="">
                  <author id=""/>
                  <desc language=""/>
               </assignment>
            </issue>
         </xforms:instance>
         <!-- instance for holding newly created issues -->
         <xforms:instance id="issues-instance" xxforms:exclude-result-prefixes="#all">
            <issues>
               <issue/>
            </issues>
         </xforms:instance>
         <!-- instance for selected issue -->
         <xforms:instance id="selected-issue">
            <selected>
               <selected/>
               <unassigned/>
               <open/>
               <inprogress/>
               <feedback/>
               <closed/>
            </selected>
         </xforms:instance>
         <!-- instance for issues -->
         <xforms:instance id="selected-status-codes">
            <selected>open</selected>
         </xforms:instance>
         <!-- instance for issues -->
         <xforms:instance id="selected-issue-types">
            <selected>RFC INC CLF</selected>
         </xforms:instance>
         <!-- instance for issues -->
         <xforms:instance id="selected-issue-priorities">
            <selected/>
         </xforms:instance>
         <!-- instance for issues -->
         <xforms:instance id="selected-issue-assignee">
            <selected/>
         </xforms:instance>
         <!-- instance for issues -->
         <xforms:instance id="selected-issue-id">
            <selected/>
         </xforms:instance>
         <!-- save issue submission -->
         <xforms:submission id="save-refset-issue" ref="instance('issues-instance')/issue[object/@id=instance('member')/@id]" action="{$terminology-exist}/snomed/modules/save-refset-issue.xquery"
            method="post" replace="none" xxforms:username="{xxforms:get-session-attribute('username')}" xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">A submission error occurred:<xforms:output value="event('error-type')"/>
            </xforms:message>
         </xforms:submission>
         <!-- update issue submission -->
         <xforms:submission id="update-refset-issue" ref="instance('refset-issues')/issue[@id=instance('selected-issue')/selected]"
            action="{$terminology-exist}/snomed/modules/update-refset-issue.xquery" method="post" replace="none" xxforms:username="{xxforms:get-session-attribute('username')}"
            xxforms:password="{xxforms:get-session-attribute('password')}">
            <xforms:message ev:event="xforms-submit-error" level="modal">A submission error occurred:<xforms:output value="event('error-type')"/>
            </xforms:message>
         </xforms:submission>




         <!-- selected codeSystem -->
         <xforms:instance id="selected-codesystem">
            <id/>
         </xforms:instance>
         <!-- codeSystem list -->
         <xforms:instance id="codesystem-list">
            <dummy/>
         </xforms:instance>
         <!-- get codesystem list -->
         <xforms:submission id="get-codesystem-list" serialization="none" method="get" resource="{$art-exist}/modules/get-decor-codesystem-selection.xquery?project={instance('document')}"
            replace="instance" instance="codesystem-list"/>


         <!-- GROUP CHOICE -->
         <!-- selected-group -->
         <xforms:instance id="selected-group">
            <collection/>
         </xforms:instance>
         <xforms:instance id="special-groups">
            <classifications>
               <group collection="snomed-data" name="Snomed CT" isGroup="false">
                  <classification id="2.16.840.1.113883.6.96" name="Snomed CT">Snomed CT</classification>
               </group>
               <group collection="loinc-data" name="LOINC" isGroup="false">
                  <classification id="2.16.840.1.113883.6.1" name="LOINC">LOINC</classification>
               </group>
            </classifications>
         </xforms:instance>


         <!-- *** SNOMED SEARCH *** -->
         <!-- instance for SNOMED CT concept -->
         <xforms:instance id="snomed-concept-instance">
            <result current="1" count="1">
               <description count="3" length="17" effectiveTime="20030731" conceptId="138875005" caseSignificanceId="900000000000017005" type="pref" fullName="SNOMED CT Concept (SNOMED RT+CTV3)"
                  >SNOMED CT Concept</description>
            </result>
         </xforms:instance>
         <!-- instance for selected concept -->
         <xforms:instance id="snomed-concept-navigation">
            <id>138875005</id>
         </xforms:instance>
         <!-- instance for description search string -->
         <xforms:instance id="snomed-description-search">
            <search/>
         </xforms:instance>
         <!-- instance for description itemset -->
         <xforms:instance id="snomed-description-itemset">
            <result current="0" count="0">
               <!--               <description count="3" length="17" effectiveTime="20030731" conceptId="138875005" caseSignificanceId="900000000000017005" type="pref" fullName="SNOMED CT Concept (SNOMED RT+CTV3)"
                  >SNOMED CT Concept</description>-->
            </result>
         </xforms:instance>
         <!-- submission for loading description -->
         <xforms:submission id="get-snomed-concept-description" serialization="none" method="get" resource="{$terminology-exist}/snomed/getDescription/{instance('snomed-concept-navigation')}"
            replace="instance" instance="snomed-description-itemset"/>
         <!-- instance for selected concept -->
         <xforms:instance id="selected-snomed-concept">
            <dummy/>
         </xforms:instance>
         <!-- instance for concept -->
         <xforms:instance id="snomed-concept">
            <dummy/>
         </xforms:instance>
         <!-- submission for loading concept -->
         <xforms:submission id="get-snomed-concept" serialization="none" method="get"
            resource="{$terminology-exist}/snomed/getConcept/{instance('snomed-concept-hierarchy')//*[@navId=instance('snomed-hierarchy-navigation')]/@conceptId}" replace="instance"
            instance="snomed-concept"/>
         <!-- instance for selected concept in hierarchy -->
         <xforms:instance id="snomed-hierarchy-navigation">
            <id/>
         </xforms:instance>
         <!-- instance for concept hierarchy -->
         <xforms:instance id="snomed-concept-hierarchy">
            <dummy/>
         </xforms:instance>

         <!-- submission for loading subconcept hierarchy -->
         <xforms:submission id="get-snomed-subconcept-hierarchy" serialization="none" method="get"
            resource="{$terminology-exist}/snomed/modules/get-snomed-subconcepts.xquery?id={instance('snomed-concept-navigation')}" replace="instance" instance="snomed-concept-hierarchy">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:action xxforms:iterate="instance('snomed-concept-hierarchy')/concept|instance('snomed-concept-hierarchy')//dest">
                  <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('navId',random())"/>
               </xforms:action>
            </xforms:action>
         </xforms:submission>
         <!-- instance for concept hierarchy -->
         <xforms:instance id="snomed-subconcepts">
            <dummy/>
         </xforms:instance>
         <!-- submission for loading concept -->
         <xforms:submission id="get-snomed-subconcepts" serialization="none" method="get"
            resource="{$terminology-exist}/snomed/modules/get-snomed-subconcepts.xquery?id={instance('snomed-concept-hierarchy')//*[@navId=instance('snomed-hierarchy-navigation')]/@conceptId}"
            replace="instance" instance="snomed-subconcepts"/>

         <!-- instance for select mode (search or select) -->
         <xforms:instance id="search-refset-only">
            <mode>true</mode>
         </xforms:instance>
         <xforms:bind nodeset="instance('search-refset-only')" type="xforms:boolean"/>
         <!-- instance for select mode (search or select) -->
         <xforms:instance id="snomed-select-mode">
            <mode>false</mode>
         </xforms:instance>
         <!-- instance for select mode (search or select) -->
         <xforms:instance id="snomed-subconcept">
            <dummy/>
         </xforms:instance>
         <!-- submission for loading subconcept -->
         <xforms:submission id="get-snomed-subconcept" serialization="none" method="get"
            resource="{$terminology-exist}/snomed/getConcept/{instance('snomed-concept-hierarchy')//*[@navId=instance('snomed-hierarchy-navigation')]/@conceptId}" replace="instance"
            instance="snomed-subconcept"/>
         <!-- submission for updating resultset -->
         <xforms:submission id="update-snomed-descriptions" ref="instance('snomed-description-search')"
            action="{$terminology-exist}/snomed/modules/search-snomed-refset.xquery?searchString={instance('snomed-description-search')}&amp;toplevels={instance('selected-toplevels')}&amp;refsets={instance('selected-refsets')}&amp;refsetId={instance('refset-navigation')}&amp;refsetOnly={instance('search-refset-only')}&amp;refsetEffectiveDate={instance('version-navigation')}&amp;statusCodes={instance('member-status-filter')}"
            method="get" instance="snomed-description-itemset" replace="instance"/>
         <!-- submission for getting draft members -->
         <xforms:submission id="get-edit-list" serialization="none"
            resource="{$terminology-exist}/snomed/modules/get-refset-member-list.xquery?refsetId={instance('refset-navigation')}&amp;refsetEffectiveDate={instance('version-navigation')}" method="get"
            instance="snomed-description-itemset" replace="instance"/>

         <!-- *** CLAML SEARCH *** -->
         <!-- instance for selected classification collection -->
         <xforms:instance id="collection">
            <name/>
         </xforms:instance>
         <!-- instance for selected classificationId -->
         <xforms:instance id="classificationId">
            <name/>
         </xforms:instance>
         <xforms:action ev:observer="classificationId" ev:event="xxforms-value-changed">
            <xforms:send submission="get-claml-hierarchy"/>
            <xforms:setvalue ref="instance('hierarchy-navigation')" value="instance('claml-instance')/Class[1]/@id"/>
            <xxforms:variable name="selection"
               select="if (instance('classification-list')//classification[@id=instance('classificationId')][@language=instance('language')]) then instance('classification-list')//classification[@id=instance('classificationId')][@language=instance('language')][1] else (instance('classification-list')//classification[@id=instance('classificationId')][1])"/>
            <xforms:setvalue ref="instance('new-conceptlist-concept')/@codeSystem" value="$selection/@id"/>
            <xforms:setvalue ref="instance('new-conceptlist-concept')/@codeSystemName" value="$selection/@name"/>
         </xforms:action>
         <!-- instance for selected classification of group -->
         <xforms:instance id="selected-classification">
            <name/>
         </xforms:instance>
         <!-- instance for classification list -->
         <xforms:instance id="classification-list">
            <classifications/>
         </xforms:instance>
         <xforms:submission id="get-classification-list" serialization="none" method="get" resource="{$terminology-exist}/claml/classification-index.xml" replace="instance"
            instance="classification-list"/>
         <!-- instance for selected class -->
         <xforms:instance id="class-navigation">
            <id/>
         </xforms:instance>
         <!-- instance for selected class in hierarchy -->
         <xforms:instance id="hierarchy-navigation">
            <id/>
         </xforms:instance>
         <!-- instance for class -->
         <xforms:instance id="class">
            <dummy/>
         </xforms:instance>
         <xforms:submission id="get-class" serialization="none" method="get"
            resource="{$terminology-exist}/claml/RetrieveClass?classificationId={instance('classificationId')}&amp;code={instance('claml-instance')//*[@id=instance('hierarchy-navigation')][1]/@code}"
            replace="instance" instance="class"/>
         <!-- instance for description search string -->
         <xforms:instance id="claml-search">
            <search/>
         </xforms:instance>
         <!-- instance for description itemset -->
         <xforms:instance id="claml-description-itemset">
            <result current="0" count="0"/>
         </xforms:instance>
         <!-- instance for claml hierarchy -->
         <xforms:instance id="claml-instance">
            <dummy/>
         </xforms:instance>
         <xforms:submission id="get-claml-hierarchy" serialization="none" method="get"
            resource="{$terminology-exist}/claml/modules/get-class-for-hierarchy.xquery?classificationId={instance('classificationId')}&amp;code={instance('class-navigation')}" replace="instance"
            instance="claml-instance">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:action xxforms:iterate="instance('claml-instance')/Class|instance('claml-instance')//SubClass">
                  <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('id',random())"/>
               </xforms:action>
            </xforms:action>
         </xforms:submission>
         <xforms:instance id="subclasses">
            <dummy/>
         </xforms:instance>
         <xforms:submission id="get-subclasses" serialization="none" method="get"
            resource="{$terminology-exist}/claml/RetrieveSubClasses?classificationId={instance('classificationId')}&amp;code={instance('claml-instance')//*[@id=instance('hierarchy-navigation')][1]/@code}"
            replace="instance" instance="claml-instance">
            <xforms:action ev:event="xforms-submit-done">
               <xforms:action xxforms:iterate="instance('claml-instance')/Class|instance('claml-instance')//SubClass">
                  <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('id',random())"/>
               </xforms:action>
            </xforms:action>
         </xforms:submission>
         <xforms:submission id="expand-tree-submission" serialization="none" method="get"
            resource="{$terminology-exist}/claml/RetrieveSubClasses?classificationId={instance('classificationId')}&amp;code={instance('claml-instance')//*[@id=instance('hierarchy-navigation')][1]/@code}"
            replace="instance" instance="subclasses"/>
         <xforms:submission id="update-claml-descriptions" ref="instance('claml-search')"
            action="{$terminology-exist}/claml/SearchDescription?classificationId={instance('classificationId')}&amp;string={instance('claml-search')}" method="get"
            instance="claml-description-itemset" replace="instance"/>
         <!-- instance for select mode (search or select) -->
         <xforms:instance id="select-mode">
            <mode>false</mode>
         </xforms:instance>
         <!-- instance for subclass -->
         <xforms:instance id="subclass">
            <dummy/>
         </xforms:instance>
         <xforms:submission id="get-subclass" serialization="none" method="get"
            resource="{$terminology-exist}/claml/RetrieveClass?classificationId={instance('classificationId')}&amp;code={instance('claml-instance')//*[@id=instance('hierarchy-navigation')][1]/@code}"
            replace="instance" instance="subclass"/>

         <!-- **** XFORMS READY**** -->
         <xforms:action ev:event="xforms-model-construct-done">
            <xforms:send submission="get-resources-submission"/>
            <xxforms:variable name="session-language" select="xxforms:get-session-attribute('language')"/>
            <xforms:setvalue ref="instance('language')"
               value="if (string-length(xxforms:get-session-attribute('language'))&gt;0) then (xxforms:get-session-attribute('language')) else (instance('resources-instance')//resources[1]/@xml:lang/string())"/>
            <xforms:insert context="." origin="xxforms:set-session-attribute('language', instance('language'))"/>
            <xforms:send submission="get-filters"/>
            <xforms:send submission="get-users-submission"/>
            <xforms:send submission="get-decor-types"/>
            <xforms:send submission="get-refset-list"/>
            <xforms:setvalue ref="instance('refset-navigation')" value="xxforms:get-request-parameter('id')"/>
            <xforms:send submission="get-refset-project"/>
            <xforms:send submission="get-refset-issues"/>
         </xforms:action>
         <xforms:action ev:event="xforms-ready">
            <xforms:setvalue ref="instance('data-safe')">true</xforms:setvalue>
            <xxforms:script>
               window.onbeforeunload = function() {
               if (ORBEON.xforms.Document.getValue('data-safe-input') != 'true')
               return "Deze tekst kunnen we aanpassen.";
               }
            </xxforms:script>
            <xforms:setfocus control="search-snomed-description"/>
         </xforms:action>
         <xxforms:variable name="resources" select="instance('resources-instance')//resources[1]"/>
         <xxforms:variable name="user" select="xxforms:get-session-attribute('username')"/>
         <xxforms:variable name="editor" select="instance('refset-project')/author[@username=xxforms:get-session-attribute('username')][@edit='true']"/>
         <xxforms:variable name="issueCreator" select="instance('refset-project')/author[@username=xxforms:get-session-attribute('username')][@issues='true']"/>
         <xxforms:variable name="authorize" select="instance('refset-project')/author[@username=xxforms:get-session-attribute('username')][@authorize='true']"/>
         <xxforms:variable name="admin" select="instance('refset-project')/author[@username=xxforms:get-session-attribute('username')][@admin='true']"/>
         <xxforms:variable name="isGroup" select="instance('classification-list')/group[@collection=instance('selected-group')]/@isGroup='true'"/>
      </xforms:model>
   </xhtml:head>
   <xhtml:body>
      <!-- special output used to give warning if user leaves page -->
      <xforms:output ref="instance('data-safe')" id="data-safe-input" style="display: none"/>
      <!-- Filter dialog -->
      <xxforms:dialog id="filter-dialog" appearance="minimal" visible="false">
         <xhtml:table>
            <xhtml:tr>
               <xhtml:td>
                  <xforms:select ref="instance('selected-toplevels')" appearance="full" id="filterList">
                     <xforms:itemset nodeset="instance('filters')/topLevels/concept">
                        <xforms:label ref="."/>
                        <xforms:value ref="@id"/>
                     </xforms:itemset>
                     <xforms:action ev:event="xforms-value-changed">
                        <xforms:send submission="update-snomed-descriptions"/>
                        <xforms:action if="xxforms:index('descriptions')&gt;1">
                           <xforms:setindex repeat="descriptions" index="1"/>
                        </xforms:action>
                     </xforms:action>
                  </xforms:select>
               </xhtml:td>
               <xhtml:td>
                  <xforms:select ref="instance('selected-refsets')" appearance="full" id="refsetFilterList">
                     <xforms:itemset nodeset="instance('filters')/refsets/refset">
                        <xforms:label ref="."/>
                        <xforms:value ref="@id"/>
                     </xforms:itemset>
                     <xforms:action ev:event="xforms-value-changed">
                        <xforms:send submission="update-snomed-descriptions"/>
                        <xforms:action if="xxforms:index('descriptions')&gt;1">
                           <xforms:setindex repeat="descriptions" index="1"/>
                        </xforms:action>
                     </xforms:action>
                  </xforms:select>
               </xhtml:td>
            </xhtml:tr>
         </xhtml:table>
      </xxforms:dialog>
      <!-- dialog for finalizing translation -->
      <xxforms:dialog id="finalize-translation-dialog" appearance="full" level="modal" close="false" draggable="true" visible="false">
         <xforms:label ref="$resources/translation"/>
         <xhtml:table width="750px">
            <xforms:group ref="instance('duplicate-translations')[not(desc)]">
               <xhtml:tr>
                  <xhtml:td colspan="3">
                     <xforms:output mediatype="text/html" ref="xxforms:serialize(instance('messages')/status-final[@language=instance('language')], 'html')"/>
                  </xhtml:td>
               </xhtml:tr>
            </xforms:group>
            <xforms:group ref="instance('duplicate-translations')[desc]">
               <xhtml:tr>
                  <xhtml:td colspan="3">
                     <xforms:output mediatype="text/html" ref="xxforms:serialize(instance('messages')/translation-exists[@language=instance('language')], 'html')"/>
                  </xhtml:td>
               </xhtml:tr>
               <xhtml:tr>
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/term"/>
                  </xhtml:td>
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/concept-name"/>
                  </xhtml:td>
                  <xhtml:td class="item-label">
                     <xforms:output ref="$resources/reference-set"/>
                  </xhtml:td>
               </xhtml:tr>
            </xforms:group>
            <xforms:repeat nodeset="instance('duplicate-translations')/desc">
               <xhtml:tr>
                  <xhtml:td>
                     <xforms:output ref="."/>
                  </xhtml:td>
                  <xhtml:td>
                     <xforms:output ref="@conceptFsn"/>
                  </xhtml:td>
                  <xhtml:td>
                     <xforms:output ref="@refset"/>
                  </xhtml:td>
               </xhtml:tr>
            </xforms:repeat>
            <xhtml:tr>
               <xhtml:td colspan="3">
                  <xhtml:p/>
               </xhtml:td>
            </xhtml:tr>
            <xhtml:tr>
               <xhtml:td colspan="3">
                  <xhtml:div class="buttons">
                     <fr:button>
                        <xforms:label ref="$resources/cancel"/>
                        <xforms:action ev:event="DOMActivate">
                           <xxforms:hide ev:event="DOMActivate" dialog="finalize-translation-dialog"/>
                        </xforms:action>
                     </fr:button>
                     <fr:button>
                        <xforms:label ref="$resources/set-status-to-final"/>
                        <xforms:action ev:event="DOMActivate">
                           <xxforms:hide ev:event="DOMActivate" dialog="finalize-translation-dialog"/>
                           <xforms:action if="not(instance('duplicate-translations')/desc)">
                              <xforms:insert context="instance('member')/desc[index('translations')]" origin="xxforms:attribute('sctId','')"/>
                           </xforms:action>
                           <xforms:action if="instance('duplicate-translations')/desc">
                              <xforms:insert context="instance('member')/desc[index('translations')]" origin="xxforms:attribute('sctId',instance('duplicate-translations')/desc/@id)"/>
                           </xforms:action>
                           <xforms:send submission="finalize-translation"/>
                           <xforms:send submission="get-refset-member"/>
                        </xforms:action>
                     </fr:button>
                  </xhtml:div>
               </xhtml:td>
            </xhtml:tr>
         </xhtml:table>
      </xxforms:dialog>
      <!-- dialog for selecting Art user -->
      <xxforms:dialog id="select-user-dialog" appearance="full" level="modeless" close="false" draggable="true" visible="false">
         <xforms:label ref="$resources/select-user"/>
         <xhtml:table width="250px">
            <xhtml:tr>
               <xhtml:td class="heading">
                  <xforms:output ref="$resources/select-user"/>
               </xhtml:td>
            </xhtml:tr>
            <xhtml:tr>
               <xhtml:td>
                  <xhtml:div class="navigate-small">
                     <xforms:select1 ref="instance('author-instance')/@username" appearance="compact" id="user-select">
                        <xforms:itemset nodeset="instance('users-instance')/user">
                           <xforms:label ref="displayName"/>
                           <xforms:value ref="@name"/>
                        </xforms:itemset>
                        <xforms:action ev:event="xforms-value-changed">
                           <xforms:setvalue ref="instance('author-instance')" value="instance('users-instance')/user[@name=instance('author-instance')/@username]/displayName"/>
                        </xforms:action>
                     </xforms:select1>
                  </xhtml:div>
               </xhtml:td>
            </xhtml:tr>
            <xhtml:tr>
               <xhtml:td>
                  <xhtml:div class="buttons">
                     <fr:button>
                        <xforms:label ref="$resources/cancel"/>
                        <xforms:action ev:event="DOMActivate">
                           <xxforms:hide ev:event="DOMActivate" dialog="select-user-dialog"/>
                        </xforms:action>
                     </fr:button>
                     <fr:button>
                        <xforms:label ref="$resources/add"/>
                        <xforms:action ev:event="DOMActivate">
                           <xxforms:variable name="newId" select="max(instance('refset-project')/author/@id)+1"/>
                           <xforms:setvalue ref="instance('author-instance')/@id" value="$newId"/>
                           <xforms:insert context="instance('refset-project')" nodeset="author" at="index('authorList')" position="after" origin="instance('author-instance')"/>
                           <xxforms:hide ev:event="DOMActivate" dialog="select-user-dialog"/>
                        </xforms:action>
                     </fr:button>
                  </xhtml:div>
               </xhtml:td>
            </xhtml:tr>
         </xhtml:table>
      </xxforms:dialog>
      <!-- dialog for lock message -->
      <xxforms:dialog id="lock-dialog" appearance="full" level="modal" close="true" draggable="true" visible="false">
         <xforms:label ref="$resources/valueset-locked"/>
         <xhtml:table>
            <xhtml:tr>
               <xhtml:td class="heading" colspan="2">
                  <xforms:output ref="$resources/valueset-locked"/>
               </xhtml:td>
            </xhtml:tr>
            <xhtml:tr>
               <xhtml:td class="item-label">
                  <xforms:output ref="$resources/user"/>
               </xhtml:td>
               <xhtml:td>
                  <xforms:output ref="instance('decor-valueset')//valuesetLock/@userName"/>
               </xhtml:td>
            </xhtml:tr>
            <xhtml:tr>
               <xhtml:td colspan="2">
                  <xhtml:div class="buttons">
                     <fr:button>
                        <xforms:label ref="$resources/close"/>
                        <xforms:action ev:event="DOMActivate">
                           <xxforms:hide dialog="lock-dialog"/>
                        </xforms:action>
                     </fr:button>
                  </xhtml:div>
               </xhtml:td>
            </xhtml:tr>
         </xhtml:table>
      </xxforms:dialog>
      <fr:tabview>
         <!-- CONCEPTS TAB -->
         <fr:tab id="refset-tab">
            <fr:label ref="$resources/concepts"/>
            <!-- REFSET AND SNOMED SEARCH -->
            <xhtml:table width="100%">
               <xxforms:variable name="current-concept" select="instance('snomed-concept-hierarchy')//concept[@id=instance('snomed-hierarchy-navigation')]"/>
               <xhtml:tr>
                  <xhtml:td colspan="4" style="border:2px solid #CCC;">
                     <!-- SEARCH -->
                     <xhtml:table width="100%">
                        <xhtml:tr>
                           <!-- Clear search and refresh -->
                           <xhtml:td class="item-label">
                              <xforms:output ref="$resources/searchterms"/>
                              <xforms:trigger appearance="minimal" id="snomed-refresh">
                                 <xforms:label class="control-label">
                                    <xhtml:img src="/img/arrow_refresh.png" alt="" align="right"/>
                                 </xforms:label>
                                 <xforms:action ev:event="DOMActivate">
                                    <xforms:setvalue ref="instance('snomed-description-search')/search" value="''"/>
                                    <xforms:delete nodeset="instance('member')/node()"/>
                                    <xforms:setvalue ref="instance('snomed-concept-navigation')" value="'138875005'"/>
                                    <xforms:send submission="get-snomed-concept-description"/>
                                    <xforms:setfocus control="search-snomed-description"/>
                                    <xforms:send submission="get-snomed-concept"/>
                                 </xforms:action>
                              </xforms:trigger>
                           </xhtml:td>
                           <!-- Search field and filters -->
                           <xhtml:td>
                              <xforms:input class="top" ref="instance('snomed-description-search')" id="search-snomed-description" incremental="true">
                                 <xforms:action ev:event="xforms-value-changed">
                                    <xxforms:variable name="search-value" select="."/>
                                    <xxforms:variable name="make-suggestion"
                                       select="(string-length($search-value) &gt;= 3 and not(matches($search-value,'^[A-Z]|\s$|\s[a-z|0-9]$'))) or (string-length($search-value) &gt;= 2 and not(matches($search-value,'^[a-z]|\s$')))  or matches($search-value,'^[0-9]+')"/>
                                    <xforms:action if="$make-suggestion">
                                       <xforms:send submission="update-snomed-descriptions"/>
                                       <xforms:action if="xxforms:index('descriptions')&gt;1">
                                          <xforms:setindex repeat="descriptions" index="1"/>
                                       </xforms:action>
                                    </xforms:action>
                                 </xforms:action>
                              </xforms:input>
                              <xforms:trigger appearance="minimal" id="filter">
                                 <xforms:label class="control-label">
                                    <xhtml:img src="/img/filter.png" alt=""/>
                                 </xforms:label>
                                 <xforms:hint ref="$resources/filter"/>
                                 <xforms:action ev:event="DOMActivate">
                                    <xxforms:show dialog="filter-dialog"/>
                                 </xforms:action>
                              </xforms:trigger>
                              <xforms:group ref=".[string-length(instance('selected-toplevels'))&gt;0 or string-length(instance('selected-refsets'))&gt;0]">
                                 <xforms:trigger appearance="minimal">
                                    <xforms:label class="control-label">
                                       <xhtml:img src="/img/node-s.png" alt=""/>
                                    </xforms:label>
                                    <xforms:hint ref="$resources/clear-filter"/>
                                    <xforms:action ev:event="DOMActivate">
                                       <xforms:setvalue ref="instance('selected-toplevels')" value="''"/>
                                       <xforms:setvalue ref="instance('selected-refsets')" value="''"/>
                                    </xforms:action>
                                 </xforms:trigger>
                              </xforms:group>
                           </xhtml:td>
                           <!-- Refset only search -->
                           <xhtml:td class="item-label">
                              <xforms:output ref="$resources/reference-set-only"/>
                           </xhtml:td>
                           <xhtml:td width="5%">
                              <xforms:input ref="instance('search-refset-only')" class="short-number">
                                 <xforms:action ev:event="xforms-value-changed">
                                    <xforms:send submission="update-snomed-descriptions"/>
                                    <xforms:action if="xxforms:index('descriptions')&gt;1">
                                       <xforms:setindex repeat="descriptions" index="1"/>
                                    </xforms:action>
                                 </xforms:action>
                              </xforms:input>
                           </xhtml:td>
                           <!-- Refset status filter -->
                           <xhtml:td class="item-label" style="width:5%;">
                              <xforms:output ref="$resources/status"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:select1 ref="instance('member-status-filter')" appearance="minimal" class="auto-width">
                                 <xforms:itemset nodeset="instance('status-filters')/filter">
                                    <xforms:label ref="name[@language=instance('language')]"/>
                                    <xforms:value ref="@statusCodes"/>
                                 </xforms:itemset>
                                 <xforms:action ev:event="xforms-value-changed">
                                    <xforms:send submission="update-snomed-descriptions"/>
                                 </xforms:action>
                              </xforms:select1>
                           </xhtml:td>
                           <!-- Selection buttons -->
                           <xhtml:td>
                              <xhtml:div class="buttons">
                                 <xforms:group ref=".[$editor or $authorize]">
                                    <!-- button for getting draft concepts -->
                                    <fr:button ref=".[instance('refset-project')/concepts/@draft &gt; 0]">
                                       <xforms:label>
                                          <xhtml:img src="/img/node-sdraft.png" alt=""/>
                                       </xforms:label>
                                       <xforms:hint>
                                          <xforms:output ref="$resources/get-all-draft-concepts"/>
                                       </xforms:hint>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:send submission="get-draft-concept-list"/>
                                          <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
                                          <xforms:setvalue ref="instance('snomed-concept-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
                                          <xforms:send submission="get-snomed-context-concept"/>
                                          <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                       </xforms:action>
                                    </fr:button>
                                    <!-- button for getting  update concepts -->
                                    <fr:button ref=".[instance('refset-project')/concepts/@update &gt; 0]">
                                       <xforms:label>
                                          <xhtml:img src="/img/node-supdate.png" alt=""/>
                                       </xforms:label>
                                       <xforms:hint>
                                          <xforms:output ref="$resources/get-all-update-concepts"/>
                                       </xforms:hint>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:send submission="get-update-concept-list"/>
                                          <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
                                          <xforms:setvalue ref="instance('snomed-concept-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
                                          <xforms:send submission="get-snomed-context-concept"/>
                                          <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                       </xforms:action>
                                    </fr:button>
                                    <!-- button for getting review concepts -->
                                    <fr:button ref=".[instance('refset-project')/concepts/@review &gt; 0]">
                                       <xforms:label>
                                          <xhtml:img src="/img/eye.png" alt=""/>
                                       </xforms:label>
                                       <xforms:hint>
                                          <xforms:output ref="$resources/get-all-review-concepts"/>
                                       </xforms:hint>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:send submission="get-review-concept-list"/>
                                          <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
                                          <xforms:setvalue ref="instance('snomed-concept-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
                                          <xforms:send submission="get-snomed-context-concept"/>
                                          <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                       </xforms:action>
                                    </fr:button>
                                    <!-- button for getting assigned concepts -->
                                    <fr:button ref=".[instance('assigned-concepts')/@count &gt; 0]">
                                       <xforms:label>
                                          <xhtml:img src="/img/tracking.png" alt=""/>
                                       </xforms:label>
                                       <xforms:hint>
                                          <xforms:output ref="$resources/get-assigned-concepts"/>
                                       </xforms:hint>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:send submission="get-assigned-concepts"/>
                                          <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
                                          <xforms:setvalue ref="instance('snomed-concept-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
                                          <xforms:send submission="get-snomed-context-concept"/>
                                          <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                       </xforms:action>
                                    </fr:button>
                                 </xforms:group>
                                 <!-- button for showing html list in new window -->
                                 <fr:button>
                                    <xforms:label>
                                       <xhtml:img src="/img/page_white_text.png" alt=""/>
                                    </xforms:label>
                                    <xforms:hint>
                                       <xforms:output ref="$resources/show-html-in-new-window"/>
                                    </xforms:hint>
                                    <xforms:action ev:event="DOMActivate">
                                       <xforms:load resource="{$terminology-external-exist}/snomed/viewRefset/{instance('refset-navigation')}" show="new"/>
                                    </xforms:action>
                                 </fr:button>
                              </xhtml:div>
                           </xhtml:td>
                        </xhtml:tr>
                     </xhtml:table>
                     <xhtml:p/>
                     <!-- SEARCH RESULTS -->
                     <xhtml:div class="h2">
                        <xforms:output ref="$resources/results"/>
                           (
                           <xforms:output ref="instance('snomed-description-itemset')/@current"/>
                        <xforms:output ref="$resources/of"/>
                        <xforms:output ref="instance('snomed-description-itemset')/@count"/>
                           )
                        </xhtml:div>
                     <xhtml:div class="navigate-seven">
                        <xhtml:table width="100%">
                           <xforms:repeat nodeset="instance('snomed-description-itemset')/description" id="descriptions">
                              <xhtml:tr>
                                 <xhtml:td style="text-align:center;background-color:#ebe7e1;padding-right:0.4em;padding-left:0.4em;width:1%;margin-right:0.5em;">
                                    <xforms:output ref="if (@type='pref') then 'P' else if(@type='fsn') then 'F' else('S')">
                                       <xforms:hint>F = Fully Specified Name, P = Preferred, S = Synonym</xforms:hint>
                                    </xforms:output>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xforms:output ref="." class="node-s{@memberStatusCode}"/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xforms:output ref="@fullName"/>
                                 </xhtml:td>
                              </xhtml:tr>
                              <xforms:action ev:event="xxforms-index-changed">
                                 <xforms:action if="instance('snomed-concept-navigation')!=instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId">
                                    <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
                                    <xforms:setvalue ref="instance('snomed-concept-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
                                    <xforms:send submission="get-snomed-context-concept"/>
                                    <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                 </xforms:action>
                              </xforms:action>
                              <xforms:action ev:event="xxforms-nodeset-changed">
                                 <xforms:setvalue ref="instance('snomed-context-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
                                 <xforms:setvalue ref="instance('snomed-concept-navigation')" value="instance('snomed-description-itemset')/description[index('descriptions')]/@conceptId"/>
                                 <xforms:send submission="get-snomed-context-concept"/>
                                 <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                              </xforms:action>
                           </xforms:repeat>
                        </xhtml:table>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
            </xhtml:table>

            <!-- REFSET MEMBER DETAILS -->
            <xhtml:table class="detail" width="100%" style="margin-top:0.8em;margin-bottom:0.8em;border:2px solid #CCC;">
               <xforms:group ref="instance('member')">
                  <!-- heading with buttons -->
                  <xhtml:tr>
                     <xhtml:td class="heading" colspan="4">
                        <xhtml:div class="heading">
                           <xforms:output ref="concept/@conceptId"/> - <xforms:output ref="concept/desc[@type='fsn']"/>
                        </xhtml:div>
                        <!-- div with buttons -->
                        <xhtml:div class="buttons">
                           <xforms:group ref=".[$authorize]">
                              <!-- button for authorizing setting status to 'active' -->
                              <fr:button ref=".[@statusCode='review']">
                                 <xforms:label>
                                    <xhtml:img src="/img/tick.png" alt=""/>
                                 </xforms:label>
                                 <xforms:hint>
                                    <xforms:output ref="$resources/authorize-and-activate"/>
                                 </xforms:hint>
                                 <xforms:action ev:event="DOMActivate">
                                    <xforms:setvalue ref="instance('status-change')/@object" value="'member'"/>
                                    <xforms:setvalue ref="instance('status-change')/@ref" value="instance('member')/@id"/>
                                    <xforms:setvalue ref="instance('status-change')/@refsetId" value="instance('refset-navigation')"/>
                                    <xforms:setvalue ref="instance('status-change')/@statusCode" value="'active'"/>
                                    <xforms:send submission="set-status"/>
                                 </xforms:action>
                              </fr:button>
                           </xforms:group>
                           <xforms:group ref=".[$editor]">
                              <!-- button for setting status to 'review' -->
                              <fr:button ref=".[@statusCode=('draft')]">
                                 <xforms:label>
                                    <xhtml:img src="/img/eye.png" alt=""/>
                                 </xforms:label>
                                 <xforms:hint>
                                    <xforms:output ref="$resources/review"/>
                                 </xforms:hint>
                                 <xforms:action ev:event="DOMActivate">
                                    <xforms:setvalue ref="instance('status-change')/@object" value="'member'"/>
                                    <xforms:setvalue ref="instance('status-change')/@ref" value="instance('member')/@id"/>
                                    <xforms:setvalue ref="instance('status-change')/@refsetId" value="instance('refset-navigation')"/>
                                    <xforms:setvalue ref="instance('status-change')/@statusCode" value="'review'"/>
                                    <xforms:send submission="set-status"/>
                                 </xforms:action>
                              </fr:button>
                              <!-- button for setting status to 'draft' -->
                              <fr:button ref=".[@statusCode='review']">
                                 <xforms:label>
                                    <xhtml:img src="/img/write.png" alt=""/>
                                 </xforms:label>
                                 <xforms:hint>
                                    <xforms:output ref="$resources/edit"/>
                                 </xforms:hint>
                                 <xforms:action ev:event="DOMActivate">
                                    <xforms:setvalue ref="instance('status-change')/@object" value="'member'"/>
                                    <xforms:setvalue ref="instance('status-change')/@ref" value="instance('member')/@id"/>
                                    <xforms:setvalue ref="instance('status-change')/@refsetId" value="instance('refset-navigation')"/>
                                    <xforms:setvalue ref="instance('status-change')/@statusCode" value="'draft'"/>
                                    <xforms:send submission="set-status"/>
                                 </xforms:action>
                              </fr:button>
                              <!-- button for setting status to 'rejected' -->
                              <fr:button ref=".[@statusCode='draft']">
                                 <xforms:label>
                                    <xhtml:img src="/img/node-srejected.png" alt=""/>
                                 </xforms:label>
                                 <xforms:hint>
                                    <xforms:output ref="$resources/set-status-to-rejected"/>
                                 </xforms:hint>
                                 <xforms:action ev:event="DOMActivate">
                                    <xforms:setvalue ref="instance('status-change')/@ref" value="instance('member')/@id"/>
                                    <xforms:setvalue ref="instance('status-change')/@refsetId" value="instance('refset-navigation')"/>
                                    <xforms:setvalue ref="instance('status-change')/@statusCode" value="'rejected'"/>
                                    <xforms:send submission="set-status"/>
                                 </xforms:action>
                              </fr:button>
                              <!-- button for deleting member -->
                              <fr:button ref=".[@statusCode='draft']">
                                 <xforms:label>
                                    <xhtml:img src="/img/remove.gif" alt=""/>
                                 </xforms:label>
                                 <xforms:hint>
                                    <xforms:output ref="$resources/delete"/>
                                 </xforms:hint>
                                 <xforms:action ev:event="DOMActivate">
                                    <xforms:action
                                       xxforms:iterate="instance('snomed-context-concept')//concept[@conceptId=instance('member')/concept/@conceptId]|instance('snomed-context-concept')//dest[@sourceId=instance('member')/concept/@conceptId]">
                                       <xforms:setvalue ref="context()/@memberStatusCode" value="''"/>
                                    </xforms:action>
                                    <xforms:action xxforms:iterate="instance('snomed-description-itemset')//description[@conceptId=instance('member')/concept/@conceptId]">
                                       <xforms:setvalue ref="context()/@memberStatusCode" value="''"/>
                                    </xforms:action>
                                    <xforms:send submission="delete-refset-member"/>
                                    <xforms:send submission="get-refset-member"/>
                                 </xforms:action>
                              </fr:button>
                              <!-- button for setting status to 'retired' -->
                              <fr:button ref=".[@statusCode='active']">
                                 <xforms:label>
                                    <xhtml:img src="/img/node-sretired.png" alt=""/>
                                 </xforms:label>
                                 <xforms:hint>
                                    <xforms:output ref="$resources/deactivate"/>
                                 </xforms:hint>
                                 <xforms:action ev:event="DOMActivate">
                                    <xforms:setvalue ref="instance('status-change')/@object" value="'member'"/>
                                    <xforms:setvalue ref="instance('status-change')/@refsetId" value="instance('refset-navigation')"/>
                                    <xforms:setvalue ref="instance('status-change')/@ref" value="instance('member')/@id"/>
                                    <xforms:setvalue ref="instance('status-change')/@statusCode" value="'retired'"/>
                                    <xforms:send submission="set-status"/>
                                 </xforms:action>
                              </fr:button>
                           </xforms:group>
                           <!-- button for creating issue -->
                           <xxforms:variable name="noIssue" select="empty(instance('issues-instance')/issue[object/@id=instance('member')/@id])"/>
                           <xforms:group ref=".[$noIssue][$issueCreator][@statusCode=('draft','active')]">
                              <fr:button id="add-issue">
                                 <xforms:label>
                                    <xhtml:img src="/img/tracking.png" alt=""/>
                                 </xforms:label>
                                 <xforms:hint>
                                    <xforms:output ref="$resources/add-issue"/>
                                 </xforms:hint>
                                 <xforms:action ev:event="DOMActivate">
                                    <xforms:insert nodeset="instance('issues-instance')/issue" at="1" position="before" origin="instance('issue-instance')/issue"/>
                                    <xforms:setvalue ref="instance('issues-instance')/issue[1]/object/@id" value="instance('member')/@id"/>
                                    <xforms:setvalue ref="instance('issues-instance')/issue[1]/object/@type" value="'RS'"/>
                                    <xforms:setvalue ref="instance('issues-instance')/issue[1]/object/@effectiveDate" value="instance('member')/@effectiveTime"/>
                                    <xforms:setvalue ref="instance('issues-instance')/issue[1]/tracking/author" value="instance('refset-project')/author[@username=$user]"/>
                                    <xforms:setvalue ref="instance('issues-instance')/issue[1]/tracking/author/@id"
                                       value="instance('refset-project')/author[@username=xxforms:get-session-attribute('username')]/@id"/>
                                    <xforms:setvalue ref="instance('issues-instance')/issue[1]/tracking/desc/@language" value="instance('language')"/>
                                    <xforms:setvalue ref="instance('issues-instance')/issue[1]/@refsetId" value="instance('refset-project')/@ref"/>
                                    <xforms:setfocus control="issue-title"/>
                                 </xforms:action>
                              </fr:button>
                           </xforms:group>
                        </xhtml:div>
                     </xhtml:td>
                  </xhtml:tr>
                  <!-- status and effectiveTime -->
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/status"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xxforms:variable name="statusCode" select="@statusCode"/>
                        <xforms:output ref="instance('status-codes')/enumeration[@value=$statusCode]/label[@language=instance('language')]" class="node-s{$statusCode}"/>
                     </xhtml:td>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/date"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="@effectiveTime"
                           xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (. castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                        />
                     </xhtml:td>
                  </xhtml:tr>
                  <!-- last status change and effectiveTime -->
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/last-status-change"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="lastStatusChange/@effectiveDate"
                           xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (. castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                        />
                     </xhtml:td>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/by"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="lastStatusChange/@authorName"/>
                     </xhtml:td>
                  </xhtml:tr>
                  <!-- translation -->
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/translations"/> / <xforms:output ref="$resources/synonyms"/>
                        <xhtml:div class="buttons">
                           <xforms:trigger ref=".[$editor][count(concept/desc[@uuid])=0][concept]" appearance="minimal">
                              <xforms:label>[+]</xforms:label>
                              <xforms:hint ref="$resources/add" appearance="minimal"/>
                              <xforms:action ev:event="DOMActivate">
                                 <xforms:send submission="create-translation"/>
                                 <xforms:insert nodeset="concept/desc" origin="instance('desc')"/>
                              </xforms:action>
                           </xforms:trigger>
                        </xhtml:div>
                     </xhtml:td>
                     <xhtml:td colspan="3">
                        <xhtml:table width="100%">
                           <xhtml:tr>
                              <xhtml:td class="item-label">
                                 <xforms:output ref="$resources/term"/>
                              </xhtml:td>
                              <xhtml:td class="item-label" style="width:5%;">
                                 <xforms:output ref="$resources/language"/>
                              </xhtml:td>
                              <xhtml:td class="item-label" style="width:5%;">
                                 <xforms:output ref="$resources/type"/>
                              </xhtml:td>
                              <xhtml:td class="item-label" style="width:5%;">
                                 <xforms:output ref="$resources/status"/>
                              </xhtml:td>
                              <xhtml:td class="item-label" style="width:5%;"/>
                           </xhtml:tr>
                           <!-- EDITOR -->
                           <xforms:repeat nodeset="concept/desc[@uuid][$editor]" id="translations">
                              <xhtml:tr>
                                 <xhtml:td>
                                    <xforms:input ref=".[@statusCode='draft']">
                                       <xforms:action ev:event="xforms-value-changed">
                                          <xforms:send submission="update-translation"/>
                                       </xforms:action>
                                    </xforms:input>
                                    <xforms:output ref=".[@statusCode!='draft']"/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xforms:select1 ref="@languageCode" appearance="minimal" class="auto-width">
                                       <xforms:itemset nodeset="instance('desc-languages')/language">
                                          <xforms:label ref="label[@language=instance('language')]"/>
                                          <xforms:value ref="@code"/>
                                       </xforms:itemset>
                                       <xforms:action ev:event="xforms-value-changed">
                                          <xforms:send submission="update-translation"/>
                                       </xforms:action>
                                    </xforms:select1>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xforms:select1 ref="@type" appearance="minimal" class="auto-width">
                                       <xforms:itemset nodeset="instance('desc-types')/type">
                                          <xforms:label ref="label[@language=instance('language')]"/>
                                          <xforms:value ref="@code"/>
                                       </xforms:itemset>
                                       <xforms:action ev:event="xforms-value-changed">
                                          <xforms:send submission="update-translation"/>
                                       </xforms:action>
                                    </xforms:select1>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xxforms:variable name="statusCode" select="@statusCode"/>
                                    <xforms:output ref="instance('status-codes')/enumeration[@value=$statusCode]/label[@language=instance('language')]" class="node-s{$statusCode}"/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xhtml:div class="buttons">
                                       <xforms:trigger ref=".[$editor]" appearance="minimal">
                                          <xforms:label>[+]</xforms:label>
                                          <xforms:hint ref="$resources/add" appearance="minimal"/>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:send submission="create-translation"/>
                                             <xforms:insert nodeset="." origin="instance('desc')"/>
                                          </xforms:action>
                                       </xforms:trigger>
                                       <xforms:trigger ref=".[$editor][@statusCode='draft']" appearance="minimal">
                                          <xforms:label>[-]</xforms:label>
                                          <xforms:hint ref="$resources/remove" appearance="minimal"/>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:send submission="delete-translation"/>
                                             <xforms:delete nodeset="."/>
                                          </xforms:action>
                                       </xforms:trigger>
                                       <xforms:trigger ref=".[$authorize][@statusCode='draft'][string-length()&gt;0]" appearance="minimal">
                                          <xforms:label>[<xhtml:img src="/img/node-sfinal.png" alt=""/>]</xforms:label>
                                          <xforms:hint ref="$resources/set-status-to-final" appearance="minimal"/>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:send submission="find-duplicate-translations"/>
                                             <xxforms:show dialog="finalize-translation-dialog"/>
                                          </xforms:action>
                                       </xforms:trigger>
                                    </xhtml:div>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:repeat>
                           <!-- READONLY -->
                           <xforms:repeat nodeset="concept/desc[@uuid][not($editor)]">
                              <xhtml:tr class="not-selectable">
                                 <xhtml:td>
                                    <xforms:output ref="."/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xxforms:variable name="descLanguageCode" select="@languageCode"/>
                                    <xforms:output ref="instance('desc-languages')/language[@code=$descLanguageCode]/label[@language=instance('language')]"/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xxforms:variable name="descType" select="@type"/>
                                    <xforms:output ref="instance('desc-types')/type[@code=$descType]/label[@language=instance('language')]"/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xxforms:variable name="statusCode" select="@statusCode"/>
                                    <xforms:output ref="instance('status-codes')/enumeration[@value=$statusCode]/label[@language=instance('language')]" class="node-s{$statusCode}"/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xhtml:div class="buttons">
                                       <xforms:trigger ref=".[$editor]" appearance="minimal">
                                          <xforms:label>[+]</xforms:label>
                                          <xforms:hint ref="$resources/add" appearance="minimal"/>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:send submission="create-translation"/>
                                             <xforms:insert nodeset="." origin="instance('desc')"/>
                                          </xforms:action>
                                       </xforms:trigger>
                                       <xforms:trigger ref=".[$editor][@statusCode='draft']" appearance="minimal">
                                          <xforms:label>[-]</xforms:label>
                                          <xforms:hint ref="$resources/remove" appearance="minimal"/>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:send submission="delete-translation"/>
                                             <xforms:delete nodeset="."/>
                                          </xforms:action>
                                       </xforms:trigger>
                                       <xforms:trigger ref=".[$editor][@statusCode='draft']" appearance="minimal">
                                          <xforms:label>[<xhtml:img src="/img/node-sfinal.png" alt=""/>]</xforms:label>
                                          <xforms:hint ref="$resources/set-status-to-final" appearance="minimal"/>
                                          <!--                                          <xforms:delete ev:event="DOMActivate" nodeset="."/>-->
                                       </xforms:trigger>
                                    </xhtml:div>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xforms:repeat>
                        </xhtml:table>
                     </xhtml:td>
                  </xhtml:tr>
               </xforms:group>
               <!-- group for issue creation -->
               <xforms:group ref="instance('issues-instance')/issue[object/@id=instance('member')/@id]">
                  <xhtml:tr>
                     <xhtml:td colspan="4">
                        <xhtml:table width="100%">
                           <xhtml:tr>
                              <xhtml:td class="heading">
                                 <xhtml:div class="heading">
                                    <xforms:output ref="$resources/new-issue"/>
                                 </xhtml:div>
                              </xhtml:td>
                           </xhtml:tr>
                           <xhtml:tr>
                              <xhtml:td>
                                 <xhtml:table width="100%">
                                    <!-- issue type -->
                                    <xhtml:tr>
                                       <xhtml:td class="item-label">
                                          <xforms:output ref="$resources/type"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:select1 ref="@type" appearance="minimal">
                                             <xforms:itemset nodeset="instance('decor-types')/IssueType/enumeration">
                                                <xforms:label ref="label[@language=instance('language')]"/>
                                                <xforms:value ref="@value"/>
                                             </xforms:itemset>
                                          </xforms:select1>
                                       </xhtml:td>
                                    </xhtml:tr>
                                    <!-- issue type -->
                                    <xhtml:tr>
                                       <xhtml:td class="item-label">
                                          <xforms:output ref="$resources/priority"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:select1 ref="@priority" appearance="minimal">
                                             <xforms:itemset nodeset="instance('decor-types')/IssuePriority/enumeration">
                                                <xforms:label ref="label[@language=instance('language')]"/>
                                                <xforms:value ref="@value"/>
                                             </xforms:itemset>
                                          </xforms:select1>
                                       </xhtml:td>
                                    </xhtml:tr>
                                    <!-- title -->
                                    <xhtml:tr>
                                       <xhtml:td class="item-label">
                                          <xforms:output ref="$resources/title"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:input id="issue-title" ref="@displayName"/>
                                       </xhtml:td>
                                    </xhtml:tr>
                                    <!-- description of issue -->
                                    <xhtml:tr>
                                       <xhtml:td class="item-label">
                                          <xforms:output ref="$resources/description"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:textarea id="issue-description" mediatype="text/html" ref="tracking/desc"/>
                                       </xhtml:td>
                                    </xhtml:tr>
                                    <!-- save and cancel buttons -->
                                    <xhtml:tr>
                                       <xhtml:td class="item-label" colspan="2">
                                          <xhtml:div class="buttons">
                                             <fr:button>
                                                <xforms:label ref="$resources/cancel"/>
                                                <xforms:action ev:event="DOMActivate">
                                                   <xforms:delete ref="instance('issues-instance')/issue[object/@id=instance('member')/@id]"/>
                                                   <xforms:setvalue ref="instance('data-safe')">true</xforms:setvalue>
                                                </xforms:action>
                                             </fr:button>
                                             <fr:button>
                                                <xforms:label ref="$resources/save-issue"/>
                                                <xforms:action ev:event="DOMActivate">
                                                   <xforms:send submission="save-refset-issue"/>
                                                   <xforms:send submission="get-refset-issues"/>
                                                   <xforms:delete ref="instance('issues-instance')/issue[object/@id=instance('member')/@id]"/>
                                                   <xforms:setvalue ref="instance('data-safe')">true</xforms:setvalue>
                                                </xforms:action>
                                             </fr:button>
                                          </xhtml:div>
                                       </xhtml:td>
                                    </xhtml:tr>
                                 </xhtml:table>
                              </xhtml:td>
                           </xhtml:tr>
                        </xhtml:table>
                     </xhtml:td>
                  </xhtml:tr>
               </xforms:group>
               <!-- group for existing issues -->
               <xforms:group ref="instance('refset-issues')/issue[contains(xxforms:get-session-attribute('groups'),'issues')][object/@id=instance('member')/@id]">
                  <xhtml:tr>
                     <xhtml:td colspan="4">
                        <fr:accordion class="fr-accordion-lnf">
                           <fr:case>
                              <fr:label ref="concat($resources/issues,' (',count(instance('refset-issues')/issue[object/@id=instance('member')/@id]),')')"/>
                              <xhtml:div class="detail">
                                 <fr:accordion class="fr-accordion-lnf">
                                    <xforms:repeat nodeset="instance('refset-issues')/issue[object/@id=instance('member')/@id]" id="concept-issues">
                                       <fr:case>
                                          <fr:label>
                                             <xxforms:variable name="type" select="@type"/>
                                             <xforms:output ref="instance('decor-types')/IssueType/enumeration[@value=$type]/label[@language=instance('language')]"/>: <xforms:output ref="@displayName"
                                             />
                                          </fr:label>
                                          <xhtml:table width="100%">
                                             <!-- issue type and priority -->
                                             <xhtml:tr class="not-selectable">
                                                <xhtml:td class="item-label">
                                                   <xforms:output ref="$resources/type"/>
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xxforms:variable name="type" select="@type"/>
                                                   <xforms:output ref="instance('decor-types')/IssueType/enumeration[@value=$type]/label[@language=instance('language')]"/>
                                                </xhtml:td>
                                                <xhtml:td class="item-label">
                                                   <xforms:output ref="$resources/priority"/>
                                                </xhtml:td>
                                                <xhtml:td>
                                                   <xxforms:variable name="priority" select="@priority"/>
                                                   <xforms:output ref="instance('decor-types')/IssuePriority/enumeration[@value=$priority]/label[@language=instance('language')]"/>
                                                </xhtml:td>
                                             </xhtml:tr>
                                             <!-- issue events -->
                                             <xhtml:tr class="not-selectable">
                                                <xhtml:td class="item-label">
                                                   <xforms:output ref="$resources/events"/>
                                                </xhtml:td>
                                                <xhtml:td colspan="3">
                                                   <xforms:repeat nodeset="tracking|assignment">
                                                      <xhtml:table width="100%" class="detail" style="border: 1px solid #AAA;">
                                                         <xhtml:tr class="not-selectable">
                                                            <xhtml:td style="background-color : #ebe7e1;width:10%;">
                                                               <xxforms:variable name="status" select="@statusCode"/>
                                                               <xforms:group ref=".[name()='assignment']">
                                                                  <xforms:output mediatype="image/*" value="'/img/arrowright.png'">
                                                                     <xforms:hint ref="$resources/assignment"/>
                                                                  </xforms:output>
                                                               </xforms:group>
                                                               <xforms:group ref=".[name()='tracking']">
                                                                  <xforms:output mediatype="image/*" value="'/img/tracking.png'">
                                                                     <xforms:hint ref="$resources/tracking"/>
                                                                  </xforms:output>
                                                                  <xforms:output mediatype="image/*" value="concat('/img/IssueStatusCodeLifeCycle_',@statusCode,'.png')">
                                                                     <xforms:hint>
                                                                        <xforms:output ref="$resources/status"
                                                                           /> = 
                                                                           <xforms:output
                                                                           ref="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value=$status]/label[@language=instance('language')]"/>
                                                                     </xforms:hint>
                                                                  </xforms:output>
                                                               </xforms:group>
                                                            </xhtml:td>
                                                            <xhtml:td style="background-color : #ebe7e1;">
                                                               <xforms:output ref="author"/>
                                                            </xhtml:td>
                                                            <xhtml:td style="background-color : #ebe7e1;">
                                                               <xforms:output ref="@effectiveDate"
                                                                  xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (. castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                                               />
                                                            </xhtml:td>
                                                         </xhtml:tr>
                                                         <xforms:group ref="@name">
                                                            <xhtml:tr class="not-selectable">
                                                               <xhtml:td class="item-label">
                                                                  <xforms:output ref="$resources/assigned-to"/>
                                                               </xhtml:td>
                                                               <xhtml:td colspan="2">
                                                                  <xforms:output ref="."/>
                                                               </xhtml:td>
                                                            </xhtml:tr>
                                                         </xforms:group>
                                                         <xhtml:tr class="not-selectable">
                                                            <xhtml:td class="item-label">
                                                               <xforms:output ref="$resources/description"/>
                                                            </xhtml:td>
                                                            <xhtml:td colspan="2">
                                                               <xforms:output mediatype="text/html" ref="desc"/>
                                                            </xhtml:td>
                                                         </xhtml:tr>
                                                      </xhtml:table>
                                                   </xforms:repeat>
                                                </xhtml:td>
                                             </xhtml:tr>
                                          </xhtml:table>
                                       </fr:case>
                                    </xforms:repeat>
                                 </fr:accordion>
                              </xhtml:div>
                           </fr:case>
                        </fr:accordion>
                     </xhtml:td>
                  </xhtml:tr>
               </xforms:group>

               <!-- SNOMED CT Context -->
            </xhtml:table>
            <!-- SNOMED CONTEXT -->
            <xhtml:table class="detail" width="100%" style="border:2px solid #CCC;">
               <xforms:group ref="instance('member')">
                  <xxforms:variable name="current-member-concept" select="instance('snomed-context-concept')//concept[@navId=instance('snomed-context-hierarchy-navigation')]"/>
                  <xhtml:tr>
                     <xhtml:td class="heading" colspan="2">
                        <xhtml:div class="heading">
                           <xforms:output ref="$resources/snomed-ct-context"/>
                        </xhtml:div>
                        <!-- selection buttons -->
                        <xforms:group ref=".[instance('snomed-select-mode')='true']">
                           <xhtml:div class="buttons">
                              <!-- cancel select -->
                              <fr:button>
                                 <xforms:label ref="$resources/cancel"/>
                                 <xforms:action ev:event="DOMActivate">
                                    <xforms:action xxforms:iterate="instance('snomed-context-concept')//concept[@selected]">
                                       <xforms:setvalue ref="context()/@memberStatusCode" value="''"/>
                                       <xforms:delete nodeset="context()/@selected"/>
                                    </xforms:action>
                                    <xforms:setvalue ref="instance('snomed-select-mode')" value="'false'"/>
                                 </xforms:action>
                              </fr:button>
                              <!-- select -->
                              <xforms:group ref=".[$current-member-concept/@memberStatusCode='']">
                                 <fr:button>
                                    <xforms:label>
                                       <xhtml:img src="/img/node-sdraft.png" alt=""/>
                                    </xforms:label>
                                    <xforms:action ev:event="DOMActivate">
                                       <xforms:insert nodeset="$current-member-concept/@*" origin="xxforms:attribute('selected','')"/>
                                       <xforms:setvalue ref="$current-member-concept/@memberStatusCode" value="'draft'"/>
                                    </xforms:action>
                                 </fr:button>
                              </xforms:group>
                              <!-- deselect -->
                              <xforms:group ref=".[$current-member-concept/@selected]">
                                 <fr:button>
                                    <xforms:label>
                                       <xhtml:img src="/img/node-s.png" alt=""/>
                                    </xforms:label>
                                    <xforms:action ev:event="DOMActivate">
                                       <xforms:delete nodeset="$current-member-concept/@selected"/>
                                       <xforms:setvalue ref="$current-member-concept/@memberStatusCode" value="''"/>
                                    </xforms:action>
                                 </fr:button>
                              </xforms:group>
                              <!-- concepts with subconcepts -->
                              <xforms:group ref=".[$current-member-concept/concept]">
                                 <!-- select direct children -->
                                 <xforms:group ref=".[$current-member-concept/concept]">
                                    <fr:button>
                                       <xforms:label>
                                          <xhtml:img src="/img/node-s.png" alt=""/>/<xhtml:img src="/img/node-sdraft.png" alt=""/>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:action xxforms:iterate="$current-member-concept/concept[@memberStatusCode='']">
                                             <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('selected','')"/>
                                             <xforms:setvalue ref="context()/@memberStatusCode" value="'draft'"/>
                                          </xforms:action>
                                       </xforms:action>
                                    </fr:button>
                                 </xforms:group>
                                 <!-- select all children -->
                                 <xforms:group ref=".[$current-member-concept/concept/concept]">
                                    <fr:button>
                                       <xforms:label>
                                          <xhtml:img src="/img/node-s.png" alt=""/>//<xhtml:img src="/img/node-sdraft.png" alt=""/>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:action xxforms:iterate="$current-member-concept//concept[@memberStatusCode='']">
                                             <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('selected','')"/>
                                             <xforms:setvalue ref="context()/@memberStatusCode" value="'draft'"/>
                                          </xforms:action>
                                       </xforms:action>
                                    </fr:button>
                                 </xforms:group>
                                 <!-- select with direct children -->
                                 <xforms:group ref=".[$current-member-concept/concept][$current-member-concept/@memberStatusCode='']">
                                    <fr:button>
                                       <xforms:label>
                                          <xhtml:img src="/img/node-sdraft.png" alt=""/>/<xhtml:img src="/img/node-sdraft.png" alt=""/>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:action if="$current-member-concept/@memberStatusCode=''">
                                             <xforms:insert nodeset="$current-member-concept/@*" origin="xxforms:attribute('selected','')"/>
                                             <xforms:setvalue ref="$current-member-concept/@memberStatusCode" value="'draft'"/>
                                          </xforms:action>
                                          <xforms:action xxforms:iterate="$current-member-concept/concept[@memberStatusCode='']">
                                             <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('selected','')"/>
                                             <xforms:setvalue ref="context()/@memberStatusCode" value="'draft'"/>
                                          </xforms:action>
                                       </xforms:action>
                                    </fr:button>
                                 </xforms:group>
                                 <!-- select with all children -->
                                 <xforms:group ref=".[$current-member-concept/concept/concept][$current-member-concept/@memberStatusCode='']">
                                    <fr:button>
                                       <xforms:label>
                                          <xhtml:img src="/img/node-sdraft.png" alt=""/>//<xhtml:img src="/img/node-sdraft.png" alt=""/>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:action if="$current-member-concept/@memberStatusCode=''">
                                             <xforms:insert nodeset="$current-member-concept/@*" origin="xxforms:attribute('selected','')"/>
                                             <xforms:setvalue ref="$current-member-concept/@memberStatusCode" value="'draft'"/>
                                          </xforms:action>
                                          <xforms:action xxforms:iterate="$current-member-concept//concept[@memberStatusCode='']">
                                             <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('selected','')"/>
                                             <xforms:setvalue ref="context()/@memberStatusCode" value="'draft'"/>
                                          </xforms:action>
                                       </xforms:action>
                                    </fr:button>
                                 </xforms:group>
                                 <!-- deselect including children -->
                                 <xforms:group ref=".[$current-member-concept/@selected]">
                                    <fr:button>
                                       <xforms:label>
                                          <xhtml:img src="/img/node-s.png" alt=""/>//<xhtml:img src="/img/node-s.png" alt=""/>
                                       </xforms:label>
                                       <xforms:action ev:event="DOMActivate">
                                          <xforms:delete nodeset="$current-member-concept/@selected"/>
                                          <xforms:setvalue ref="$current-member-concept/@memberStatusCode" value="''"/>
                                          <xforms:action xxforms:iterate="$current-member-concept//concept">
                                             <xforms:delete nodeset="context()/@selected"/>
                                             <xforms:setvalue ref="context()/@memberStatusCode" value="''"/>
                                          </xforms:action>
                                       </xforms:action>
                                    </fr:button>
                                 </xforms:group>
                              </xforms:group>
                              <!-- deselect ALL -->
                              <xforms:group ref=".[instance('snomed-context-concept')//concept/@selected]">
                                 <fr:button>
                                    <xforms:label>
                                       //<xhtml:img src="/img/node-s.png" alt=""/>
                                    </xforms:label>
                                    <xforms:action ev:event="DOMActivate" xxforms:iterate="instance('snomed-context-concept')//concept[@selected]">
                                       <xforms:delete nodeset="context()/@selected"/>
                                       <xforms:setvalue ref="context()/@memberStatusCode" value="''"/>
                                    </xforms:action>
                                 </fr:button>
                              </xforms:group>
                              <!-- add selected concepts to refset -->
                              <xforms:group ref=".[instance('snomed-context-concept')//concept/@selected]">
                                 <fr:button>
                                    <xforms:label ref="$resources/add-selected-concepts"/>
                                    <xforms:action ev:event="DOMActivate">
                                       <xforms:insert context="instance('snomed-context-concept')" origin="xxforms:attribute('refsetId',instance('refset-navigation'))"/>
                                       <!-- iterate selected concepts -->
                                       <xforms:action xxforms:iterate="instance('snomed-context-concept')//concept[@selected]">
                                          <xxforms:variable name="concept" select="context()"/>
                                          <xforms:action xxforms:iterate="instance('snomed-description-itemset')//description[@conceptId=$concept/@conceptId]">
                                             <xforms:setvalue ref="context()/@memberStatusCode" value="$concept/@memberStatusCode"/>
                                          </xforms:action>
                                       </xforms:action>
                                       <xforms:send submission="add-selected-concepts"/>
                                       <xforms:send submission="get-snomed-context-concept"/>
                                       <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                    </xforms:action>
                                 </fr:button>
                              </xforms:group>
                           </xhtml:div>
                        </xforms:group>
                     </xhtml:td>
                  </xhtml:tr>
                  <!-- table row with master-detail columns -->
                  <xhtml:tr>
                     <!-- left column with tree concept-navigation -->
                     <xhtml:td width="40%">
                        <!-- table for tree concept-navigation components -->
                        <xhtml:table width="100%">
                           <xhtml:tr>
                              <xhtml:td class="heading">
                                 <xhtml:div class="heading">
                                    <xforms:output ref="$resources/hierarchy"/>
                                 </xhtml:div>
                                 <xforms:group ref=".[$editor][instance('snomed-select-mode')='false'][instance('snomed-context-concept')/concept/concept]">
                                    <xhtml:div class="buttons">
                                       <fr:button>
                                          <xforms:label ref="$resources/select-subconcepts"/>
                                          <xforms:action ev:event="DOMActivate">
                                             <xforms:setvalue ref="instance('snomed-select-mode')" value="'true'"/>
                                          </xforms:action>
                                       </fr:button>
                                    </xhtml:div>
                                 </xforms:group>
                              </xhtml:td>
                           </xhtml:tr>
                           <xhtml:tr>
                              <xhtml:td>
                                 <xhtml:div class="navigate-container">
                                    <xhtml:div class="navigate">
                                       <xforms:select1 ref="instance('snomed-context-hierarchy-navigation')" appearance="xxforms:tree">
                                          <xforms:itemset nodeset="instance('snomed-context-concept')//*[name()='concept' or (name()='dest' and @type='Is a')]"
                                             xxforms:open="{if (parent::concepts) then 'true' else ('false')}" class="node-s{@memberStatusCode} {if (not(@active)) then 'node-alert' else ''}">
                                             <xforms:label ref="if (@conceptId) then desc[@type='pref'] else concat(.,' (',@subCount,')') "/>
                                             <xforms:value ref="@navId"/>
                                          </xforms:itemset>
                                          <xforms:action ev:event="xforms-value-changed">
                                             <xforms:action if="$current-member-concept/dest">
                                                <xforms:send submission="get-snomed-context-subconcepts"/>
                                                <xforms:action xxforms:iterate="instance('snomed-context-subconcepts')//concept">
                                                   <xforms:insert nodeset="context()/@*" origin="$current-member-concept/dest[@sourceId=context()/@conceptId]/@navId"/>
                                                </xforms:action>
                                                <xforms:action xxforms:iterate="instance('snomed-context-subconcepts')//dest">
                                                   <xforms:insert nodeset="context()/@*" origin="xxforms:attribute('navId',random())"/>
                                                </xforms:action>
                                                <xforms:delete ref="$current-member-concept/dest"/>
                                                <xforms:insert nodeset="$current-member-concept/*" origin="instance('snomed-context-subconcepts')//concept"/>
                                             </xforms:action>
                                             <xforms:send submission="get-snomed-focus-concept"/>
                                          </xforms:action>
                                       </xforms:select1>
                                    </xhtml:div>
                                 </xhtml:div>
                              </xhtml:td>
                           </xhtml:tr>
                        </xhtml:table>
                     </xhtml:td>
                     <!-- concept details -->
                     <xhtml:td width="60%">
                        <xforms:group ref="instance('snomed-focus-concept')/concept">
                           <xhtml:table width="100%">
                              <!-- row with buttons -->
                              <xhtml:tr>
                                 <xhtml:td class="heading" colspan="2">
                                    <xhtml:div class="{if (not(@active)) then 'heading-alert' else 'heading'}">
                                       <xforms:output ref="@conceptId"/> - <xforms:output ref="desc[@type='pref'][@active]"/>
                                    </xhtml:div>
                                    <!-- div with buttons -->
                                    <xhtml:div class="buttons">
                                       <!-- button for adding concept to refset -->
                                       <xforms:group ref=".[instance('snomed-select-mode')='false'][$editor][@memberStatusCode=''][@active]">
                                          <fr:button>
                                             <xforms:label>
                                                <xhtml:img src="/img/plus.png" alt=""/>
                                             </xforms:label>
                                             <xforms:hint>
                                                <xforms:output ref="$resources/add"/>
                                             </xforms:hint>
                                             <xforms:action ev:event="DOMActivate">
                                                <xforms:send submission="add-concept-to-refset"/>
                                                <xforms:setvalue ref="@memberStatusCode" value="instance('member')/@statusCode"/>
                                                <xforms:action
                                                   xxforms:iterate="instance('snomed-context-concept')//concept[@conceptId=instance('member')/concept/@conceptId]|instance('snomed-context-concept')//dest[@sourceId=instance('member')/concept/@conceptId]">
                                                   <xforms:setvalue ref="context()/@memberStatusCode" value="instance('member')/@statusCode"/>
                                                </xforms:action>
                                                <xforms:action xxforms:iterate="instance('snomed-description-itemset')//description[@conceptId=instance('member')/concept/@conceptId]">
                                                   <xforms:setvalue ref="context()/@memberStatusCode" value="instance('member')/@statusCode"/>
                                                </xforms:action>
                                             </xforms:action>
                                          </fr:button>
                                       </xforms:group>
                                    </xhtml:div>
                                 </xhtml:td>
                              </xhtml:tr>
                              <xhtml:tr>
                                 <xhtml:td class="item-label">
                                    <xforms:output ref="$resources/full-name"/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xforms:output ref="desc[@type='fsn'][@active]"/>
                                 </xhtml:td>
                              </xhtml:tr>
                              <!-- concept synonyms -->
                              <xhtml:tr>
                                 <xhtml:td class="item-label">
                                    <xforms:output ref="$resources/synonyms"/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xhtml:table width="100%">
                                       <xforms:repeat nodeset="desc[@type='syn'][@active]">
                                          <xhtml:tr class="not-selectable">
                                             <xhtml:td>
                                                <xforms:output ref="."/>
                                             </xhtml:td>
                                          </xhtml:tr>
                                       </xforms:repeat>
                                    </xhtml:table>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xhtml:table>
                           <xhtml:div class="h2">
                              <xforms:output ref="$resources/definition"/> (<xforms:output ref="@definitionStatus"/>)
                                       </xhtml:div>
                           <!-- concept definitions -->
                           <xhtml:table width="100%" style="border:solid 1px #CCC;margin-bottom:0.4em;margin-top:0.2em">
                              <xforms:repeat nodeset="grp[@grp='0']" id="member-group">
                                 <xhtml:tr class="not-selectable">
                                    <xhtml:td width="90%">
                                       <xhtml:table width="100%">
                                          <xforms:repeat nodeset="src[@typeId='116680003'][@active]" id="member-sourcesIsA">
                                             <xhtml:tr class="not-selectable">
                                                <xhtml:td width="30%" class="floating-label">
                                                   <xforms:output ref="@type"/>
                                                </xhtml:td>
                                                <xhtml:td width="70%">
                                                   <xforms:trigger appearance="minimal">
                                                      <xforms:label ref="."/>
                                                      <xforms:action ev:event="DOMActivate">
                                                         <xforms:setvalue ref="instance('snomed-context-navigation')" value="xxforms:repeat-current('member-sourcesIsA')/@destinationId"/>
                                                         <xforms:send submission="get-snomed-context-concept"/>
                                                         <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                                      </xforms:action>
                                                   </xforms:trigger>
                                                </xhtml:td>
                                             </xhtml:tr>
                                          </xforms:repeat>
                                          <xforms:repeat nodeset="src[@typeId!='116680003'][@active]" id="member-sources">
                                             <xhtml:tr class="not-selectable">
                                                <xhtml:td width="30%" class="floating-label">
                                                   <xforms:output ref="@type"/>
                                                </xhtml:td>
                                                <xhtml:td width="70%">
                                                   <xforms:trigger appearance="minimal">
                                                      <xforms:label ref="."/>
                                                      <xforms:action ev:event="DOMActivate">
                                                         <xforms:setvalue ref="instance('snomed-context-navigation')" value="xxforms:repeat-current('member-sources')/@destinationId"/>
                                                         <xforms:send submission="get-snomed-context-concept"/>
                                                         <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                                      </xforms:action>
                                                   </xforms:trigger>
                                                </xhtml:td>
                                             </xhtml:tr>
                                          </xforms:repeat>
                                       </xhtml:table>
                                    </xhtml:td>
                                 </xhtml:tr>
                              </xforms:repeat>
                           </xhtml:table>
                           <xforms:repeat nodeset="grp[@grp!='0']" id="member-groups">
                              <xhtml:table width="100%" class="not-selectable" style="border:solid 1px #CCC;margin-bottom:0.4em">
                                 <xforms:repeat nodeset="src[@active]" id="member-grpSources">
                                    <xhtml:tr class="not-selectable">
                                       <xhtml:td width="30%" class="floating-label">
                                          <xforms:output ref="@type"/>
                                       </xhtml:td>
                                       <xhtml:td width="70%">
                                          <xforms:trigger appearance="minimal">
                                             <xforms:label ref="."/>
                                             <xforms:action ev:event="DOMActivate">
                                                <xforms:setvalue ref="instance('snomed-context-navigation')" value="xxforms:repeat-current('member-grpSources')/@destinationId"/>
                                                <xforms:send submission="get-snomed-context-concept"/>
                                                <xforms:setvalue ref="instance('snomed-context-hierarchy-navigation')" value="instance('snomed-context-concept')//concept[1]/@navId"/>
                                             </xforms:action>
                                          </xforms:trigger>
                                       </xhtml:td>
                                    </xhtml:tr>
                                 </xforms:repeat>
                              </xhtml:table>
                           </xforms:repeat>
                           <!-- REFSETS -->
                           <xforms:group ref="refsets[refset]">
                              <xhtml:table width="100%" style="border:solid 1px #CCC;margin-bottom:0.4em;">
                                 <xhtml:tr class="not-selectable">
                                    <xhtml:td class="item-label">
                                       <xforms:output ref="$resources/reference-set"/>
                                    </xhtml:td>
                                    <xhtml:td width="90%">
                                       <xhtml:table width="100%">
                                          <xforms:repeat nodeset="refset">
                                             <xhtml:tr class="not-selectable">
                                                <xhtml:td>
                                                   <xforms:output ref="@refset"/>
                                                </xhtml:td>
                                             </xhtml:tr>
                                          </xforms:repeat>
                                       </xhtml:table>
                                    </xhtml:td>
                                 </xhtml:tr>
                              </xhtml:table>
                           </xforms:group>
                           <!-- Simple Mappings -->
                           <xforms:group ref="simpleMaps[map]">
                              <xhtml:table width="100%" style="border:solid 1px #CCC;margin-bottom:0.4em">
                                 <xforms:repeat nodeset="map[@active='1']">
                                    <xhtml:tr class="not-selectable">
                                       <xhtml:td width="30%" class="floating-label">
                                          <xforms:output ref="@refset"/>
                                       </xhtml:td>
                                       <xhtml:td width="70%">
                                          <xforms:output ref="@mapTarget"/>
                                       </xhtml:td>
                                    </xhtml:tr>
                                 </xforms:repeat>
                              </xhtml:table>
                           </xforms:group>
                           <!-- Complex Mappings -->
                           <xforms:group ref="complexMaps[map]">
                              <xhtml:table width="100%" style="border:solid 1px #CCC;margin-bottom:0.4em">
                                 <xforms:repeat nodeset="map">
                                    <xhtml:tr class="not-selectable">
                                       <xhtml:td width="30%" class="floating-label">
                                          <xforms:output ref="@refset"/>
                                       </xhtml:td>
                                       <xhtml:td width="70%">
                                          <xforms:repeat nodeset="group">
                                             <xhtml:table width="100%" style="border:solid 1px #CCC;margin-bottom:0.4em">
                                                <xhtml:tr class="not-selectable">
                                                   <xhtml:td>
                                                      <xhtml:table width="100%">
                                                         <xforms:repeat nodeset="map[@active='1']">
                                                            <xhtml:tr class="not-selectable">
                                                               <xhtml:td>
                                                                  <xforms:output ref="@mapTarget"/>
                                                               </xhtml:td>
                                                               <xhtml:td>
                                                                  <xforms:output ref="@mapRule">
                                                                     <xforms:hint>
                                                                        <xforms:output ref="../@mapAdvice"/>
                                                                        <xhtml:br/>
                                                                        <xforms:output ref="../@correlation"/>
                                                                     </xforms:hint>
                                                                  </xforms:output>
                                                               </xhtml:td>
                                                            </xhtml:tr>
                                                         </xforms:repeat>
                                                      </xhtml:table>
                                                   </xhtml:td>
                                                </xhtml:tr>
                                             </xhtml:table>
                                          </xforms:repeat>
                                       </xhtml:td>
                                    </xhtml:tr>
                                 </xforms:repeat>
                              </xhtml:table>
                           </xforms:group>
                        </xforms:group>
                     </xhtml:td>
                  </xhtml:tr>
               </xforms:group>
            </xhtml:table>
         </fr:tab>
         <!-- PROJECT TAB -->
         <fr:tab>
            <fr:label ref="$resources/general"/>
            <xforms:group ref=".[instance('data-safe')='false']">
               <xhtml:table width="100%" style="margin-bottom:0.5em;">
                  <xhtml:tr>
                     <xhtml:td colspan="4">
                        <xhtml:div class="buttons">
                           <fr:button>
                              <xforms:label ref="$resources/cancel"/>
                              <xforms:action ev:event="DOMActivate">
                                 <xforms:send submission="get-refset-project"/>
                                 <xforms:setvalue ref="instance('data-safe')" value="'true'"/>
                              </xforms:action>
                           </fr:button>
                           <fr:button>
                              <xforms:label ref="$resources/save"/>
                              <xforms:action ev:event="DOMActivate">
                                 <xforms:send submission="save-refset-project"/>
                                 <xforms:send submission="get-refset-project"/>
                                 <xforms:setvalue ref="instance('data-safe')" value="'true'"/>
                              </xforms:action>
                           </fr:button>
                        </xhtml:div>
                     </xhtml:td>
                  </xhtml:tr>
               </xhtml:table>
            </xforms:group>
            <xhtml:table width="100%" class="detail">
               <!-- EDITOR -->
               <xforms:group ref="instance('refset-project')[$editor]">
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/display-name"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:input ref="name[@language=instance('language')]"/>
                     </xhtml:td>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/id"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="@ref"/>
                     </xhtml:td>
                  </xhtml:tr>
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/dependency"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="moduleDependency/@referencedComponent"/>
                     </xhtml:td>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/date"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="moduleDependency/@sourceEffectiveTime"
                           xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (. castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                        />
                     </xhtml:td>
                  </xhtml:tr>
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/description"/>
                     </xhtml:td>
                     <xhtml:td colspan="3">
                        <xforms:textarea mediatype="text/html" ref="desc[@language=instance('language')]"/>
                     </xhtml:td>
                  </xhtml:tr>
               </xforms:group>
               <!-- READONLY -->
               <xforms:group ref="instance('refset-project')[not($editor)]">
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/name"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="project/name[@language=instance('language')]"/>
                     </xhtml:td>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/id"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="@id"/>
                     </xhtml:td>
                  </xhtml:tr>
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/dependency"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="moduleDependency/@referencedComponent"/>
                     </xhtml:td>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/date"/>
                     </xhtml:td>
                     <xhtml:td>
                        <xforms:output ref="moduleDependency/@sourceEffectiveTime"
                           xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (. castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                        />
                     </xhtml:td>
                  </xhtml:tr>
                  <xhtml:tr>
                     <xhtml:td class="item-label">
                        <xforms:output ref="$resources/description"/>
                     </xhtml:td>
                     <xhtml:td colspan="3">
                        <xforms:output mediatype="text/html" ref="project/desc[@language=instance('language')]"/>
                     </xhtml:td>
                  </xhtml:tr>
               </xforms:group>
            </xhtml:table>
            <!-- AUTHORS -->
            <xhtml:table width="100%" class="detail" style="border:2px solid #CCC;margin-top:1em;">
               <xforms:group ref="instance('refset-project')">
                  <!-- row with authors header and buttons -->
                  <xhtml:tr>
                     <xhtml:td class="heading" colspan="7">
                        <xhtml:div class="heading">
                           <xforms:output ref="$resources/users"/>
                        </xhtml:div>
                        <!-- div with buttons -->
                        <xforms:group ref=".[$admin]">
                           <xhtml:div class="buttons">
                              <fr:button id="add-author">
                                 <xforms:label>
                                    <xhtml:img src="/img/plus.png" alt=""/>
                                 </xforms:label>
                                 <xforms:hint>
                                    <xforms:output ref="$resources/add-author"/>
                                 </xforms:hint>
                                 <xforms:action ev:event="DOMActivate">
                                    <xxforms:show dialog="select-user-dialog"/>
                                 </xforms:action>
                              </fr:button>
                              <fr:button id="delete-author">
                                 <xforms:label>
                                    <xhtml:img src="/img/remove.gif" alt=""/>
                                 </xforms:label>
                                 <xforms:hint>
                                    <xforms:output ref="$resources/delete-author"/>
                                 </xforms:hint>
                                 <xforms:action ev:event="DOMActivate">
                                    <xforms:delete context="instance('refset-project')" nodeset="author" at="index('authorList')"/>
                                 </xforms:action>
                              </fr:button>
                           </xhtml:div>
                        </xforms:group>
                     </xhtml:td>
                  </xhtml:tr>
                  <!-- EDITOR -->
                  <xforms:group ref=".[$admin]">
                     <xhtml:tr>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/id"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/user-name"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/name"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/issues"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/edit"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/authorize"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/admin"/>
                        </xhtml:td>
                     </xhtml:tr>
                     <xforms:repeat nodeset="author" id="authorList">
                        <xhtml:tr>
                           <xhtml:td>
                              <xforms:output ref="@id"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xxforms:variable name="username" select="@username"/>
                              <xforms:output ref="@username"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="."/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@issues" class="auto-width"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@edit" class="auto-width"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@authorize" class="auto-width"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@admin" class="auto-width"/>
                           </xhtml:td>
                        </xhtml:tr>
                     </xforms:repeat>
                  </xforms:group>
                  <!-- VIEWER -->
                  <xforms:group ref=".[not($admin)]">
                     <xhtml:tr>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/name"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/issues"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/edit"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/authorize"/>
                        </xhtml:td>
                        <xhtml:td class="heading">
                           <xforms:output ref="$resources/admin"/>
                        </xhtml:td>
                        <!--                            <xhtml:td class="item-label">
                                <xforms:output ref="$resources/username"/>
                            </xhtml:td>-->
                     </xhtml:tr>
                     <xforms:repeat nodeset="author">
                        <xhtml:tr class="not-selectable">
                           <xhtml:td>
                              <xforms:output ref="."/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@issues" class="auto-width"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@edit" class="auto-width"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@authorize" class="auto-width"/>
                           </xhtml:td>
                           <xhtml:td>
                              <xforms:input ref="@admin" class="auto-width"/>
                           </xhtml:td>
                        </xhtml:tr>
                     </xforms:repeat>
                  </xforms:group>
               </xforms:group>
            </xhtml:table>
         </fr:tab>
         <!-- ISSUES TAB -->
         <fr:tab>
            <fr:label ref="$resources/issues"/>
            <fr:accordion class="fr-accordion-lnf">
               <fr:case selected="true" id="search-box">
                  <fr:label ref="$resources/selection"/>
                  <xhtml:table width="100%">
                     <!-- row with issues table -->
                     <xhtml:tr>
                        <xhtml:td colspan="4">
                           <xhtml:b>
                              <xforms:output ref="$resources/show"/>
                              <xforms:output
                                 ref="concat(' (', $resources/issues, ': ', count(instance('refset-issues')/issue[if (string-length(instance('selected-issue-id'))&gt;0) then (tokenize(@id,'\.')[last()]=instance('selected-issue-id')) else (@currentStatusCode=tokenize(instance('selected-status-codes'),' ') and @type=tokenize(instance('selected-issue-types'),' ') and (instance('selected-issue-priorities')='' or @priority=tokenize(instance('selected-issue-priorities'),' ')) and (instance('selected-issue-assignee')='' or @lastAssignment=instance('selected-issue-assignee')))]), ' / ', count(instance('refset-issues')/issue), ')')"
                              />
                           </xhtml:b>
                        </xhtml:td>
                     </xhtml:tr>
                     <xhtml:tr>
                        <xhtml:td class="item-label">
                           <xforms:output ref="concat($resources/status,': ')"/>
                        </xhtml:td>
                        <xhtml:td>
                           <xforms:select ref="instance('selected-status-codes')" appearance="full">
                              <xforms:itemset nodeset="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value!='new']">
                                 <xforms:label ref="label[@language=instance('language')]"/>
                                 <xforms:value ref="@value"/>
                              </xforms:itemset>
                           </xforms:select>
                        </xhtml:td>
                        <xhtml:td class="item-label">
                           <xforms:output ref="concat($resources/type,': ')"/>
                        </xhtml:td>
                        <xhtml:td>
                           <xforms:select ref="instance('selected-issue-types')" appearance="full">
                              <xforms:itemset nodeset="instance('decor-types')/IssueType/enumeration">
                                 <xforms:label ref="label[@language=instance('language')]"/>
                                 <xforms:value ref="@value"/>
                              </xforms:itemset>
                           </xforms:select>
                        </xhtml:td>
                        <xhtml:td class="item-label">
                           <xforms:output ref="concat($resources/priority,': ')"/>
                        </xhtml:td>
                        <xhtml:td>
                           <xforms:select ref="instance('selected-issue-priorities')" appearance="full">
                              <xforms:itemset nodeset="instance('decor-types')/IssuePriority/enumeration">
                                 <xforms:label ref="label[@language=instance('language')]"/>
                                 <xforms:value ref="@value"/>
                              </xforms:itemset>
                           </xforms:select>
                        </xhtml:td>
                     </xhtml:tr>
                     <xhtml:tr>
                        <xhtml:td class="item-label">
                           <xforms:output ref="concat($resources/assigned-to,': ')"/>
                        </xhtml:td>
                        <xhtml:td colspan="5">
                           <xforms:select1 ref="instance('selected-issue-assignee')" class="auto-width" appearance="minimal">
                              <xforms:item>
                                 <xforms:label>-</xforms:label>
                                 <xforms:value/>
                              </xforms:item>
                              <xforms:itemset nodeset="distinct-values(instance('refset-issues')//issue[string-length(@lastAssignment)&gt;0]/@lastAssignment)">
                                 <xforms:label ref="."/>
                                 <xforms:value ref="."/>
                              </xforms:itemset>
                           </xforms:select1>
                        </xhtml:td>
                     </xhtml:tr>
                  </xhtml:table>
               </fr:case>
               <fr:case selected="true" id="result-box">
                  <fr:label ref="$resources/results"/>
                  <xhtml:table width="100%">
                     <!-- row with issues table -->
                     <xhtml:tr>
                        <xhtml:td>
                           <xhtml:div class="detail">
                              <fr:datatable width="100%" scrollable="vertical" height="200px">
                                 <xhtml:thead>
                                    <xhtml:tr>
                                       <xhtml:th fr:sortable="true" fr:resizeable="true">
                                          <xforms:output ref="$resources/issue"/>
                                       </xhtml:th>
                                       <xhtml:th fr:sortable="true" fr:sortKey="@currentStatusCode" fr:resizeable="true">
                                          <xforms:output ref="$resources/status"/>
                                       </xhtml:th>
                                       <xhtml:th fr:sortable="true" fr:sortKey="@priority" fr:resizeable="true">
                                          <xforms:output ref="$resources/priority"/>
                                       </xhtml:th>
                                       <xhtml:th fr:sortable="true" fr:resizeable="true">
                                          <xforms:output ref="$resources/type"/>
                                       </xhtml:th>
                                       <xhtml:th fr:sortable="true" fr:resizeable="true">
                                          <xforms:output ref="$resources/date"/>
                                       </xhtml:th>
                                       <xhtml:th fr:sortable="true" fr:sorted="ascending" fr:resizeable="true">
                                          <xforms:output ref="$resources/assigned-to"/>
                                       </xhtml:th>
                                    </xhtml:tr>
                                 </xhtml:thead>
                                 <xhtml:tbody>
                                    <xhtml:tr
                                       repeat-nodeset="instance('refset-issues')/issue[if (string-length(instance('selected-issue-id'))&gt;0) then (tokenize(@id,'\.')[last()]=instance('selected-issue-id')) else (@currentStatusCode=tokenize(instance('selected-status-codes'),' ') and @type=tokenize(instance('selected-issue-types'),' ') and (instance('selected-issue-priorities')='' or @priority=tokenize(instance('selected-issue-priorities'),' ')) and (instance('selected-issue-assignee')='' or @lastAssignment=instance('selected-issue-assignee')))]"
                                       id="open-issue-table">
                                       <xxforms:variable name="type" select="@type"/>
                                       <xhtml:td>
                                          <xforms:output ref="@displayName"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xxforms:variable name="currentStatusCode" select="@currentStatusCode"/>
                                          <xforms:output ref="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value=$currentStatusCode]/label[@language=instance('language')]"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xxforms:variable name="priority" select="@priority"/>
                                          <xforms:output ref="instance('decor-types')/IssuePriority/enumeration[@value=$priority]/label[@language=instance('language')]"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@typeName"/>
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@lastDate"
                                             xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (. castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                          />
                                       </xhtml:td>
                                       <xhtml:td>
                                          <xforms:output ref="@lastAssignment"/>
                                       </xhtml:td>
                                    </xhtml:tr>
                                 </xhtml:tbody>
                                 <xforms:action ev:event="fr-selection-changed">
                                    <xforms:setvalue ref="instance('selected-issue')/selected" value="event('selected')/@id"/>
                                 </xforms:action>
                              </fr:datatable>
                           </xhtml:div>
                        </xhtml:td>
                     </xhtml:tr>
                  </xhtml:table>
               </fr:case>
            </fr:accordion>
            <xhtml:table width="100%">
               <!-- row with issue details -->
               <xhtml:tr>
                  <xhtml:td>
                     <xhtml:div class="detail">
                        <xforms:group ref="instance('refset-issues')/issue[@id=instance('selected-issue')/selected]">
                           <xhtml:table width="100%">
                              <!-- row with issue header -->
                              <xhtml:tr>
                                 <xhtml:td class="heading" colspan="2">
                                    <xhtml:div class="heading">
                                       <xforms:output ref="@typeName"/>: 
                                     <xforms:output ref="@displayName"/>
                                    </xhtml:div>
                                 </xhtml:td>
                              </xhtml:tr>
                              <xhtml:tr>
                                 <xhtml:td class="item-label">
                                    <xforms:output ref="$resources/priority"/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xxforms:variable name="priority" select="@priority"/>
                                    <xforms:output ref="instance('decor-types')/IssuePriority/enumeration[@value=$priority]/label[@language=instance('language')]"/>
                                 </xhtml:td>
                              </xhtml:tr>
                              <xhtml:tr>
                                 <xhtml:td class="item-label">
                                    <xforms:output ref="$resources/status"/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xxforms:variable name="statusCode" select="@currentStatusCode"/>
                                    <xforms:output ref="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value=$statusCode]/label[@language=instance('language')]"/>
                                 </xhtml:td>
                              </xhtml:tr>
                              <!-- issue objects -->
                              <xhtml:tr>
                                 <xhtml:td class="item-label">
                                    <xforms:output ref="$resources/concerns"/>
                                 </xhtml:td>
                                 <xhtml:td>
                                    <xforms:group ref="instance('refset')/members/member[@id=instance('refset-issues')/issue[@id=instance('selected-issue')/selected]/object/@id]">
                                       <xhtml:table class="detail" width="100%">
                                          <!-- heading -->
                                          <xhtml:tr>
                                             <xhtml:td class="heading" colspan="4">
                                                <xhtml:div class="heading">
                                                   <xforms:output ref="originalText"/>
                                                </xhtml:div>
                                                <xhtml:div class="buttons">
                                                   <fr:button>
                                                      <xforms:label>
                                                         <xforms:output ref="$resources/show-in-refset"/>
                                                      </xforms:label>
                                                      <xforms:action ev:event="DOMActivate">
                                                         <xxforms:variable name="user" select="xxforms:get-session-attribute('username')"/>
                                                         <xforms:setvalue ref="instance('member-navigation')"
                                                            value="instance('refset-issues')/issue[@id=instance('selected-issue')/selected]/object/@id"/>
                                                         <xforms:dispatch targetid="refset-tab" name="fr-toggle"/>
                                                         <xforms:setfocus control="memberNavigation"/>
                                                      </xforms:action>
                                                   </fr:button>
                                                </xhtml:div>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <!-- status and effectiveTime -->
                                          <xhtml:tr>
                                             <xhtml:td class="item-label">
                                                <xforms:output ref="$resources/status"/>
                                             </xhtml:td>
                                             <xhtml:td>
                                                <xxforms:variable name="statusCode" select="@statusCode"/>
                                                <xforms:output ref="instance('decor-types')/ItemStatusCodeLifeCycle/enumeration[@value=$statusCode]/label[@language=instance('language')]"/>
                                             </xhtml:td>
                                             <xhtml:td class="item-label">
                                                <xforms:output ref="$resources/date"/>
                                             </xhtml:td>
                                             <xhtml:td>
                                                <xforms:output ref="@effectiveTime"
                                                   xxforms:format="if (instance('language')='en-US' and . castable as xs:date) then format-date(.,'[M01]/[D01]/[Y]') else if (. castable as xs:date) then format-date(.,'[D01]-[M01]-[Y]') else ."
                                                />
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <!-- original text -->
                                          <xhtml:tr>
                                             <xhtml:td class="item-label">
                                                <xforms:output ref="$resources/original-text"/>
                                             </xhtml:td>
                                             <xhtml:td colspan="3">
                                                <xforms:output ref="originalText"/>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <xhtml:tr>
                                             <xhtml:td class="item-label">
                                                <xforms:output ref="$resources/translation"/>
                                             </xhtml:td>
                                             <xhtml:td colspan="3">
                                                <xforms:group ref=".[not(edit)]">
                                                   <xforms:output ref="translation[@language=instance('language')]"/>
                                                </xforms:group>
                                                <xforms:group ref=".[edit]">
                                                   <xforms:input ref="translation[@language=instance('language')]" style="width:40em;"/>
                                                </xforms:group>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <!-- concept id -->
                                          <xhtml:tr>
                                             <xhtml:td class="item-label">
                                                <xforms:output ref="$resources/id"/>
                                             </xhtml:td>
                                             <xhtml:td colspan="3">
                                                <xforms:output ref="referencedComponent/@id"/>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <!-- concept full name -->
                                          <xhtml:tr>
                                             <xhtml:td class="item-label">
                                                <xforms:output ref="$resources/full-name"/>
                                             </xhtml:td>
                                             <xhtml:td colspan="3">
                                                <xforms:output ref="referencedComponent/description[1]/@fullName"/>
                                             </xhtml:td>
                                          </xhtml:tr>
                                       </xhtml:table>
                                    </xforms:group>
                                 </xhtml:td>
                              </xhtml:tr>
                              <!-- issue trackings and assignments header with buttons -->
                              <xhtml:tr>
                                 <xhtml:td class="heading" colspan="2">
                                    <xhtml:div class="heading">
                                       <xforms:output ref="$resources/events"/>
                                    </xhtml:div>
                                    <xforms:group ref=".[$issueCreator]">
                                       <xhtml:div class="buttons">
                                          <fr:button>
                                             <xforms:label>
                                                <xhtml:img src="/img/tracking.png" alt=""/>
                                             </xforms:label>
                                             <xforms:hint>
                                                <xforms:output ref="$resources/add"/>
                                             </xforms:hint>
                                             <xforms:action ev:event="DOMActivate">
                                                <xxforms:variable name="user" select="xxforms:get-session-attribute('username')"/>
                                                <xforms:setvalue ref="instance('tracking-instance')/tracking/author/@id" value="instance('refset-project')/author[@username=$user]/@id"/>
                                                <xforms:setvalue ref="instance('tracking-instance')/tracking/author" value="instance('refset-project')/author[@username=$user]"/>
                                                <xforms:setvalue ref="instance('tracking-instance')/tracking/desc/@language" value="instance('language')"/>
                                                <xforms:insert context="instance('refset-issues')/issue[@id=instance('selected-issue')/selected]" nodeset="*" at="last()" position="after"
                                                   origin="instance('tracking-instance')/tracking"/>
                                                <xforms:setfocus control="tracking-description"/>
                                             </xforms:action>
                                          </fr:button>
                                          <fr:button>
                                             <xforms:label>
                                                <xhtml:img src="/img/arrowright.png" alt=""/>
                                             </xforms:label>
                                             <xforms:hint>
                                                <xforms:output ref="$resources/assign"/>
                                             </xforms:hint>
                                             <xforms:action ev:event="DOMActivate">
                                                <xxforms:variable name="user" select="xxforms:get-session-attribute('username')"/>
                                                <xforms:setvalue ref="instance('assignment-instance')/assignment/author/@id" value="instance('refset-project')/author[@username=$user]/@id"/>
                                                <xforms:setvalue ref="instance('assignment-instance')/assignment/@to" value="instance('refset-project')/author[@username=$user]/@id"/>
                                                <xforms:setvalue ref="instance('assignment-instance')/assignment/author" value="instance('refset-project')/author[@username=$user]"/>
                                                <xforms:setvalue ref="instance('assignment-instance')/assignment/@name" value="instance('refset-project')/author[@username=$user]"/>
                                                <xforms:setvalue ref="instance('assignment-instance')/assignment/desc/@language" value="instance('language')"/>
                                                <xforms:insert context="instance('refset-issues')/issue[@id=instance('selected-issue')/selected]" nodeset="*" at="last()" position="after"
                                                   origin="instance('assignment-instance')/assignment"/>
                                                <xforms:setfocus control="assignment-description"/>
                                             </xforms:action>
                                          </fr:button>
                                       </xhtml:div>
                                    </xforms:group>
                                 </xhtml:td>
                              </xhtml:tr>
                              <!-- tracking and assignment editor -->
                              <xhtml:tr>
                                 <xhtml:td colspan="2">
                                    <!-- new tracking editor -->
                                    <xforms:group ref="instance('refset-issues')/issue[@id=instance('selected-issue')/selected]/tracking[string-length(@effectiveDate)=0]">
                                       <xhtml:table width="100%">
                                          <!-- trackings -->
                                          <xhtml:tr>
                                             <xhtml:td class="item-label">
                                                <xforms:output ref="$resources/new-event"/>
                                             </xhtml:td>
                                             <xhtml:td>
                                                <xhtml:table width="100%">
                                                   <!-- tracking type -->
                                                   <xhtml:tr>
                                                      <xhtml:td class="item-label">
                                                         <xforms:output ref="$resources/issue-status"/>
                                                      </xhtml:td>
                                                      <xhtml:td>
                                                         <fr:select1-button ref="@statusCode" appearance="minimal">
                                                            <xforms:itemset nodeset="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration">
                                                               <xforms:label ref="label[@language=instance('language')]"/>
                                                               <xforms:value ref="@value"/>
                                                            </xforms:itemset>
                                                         </fr:select1-button>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                   <!-- description of tracking -->
                                                   <xhtml:tr>
                                                      <xhtml:td class="item-label">
                                                         <xforms:output ref="$resources/description"/>
                                                      </xhtml:td>
                                                      <xhtml:td>
                                                         <xforms:textarea id="tracking-description" mediatype="text/html" ref="desc[@language=instance('language')]"/>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                   <!-- save and cancel buttons -->
                                                   <xhtml:tr>
                                                      <xhtml:td class="item-label" colspan="2">
                                                         <xhtml:div class="buttons">
                                                            <fr:button>
                                                               <xforms:label ref="$resources/cancel"/>
                                                               <xforms:action ev:event="DOMActivate">
                                                                  <xforms:delete
                                                                     ref="instance('refset-issues')/issue/tracking[../@id=instance('selected-issue')/selected and string-length(@effectiveDate)=0]"/>
                                                               </xforms:action>
                                                            </fr:button>
                                                            <fr:button>
                                                               <xforms:label ref="$resources/save-tracking"/>
                                                               <xforms:action ev:event="DOMActivate">
                                                                  <xxforms:variable name="currentIssue" select="instance('selected-issue')/selected"/>
                                                                  <xforms:setvalue
                                                                     ref="instance('refset-issues')/issue/tracking[../@id=instance('selected-issue')/selected and string-length(@effectiveDate)=0]/@effectiveDate"
                                                                     value="format-dateTime(current-dateTime(), '[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01]')"/>
                                                                  <xforms:send submission="update-refset-issue"/>
                                                                  <xforms:send submission="get-refset-issues"/>
                                                               </xforms:action>
                                                            </fr:button>
                                                         </xhtml:div>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                </xhtml:table>
                                             </xhtml:td>
                                          </xhtml:tr>
                                       </xhtml:table>
                                    </xforms:group>
                                    <!-- new assignment editor -->
                                    <xforms:group ref="instance('refset-issues')/issue[@id=instance('selected-issue')/selected]/assignment[@effectiveDate/string-length()=0]">
                                       <xhtml:table width="100%">
                                          <!-- assignment -->
                                          <xhtml:tr>
                                             <xhtml:td class="item-label">
                                                <xforms:output ref="$resources/new-assignment"/>
                                             </xhtml:td>
                                             <xhtml:td>
                                                <xhtml:table width="100%">
                                                   <!-- assign to -->
                                                   <xhtml:tr>
                                                      <xhtml:td class="item-label">
                                                         <xforms:output ref="$resources/assign-to"/>
                                                      </xhtml:td>
                                                      <xhtml:td>
                                                         <fr:select1-button ref="@to" appearance="minimal">
                                                            <xforms:itemset nodeset="instance('refset-project')/author">
                                                               <xforms:label ref="."/>
                                                               <xforms:value ref="@id"/>
                                                            </xforms:itemset>
                                                            <xforms:action ev:event="xforms-value-changed">
                                                               <xxforms:variable name="id"
                                                                  select="instance('refset-issues')/issue/assignment[../@id=instance('selected-issue')/selected and @effectiveDate/string-length()=0]/@to"/>
                                                               <xforms:setvalue
                                                                  ref="instance('refset-issues')/issue/assignment[../@id=instance('selected-issue')/selected and @effectiveDate/string-length()=0]/@name"
                                                                  value="instance('refset-project')/author[@id=$id]"/>
                                                            </xforms:action>
                                                         </fr:select1-button>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                   <!-- description of assignment -->
                                                   <xhtml:tr>
                                                      <xhtml:td class="item-label">
                                                         <xforms:output ref="$resources/description"/>
                                                      </xhtml:td>
                                                      <xhtml:td>
                                                         <xforms:textarea id="assignment-description" mediatype="text/html" ref="desc[@language=instance('language')]"/>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                   <!-- save and cancel buttons -->
                                                   <xhtml:tr>
                                                      <xhtml:td class="item-label" colspan="2">
                                                         <xhtml:div class="buttons">
                                                            <fr:button>
                                                               <xforms:label ref="$resources/cancel"/>
                                                               <xforms:action ev:event="DOMActivate">
                                                                  <xforms:delete
                                                                     ref="instance('refset-issues')/issue/assignment[../@id=instance('selected-issue')/selected and string-length(@effectiveDate)=0]"/>
                                                               </xforms:action>
                                                            </fr:button>
                                                            <fr:button>
                                                               <xforms:label ref="$resources/assign"/>
                                                               <xforms:action ev:event="DOMActivate">
                                                                  <xforms:setvalue
                                                                     ref="instance('refset-issues')/issue/assignment[../@id=instance('selected-issue')/selected and string-length(@effectiveDate)=0]/@effectiveDate"
                                                                     value="format-dateTime(current-dateTime(), '[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01]')"/>
                                                                  <xforms:send submission="update-refset-issue"/>
                                                                  <xforms:send submission="get-refset-issues"/>
                                                               </xforms:action>
                                                            </fr:button>
                                                         </xhtml:div>
                                                      </xhtml:td>
                                                   </xhtml:tr>
                                                </xhtml:table>
                                             </xhtml:td>
                                          </xhtml:tr>
                                       </xhtml:table>
                                    </xforms:group>
                                 </xhtml:td>
                              </xhtml:tr>
                              <!-- trackings and assignments -->
                              <xhtml:tr>
                                 <xhtml:td colspan="2">
                                    <xhtml:table width="100%">
                                       <xforms:repeat nodeset="tracking[string-length(@effectiveDate)&gt;0]|assignment[string-length(@effectiveDate)&gt;0]">
                                          <xhtml:tr class="not-selectable">
                                             <xhtml:td class="item-label-var" width="5%">
                                                <xforms:group ref=".[name()='assignment']">
                                                   <xforms:output mediatype="image/*" value="'/img/arrowright.png'">
                                                      <xforms:hint ref="$resources/assignment"/>
                                                   </xforms:output>
                                                </xforms:group>
                                                <xforms:group ref=".[name()='tracking']">
                                                   <xforms:output mediatype="image/*" value="'/img/tracking.png'">
                                                      <xforms:hint ref="$resources/tracking"/>
                                                   </xforms:output>
                                                </xforms:group>
                                             </xhtml:td>
                                             <xhtml:td class="item-label-var" width="10%">
                                                <xforms:group ref="@statusCode">
                                                   <xxforms:variable name="status" select="."/>
                                                   <!--
                                                            <xforms:output ref="$resources/issue-status"/>
                                                            <xforms:output ref="': '"/>
                                                            -->
                                                   <xforms:output mediatype="image/*" value="concat('/img/IssueStatusCodeLifeCycle_',.,'.png')">
                                                      <xforms:hint>
                                                         <xforms:output ref="$resources/status"/> = 
                                                                    <xforms:output
                                                            ref="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value=$status]/label[@language=instance('language')]"/>
                                                      </xforms:hint>
                                                   </xforms:output>
                                                   <xforms:output ref="instance('decor-types')/IssueStatusCodeLifeCycle/enumeration[@value=$status]/label[@language=instance('language')]"/>
                                                </xforms:group>
                                             </xhtml:td>
                                             <xhtml:td class="heading-var" width="85%">

                                                <!-- date -->
                                                <xforms:output ref="@effectiveDate" xxforms:format="format-dateTime(xs:dateTime(.),'[Y]-[M01]-[D01]', (), (), ())"/>
                                                <xforms:output ref="': '"/>

                                                <!-- assignment to: -->
                                                <xforms:group ref=".[name()='assignment']">
                                                   <xforms:output ref="$resources/assigned-to"/>
                                                   <xforms:output ref="@name"/>
                                                </xforms:group>

                                                <!-- tracking -->
                                                <xforms:group ref=".[name()='tracking']">
                                                   <xforms:output ref="$resources/tracking"/>
                                                </xforms:group>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <xhtml:tr class="not-selectable">
                                             <xhtml:td class="item-label-var" width="5%">
                                                <xforms:output ref="$resources/author"/>
                                             </xhtml:td>
                                             <xhtml:td class="item-label-var" width="5%">
                                                <xforms:output ref="author"/>
                                             </xhtml:td>
                                             <xhtml:td class="desc-var">
                                                <xforms:output mediatype="text/html" ref="desc"/>
                                             </xhtml:td>
                                          </xhtml:tr>
                                          <xhtml:tr class="not-selectable">
                                             <xhtml:td colspan="3"/>
                                          </xhtml:tr>
                                       </xforms:repeat>
                                    </xhtml:table>
                                 </xhtml:td>
                              </xhtml:tr>
                           </xhtml:table>
                        </xforms:group>
                     </xhtml:div>
                  </xhtml:td>
               </xhtml:tr>
            </xhtml:table>
         </fr:tab>
      </fr:tabview>
   </xhtml:body>
</xhtml:html>
